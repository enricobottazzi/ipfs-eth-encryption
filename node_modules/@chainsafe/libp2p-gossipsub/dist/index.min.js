(function (root, factory) {(typeof module === 'object' && module.exports) ? module.exports = factory() : root.ChainsafeLibp2PGossipsub = factory()}(typeof self !== 'undefined' ? self : this, function () {
var ChainsafeLibp2PGossipsub=(()=>{var Qp=Object.create;var Oi=Object.defineProperty;var Jp=Object.getOwnPropertyDescriptor;var ed=Object.getOwnPropertyNames;var td=Object.getPrototypeOf,rd=Object.prototype.hasOwnProperty;var L=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),Ge=(t,e)=>{for(var r in e)Oi(t,r,{get:e[r],enumerable:!0})},Hc=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of ed(e))!rd.call(t,i)&&i!==r&&Oi(t,i,{get:()=>e[i],enumerable:!(n=Jp(e,i))||n.enumerable});return t};var O=(t,e,r)=>(r=t!=null?Qp(td(t)):{},Hc(e||!t||!t.__esModule?Oi(r,"default",{value:t,enumerable:!0}):r,t)),nd=t=>Hc(Oi({},"__esModule",{value:!0}),t);var $c=L((fE,Wc)=>{Wc.exports=class{constructor(e){if(!(e>0)||(e-1&e)!==0)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){let e=this.buffer[this.btm];if(e!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}peek(){return this.buffer[this.btm]}isEmpty(){return this.buffer[this.btm]===void 0}}});var jc=L((lE,Zc)=>{var Yc=$c();Zc.exports=class{constructor(e){this.hwm=e||16,this.head=new Yc(this.hwm),this.tail=this.head}push(e){if(!this.head.push(e)){let r=this.head;this.head=r.next=new Yc(2*this.head.buffer.length),this.head.push(e)}}shift(){let e=this.tail.shift();if(e===void 0&&this.tail.next){let r=this.tail.next;return this.tail.next=null,this.tail=r,this.tail.shift()}return e}peek(){return this.tail.peek()}isEmpty(){return this.head.isEmpty()}}});var Qc=L((pE,Xc)=>{var yo=jc();Xc.exports=t=>{t=t||{};let e;typeof t=="function"?(e=t,t={}):e=t.onEnd;let r=new yo,n,i,s,o=()=>{if(!r.isEmpty()){if(t.writev){let d,m=[];for(;!r.isEmpty();){if(d=r.shift(),d.error)throw d.error;m.push(d.value)}return{done:d.done,value:m}}let p=r.shift();if(p.error)throw p.error;return p}return s?{done:!0}:new Promise((p,d)=>{i=m=>(i=null,m.error?d(m.error):t.writev&&!m.done?p({done:m.done,value:[m.value]}):p(m),n)})},a=p=>i?i(p):(r.push(p),n),c=p=>(r=new yo,i?i({error:p}):(r.push({error:p}),n)),u=p=>s?n:a({done:!1,value:p}),f=p=>s?n:(s=!0,p?c(p):a({done:!0})),h=()=>(r=new yo,f(),{done:!0}),l=p=>(f(p),{done:!0});if(n={[Symbol.asyncIterator](){return this},next:o,return:h,throw:l,push:u,end:f},!e)return n;let g=n;return n={[Symbol.asyncIterator](){return this},next(){return g.next()},throw(p){return g.throw(p),e&&(e(p),e=null),{done:!0}},return(){return g.return(),e&&(e(),e=null),{done:!0}},push:u,end(p){return g.end(p),e&&(e(p),e=null),n}},n}});var eu=L((dE,Jc)=>{"use strict";var sd=Qc(),od=async function*(...t){let e=sd();setTimeout(async()=>{try{await Promise.all(t.map(async r=>{for await(let n of r)e.push(n)})),e.end()}catch(r){e.end(r)}},0),yield*e};Jc.exports=od});var De=L((mE,iu)=>{"use strict";function nu(t,e){for(let r in e)Object.defineProperty(t,r,{value:e[r],enumerable:!0,configurable:!0});return t}function ud(t,e,r){if(!t||typeof t=="string")throw new TypeError("Please pass an Error to err-code");r||(r={}),typeof e=="object"&&(r=e,e=""),e&&(r.code=e);try{return nu(t,r)}catch{r.message=t.message,r.stack=t.stack;let i=function(){};return i.prototype=Object.create(Object.getPrototypeOf(t)),nu(new i,r)}}iu.exports=ud});var ie=L((eA,Ku)=>{Ku.exports={options:{usePureJavaScript:!1}}});var zu=L((tA,Vu)=>{var Ko={};Vu.exports=Ko;var qu={};Ko.encode=function(t,e,r){if(typeof e!="string")throw new TypeError('"alphabet" must be a string.');if(r!==void 0&&typeof r!="number")throw new TypeError('"maxline" must be a number.');var n="";if(!(t instanceof Uint8Array))n=gy(t,e);else{var i=0,s=e.length,o=e.charAt(0),a=[0];for(i=0;i<t.length;++i){for(var c=0,u=t[i];c<a.length;++c)u+=a[c]<<8,a[c]=u%s,u=u/s|0;for(;u>0;)a.push(u%s),u=u/s|0}for(i=0;t[i]===0&&i<t.length-1;++i)n+=o;for(i=a.length-1;i>=0;--i)n+=e[a[i]]}if(r){var f=new RegExp(".{1,"+r+"}","g");n=n.match(f).join(`\r
`)}return n};Ko.decode=function(t,e){if(typeof t!="string")throw new TypeError('"input" must be a string.');if(typeof e!="string")throw new TypeError('"alphabet" must be a string.');var r=qu[e];if(!r){r=qu[e]=[];for(var n=0;n<e.length;++n)r[e.charCodeAt(n)]=n}t=t.replace(/\s/g,"");for(var i=e.length,s=e.charAt(0),o=[0],n=0;n<t.length;n++){var a=r[t.charCodeAt(n)];if(a===void 0)return;for(var c=0,u=a;c<o.length;++c)u+=o[c]*i,o[c]=u&255,u>>=8;for(;u>0;)o.push(u&255),u>>=8}for(var f=0;t[f]===s&&f<t.length-1;++f)o.push(0);return typeof Buffer<"u"?Buffer.from(o.reverse()):new Uint8Array(o.reverse())};function gy(t,e){var r=0,n=e.length,i=e.charAt(0),s=[0];for(r=0;r<t.length();++r){for(var o=0,a=t.at(r);o<s.length;++o)a+=s[o]<<8,s[o]=a%n,a=a/n|0;for(;a>0;)s.push(a%n),a=a/n|0}var c="";for(r=0;t.at(r)===0&&r<t.length()-1;++r)c+=i;for(r=s.length-1;r>=0;--r)c+=e[s[r]];return c}});var Re=L((rA,$u)=>{var Gu=ie(),Hu=zu(),y=$u.exports=Gu.util=Gu.util||{};(function(){if(typeof process<"u"&&process.nextTick&&!process.browser){y.nextTick=process.nextTick,typeof setImmediate=="function"?y.setImmediate=setImmediate:y.setImmediate=y.nextTick;return}if(typeof setImmediate=="function"){y.setImmediate=function(){return setImmediate.apply(void 0,arguments)},y.nextTick=function(a){return setImmediate(a)};return}if(y.setImmediate=function(a){setTimeout(a,0)},typeof window<"u"&&typeof window.postMessage=="function"){let a=function(c){if(c.source===window&&c.data===t){c.stopPropagation();var u=e.slice();e.length=0,u.forEach(function(f){f()})}};var o=a,t="forge.setImmediate",e=[];y.setImmediate=function(c){e.push(c),e.length===1&&window.postMessage(t,"*")},window.addEventListener("message",a,!0)}if(typeof MutationObserver<"u"){var r=Date.now(),n=!0,i=document.createElement("div"),e=[];new MutationObserver(function(){var c=e.slice();e.length=0,c.forEach(function(u){u()})}).observe(i,{attributes:!0});var s=y.setImmediate;y.setImmediate=function(c){Date.now()-r>15?(r=Date.now(),s(c)):(e.push(c),e.length===1&&i.setAttribute("a",n=!n))}}y.nextTick=y.setImmediate})();y.isNodejs=typeof process<"u"&&process.versions&&process.versions.node;y.globalScope=function(){return y.isNodejs?globalThis:typeof self>"u"?window:self}();y.isArray=Array.isArray||function(t){return Object.prototype.toString.call(t)==="[object Array]"};y.isArrayBuffer=function(t){return typeof ArrayBuffer<"u"&&t instanceof ArrayBuffer};y.isArrayBufferView=function(t){return t&&y.isArrayBuffer(t.buffer)&&t.byteLength!==void 0};function ei(t){if(!(t===8||t===16||t===24||t===32))throw new Error("Only 8, 16, 24, or 32 bits supported: "+t)}y.ByteBuffer=qo;function qo(t){if(this.data="",this.read=0,typeof t=="string")this.data=t;else if(y.isArrayBuffer(t)||y.isArrayBufferView(t))if(typeof Buffer<"u"&&t instanceof Buffer)this.data=t.toString("binary");else{var e=new Uint8Array(t);try{this.data=String.fromCharCode.apply(null,e)}catch{for(var r=0;r<e.length;++r)this.putByte(e[r])}}else(t instanceof qo||typeof t=="object"&&typeof t.data=="string"&&typeof t.read=="number")&&(this.data=t.data,this.read=t.read);this._constructedStringLength=0}y.ByteStringBuffer=qo;var yy=4096;y.ByteStringBuffer.prototype._optimizeConstructedString=function(t){this._constructedStringLength+=t,this._constructedStringLength>yy&&(this.data.substr(0,1),this._constructedStringLength=0)};y.ByteStringBuffer.prototype.length=function(){return this.data.length-this.read};y.ByteStringBuffer.prototype.isEmpty=function(){return this.length()<=0};y.ByteStringBuffer.prototype.putByte=function(t){return this.putBytes(String.fromCharCode(t))};y.ByteStringBuffer.prototype.fillWithByte=function(t,e){t=String.fromCharCode(t);for(var r=this.data;e>0;)e&1&&(r+=t),e>>>=1,e>0&&(t+=t);return this.data=r,this._optimizeConstructedString(e),this};y.ByteStringBuffer.prototype.putBytes=function(t){return this.data+=t,this._optimizeConstructedString(t.length),this};y.ByteStringBuffer.prototype.putString=function(t){return this.putBytes(y.encodeUtf8(t))};y.ByteStringBuffer.prototype.putInt16=function(t){return this.putBytes(String.fromCharCode(t>>8&255)+String.fromCharCode(t&255))};y.ByteStringBuffer.prototype.putInt24=function(t){return this.putBytes(String.fromCharCode(t>>16&255)+String.fromCharCode(t>>8&255)+String.fromCharCode(t&255))};y.ByteStringBuffer.prototype.putInt32=function(t){return this.putBytes(String.fromCharCode(t>>24&255)+String.fromCharCode(t>>16&255)+String.fromCharCode(t>>8&255)+String.fromCharCode(t&255))};y.ByteStringBuffer.prototype.putInt16Le=function(t){return this.putBytes(String.fromCharCode(t&255)+String.fromCharCode(t>>8&255))};y.ByteStringBuffer.prototype.putInt24Le=function(t){return this.putBytes(String.fromCharCode(t&255)+String.fromCharCode(t>>8&255)+String.fromCharCode(t>>16&255))};y.ByteStringBuffer.prototype.putInt32Le=function(t){return this.putBytes(String.fromCharCode(t&255)+String.fromCharCode(t>>8&255)+String.fromCharCode(t>>16&255)+String.fromCharCode(t>>24&255))};y.ByteStringBuffer.prototype.putInt=function(t,e){ei(e);var r="";do e-=8,r+=String.fromCharCode(t>>e&255);while(e>0);return this.putBytes(r)};y.ByteStringBuffer.prototype.putSignedInt=function(t,e){return t<0&&(t+=2<<e-1),this.putInt(t,e)};y.ByteStringBuffer.prototype.putBuffer=function(t){return this.putBytes(t.getBytes())};y.ByteStringBuffer.prototype.getByte=function(){return this.data.charCodeAt(this.read++)};y.ByteStringBuffer.prototype.getInt16=function(){var t=this.data.charCodeAt(this.read)<<8^this.data.charCodeAt(this.read+1);return this.read+=2,t};y.ByteStringBuffer.prototype.getInt24=function(){var t=this.data.charCodeAt(this.read)<<16^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2);return this.read+=3,t};y.ByteStringBuffer.prototype.getInt32=function(){var t=this.data.charCodeAt(this.read)<<24^this.data.charCodeAt(this.read+1)<<16^this.data.charCodeAt(this.read+2)<<8^this.data.charCodeAt(this.read+3);return this.read+=4,t};y.ByteStringBuffer.prototype.getInt16Le=function(){var t=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8;return this.read+=2,t};y.ByteStringBuffer.prototype.getInt24Le=function(){var t=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16;return this.read+=3,t};y.ByteStringBuffer.prototype.getInt32Le=function(){var t=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16^this.data.charCodeAt(this.read+3)<<24;return this.read+=4,t};y.ByteStringBuffer.prototype.getInt=function(t){ei(t);var e=0;do e=(e<<8)+this.data.charCodeAt(this.read++),t-=8;while(t>0);return e};y.ByteStringBuffer.prototype.getSignedInt=function(t){var e=this.getInt(t),r=2<<t-2;return e>=r&&(e-=r<<1),e};y.ByteStringBuffer.prototype.getBytes=function(t){var e;return t?(t=Math.min(this.length(),t),e=this.data.slice(this.read,this.read+t),this.read+=t):t===0?e="":(e=this.read===0?this.data:this.data.slice(this.read),this.clear()),e};y.ByteStringBuffer.prototype.bytes=function(t){return typeof t>"u"?this.data.slice(this.read):this.data.slice(this.read,this.read+t)};y.ByteStringBuffer.prototype.at=function(t){return this.data.charCodeAt(this.read+t)};y.ByteStringBuffer.prototype.setAt=function(t,e){return this.data=this.data.substr(0,this.read+t)+String.fromCharCode(e)+this.data.substr(this.read+t+1),this};y.ByteStringBuffer.prototype.last=function(){return this.data.charCodeAt(this.data.length-1)};y.ByteStringBuffer.prototype.copy=function(){var t=y.createBuffer(this.data);return t.read=this.read,t};y.ByteStringBuffer.prototype.compact=function(){return this.read>0&&(this.data=this.data.slice(this.read),this.read=0),this};y.ByteStringBuffer.prototype.clear=function(){return this.data="",this.read=0,this};y.ByteStringBuffer.prototype.truncate=function(t){var e=Math.max(0,this.length()-t);return this.data=this.data.substr(this.read,e),this.read=0,this};y.ByteStringBuffer.prototype.toHex=function(){for(var t="",e=this.read;e<this.data.length;++e){var r=this.data.charCodeAt(e);r<16&&(t+="0"),t+=r.toString(16)}return t};y.ByteStringBuffer.prototype.toString=function(){return y.decodeUtf8(this.bytes())};function my(t,e){e=e||{},this.read=e.readOffset||0,this.growSize=e.growSize||1024;var r=y.isArrayBuffer(t),n=y.isArrayBufferView(t);if(r||n){r?this.data=new DataView(t):this.data=new DataView(t.buffer,t.byteOffset,t.byteLength),this.write="writeOffset"in e?e.writeOffset:this.data.byteLength;return}this.data=new DataView(new ArrayBuffer(0)),this.write=0,t!=null&&this.putBytes(t),"writeOffset"in e&&(this.write=e.writeOffset)}y.DataBuffer=my;y.DataBuffer.prototype.length=function(){return this.write-this.read};y.DataBuffer.prototype.isEmpty=function(){return this.length()<=0};y.DataBuffer.prototype.accommodate=function(t,e){if(this.length()>=t)return this;e=Math.max(e||this.growSize,t);var r=new Uint8Array(this.data.buffer,this.data.byteOffset,this.data.byteLength),n=new Uint8Array(this.length()+e);return n.set(r),this.data=new DataView(n.buffer),this};y.DataBuffer.prototype.putByte=function(t){return this.accommodate(1),this.data.setUint8(this.write++,t),this};y.DataBuffer.prototype.fillWithByte=function(t,e){this.accommodate(e);for(var r=0;r<e;++r)this.data.setUint8(t);return this};y.DataBuffer.prototype.putBytes=function(t,e){if(y.isArrayBufferView(t)){var r=new Uint8Array(t.buffer,t.byteOffset,t.byteLength),n=r.byteLength-r.byteOffset;this.accommodate(n);var i=new Uint8Array(this.data.buffer,this.write);return i.set(r),this.write+=n,this}if(y.isArrayBuffer(t)){var r=new Uint8Array(t);this.accommodate(r.byteLength);var i=new Uint8Array(this.data.buffer);return i.set(r,this.write),this.write+=r.byteLength,this}if(t instanceof y.DataBuffer||typeof t=="object"&&typeof t.read=="number"&&typeof t.write=="number"&&y.isArrayBufferView(t.data)){var r=new Uint8Array(t.data.byteLength,t.read,t.length());this.accommodate(r.byteLength);var i=new Uint8Array(t.data.byteLength,this.write);return i.set(r),this.write+=r.byteLength,this}if(t instanceof y.ByteStringBuffer&&(t=t.data,e="binary"),e=e||"binary",typeof t=="string"){var s;if(e==="hex")return this.accommodate(Math.ceil(t.length/2)),s=new Uint8Array(this.data.buffer,this.write),this.write+=y.binary.hex.decode(t,s,this.write),this;if(e==="base64")return this.accommodate(Math.ceil(t.length/4)*3),s=new Uint8Array(this.data.buffer,this.write),this.write+=y.binary.base64.decode(t,s,this.write),this;if(e==="utf8"&&(t=y.encodeUtf8(t),e="binary"),e==="binary"||e==="raw")return this.accommodate(t.length),s=new Uint8Array(this.data.buffer,this.write),this.write+=y.binary.raw.decode(s),this;if(e==="utf16")return this.accommodate(t.length*2),s=new Uint16Array(this.data.buffer,this.write),this.write+=y.text.utf16.encode(s),this;throw new Error("Invalid encoding: "+e)}throw Error("Invalid parameter: "+t)};y.DataBuffer.prototype.putBuffer=function(t){return this.putBytes(t),t.clear(),this};y.DataBuffer.prototype.putString=function(t){return this.putBytes(t,"utf16")};y.DataBuffer.prototype.putInt16=function(t){return this.accommodate(2),this.data.setInt16(this.write,t),this.write+=2,this};y.DataBuffer.prototype.putInt24=function(t){return this.accommodate(3),this.data.setInt16(this.write,t>>8&65535),this.data.setInt8(this.write,t>>16&255),this.write+=3,this};y.DataBuffer.prototype.putInt32=function(t){return this.accommodate(4),this.data.setInt32(this.write,t),this.write+=4,this};y.DataBuffer.prototype.putInt16Le=function(t){return this.accommodate(2),this.data.setInt16(this.write,t,!0),this.write+=2,this};y.DataBuffer.prototype.putInt24Le=function(t){return this.accommodate(3),this.data.setInt8(this.write,t>>16&255),this.data.setInt16(this.write,t>>8&65535,!0),this.write+=3,this};y.DataBuffer.prototype.putInt32Le=function(t){return this.accommodate(4),this.data.setInt32(this.write,t,!0),this.write+=4,this};y.DataBuffer.prototype.putInt=function(t,e){ei(e),this.accommodate(e/8);do e-=8,this.data.setInt8(this.write++,t>>e&255);while(e>0);return this};y.DataBuffer.prototype.putSignedInt=function(t,e){return ei(e),this.accommodate(e/8),t<0&&(t+=2<<e-1),this.putInt(t,e)};y.DataBuffer.prototype.getByte=function(){return this.data.getInt8(this.read++)};y.DataBuffer.prototype.getInt16=function(){var t=this.data.getInt16(this.read);return this.read+=2,t};y.DataBuffer.prototype.getInt24=function(){var t=this.data.getInt16(this.read)<<8^this.data.getInt8(this.read+2);return this.read+=3,t};y.DataBuffer.prototype.getInt32=function(){var t=this.data.getInt32(this.read);return this.read+=4,t};y.DataBuffer.prototype.getInt16Le=function(){var t=this.data.getInt16(this.read,!0);return this.read+=2,t};y.DataBuffer.prototype.getInt24Le=function(){var t=this.data.getInt8(this.read)^this.data.getInt16(this.read+1,!0)<<8;return this.read+=3,t};y.DataBuffer.prototype.getInt32Le=function(){var t=this.data.getInt32(this.read,!0);return this.read+=4,t};y.DataBuffer.prototype.getInt=function(t){ei(t);var e=0;do e=(e<<8)+this.data.getInt8(this.read++),t-=8;while(t>0);return e};y.DataBuffer.prototype.getSignedInt=function(t){var e=this.getInt(t),r=2<<t-2;return e>=r&&(e-=r<<1),e};y.DataBuffer.prototype.getBytes=function(t){var e;return t?(t=Math.min(this.length(),t),e=this.data.slice(this.read,this.read+t),this.read+=t):t===0?e="":(e=this.read===0?this.data:this.data.slice(this.read),this.clear()),e};y.DataBuffer.prototype.bytes=function(t){return typeof t>"u"?this.data.slice(this.read):this.data.slice(this.read,this.read+t)};y.DataBuffer.prototype.at=function(t){return this.data.getUint8(this.read+t)};y.DataBuffer.prototype.setAt=function(t,e){return this.data.setUint8(t,e),this};y.DataBuffer.prototype.last=function(){return this.data.getUint8(this.write-1)};y.DataBuffer.prototype.copy=function(){return new y.DataBuffer(this)};y.DataBuffer.prototype.compact=function(){if(this.read>0){var t=new Uint8Array(this.data.buffer,this.read),e=new Uint8Array(t.byteLength);e.set(t),this.data=new DataView(e),this.write-=this.read,this.read=0}return this};y.DataBuffer.prototype.clear=function(){return this.data=new DataView(new ArrayBuffer(0)),this.read=this.write=0,this};y.DataBuffer.prototype.truncate=function(t){return this.write=Math.max(0,this.length()-t),this.read=Math.min(this.read,this.write),this};y.DataBuffer.prototype.toHex=function(){for(var t="",e=this.read;e<this.data.byteLength;++e){var r=this.data.getUint8(e);r<16&&(t+="0"),t+=r.toString(16)}return t};y.DataBuffer.prototype.toString=function(t){var e=new Uint8Array(this.data,this.read,this.length());if(t=t||"utf8",t==="binary"||t==="raw")return y.binary.raw.encode(e);if(t==="hex")return y.binary.hex.encode(e);if(t==="base64")return y.binary.base64.encode(e);if(t==="utf8")return y.text.utf8.decode(e);if(t==="utf16")return y.text.utf16.decode(e);throw new Error("Invalid encoding: "+t)};y.createBuffer=function(t,e){return e=e||"raw",t!==void 0&&e==="utf8"&&(t=y.encodeUtf8(t)),new y.ByteBuffer(t)};y.fillString=function(t,e){for(var r="";e>0;)e&1&&(r+=t),e>>>=1,e>0&&(t+=t);return r};y.xorBytes=function(t,e,r){for(var n="",i="",s="",o=0,a=0;r>0;--r,++o)i=t.charCodeAt(o)^e.charCodeAt(o),a>=10&&(n+=s,s="",a=0),s+=String.fromCharCode(i),++a;return n+=s,n};y.hexToBytes=function(t){var e="",r=0;for(t.length&!0&&(r=1,e+=String.fromCharCode(parseInt(t[0],16)));r<t.length;r+=2)e+=String.fromCharCode(parseInt(t.substr(r,2),16));return e};y.bytesToHex=function(t){return y.createBuffer(t).toHex()};y.int32ToBytes=function(t){return String.fromCharCode(t>>24&255)+String.fromCharCode(t>>16&255)+String.fromCharCode(t>>8&255)+String.fromCharCode(t&255)};var fr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",hr=[62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,64,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51],Wu="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";y.encode64=function(t,e){for(var r="",n="",i,s,o,a=0;a<t.length;)i=t.charCodeAt(a++),s=t.charCodeAt(a++),o=t.charCodeAt(a++),r+=fr.charAt(i>>2),r+=fr.charAt((i&3)<<4|s>>4),isNaN(s)?r+="==":(r+=fr.charAt((s&15)<<2|o>>6),r+=isNaN(o)?"=":fr.charAt(o&63)),e&&r.length>e&&(n+=r.substr(0,e)+`\r
`,r=r.substr(e));return n+=r,n};y.decode64=function(t){t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");for(var e="",r,n,i,s,o=0;o<t.length;)r=hr[t.charCodeAt(o++)-43],n=hr[t.charCodeAt(o++)-43],i=hr[t.charCodeAt(o++)-43],s=hr[t.charCodeAt(o++)-43],e+=String.fromCharCode(r<<2|n>>4),i!==64&&(e+=String.fromCharCode((n&15)<<4|i>>2),s!==64&&(e+=String.fromCharCode((i&3)<<6|s)));return e};y.encodeUtf8=function(t){return unescape(encodeURIComponent(t))};y.decodeUtf8=function(t){return decodeURIComponent(escape(t))};y.binary={raw:{},hex:{},base64:{},base58:{},baseN:{encode:Hu.encode,decode:Hu.decode}};y.binary.raw.encode=function(t){return String.fromCharCode.apply(null,t)};y.binary.raw.decode=function(t,e,r){var n=e;n||(n=new Uint8Array(t.length)),r=r||0;for(var i=r,s=0;s<t.length;++s)n[i++]=t.charCodeAt(s);return e?i-r:n};y.binary.hex.encode=y.bytesToHex;y.binary.hex.decode=function(t,e,r){var n=e;n||(n=new Uint8Array(Math.ceil(t.length/2))),r=r||0;var i=0,s=r;for(t.length&1&&(i=1,n[s++]=parseInt(t[0],16));i<t.length;i+=2)n[s++]=parseInt(t.substr(i,2),16);return e?s-r:n};y.binary.base64.encode=function(t,e){for(var r="",n="",i,s,o,a=0;a<t.byteLength;)i=t[a++],s=t[a++],o=t[a++],r+=fr.charAt(i>>2),r+=fr.charAt((i&3)<<4|s>>4),isNaN(s)?r+="==":(r+=fr.charAt((s&15)<<2|o>>6),r+=isNaN(o)?"=":fr.charAt(o&63)),e&&r.length>e&&(n+=r.substr(0,e)+`\r
`,r=r.substr(e));return n+=r,n};y.binary.base64.decode=function(t,e,r){var n=e;n||(n=new Uint8Array(Math.ceil(t.length/4)*3)),t=t.replace(/[^A-Za-z0-9\+\/\=]/g,""),r=r||0;for(var i,s,o,a,c=0,u=r;c<t.length;)i=hr[t.charCodeAt(c++)-43],s=hr[t.charCodeAt(c++)-43],o=hr[t.charCodeAt(c++)-43],a=hr[t.charCodeAt(c++)-43],n[u++]=i<<2|s>>4,o!==64&&(n[u++]=(s&15)<<4|o>>2,a!==64&&(n[u++]=(o&3)<<6|a));return e?u-r:n.subarray(0,u)};y.binary.base58.encode=function(t,e){return y.binary.baseN.encode(t,Wu,e)};y.binary.base58.decode=function(t,e){return y.binary.baseN.decode(t,Wu,e)};y.text={utf8:{},utf16:{}};y.text.utf8.encode=function(t,e,r){t=y.encodeUtf8(t);var n=e;n||(n=new Uint8Array(t.length)),r=r||0;for(var i=r,s=0;s<t.length;++s)n[i++]=t.charCodeAt(s);return e?i-r:n};y.text.utf8.decode=function(t){return y.decodeUtf8(String.fromCharCode.apply(null,t))};y.text.utf16.encode=function(t,e,r){var n=e;n||(n=new Uint8Array(t.length*2));var i=new Uint16Array(n.buffer);r=r||0;for(var s=r,o=r,a=0;a<t.length;++a)i[o++]=t.charCodeAt(a),s+=2;return e?s-r:n};y.text.utf16.decode=function(t){return String.fromCharCode.apply(null,new Uint16Array(t.buffer))};y.deflate=function(t,e,r){if(e=y.decode64(t.deflate(y.encode64(e)).rval),r){var n=2,i=e.charCodeAt(1);i&32&&(n=6),e=e.substring(n,e.length-4)}return e};y.inflate=function(t,e,r){var n=t.inflate(y.encode64(e)).rval;return n===null?null:y.decode64(n)};var Vo=function(t,e,r){if(!t)throw new Error("WebStorage not available.");var n;if(r===null?n=t.removeItem(e):(r=y.encode64(JSON.stringify(r)),n=t.setItem(e,r)),typeof n<"u"&&n.rval!==!0){var i=new Error(n.error.message);throw i.id=n.error.id,i.name=n.error.name,i}},zo=function(t,e){if(!t)throw new Error("WebStorage not available.");var r=t.getItem(e);if(t.init)if(r.rval===null){if(r.error){var n=new Error(r.error.message);throw n.id=r.error.id,n.name=r.error.name,n}r=null}else r=r.rval;return r!==null&&(r=JSON.parse(y.decode64(r))),r},vy=function(t,e,r,n){var i=zo(t,e);i===null&&(i={}),i[r]=n,Vo(t,e,i)},by=function(t,e,r){var n=zo(t,e);return n!==null&&(n=r in n?n[r]:null),n},wy=function(t,e,r){var n=zo(t,e);if(n!==null&&r in n){delete n[r];var i=!0;for(var s in n){i=!1;break}i&&(n=null),Vo(t,e,n)}},xy=function(t,e){Vo(t,e,null)},Qi=function(t,e,r){var n=null;typeof r>"u"&&(r=["web","flash"]);var i,s=!1,o=null;for(var a in r){i=r[a];try{if(i==="flash"||i==="both"){if(e[0]===null)throw new Error("Flash local storage not available.");n=t.apply(this,e),s=i==="flash"}(i==="web"||i==="both")&&(e[0]=localStorage,n=t.apply(this,e),s=!0)}catch(c){o=c}if(s)break}if(!s)throw o;return n};y.setItem=function(t,e,r,n,i){Qi(vy,arguments,i)};y.getItem=function(t,e,r,n){return Qi(by,arguments,n)};y.removeItem=function(t,e,r,n){Qi(wy,arguments,n)};y.clearItems=function(t,e,r){Qi(xy,arguments,r)};y.isEmpty=function(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0};y.format=function(t){for(var e=/%./g,r,n,i=0,s=[],o=0;r=e.exec(t);){n=t.substring(o,e.lastIndex-2),n.length>0&&s.push(n),o=e.lastIndex;var a=r[0][1];switch(a){case"s":case"o":i<arguments.length?s.push(arguments[i+++1]):s.push("<?>");break;case"%":s.push("%");break;default:s.push("<%"+a+"?>")}}return s.push(t.substring(o)),s.join("")};y.formatNumber=function(t,e,r,n){var i=t,s=isNaN(e=Math.abs(e))?2:e,o=r===void 0?",":r,a=n===void 0?".":n,c=i<0?"-":"",u=parseInt(i=Math.abs(+i||0).toFixed(s),10)+"",f=u.length>3?u.length%3:0;return c+(f?u.substr(0,f)+a:"")+u.substr(f).replace(/(\d{3})(?=\d)/g,"$1"+a)+(s?o+Math.abs(i-u).toFixed(s).slice(2):"")};y.formatSize=function(t){return t>=1073741824?t=y.formatNumber(t/1073741824,2,".","")+" GiB":t>=1048576?t=y.formatNumber(t/1048576,2,".","")+" MiB":t>=1024?t=y.formatNumber(t/1024,0)+" KiB":t=y.formatNumber(t,0)+" bytes",t};y.bytesFromIP=function(t){return t.indexOf(".")!==-1?y.bytesFromIPv4(t):t.indexOf(":")!==-1?y.bytesFromIPv6(t):null};y.bytesFromIPv4=function(t){if(t=t.split("."),t.length!==4)return null;for(var e=y.createBuffer(),r=0;r<t.length;++r){var n=parseInt(t[r],10);if(isNaN(n))return null;e.putByte(n)}return e.getBytes()};y.bytesFromIPv6=function(t){var e=0;t=t.split(":").filter(function(o){return o.length===0&&++e,!0});for(var r=(8-t.length+e)*2,n=y.createBuffer(),i=0;i<8;++i){if(!t[i]||t[i].length===0){n.fillWithByte(0,r),r=0;continue}var s=y.hexToBytes(t[i]);s.length<2&&n.putByte(0),n.putBytes(s)}return n.getBytes()};y.bytesToIP=function(t){return t.length===4?y.bytesToIPv4(t):t.length===16?y.bytesToIPv6(t):null};y.bytesToIPv4=function(t){if(t.length!==4)return null;for(var e=[],r=0;r<t.length;++r)e.push(t.charCodeAt(r));return e.join(".")};y.bytesToIPv6=function(t){if(t.length!==16)return null;for(var e=[],r=[],n=0,i=0;i<t.length;i+=2){for(var s=y.bytesToHex(t[i]+t[i+1]);s[0]==="0"&&s!=="0";)s=s.substr(1);if(s==="0"){var o=r[r.length-1],a=e.length;!o||a!==o.end+1?r.push({start:a,end:a}):(o.end=a,o.end-o.start>r[n].end-r[n].start&&(n=r.length-1))}e.push(s)}if(r.length>0){var c=r[n];c.end-c.start>0&&(e.splice(c.start,c.end-c.start+1,""),c.start===0&&e.unshift(""),c.end===7&&e.push(""))}return e.join(":")};y.estimateCores=function(t,e){if(typeof t=="function"&&(e=t,t={}),t=t||{},"cores"in y&&!t.update)return e(null,y.cores);if(typeof navigator<"u"&&"hardwareConcurrency"in navigator&&navigator.hardwareConcurrency>0)return y.cores=navigator.hardwareConcurrency,e(null,y.cores);if(typeof Worker>"u")return y.cores=1,e(null,y.cores);if(typeof Blob>"u")return y.cores=2,e(null,y.cores);var r=URL.createObjectURL(new Blob(["(",function(){self.addEventListener("message",function(o){for(var a=Date.now(),c=a+4;Date.now()<c;);self.postMessage({st:a,et:c})})}.toString(),")()"],{type:"application/javascript"}));n([],5,16);function n(o,a,c){if(a===0){var u=Math.floor(o.reduce(function(f,h){return f+h},0)/o.length);return y.cores=Math.max(1,u),URL.revokeObjectURL(r),e(null,y.cores)}i(c,function(f,h){o.push(s(c,h)),n(o,a-1,c)})}function i(o,a){for(var c=[],u=[],f=0;f<o;++f){var h=new Worker(r);h.addEventListener("message",function(l){if(u.push(l.data),u.length===o){for(var g=0;g<o;++g)c[g].terminate();a(null,u)}}),c.push(h)}for(var f=0;f<o;++f)c[f].postMessage(f)}function s(o,a){for(var c=[],u=0;u<o;++u)for(var f=a[u],h=c[u]=[],l=0;l<o;++l)if(u!==l){var g=a[l];(f.st>g.st&&f.st<g.et||g.st>f.st&&g.st<f.et)&&h.push(l)}return c.reduce(function(p,d){return Math.max(p,d.length)},0)}}});var Ji=L((nA,Yu)=>{var ti=ie();ti.pki=ti.pki||{};var Go=Yu.exports=ti.pki.oids=ti.oids=ti.oids||{};function C(t,e){Go[t]=e,Go[e]=t}function ne(t,e){Go[t]=e}C("1.2.840.113549.1.1.1","rsaEncryption");C("1.2.840.113549.1.1.4","md5WithRSAEncryption");C("1.2.840.113549.1.1.5","sha1WithRSAEncryption");C("1.2.840.113549.1.1.7","RSAES-OAEP");C("1.2.840.113549.1.1.8","mgf1");C("1.2.840.113549.1.1.9","pSpecified");C("1.2.840.113549.1.1.10","RSASSA-PSS");C("1.2.840.113549.1.1.11","sha256WithRSAEncryption");C("1.2.840.113549.1.1.12","sha384WithRSAEncryption");C("1.2.840.113549.1.1.13","sha512WithRSAEncryption");C("1.3.101.112","EdDSA25519");C("1.2.840.10040.4.3","dsa-with-sha1");C("1.3.14.3.2.7","desCBC");C("1.3.14.3.2.26","sha1");C("1.3.14.3.2.29","sha1WithRSASignature");C("2.16.840.1.101.3.4.2.1","sha256");C("2.16.840.1.101.3.4.2.2","sha384");C("2.16.840.1.101.3.4.2.3","sha512");C("2.16.840.1.101.3.4.2.4","sha224");C("2.16.840.1.101.3.4.2.5","sha512-224");C("2.16.840.1.101.3.4.2.6","sha512-256");C("1.2.840.113549.2.2","md2");C("1.2.840.113549.2.5","md5");C("1.2.840.113549.1.7.1","data");C("1.2.840.113549.1.7.2","signedData");C("1.2.840.113549.1.7.3","envelopedData");C("1.2.840.113549.1.7.4","signedAndEnvelopedData");C("1.2.840.113549.1.7.5","digestedData");C("1.2.840.113549.1.7.6","encryptedData");C("1.2.840.113549.1.9.1","emailAddress");C("1.2.840.113549.1.9.2","unstructuredName");C("1.2.840.113549.1.9.3","contentType");C("1.2.840.113549.1.9.4","messageDigest");C("1.2.840.113549.1.9.5","signingTime");C("1.2.840.113549.1.9.6","counterSignature");C("1.2.840.113549.1.9.7","challengePassword");C("1.2.840.113549.1.9.8","unstructuredAddress");C("1.2.840.113549.1.9.14","extensionRequest");C("1.2.840.113549.1.9.20","friendlyName");C("1.2.840.113549.1.9.21","localKeyId");C("1.2.840.113549.1.9.22.1","x509Certificate");C("1.2.840.113549.1.12.10.1.1","keyBag");C("1.2.840.113549.1.12.10.1.2","pkcs8ShroudedKeyBag");C("1.2.840.113549.1.12.10.1.3","certBag");C("1.2.840.113549.1.12.10.1.4","crlBag");C("1.2.840.113549.1.12.10.1.5","secretBag");C("1.2.840.113549.1.12.10.1.6","safeContentsBag");C("1.2.840.113549.1.5.13","pkcs5PBES2");C("1.2.840.113549.1.5.12","pkcs5PBKDF2");C("1.2.840.113549.1.12.1.1","pbeWithSHAAnd128BitRC4");C("1.2.840.113549.1.12.1.2","pbeWithSHAAnd40BitRC4");C("1.2.840.113549.1.12.1.3","pbeWithSHAAnd3-KeyTripleDES-CBC");C("1.2.840.113549.1.12.1.4","pbeWithSHAAnd2-KeyTripleDES-CBC");C("1.2.840.113549.1.12.1.5","pbeWithSHAAnd128BitRC2-CBC");C("1.2.840.113549.1.12.1.6","pbewithSHAAnd40BitRC2-CBC");C("1.2.840.113549.2.7","hmacWithSHA1");C("1.2.840.113549.2.8","hmacWithSHA224");C("1.2.840.113549.2.9","hmacWithSHA256");C("1.2.840.113549.2.10","hmacWithSHA384");C("1.2.840.113549.2.11","hmacWithSHA512");C("1.2.840.113549.3.7","des-EDE3-CBC");C("2.16.840.1.101.3.4.1.2","aes128-CBC");C("2.16.840.1.101.3.4.1.22","aes192-CBC");C("2.16.840.1.101.3.4.1.42","aes256-CBC");C("2.5.4.3","commonName");C("2.5.4.4","surname");C("2.5.4.5","serialNumber");C("2.5.4.6","countryName");C("2.5.4.7","localityName");C("2.5.4.8","stateOrProvinceName");C("2.5.4.9","streetAddress");C("2.5.4.10","organizationName");C("2.5.4.11","organizationalUnitName");C("2.5.4.12","title");C("2.5.4.13","description");C("2.5.4.15","businessCategory");C("2.5.4.17","postalCode");C("2.5.4.42","givenName");C("1.3.6.1.4.1.311.60.2.1.2","jurisdictionOfIncorporationStateOrProvinceName");C("1.3.6.1.4.1.311.60.2.1.3","jurisdictionOfIncorporationCountryName");C("2.16.840.1.113730.1.1","nsCertType");C("2.16.840.1.113730.1.13","nsComment");ne("2.5.29.1","authorityKeyIdentifier");ne("2.5.29.2","keyAttributes");ne("2.5.29.3","certificatePolicies");ne("2.5.29.4","keyUsageRestriction");ne("2.5.29.5","policyMapping");ne("2.5.29.6","subtreesConstraint");ne("2.5.29.7","subjectAltName");ne("2.5.29.8","issuerAltName");ne("2.5.29.9","subjectDirectoryAttributes");ne("2.5.29.10","basicConstraints");ne("2.5.29.11","nameConstraints");ne("2.5.29.12","policyConstraints");ne("2.5.29.13","basicConstraints");C("2.5.29.14","subjectKeyIdentifier");C("2.5.29.15","keyUsage");ne("2.5.29.16","privateKeyUsagePeriod");C("2.5.29.17","subjectAltName");C("2.5.29.18","issuerAltName");C("2.5.29.19","basicConstraints");ne("2.5.29.20","cRLNumber");ne("2.5.29.21","cRLReason");ne("2.5.29.22","expirationDate");ne("2.5.29.23","instructionCode");ne("2.5.29.24","invalidityDate");ne("2.5.29.25","cRLDistributionPoints");ne("2.5.29.26","issuingDistributionPoint");ne("2.5.29.27","deltaCRLIndicator");ne("2.5.29.28","issuingDistributionPoint");ne("2.5.29.29","certificateIssuer");ne("2.5.29.30","nameConstraints");C("2.5.29.31","cRLDistributionPoints");C("2.5.29.32","certificatePolicies");ne("2.5.29.33","policyMappings");ne("2.5.29.34","policyConstraints");C("2.5.29.35","authorityKeyIdentifier");ne("2.5.29.36","policyConstraints");C("2.5.29.37","extKeyUsage");ne("2.5.29.46","freshestCRL");ne("2.5.29.54","inhibitAnyPolicy");C("1.3.6.1.4.1.11129.2.4.2","timestampList");C("1.3.6.1.5.5.7.1.1","authorityInfoAccess");C("1.3.6.1.5.5.7.3.1","serverAuth");C("1.3.6.1.5.5.7.3.2","clientAuth");C("1.3.6.1.5.5.7.3.3","codeSigning");C("1.3.6.1.5.5.7.3.4","emailProtection");C("1.3.6.1.5.5.7.3.8","timeStamping")});var ni=L((iA,ju)=>{var de=ie();Re();Ji();var B=ju.exports=de.asn1=de.asn1||{};B.Class={UNIVERSAL:0,APPLICATION:64,CONTEXT_SPECIFIC:128,PRIVATE:192};B.Type={NONE:0,BOOLEAN:1,INTEGER:2,BITSTRING:3,OCTETSTRING:4,NULL:5,OID:6,ODESC:7,EXTERNAL:8,REAL:9,ENUMERATED:10,EMBEDDED:11,UTF8:12,ROID:13,SEQUENCE:16,SET:17,PRINTABLESTRING:19,IA5STRING:22,UTCTIME:23,GENERALIZEDTIME:24,BMPSTRING:30};B.create=function(t,e,r,n,i){if(de.util.isArray(n)){for(var s=[],o=0;o<n.length;++o)n[o]!==void 0&&s.push(n[o]);n=s}var a={tagClass:t,type:e,constructed:r,composed:r||de.util.isArray(n),value:n};return i&&"bitStringContents"in i&&(a.bitStringContents=i.bitStringContents,a.original=B.copy(a)),a};B.copy=function(t,e){var r;if(de.util.isArray(t)){r=[];for(var n=0;n<t.length;++n)r.push(B.copy(t[n],e));return r}return typeof t=="string"?t:(r={tagClass:t.tagClass,type:t.type,constructed:t.constructed,composed:t.composed,value:B.copy(t.value,e)},e&&!e.excludeBitStringContents&&(r.bitStringContents=t.bitStringContents),r)};B.equals=function(t,e,r){if(de.util.isArray(t)){if(!de.util.isArray(e)||t.length!==e.length)return!1;for(var n=0;n<t.length;++n)if(!B.equals(t[n],e[n]))return!1;return!0}if(typeof t!=typeof e)return!1;if(typeof t=="string")return t===e;var i=t.tagClass===e.tagClass&&t.type===e.type&&t.constructed===e.constructed&&t.composed===e.composed&&B.equals(t.value,e.value);return r&&r.includeBitStringContents&&(i=i&&t.bitStringContents===e.bitStringContents),i};B.getBerValueLength=function(t){var e=t.getByte();if(e!==128){var r,n=e&128;return n?r=t.getInt((e&127)<<3):r=e,r}};function ri(t,e,r){if(r>e){var n=new Error("Too few bytes to parse DER.");throw n.available=t.length(),n.remaining=e,n.requested=r,n}}var Ey=function(t,e){var r=t.getByte();if(e--,r!==128){var n,i=r&128;if(!i)n=r;else{var s=r&127;ri(t,e,s),n=t.getInt(s<<3)}if(n<0)throw new Error("Negative length: "+n);return n}};B.fromDer=function(t,e){e===void 0&&(e={strict:!0,parseAllBytes:!0,decodeBitStrings:!0}),typeof e=="boolean"&&(e={strict:e,parseAllBytes:!0,decodeBitStrings:!0}),"strict"in e||(e.strict=!0),"parseAllBytes"in e||(e.parseAllBytes=!0),"decodeBitStrings"in e||(e.decodeBitStrings=!0),typeof t=="string"&&(t=de.util.createBuffer(t));var r=t.length(),n=es(t,t.length(),0,e);if(e.parseAllBytes&&t.length()!==0){var i=new Error("Unparsed DER bytes remain after ASN.1 parsing.");throw i.byteCount=r,i.remaining=t.length(),i}return n};function es(t,e,r,n){var i;ri(t,e,2);var s=t.getByte();e--;var o=s&192,a=s&31;i=t.length();var c=Ey(t,e);if(e-=i-t.length(),c!==void 0&&c>e){if(n.strict){var u=new Error("Too few bytes to read ASN.1 value.");throw u.available=t.length(),u.remaining=e,u.requested=c,u}c=e}var f,h,l=(s&32)===32;if(l)if(f=[],c===void 0)for(;;){if(ri(t,e,2),t.bytes(2)===String.fromCharCode(0,0)){t.getBytes(2),e-=2;break}i=t.length(),f.push(es(t,e,r+1,n)),e-=i-t.length()}else for(;c>0;)i=t.length(),f.push(es(t,c,r+1,n)),e-=i-t.length(),c-=i-t.length();if(f===void 0&&o===B.Class.UNIVERSAL&&a===B.Type.BITSTRING&&(h=t.bytes(c)),f===void 0&&n.decodeBitStrings&&o===B.Class.UNIVERSAL&&a===B.Type.BITSTRING&&c>1){var g=t.read,p=e,d=0;if(a===B.Type.BITSTRING&&(ri(t,e,1),d=t.getByte(),e--),d===0)try{i=t.length();var m={strict:!0,decodeBitStrings:!0},b=es(t,e,r+1,m),S=i-t.length();e-=S,a==B.Type.BITSTRING&&S++;var I=b.tagClass;S===c&&(I===B.Class.UNIVERSAL||I===B.Class.CONTEXT_SPECIFIC)&&(f=[b])}catch{}f===void 0&&(t.read=g,e=p)}if(f===void 0){if(c===void 0){if(n.strict)throw new Error("Non-constructed ASN.1 object of indefinite length.");c=e}if(a===B.Type.BMPSTRING)for(f="";c>0;c-=2)ri(t,e,2),f+=String.fromCharCode(t.getInt16()),e-=2;else f=t.getBytes(c),e-=c}var R=h===void 0?null:{bitStringContents:h};return B.create(o,a,l,f,R)}B.toDer=function(t){var e=de.util.createBuffer(),r=t.tagClass|t.type,n=de.util.createBuffer(),i=!1;if("bitStringContents"in t&&(i=!0,t.original&&(i=B.equals(t,t.original))),i)n.putBytes(t.bitStringContents);else if(t.composed){t.constructed?r|=32:n.putByte(0);for(var s=0;s<t.value.length;++s)t.value[s]!==void 0&&n.putBuffer(B.toDer(t.value[s]))}else if(t.type===B.Type.BMPSTRING)for(var s=0;s<t.value.length;++s)n.putInt16(t.value.charCodeAt(s));else t.type===B.Type.INTEGER&&t.value.length>1&&(t.value.charCodeAt(0)===0&&(t.value.charCodeAt(1)&128)===0||t.value.charCodeAt(0)===255&&(t.value.charCodeAt(1)&128)===128)?n.putBytes(t.value.substr(1)):n.putBytes(t.value);if(e.putByte(r),n.length()<=127)e.putByte(n.length()&127);else{var o=n.length(),a="";do a+=String.fromCharCode(o&255),o=o>>>8;while(o>0);e.putByte(a.length|128);for(var s=a.length-1;s>=0;--s)e.putByte(a.charCodeAt(s))}return e.putBuffer(n),e};B.oidToDer=function(t){var e=t.split("."),r=de.util.createBuffer();r.putByte(40*parseInt(e[0],10)+parseInt(e[1],10));for(var n,i,s,o,a=2;a<e.length;++a){n=!0,i=[],s=parseInt(e[a],10);do o=s&127,s=s>>>7,n||(o|=128),i.push(o),n=!1;while(s>0);for(var c=i.length-1;c>=0;--c)r.putByte(i[c])}return r};B.derToOid=function(t){var e;typeof t=="string"&&(t=de.util.createBuffer(t));var r=t.getByte();e=Math.floor(r/40)+"."+r%40;for(var n=0;t.length()>0;)r=t.getByte(),n=n<<7,r&128?n+=r&127:(e+="."+(n+r),n=0);return e};B.utcTimeToDate=function(t){var e=new Date,r=parseInt(t.substr(0,2),10);r=r>=50?1900+r:2e3+r;var n=parseInt(t.substr(2,2),10)-1,i=parseInt(t.substr(4,2),10),s=parseInt(t.substr(6,2),10),o=parseInt(t.substr(8,2),10),a=0;if(t.length>11){var c=t.charAt(10),u=10;c!=="+"&&c!=="-"&&(a=parseInt(t.substr(10,2),10),u+=2)}if(e.setUTCFullYear(r,n,i),e.setUTCHours(s,o,a,0),u&&(c=t.charAt(u),c==="+"||c==="-")){var f=parseInt(t.substr(u+1,2),10),h=parseInt(t.substr(u+4,2),10),l=f*60+h;l*=6e4,c==="+"?e.setTime(+e-l):e.setTime(+e+l)}return e};B.generalizedTimeToDate=function(t){var e=new Date,r=parseInt(t.substr(0,4),10),n=parseInt(t.substr(4,2),10)-1,i=parseInt(t.substr(6,2),10),s=parseInt(t.substr(8,2),10),o=parseInt(t.substr(10,2),10),a=parseInt(t.substr(12,2),10),c=0,u=0,f=!1;t.charAt(t.length-1)==="Z"&&(f=!0);var h=t.length-5,l=t.charAt(h);if(l==="+"||l==="-"){var g=parseInt(t.substr(h+1,2),10),p=parseInt(t.substr(h+4,2),10);u=g*60+p,u*=6e4,l==="+"&&(u*=-1),f=!0}return t.charAt(14)==="."&&(c=parseFloat(t.substr(14),10)*1e3),f?(e.setUTCFullYear(r,n,i),e.setUTCHours(s,o,a,c),e.setTime(+e+u)):(e.setFullYear(r,n,i),e.setHours(s,o,a,c)),e};B.dateToUtcTime=function(t){if(typeof t=="string")return t;var e="",r=[];r.push((""+t.getUTCFullYear()).substr(2)),r.push(""+(t.getUTCMonth()+1)),r.push(""+t.getUTCDate()),r.push(""+t.getUTCHours()),r.push(""+t.getUTCMinutes()),r.push(""+t.getUTCSeconds());for(var n=0;n<r.length;++n)r[n].length<2&&(e+="0"),e+=r[n];return e+="Z",e};B.dateToGeneralizedTime=function(t){if(typeof t=="string")return t;var e="",r=[];r.push(""+t.getUTCFullYear()),r.push(""+(t.getUTCMonth()+1)),r.push(""+t.getUTCDate()),r.push(""+t.getUTCHours()),r.push(""+t.getUTCMinutes()),r.push(""+t.getUTCSeconds());for(var n=0;n<r.length;++n)r[n].length<2&&(e+="0"),e+=r[n];return e+="Z",e};B.integerToDer=function(t){var e=de.util.createBuffer();if(t>=-128&&t<128)return e.putSignedInt(t,8);if(t>=-32768&&t<32768)return e.putSignedInt(t,16);if(t>=-8388608&&t<8388608)return e.putSignedInt(t,24);if(t>=-2147483648&&t<2147483648)return e.putSignedInt(t,32);var r=new Error("Integer too large; max is 32-bits.");throw r.integer=t,r};B.derToInteger=function(t){typeof t=="string"&&(t=de.util.createBuffer(t));var e=t.length()*8;if(e>32)throw new Error("Integer too large; max is 32-bits.");return t.getSignedInt(e)};B.validate=function(t,e,r,n){var i=!1;if((t.tagClass===e.tagClass||typeof e.tagClass>"u")&&(t.type===e.type||typeof e.type>"u"))if(t.constructed===e.constructed||typeof e.constructed>"u"){if(i=!0,e.value&&de.util.isArray(e.value))for(var s=0,o=0;i&&o<e.value.length;++o)i=e.value[o].optional||!1,t.value[s]&&(i=B.validate(t.value[s],e.value[o],r,n),i?++s:e.value[o].optional&&(i=!0)),!i&&n&&n.push("["+e.name+'] Tag class "'+e.tagClass+'", type "'+e.type+'" expected value length "'+e.value.length+'", got "'+t.value.length+'"');if(i&&r&&(e.capture&&(r[e.capture]=t.value),e.captureAsn1&&(r[e.captureAsn1]=t),e.captureBitStringContents&&"bitStringContents"in t&&(r[e.captureBitStringContents]=t.bitStringContents),e.captureBitStringValue&&"bitStringContents"in t)){var a;if(t.bitStringContents.length<2)r[e.captureBitStringValue]="";else{var c=t.bitStringContents.charCodeAt(0);if(c!==0)throw new Error("captureBitStringValue only supported for zero unused bits");r[e.captureBitStringValue]=t.bitStringContents.slice(1)}}}else n&&n.push("["+e.name+'] Expected constructed "'+e.constructed+'", got "'+t.constructed+'"');else n&&(t.tagClass!==e.tagClass&&n.push("["+e.name+'] Expected tag class "'+e.tagClass+'", got "'+t.tagClass+'"'),t.type!==e.type&&n.push("["+e.name+'] Expected type "'+e.type+'", got "'+t.type+'"'));return i};var Zu=/[^\\u0000-\\u00ff]/;B.prettyPrint=function(t,e,r){var n="";e=e||0,r=r||2,e>0&&(n+=`
`);for(var i="",s=0;s<e*r;++s)i+=" ";switch(n+=i+"Tag: ",t.tagClass){case B.Class.UNIVERSAL:n+="Universal:";break;case B.Class.APPLICATION:n+="Application:";break;case B.Class.CONTEXT_SPECIFIC:n+="Context-Specific:";break;case B.Class.PRIVATE:n+="Private:";break}if(t.tagClass===B.Class.UNIVERSAL)switch(n+=t.type,t.type){case B.Type.NONE:n+=" (None)";break;case B.Type.BOOLEAN:n+=" (Boolean)";break;case B.Type.INTEGER:n+=" (Integer)";break;case B.Type.BITSTRING:n+=" (Bit string)";break;case B.Type.OCTETSTRING:n+=" (Octet string)";break;case B.Type.NULL:n+=" (Null)";break;case B.Type.OID:n+=" (Object Identifier)";break;case B.Type.ODESC:n+=" (Object Descriptor)";break;case B.Type.EXTERNAL:n+=" (External or Instance of)";break;case B.Type.REAL:n+=" (Real)";break;case B.Type.ENUMERATED:n+=" (Enumerated)";break;case B.Type.EMBEDDED:n+=" (Embedded PDV)";break;case B.Type.UTF8:n+=" (UTF8)";break;case B.Type.ROID:n+=" (Relative Object Identifier)";break;case B.Type.SEQUENCE:n+=" (Sequence)";break;case B.Type.SET:n+=" (Set)";break;case B.Type.PRINTABLESTRING:n+=" (Printable String)";break;case B.Type.IA5String:n+=" (IA5String (ASCII))";break;case B.Type.UTCTIME:n+=" (UTC time)";break;case B.Type.GENERALIZEDTIME:n+=" (Generalized time)";break;case B.Type.BMPSTRING:n+=" (BMP String)";break}else n+=t.type;if(n+=`
`,n+=i+"Constructed: "+t.constructed+`
`,t.composed){for(var o=0,a="",s=0;s<t.value.length;++s)t.value[s]!==void 0&&(o+=1,a+=B.prettyPrint(t.value[s],e+1,r),s+1<t.value.length&&(a+=","));n+=i+"Sub values: "+o+a}else{if(n+=i+"Value: ",t.type===B.Type.OID){var c=B.derToOid(t.value);n+=c,de.pki&&de.pki.oids&&c in de.pki.oids&&(n+=" ("+de.pki.oids[c]+") ")}if(t.type===B.Type.INTEGER)try{n+=B.derToInteger(t.value)}catch{n+="0x"+de.util.bytesToHex(t.value)}else if(t.type===B.Type.BITSTRING){if(t.value.length>1?n+="0x"+de.util.bytesToHex(t.value.slice(1)):n+="(none)",t.value.length>0){var u=t.value.charCodeAt(0);u==1?n+=" (1 unused bit shown)":u>1&&(n+=" ("+u+" unused bits shown)")}}else if(t.type===B.Type.OCTETSTRING)Zu.test(t.value)||(n+="("+t.value+") "),n+="0x"+de.util.bytesToHex(t.value);else if(t.type===B.Type.UTF8)try{n+=de.util.decodeUtf8(t.value)}catch(f){if(f.message==="URI malformed")n+="0x"+de.util.bytesToHex(t.value)+" (malformed UTF8)";else throw f}else t.type===B.Type.PRINTABLESTRING||t.type===B.Type.IA5String?n+=t.value:Zu.test(t.value)?n+="0x"+de.util.bytesToHex(t.value):t.value.length===0?n+="[null]":n+=t.value}return n}});var Wo=L((sA,Xu)=>{var Oe=ie();Re();Xu.exports=Oe.cipher=Oe.cipher||{};Oe.cipher.algorithms=Oe.cipher.algorithms||{};Oe.cipher.createCipher=function(t,e){var r=t;if(typeof r=="string"&&(r=Oe.cipher.getAlgorithm(r),r&&(r=r())),!r)throw new Error("Unsupported algorithm: "+t);return new Oe.cipher.BlockCipher({algorithm:r,key:e,decrypt:!1})};Oe.cipher.createDecipher=function(t,e){var r=t;if(typeof r=="string"&&(r=Oe.cipher.getAlgorithm(r),r&&(r=r())),!r)throw new Error("Unsupported algorithm: "+t);return new Oe.cipher.BlockCipher({algorithm:r,key:e,decrypt:!0})};Oe.cipher.registerAlgorithm=function(t,e){t=t.toUpperCase(),Oe.cipher.algorithms[t]=e};Oe.cipher.getAlgorithm=function(t){return t=t.toUpperCase(),t in Oe.cipher.algorithms?Oe.cipher.algorithms[t]:null};var Ho=Oe.cipher.BlockCipher=function(t){this.algorithm=t.algorithm,this.mode=this.algorithm.mode,this.blockSize=this.mode.blockSize,this._finish=!1,this._input=null,this.output=null,this._op=t.decrypt?this.mode.decrypt:this.mode.encrypt,this._decrypt=t.decrypt,this.algorithm.initialize(t)};Ho.prototype.start=function(t){t=t||{};var e={};for(var r in t)e[r]=t[r];e.decrypt=this._decrypt,this._finish=!1,this._input=Oe.util.createBuffer(),this.output=t.output||Oe.util.createBuffer(),this.mode.start(e)};Ho.prototype.update=function(t){for(t&&this._input.putBuffer(t);!this._op.call(this.mode,this._input,this.output,this._finish)&&!this._finish;);this._input.compact()};Ho.prototype.finish=function(t){t&&(this.mode.name==="ECB"||this.mode.name==="CBC")&&(this.mode.pad=function(r){return t(this.blockSize,r,!1)},this.mode.unpad=function(r){return t(this.blockSize,r,!0)});var e={};return e.decrypt=this._decrypt,e.overflow=this._input.length()%this.blockSize,!(!this._decrypt&&this.mode.pad&&!this.mode.pad(this._input,e)||(this._finish=!0,this.update(),this._decrypt&&this.mode.unpad&&!this.mode.unpad(this.output,e))||this.mode.afterFinish&&!this.mode.afterFinish(this.output,e))}});var Yo=L((oA,Qu)=>{var Ke=ie();Re();Ke.cipher=Ke.cipher||{};var W=Qu.exports=Ke.cipher.modes=Ke.cipher.modes||{};W.ecb=function(t){t=t||{},this.name="ECB",this.cipher=t.cipher,this.blockSize=t.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints)};W.ecb.prototype.start=function(t){};W.ecb.prototype.encrypt=function(t,e,r){if(t.length()<this.blockSize&&!(r&&t.length()>0))return!0;for(var n=0;n<this._ints;++n)this._inBlock[n]=t.getInt32();this.cipher.encrypt(this._inBlock,this._outBlock);for(var n=0;n<this._ints;++n)e.putInt32(this._outBlock[n])};W.ecb.prototype.decrypt=function(t,e,r){if(t.length()<this.blockSize&&!(r&&t.length()>0))return!0;for(var n=0;n<this._ints;++n)this._inBlock[n]=t.getInt32();this.cipher.decrypt(this._inBlock,this._outBlock);for(var n=0;n<this._ints;++n)e.putInt32(this._outBlock[n])};W.ecb.prototype.pad=function(t,e){var r=t.length()===this.blockSize?this.blockSize:this.blockSize-t.length();return t.fillWithByte(r,r),!0};W.ecb.prototype.unpad=function(t,e){if(e.overflow>0)return!1;var r=t.length(),n=t.at(r-1);return n>this.blockSize<<2?!1:(t.truncate(n),!0)};W.cbc=function(t){t=t||{},this.name="CBC",this.cipher=t.cipher,this.blockSize=t.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints)};W.cbc.prototype.start=function(t){if(t.iv===null){if(!this._prev)throw new Error("Invalid IV parameter.");this._iv=this._prev.slice(0)}else if("iv"in t)this._iv=ts(t.iv,this.blockSize),this._prev=this._iv.slice(0);else throw new Error("Invalid IV parameter.")};W.cbc.prototype.encrypt=function(t,e,r){if(t.length()<this.blockSize&&!(r&&t.length()>0))return!0;for(var n=0;n<this._ints;++n)this._inBlock[n]=this._prev[n]^t.getInt32();this.cipher.encrypt(this._inBlock,this._outBlock);for(var n=0;n<this._ints;++n)e.putInt32(this._outBlock[n]);this._prev=this._outBlock};W.cbc.prototype.decrypt=function(t,e,r){if(t.length()<this.blockSize&&!(r&&t.length()>0))return!0;for(var n=0;n<this._ints;++n)this._inBlock[n]=t.getInt32();this.cipher.decrypt(this._inBlock,this._outBlock);for(var n=0;n<this._ints;++n)e.putInt32(this._prev[n]^this._outBlock[n]);this._prev=this._inBlock.slice(0)};W.cbc.prototype.pad=function(t,e){var r=t.length()===this.blockSize?this.blockSize:this.blockSize-t.length();return t.fillWithByte(r,r),!0};W.cbc.prototype.unpad=function(t,e){if(e.overflow>0)return!1;var r=t.length(),n=t.at(r-1);return n>this.blockSize<<2?!1:(t.truncate(n),!0)};W.cfb=function(t){t=t||{},this.name="CFB",this.cipher=t.cipher,this.blockSize=t.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialBlock=new Array(this._ints),this._partialOutput=Ke.util.createBuffer(),this._partialBytes=0};W.cfb.prototype.start=function(t){if(!("iv"in t))throw new Error("Invalid IV parameter.");this._iv=ts(t.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0};W.cfb.prototype.encrypt=function(t,e,r){var n=t.length();if(n===0)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),this._partialBytes===0&&n>=this.blockSize){for(var i=0;i<this._ints;++i)this._inBlock[i]=t.getInt32()^this._outBlock[i],e.putInt32(this._inBlock[i]);return}var s=(this.blockSize-n)%this.blockSize;s>0&&(s=this.blockSize-s),this._partialOutput.clear();for(var i=0;i<this._ints;++i)this._partialBlock[i]=t.getInt32()^this._outBlock[i],this._partialOutput.putInt32(this._partialBlock[i]);if(s>0)t.read-=this.blockSize;else for(var i=0;i<this._ints;++i)this._inBlock[i]=this._partialBlock[i];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),s>0&&!r)return e.putBytes(this._partialOutput.getBytes(s-this._partialBytes)),this._partialBytes=s,!0;e.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0};W.cfb.prototype.decrypt=function(t,e,r){var n=t.length();if(n===0)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),this._partialBytes===0&&n>=this.blockSize){for(var i=0;i<this._ints;++i)this._inBlock[i]=t.getInt32(),e.putInt32(this._inBlock[i]^this._outBlock[i]);return}var s=(this.blockSize-n)%this.blockSize;s>0&&(s=this.blockSize-s),this._partialOutput.clear();for(var i=0;i<this._ints;++i)this._partialBlock[i]=t.getInt32(),this._partialOutput.putInt32(this._partialBlock[i]^this._outBlock[i]);if(s>0)t.read-=this.blockSize;else for(var i=0;i<this._ints;++i)this._inBlock[i]=this._partialBlock[i];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),s>0&&!r)return e.putBytes(this._partialOutput.getBytes(s-this._partialBytes)),this._partialBytes=s,!0;e.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0};W.ofb=function(t){t=t||{},this.name="OFB",this.cipher=t.cipher,this.blockSize=t.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialOutput=Ke.util.createBuffer(),this._partialBytes=0};W.ofb.prototype.start=function(t){if(!("iv"in t))throw new Error("Invalid IV parameter.");this._iv=ts(t.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0};W.ofb.prototype.encrypt=function(t,e,r){var n=t.length();if(t.length()===0)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),this._partialBytes===0&&n>=this.blockSize){for(var i=0;i<this._ints;++i)e.putInt32(t.getInt32()^this._outBlock[i]),this._inBlock[i]=this._outBlock[i];return}var s=(this.blockSize-n)%this.blockSize;s>0&&(s=this.blockSize-s),this._partialOutput.clear();for(var i=0;i<this._ints;++i)this._partialOutput.putInt32(t.getInt32()^this._outBlock[i]);if(s>0)t.read-=this.blockSize;else for(var i=0;i<this._ints;++i)this._inBlock[i]=this._outBlock[i];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),s>0&&!r)return e.putBytes(this._partialOutput.getBytes(s-this._partialBytes)),this._partialBytes=s,!0;e.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0};W.ofb.prototype.decrypt=W.ofb.prototype.encrypt;W.ctr=function(t){t=t||{},this.name="CTR",this.cipher=t.cipher,this.blockSize=t.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialOutput=Ke.util.createBuffer(),this._partialBytes=0};W.ctr.prototype.start=function(t){if(!("iv"in t))throw new Error("Invalid IV parameter.");this._iv=ts(t.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0};W.ctr.prototype.encrypt=function(t,e,r){var n=t.length();if(n===0)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),this._partialBytes===0&&n>=this.blockSize)for(var i=0;i<this._ints;++i)e.putInt32(t.getInt32()^this._outBlock[i]);else{var s=(this.blockSize-n)%this.blockSize;s>0&&(s=this.blockSize-s),this._partialOutput.clear();for(var i=0;i<this._ints;++i)this._partialOutput.putInt32(t.getInt32()^this._outBlock[i]);if(s>0&&(t.read-=this.blockSize),this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),s>0&&!r)return e.putBytes(this._partialOutput.getBytes(s-this._partialBytes)),this._partialBytes=s,!0;e.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0}rs(this._inBlock)};W.ctr.prototype.decrypt=W.ctr.prototype.encrypt;W.gcm=function(t){t=t||{},this.name="GCM",this.cipher=t.cipher,this.blockSize=t.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints),this._partialOutput=Ke.util.createBuffer(),this._partialBytes=0,this._R=3774873600};W.gcm.prototype.start=function(t){if(!("iv"in t))throw new Error("Invalid IV parameter.");var e=Ke.util.createBuffer(t.iv);this._cipherLength=0;var r;if("additionalData"in t?r=Ke.util.createBuffer(t.additionalData):r=Ke.util.createBuffer(),"tagLength"in t?this._tagLength=t.tagLength:this._tagLength=128,this._tag=null,t.decrypt&&(this._tag=Ke.util.createBuffer(t.tag).getBytes(),this._tag.length!==this._tagLength/8))throw new Error("Authentication tag does not match tag length.");this._hashBlock=new Array(this._ints),this.tag=null,this._hashSubkey=new Array(this._ints),this.cipher.encrypt([0,0,0,0],this._hashSubkey),this.componentBits=4,this._m=this.generateHashTable(this._hashSubkey,this.componentBits);var n=e.length();if(n===12)this._j0=[e.getInt32(),e.getInt32(),e.getInt32(),1];else{for(this._j0=[0,0,0,0];e.length()>0;)this._j0=this.ghash(this._hashSubkey,this._j0,[e.getInt32(),e.getInt32(),e.getInt32(),e.getInt32()]);this._j0=this.ghash(this._hashSubkey,this._j0,[0,0].concat($o(n*8)))}this._inBlock=this._j0.slice(0),rs(this._inBlock),this._partialBytes=0,r=Ke.util.createBuffer(r),this._aDataLength=$o(r.length()*8);var i=r.length()%this.blockSize;for(i&&r.fillWithByte(0,this.blockSize-i),this._s=[0,0,0,0];r.length()>0;)this._s=this.ghash(this._hashSubkey,this._s,[r.getInt32(),r.getInt32(),r.getInt32(),r.getInt32()])};W.gcm.prototype.encrypt=function(t,e,r){var n=t.length();if(n===0)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),this._partialBytes===0&&n>=this.blockSize){for(var i=0;i<this._ints;++i)e.putInt32(this._outBlock[i]^=t.getInt32());this._cipherLength+=this.blockSize}else{var s=(this.blockSize-n)%this.blockSize;s>0&&(s=this.blockSize-s),this._partialOutput.clear();for(var i=0;i<this._ints;++i)this._partialOutput.putInt32(t.getInt32()^this._outBlock[i]);if(s<=0||r){if(r){var o=n%this.blockSize;this._cipherLength+=o,this._partialOutput.truncate(this.blockSize-o)}else this._cipherLength+=this.blockSize;for(var i=0;i<this._ints;++i)this._outBlock[i]=this._partialOutput.getInt32();this._partialOutput.read-=this.blockSize}if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),s>0&&!r)return t.read-=this.blockSize,e.putBytes(this._partialOutput.getBytes(s-this._partialBytes)),this._partialBytes=s,!0;e.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0}this._s=this.ghash(this._hashSubkey,this._s,this._outBlock),rs(this._inBlock)};W.gcm.prototype.decrypt=function(t,e,r){var n=t.length();if(n<this.blockSize&&!(r&&n>0))return!0;this.cipher.encrypt(this._inBlock,this._outBlock),rs(this._inBlock),this._hashBlock[0]=t.getInt32(),this._hashBlock[1]=t.getInt32(),this._hashBlock[2]=t.getInt32(),this._hashBlock[3]=t.getInt32(),this._s=this.ghash(this._hashSubkey,this._s,this._hashBlock);for(var i=0;i<this._ints;++i)e.putInt32(this._outBlock[i]^this._hashBlock[i]);n<this.blockSize?this._cipherLength+=n%this.blockSize:this._cipherLength+=this.blockSize};W.gcm.prototype.afterFinish=function(t,e){var r=!0;e.decrypt&&e.overflow&&t.truncate(this.blockSize-e.overflow),this.tag=Ke.util.createBuffer();var n=this._aDataLength.concat($o(this._cipherLength*8));this._s=this.ghash(this._hashSubkey,this._s,n);var i=[];this.cipher.encrypt(this._j0,i);for(var s=0;s<this._ints;++s)this.tag.putInt32(this._s[s]^i[s]);return this.tag.truncate(this.tag.length()%(this._tagLength/8)),e.decrypt&&this.tag.bytes()!==this._tag&&(r=!1),r};W.gcm.prototype.multiply=function(t,e){for(var r=[0,0,0,0],n=e.slice(0),i=0;i<128;++i){var s=t[i/32|0]&1<<31-i%32;s&&(r[0]^=n[0],r[1]^=n[1],r[2]^=n[2],r[3]^=n[3]),this.pow(n,n)}return r};W.gcm.prototype.pow=function(t,e){for(var r=t[3]&1,n=3;n>0;--n)e[n]=t[n]>>>1|(t[n-1]&1)<<31;e[0]=t[0]>>>1,r&&(e[0]^=this._R)};W.gcm.prototype.tableMultiply=function(t){for(var e=[0,0,0,0],r=0;r<32;++r){var n=r/8|0,i=t[n]>>>(7-r%8)*4&15,s=this._m[r][i];e[0]^=s[0],e[1]^=s[1],e[2]^=s[2],e[3]^=s[3]}return e};W.gcm.prototype.ghash=function(t,e,r){return e[0]^=r[0],e[1]^=r[1],e[2]^=r[2],e[3]^=r[3],this.tableMultiply(e)};W.gcm.prototype.generateHashTable=function(t,e){for(var r=8/e,n=4*r,i=16*r,s=new Array(i),o=0;o<i;++o){var a=[0,0,0,0],c=o/n|0,u=(n-1-o%n)*e;a[c]=1<<e-1<<u,s[o]=this.generateSubHashTable(this.multiply(a,t),e)}return s};W.gcm.prototype.generateSubHashTable=function(t,e){var r=1<<e,n=r>>>1,i=new Array(r);i[n]=t.slice(0);for(var s=n>>>1;s>0;)this.pow(i[2*s],i[s]=[]),s>>=1;for(s=2;s<n;){for(var o=1;o<s;++o){var a=i[s],c=i[o];i[s+o]=[a[0]^c[0],a[1]^c[1],a[2]^c[2],a[3]^c[3]]}s*=2}for(i[0]=[0,0,0,0],s=n+1;s<r;++s){var u=i[s^n];i[s]=[t[0]^u[0],t[1]^u[1],t[2]^u[2],t[3]^u[3]]}return i};function ts(t,e){if(typeof t=="string"&&(t=Ke.util.createBuffer(t)),Ke.util.isArray(t)&&t.length>4){var r=t;t=Ke.util.createBuffer();for(var n=0;n<r.length;++n)t.putByte(r[n])}if(t.length()<e)throw new Error("Invalid IV length; got "+t.length()+" bytes and expected "+e+" bytes.");if(!Ke.util.isArray(t)){for(var i=[],s=e/4,n=0;n<s;++n)i.push(t.getInt32());t=i}return t}function rs(t){t[t.length-1]=t[t.length-1]+1&4294967295}function $o(t){return[t/4294967296|0,t&4294967295]}});var Qo=L((aA,rf)=>{var fe=ie();Wo();Yo();Re();rf.exports=fe.aes=fe.aes||{};fe.aes.startEncrypting=function(t,e,r,n){var i=ns({key:t,output:r,decrypt:!1,mode:n});return i.start(e),i};fe.aes.createEncryptionCipher=function(t,e){return ns({key:t,output:null,decrypt:!1,mode:e})};fe.aes.startDecrypting=function(t,e,r,n){var i=ns({key:t,output:r,decrypt:!0,mode:n});return i.start(e),i};fe.aes.createDecryptionCipher=function(t,e){return ns({key:t,output:null,decrypt:!0,mode:e})};fe.aes.Algorithm=function(t,e){Xo||ef();var r=this;r.name=t,r.mode=new e({blockSize:16,cipher:{encrypt:function(n,i){return jo(r._w,n,i,!1)},decrypt:function(n,i){return jo(r._w,n,i,!0)}}}),r._init=!1};fe.aes.Algorithm.prototype.initialize=function(t){if(!this._init){var e=t.key,r;if(typeof e=="string"&&(e.length===16||e.length===24||e.length===32))e=fe.util.createBuffer(e);else if(fe.util.isArray(e)&&(e.length===16||e.length===24||e.length===32)){r=e,e=fe.util.createBuffer();for(var n=0;n<r.length;++n)e.putByte(r[n])}if(!fe.util.isArray(e)){r=e,e=[];var i=r.length();if(i===16||i===24||i===32){i=i>>>2;for(var n=0;n<i;++n)e.push(r.getInt32())}}if(!fe.util.isArray(e)||!(e.length===4||e.length===6||e.length===8))throw new Error("Invalid key parameter.");var s=this.mode.name,o=["CFB","OFB","CTR","GCM"].indexOf(s)!==-1;this._w=tf(e,t.decrypt&&!o),this._init=!0}};fe.aes._expandKey=function(t,e){return Xo||ef(),tf(t,e)};fe.aes._updateBlock=jo;cn("AES-ECB",fe.cipher.modes.ecb);cn("AES-CBC",fe.cipher.modes.cbc);cn("AES-CFB",fe.cipher.modes.cfb);cn("AES-OFB",fe.cipher.modes.ofb);cn("AES-CTR",fe.cipher.modes.ctr);cn("AES-GCM",fe.cipher.modes.gcm);function cn(t,e){var r=function(){return new fe.aes.Algorithm(t,e)};fe.cipher.registerAlgorithm(t,r)}var Xo=!1,an=4,$e,Zo,Ju,Cr,xt;function ef(){Xo=!0,Ju=[0,1,2,4,8,16,32,64,128,27,54];for(var t=new Array(256),e=0;e<128;++e)t[e]=e<<1,t[e+128]=e+128<<1^283;$e=new Array(256),Zo=new Array(256),Cr=new Array(4),xt=new Array(4);for(var e=0;e<4;++e)Cr[e]=new Array(256),xt[e]=new Array(256);for(var r=0,n=0,i,s,o,a,c,u,f,e=0;e<256;++e){a=n^n<<1^n<<2^n<<3^n<<4,a=a>>8^a&255^99,$e[r]=a,Zo[a]=r,c=t[a],i=t[r],s=t[i],o=t[s],u=c<<24^a<<16^a<<8^(a^c),f=(i^s^o)<<24^(r^o)<<16^(r^s^o)<<8^(r^i^o);for(var h=0;h<4;++h)Cr[h][r]=u,xt[h][a]=f,u=u<<24|u>>>8,f=f<<24|f>>>8;r===0?r=n=1:(r=i^t[t[t[i^o]]],n^=t[t[n]])}}function tf(t,e){for(var r=t.slice(0),n,i=1,s=r.length,o=s+6+1,a=an*o,c=s;c<a;++c)n=r[c-1],c%s===0?(n=$e[n>>>16&255]<<24^$e[n>>>8&255]<<16^$e[n&255]<<8^$e[n>>>24]^Ju[i]<<24,i++):s>6&&c%s===4&&(n=$e[n>>>24]<<24^$e[n>>>16&255]<<16^$e[n>>>8&255]<<8^$e[n&255]),r[c]=r[c-s]^n;if(e){var u,f=xt[0],h=xt[1],l=xt[2],g=xt[3],p=r.slice(0);a=r.length;for(var c=0,d=a-an;c<a;c+=an,d-=an)if(c===0||c===a-an)p[c]=r[d],p[c+1]=r[d+3],p[c+2]=r[d+2],p[c+3]=r[d+1];else for(var m=0;m<an;++m)u=r[d+m],p[c+(3&-m)]=f[$e[u>>>24]]^h[$e[u>>>16&255]]^l[$e[u>>>8&255]]^g[$e[u&255]];r=p}return r}function jo(t,e,r,n){var i=t.length/4-1,s,o,a,c,u;n?(s=xt[0],o=xt[1],a=xt[2],c=xt[3],u=Zo):(s=Cr[0],o=Cr[1],a=Cr[2],c=Cr[3],u=$e);var f,h,l,g,p,d,m;f=e[0]^t[0],h=e[n?3:1]^t[1],l=e[2]^t[2],g=e[n?1:3]^t[3];for(var b=3,S=1;S<i;++S)p=s[f>>>24]^o[h>>>16&255]^a[l>>>8&255]^c[g&255]^t[++b],d=s[h>>>24]^o[l>>>16&255]^a[g>>>8&255]^c[f&255]^t[++b],m=s[l>>>24]^o[g>>>16&255]^a[f>>>8&255]^c[h&255]^t[++b],g=s[g>>>24]^o[f>>>16&255]^a[h>>>8&255]^c[l&255]^t[++b],f=p,h=d,l=m;r[0]=u[f>>>24]<<24^u[h>>>16&255]<<16^u[l>>>8&255]<<8^u[g&255]^t[++b],r[n?3:1]=u[h>>>24]<<24^u[l>>>16&255]<<16^u[g>>>8&255]<<8^u[f&255]^t[++b],r[2]=u[l>>>24]<<24^u[g>>>16&255]<<16^u[f>>>8&255]<<8^u[h&255]^t[++b],r[n?1:3]=u[g>>>24]<<24^u[f>>>16&255]<<16^u[h>>>8&255]<<8^u[l&255]^t[++b]}function ns(t){t=t||{};var e=(t.mode||"CBC").toUpperCase(),r="AES-"+e,n;t.decrypt?n=fe.cipher.createDecipher(r,t.key):n=fe.cipher.createCipher(r,t.key);var i=n.start;return n.start=function(s,o){var a=null;o instanceof fe.util.ByteBuffer&&(a=o,o={}),o=o||{},o.output=a,o.iv=s,i.call(n,o)},n}});var of=L((cA,sf)=>{var ve=ie();Wo();Yo();Re();sf.exports=ve.des=ve.des||{};ve.des.startEncrypting=function(t,e,r,n){var i=is({key:t,output:r,decrypt:!1,mode:n||(e===null?"ECB":"CBC")});return i.start(e),i};ve.des.createEncryptionCipher=function(t,e){return is({key:t,output:null,decrypt:!1,mode:e})};ve.des.startDecrypting=function(t,e,r,n){var i=is({key:t,output:r,decrypt:!0,mode:n||(e===null?"ECB":"CBC")});return i.start(e),i};ve.des.createDecryptionCipher=function(t,e){return is({key:t,output:null,decrypt:!0,mode:e})};ve.des.Algorithm=function(t,e){var r=this;r.name=t,r.mode=new e({blockSize:8,cipher:{encrypt:function(n,i){return nf(r._keys,n,i,!1)},decrypt:function(n,i){return nf(r._keys,n,i,!0)}}}),r._init=!1};ve.des.Algorithm.prototype.initialize=function(t){if(!this._init){var e=ve.util.createBuffer(t.key);if(this.name.indexOf("3DES")===0&&e.length()!==24)throw new Error("Invalid Triple-DES key size: "+e.length()*8);this._keys=Py(e),this._init=!0}};Pt("DES-ECB",ve.cipher.modes.ecb);Pt("DES-CBC",ve.cipher.modes.cbc);Pt("DES-CFB",ve.cipher.modes.cfb);Pt("DES-OFB",ve.cipher.modes.ofb);Pt("DES-CTR",ve.cipher.modes.ctr);Pt("3DES-ECB",ve.cipher.modes.ecb);Pt("3DES-CBC",ve.cipher.modes.cbc);Pt("3DES-CFB",ve.cipher.modes.cfb);Pt("3DES-OFB",ve.cipher.modes.ofb);Pt("3DES-CTR",ve.cipher.modes.ctr);function Pt(t,e){var r=function(){return new ve.des.Algorithm(t,e)};ve.cipher.registerAlgorithm(t,r)}var Sy=[16843776,0,65536,16843780,16842756,66564,4,65536,1024,16843776,16843780,1024,16778244,16842756,16777216,4,1028,16778240,16778240,66560,66560,16842752,16842752,16778244,65540,16777220,16777220,65540,0,1028,66564,16777216,65536,16843780,4,16842752,16843776,16777216,16777216,1024,16842756,65536,66560,16777220,1024,4,16778244,66564,16843780,65540,16842752,16778244,16777220,1028,66564,16843776,1028,16778240,16778240,0,65540,66560,0,16842756],_y=[-2146402272,-2147450880,32768,1081376,1048576,32,-2146435040,-2147450848,-2147483616,-2146402272,-2146402304,-2147483648,-2147450880,1048576,32,-2146435040,1081344,1048608,-2147450848,0,-2147483648,32768,1081376,-2146435072,1048608,-2147483616,0,1081344,32800,-2146402304,-2146435072,32800,0,1081376,-2146435040,1048576,-2147450848,-2146435072,-2146402304,32768,-2146435072,-2147450880,32,-2146402272,1081376,32,32768,-2147483648,32800,-2146402304,1048576,-2147483616,1048608,-2147450848,-2147483616,1048608,1081344,0,-2147450880,32800,-2147483648,-2146435040,-2146402272,1081344],Ay=[520,134349312,0,134348808,134218240,0,131592,134218240,131080,134217736,134217736,131072,134349320,131080,134348800,520,134217728,8,134349312,512,131584,134348800,134348808,131592,134218248,131584,131072,134218248,8,134349320,512,134217728,134349312,134217728,131080,520,131072,134349312,134218240,0,512,131080,134349320,134218240,134217736,512,0,134348808,134218248,131072,134217728,134349320,8,131592,131584,134217736,134348800,134218248,520,134348800,131592,8,134348808,131584],Ty=[8396801,8321,8321,128,8396928,8388737,8388609,8193,0,8396800,8396800,8396929,129,0,8388736,8388609,1,8192,8388608,8396801,128,8388608,8193,8320,8388737,1,8320,8388736,8192,8396928,8396929,129,8388736,8388609,8396800,8396929,129,0,0,8396800,8320,8388736,8388737,1,8396801,8321,8321,128,8396929,129,1,8192,8388609,8193,8396928,8388737,8193,8320,8388608,8396801,128,8388608,8192,8396928],Iy=[256,34078976,34078720,1107296512,524288,256,1073741824,34078720,1074266368,524288,33554688,1074266368,1107296512,1107820544,524544,1073741824,33554432,1074266112,1074266112,0,1073742080,1107820800,1107820800,33554688,1107820544,1073742080,0,1107296256,34078976,33554432,1107296256,524544,524288,1107296512,256,33554432,1073741824,34078720,1107296512,1074266368,33554688,1073741824,1107820544,34078976,1074266368,256,33554432,1107820544,1107820800,524544,1107296256,1107820800,34078720,0,1074266112,1107296256,524544,33554688,1073742080,524288,0,1074266112,34078976,1073742080],Cy=[536870928,541065216,16384,541081616,541065216,16,541081616,4194304,536887296,4210704,4194304,536870928,4194320,536887296,536870912,16400,0,4194320,536887312,16384,4210688,536887312,16,541065232,541065232,0,4210704,541081600,16400,4210688,541081600,536870912,536887296,16,541065232,4210688,541081616,4194304,16400,536870928,4194304,536887296,536870912,16400,536870928,541081616,4210688,541065216,4210704,541081600,0,541065232,16,16384,541065216,4210704,16384,4194320,536887312,0,541081600,536870912,4194320,536887312],By=[2097152,69206018,67110914,0,2048,67110914,2099202,69208064,69208066,2097152,0,67108866,2,67108864,69206018,2050,67110912,2099202,2097154,67110912,67108866,69206016,69208064,2097154,69206016,2048,2050,69208066,2099200,2,67108864,2099200,67108864,2099200,2097152,67110914,67110914,69206018,69206018,2,2097154,67108864,67110912,2097152,69208064,2050,2099202,69208064,2050,67108866,69208066,69206016,2099200,0,2,69208066,0,2099202,69206016,2048,67108866,67110912,2048,2097154],Ry=[268439616,4096,262144,268701760,268435456,268439616,64,268435456,262208,268697600,268701760,266240,268701696,266304,4096,64,268697600,268435520,268439552,4160,266240,262208,268697664,268701696,4160,0,0,268697664,268435520,268439552,266304,262144,266304,262144,268701696,4096,64,268697664,4096,266304,268439552,64,268435520,268697600,268697664,268435456,262144,268439616,0,268701760,262208,268435520,268697600,268439552,268439616,0,268701760,266240,266240,4160,4160,262208,268435456,268701696];function Py(t){for(var e=[0,4,536870912,536870916,65536,65540,536936448,536936452,512,516,536871424,536871428,66048,66052,536936960,536936964],r=[0,1,1048576,1048577,67108864,67108865,68157440,68157441,256,257,1048832,1048833,67109120,67109121,68157696,68157697],n=[0,8,2048,2056,16777216,16777224,16779264,16779272,0,8,2048,2056,16777216,16777224,16779264,16779272],i=[0,2097152,134217728,136314880,8192,2105344,134225920,136323072,131072,2228224,134348800,136445952,139264,2236416,134356992,136454144],s=[0,262144,16,262160,0,262144,16,262160,4096,266240,4112,266256,4096,266240,4112,266256],o=[0,1024,32,1056,0,1024,32,1056,33554432,33555456,33554464,33555488,33554432,33555456,33554464,33555488],a=[0,268435456,524288,268959744,2,268435458,524290,268959746,0,268435456,524288,268959744,2,268435458,524290,268959746],c=[0,65536,2048,67584,536870912,536936448,536872960,536938496,131072,196608,133120,198656,537001984,537067520,537004032,537069568],u=[0,262144,0,262144,2,262146,2,262146,33554432,33816576,33554432,33816576,33554434,33816578,33554434,33816578],f=[0,268435456,8,268435464,0,268435456,8,268435464,1024,268436480,1032,268436488,1024,268436480,1032,268436488],h=[0,32,0,32,1048576,1048608,1048576,1048608,8192,8224,8192,8224,1056768,1056800,1056768,1056800],l=[0,16777216,512,16777728,2097152,18874368,2097664,18874880,67108864,83886080,67109376,83886592,69206016,85983232,69206528,85983744],g=[0,4096,134217728,134221824,524288,528384,134742016,134746112,16,4112,134217744,134221840,524304,528400,134742032,134746128],p=[0,4,256,260,0,4,256,260,1,5,257,261,1,5,257,261],d=t.length()>8?3:1,m=[],b=[0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,0],S=0,I,R=0;R<d;R++){var w=t.getInt32(),T=t.getInt32();I=(w>>>4^T)&252645135,T^=I,w^=I<<4,I=(T>>>-16^w)&65535,w^=I,T^=I<<-16,I=(w>>>2^T)&858993459,T^=I,w^=I<<2,I=(T>>>-16^w)&65535,w^=I,T^=I<<-16,I=(w>>>1^T)&1431655765,T^=I,w^=I<<1,I=(T>>>8^w)&16711935,w^=I,T^=I<<8,I=(w>>>1^T)&1431655765,T^=I,w^=I<<1,I=w<<8|T>>>20&240,w=T<<24|T<<8&16711680|T>>>8&65280|T>>>24&240,T=I;for(var D=0;D<b.length;++D){b[D]?(w=w<<2|w>>>26,T=T<<2|T>>>26):(w=w<<1|w>>>27,T=T<<1|T>>>27),w&=-15,T&=-15;var k=e[w>>>28]|r[w>>>24&15]|n[w>>>20&15]|i[w>>>16&15]|s[w>>>12&15]|o[w>>>8&15]|a[w>>>4&15],V=c[T>>>28]|u[T>>>24&15]|f[T>>>20&15]|h[T>>>16&15]|l[T>>>12&15]|g[T>>>8&15]|p[T>>>4&15];I=(V>>>16^k)&65535,m[S++]=k^I,m[S++]=V^I<<16}}return m}function nf(t,e,r,n){var i=t.length===32?3:9,s;i===3?s=n?[30,-2,-2]:[0,32,2]:s=n?[94,62,-2,32,64,2,30,-2,-2]:[0,32,2,62,30,-2,64,96,2];var o,a=e[0],c=e[1];o=(a>>>4^c)&252645135,c^=o,a^=o<<4,o=(a>>>16^c)&65535,c^=o,a^=o<<16,o=(c>>>2^a)&858993459,a^=o,c^=o<<2,o=(c>>>8^a)&16711935,a^=o,c^=o<<8,o=(a>>>1^c)&1431655765,c^=o,a^=o<<1,a=a<<1|a>>>31,c=c<<1|c>>>31;for(var u=0;u<i;u+=3){for(var f=s[u+1],h=s[u+2],l=s[u];l!=f;l+=h){var g=c^t[l],p=(c>>>4|c<<28)^t[l+1];o=a,a=c,c=o^(_y[g>>>24&63]|Ty[g>>>16&63]|Cy[g>>>8&63]|Ry[g&63]|Sy[p>>>24&63]|Ay[p>>>16&63]|Iy[p>>>8&63]|By[p&63])}o=a,a=c,c=o}a=a>>>1|a<<31,c=c>>>1|c<<31,o=(a>>>1^c)&1431655765,c^=o,a^=o<<1,o=(c>>>8^a)&16711935,a^=o,c^=o<<8,o=(c>>>2^a)&858993459,a^=o,c^=o<<2,o=(a>>>16^c)&65535,c^=o,a^=o<<16,o=(a>>>4^c)&252645135,c^=o,a^=o<<4,r[0]=a,r[1]=c}function is(t){t=t||{};var e=(t.mode||"CBC").toUpperCase(),r="DES-"+e,n;t.decrypt?n=ve.cipher.createDecipher(r,t.key):n=ve.cipher.createCipher(r,t.key);var i=n.start;return n.start=function(s,o){var a=null;o instanceof ve.util.ByteBuffer&&(a=o,o={}),o=o||{},o.output=a,o.iv=s,i.call(n,o)},n}});var Br=L((uA,af)=>{var ss=ie();af.exports=ss.md=ss.md||{};ss.md.algorithms=ss.md.algorithms||{}});var uf=L((fA,cf)=>{var Yt=ie();Br();Re();var Dy=cf.exports=Yt.hmac=Yt.hmac||{};Dy.create=function(){var t=null,e=null,r=null,n=null,i={};return i.start=function(s,o){if(s!==null)if(typeof s=="string")if(s=s.toLowerCase(),s in Yt.md.algorithms)e=Yt.md.algorithms[s].create();else throw new Error('Unknown hash algorithm "'+s+'"');else e=s;if(o===null)o=t;else{if(typeof o=="string")o=Yt.util.createBuffer(o);else if(Yt.util.isArray(o)){var a=o;o=Yt.util.createBuffer();for(var c=0;c<a.length;++c)o.putByte(a[c])}var u=o.length();u>e.blockLength&&(e.start(),e.update(o.bytes()),o=e.digest()),r=Yt.util.createBuffer(),n=Yt.util.createBuffer(),u=o.length();for(var c=0;c<u;++c){var a=o.at(c);r.putByte(54^a),n.putByte(92^a)}if(u<e.blockLength)for(var a=e.blockLength-u,c=0;c<a;++c)r.putByte(54),n.putByte(92);t=o,r=r.bytes(),n=n.bytes()}e.start(),e.update(r)},i.update=function(s){e.update(s)},i.getMac=function(){var s=e.digest().bytes();return e.start(),e.update(n),e.update(s),e.digest()},i.digest=i.getMac,i}});var un=L(()=>{});var hf=L((pA,ff)=>{var Ye=ie();uf();Br();Re();var My=Ye.pkcs5=Ye.pkcs5||{},Zt;Ye.util.isNodejs&&!Ye.options.usePureJavaScript&&(Zt=un());ff.exports=Ye.pbkdf2=My.pbkdf2=function(t,e,r,n,i,s){if(typeof i=="function"&&(s=i,i=null),Ye.util.isNodejs&&!Ye.options.usePureJavaScript&&Zt.pbkdf2&&(i===null||typeof i!="object")&&(Zt.pbkdf2Sync.length>4||!i||i==="sha1"))return typeof i!="string"&&(i="sha1"),t=Buffer.from(t,"binary"),e=Buffer.from(e,"binary"),s?Zt.pbkdf2Sync.length===4?Zt.pbkdf2(t,e,r,n,function(I,R){if(I)return s(I);s(null,R.toString("binary"))}):Zt.pbkdf2(t,e,r,n,i,function(I,R){if(I)return s(I);s(null,R.toString("binary"))}):Zt.pbkdf2Sync.length===4?Zt.pbkdf2Sync(t,e,r,n).toString("binary"):Zt.pbkdf2Sync(t,e,r,n,i).toString("binary");if((typeof i>"u"||i===null)&&(i="sha1"),typeof i=="string"){if(!(i in Ye.md.algorithms))throw new Error("Unknown hash algorithm: "+i);i=Ye.md[i].create()}var o=i.digestLength;if(n>4294967295*o){var a=new Error("Derived key is too long.");if(s)return s(a);throw a}var c=Math.ceil(n/o),u=n-(c-1)*o,f=Ye.hmac.create();f.start(i,t);var h="",l,g,p;if(!s){for(var d=1;d<=c;++d){f.start(null,null),f.update(e),f.update(Ye.util.int32ToBytes(d)),l=p=f.digest().getBytes();for(var m=2;m<=r;++m)f.start(null,null),f.update(p),g=f.digest().getBytes(),l=Ye.util.xorBytes(l,g,o),p=g;h+=d<c?l:l.substr(0,u)}return h}var d=1,m;function b(){if(d>c)return s(null,h);f.start(null,null),f.update(e),f.update(Ye.util.int32ToBytes(d)),l=p=f.digest().getBytes(),m=2,S()}function S(){if(m<=r)return f.start(null,null),f.update(p),g=f.digest().getBytes(),l=Ye.util.xorBytes(l,g,o),p=g,++m,Ye.util.setImmediate(S);h+=d<c?l:l.substr(0,u),++d,b()}b()}});var df=L((dA,pf)=>{var as=ie();Re();var lf=pf.exports=as.pem=as.pem||{};lf.encode=function(t,e){e=e||{};var r="-----BEGIN "+t.type+`-----\r
`,n;if(t.procType&&(n={name:"Proc-Type",values:[String(t.procType.version),t.procType.type]},r+=os(n)),t.contentDomain&&(n={name:"Content-Domain",values:[t.contentDomain]},r+=os(n)),t.dekInfo&&(n={name:"DEK-Info",values:[t.dekInfo.algorithm]},t.dekInfo.parameters&&n.values.push(t.dekInfo.parameters),r+=os(n)),t.headers)for(var i=0;i<t.headers.length;++i)r+=os(t.headers[i]);return t.procType&&(r+=`\r
`),r+=as.util.encode64(t.body,e.maxline||64)+`\r
`,r+="-----END "+t.type+`-----\r
`,r};lf.decode=function(t){for(var e=[],r=/\s*-----BEGIN ([A-Z0-9- ]+)-----\r?\n?([\x21-\x7e\s]+?(?:\r?\n\r?\n))?([:A-Za-z0-9+\/=\s]+?)-----END \1-----/g,n=/([\x21-\x7e]+):\s*([\x21-\x7e\s^:]+)/,i=/\r?\n/,s;s=r.exec(t),!!s;){var o=s[1];o==="NEW CERTIFICATE REQUEST"&&(o="CERTIFICATE REQUEST");var a={type:o,procType:null,contentDomain:null,dekInfo:null,headers:[],body:as.util.decode64(s[3])};if(e.push(a),!!s[2]){for(var c=s[2].split(i),u=0;s&&u<c.length;){for(var f=c[u].replace(/\s+$/,""),h=u+1;h<c.length;++h){var l=c[h];if(!/\s/.test(l[0]))break;f+=l,u=h}if(s=f.match(n),s){for(var g={name:s[1],values:[]},p=s[2].split(","),d=0;d<p.length;++d)g.values.push(Ly(p[d]));if(a.procType)if(!a.contentDomain&&g.name==="Content-Domain")a.contentDomain=p[0]||"";else if(!a.dekInfo&&g.name==="DEK-Info"){if(g.values.length===0)throw new Error('Invalid PEM formatted message. The "DEK-Info" header must have at least one subfield.');a.dekInfo={algorithm:p[0],parameters:p[1]||null}}else a.headers.push(g);else{if(g.name!=="Proc-Type")throw new Error('Invalid PEM formatted message. The first encapsulated header must be "Proc-Type".');if(g.values.length!==2)throw new Error('Invalid PEM formatted message. The "Proc-Type" header must have two subfields.');a.procType={version:p[0],type:p[1]}}}++u}if(a.procType==="ENCRYPTED"&&!a.dekInfo)throw new Error('Invalid PEM formatted message. The "DEK-Info" header must be present if "Proc-Type" is "ENCRYPTED".')}}if(e.length===0)throw new Error("Invalid PEM formatted message.");return e};function os(t){for(var e=t.name+": ",r=[],n=function(c,u){return" "+u},i=0;i<t.values.length;++i)r.push(t.values[i].replace(/^(\S+\r\n)/,n));e+=r.join(",")+`\r
`;for(var s=0,o=-1,i=0;i<e.length;++i,++s)if(s>65&&o!==-1){var a=e[o];a===","?(++o,e=e.substr(0,o)+`\r
 `+e.substr(o)):e=e.substr(0,o)+`\r
`+a+e.substr(o+1),s=i-o-1,o=-1,++i}else(e[i]===" "||e[i]==="	"||e[i]===",")&&(o=i);return e}function Ly(t){return t.replace(/^\s+/,"")}});var wf=L((gA,bf)=>{var Dt=ie();Br();Re();var yf=bf.exports=Dt.sha256=Dt.sha256||{};Dt.md.sha256=Dt.md.algorithms.sha256=yf;yf.create=function(){mf||Ny();var t=null,e=Dt.util.createBuffer(),r=new Array(64),n={algorithm:"sha256",blockLength:64,digestLength:32,messageLength:0,fullMessageLength:null,messageLengthSize:8};return n.start=function(){n.messageLength=0,n.fullMessageLength=n.messageLength64=[];for(var i=n.messageLengthSize/4,s=0;s<i;++s)n.fullMessageLength.push(0);return e=Dt.util.createBuffer(),t={h0:1779033703,h1:3144134277,h2:1013904242,h3:2773480762,h4:1359893119,h5:2600822924,h6:528734635,h7:1541459225},n},n.start(),n.update=function(i,s){s==="utf8"&&(i=Dt.util.encodeUtf8(i));var o=i.length;n.messageLength+=o,o=[o/4294967296>>>0,o>>>0];for(var a=n.fullMessageLength.length-1;a>=0;--a)n.fullMessageLength[a]+=o[1],o[1]=o[0]+(n.fullMessageLength[a]/4294967296>>>0),n.fullMessageLength[a]=n.fullMessageLength[a]>>>0,o[0]=o[1]/4294967296>>>0;return e.putBytes(i),gf(t,r,e),(e.read>2048||e.length()===0)&&e.compact(),n},n.digest=function(){var i=Dt.util.createBuffer();i.putBytes(e.bytes());var s=n.fullMessageLength[n.fullMessageLength.length-1]+n.messageLengthSize,o=s&n.blockLength-1;i.putBytes(Jo.substr(0,n.blockLength-o));for(var a,c,u=n.fullMessageLength[0]*8,f=0;f<n.fullMessageLength.length-1;++f)a=n.fullMessageLength[f+1]*8,c=a/4294967296>>>0,u+=c,i.putInt32(u>>>0),u=a>>>0;i.putInt32(u);var h={h0:t.h0,h1:t.h1,h2:t.h2,h3:t.h3,h4:t.h4,h5:t.h5,h6:t.h6,h7:t.h7};gf(h,r,i);var l=Dt.util.createBuffer();return l.putInt32(h.h0),l.putInt32(h.h1),l.putInt32(h.h2),l.putInt32(h.h3),l.putInt32(h.h4),l.putInt32(h.h5),l.putInt32(h.h6),l.putInt32(h.h7),l},n};var Jo=null,mf=!1,vf=null;function Ny(){Jo=String.fromCharCode(128),Jo+=Dt.util.fillString(String.fromCharCode(0),64),vf=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],mf=!0}function gf(t,e,r){for(var n,i,s,o,a,c,u,f,h,l,g,p,d,m,b,S=r.length();S>=64;){for(u=0;u<16;++u)e[u]=r.getInt32();for(;u<64;++u)n=e[u-2],n=(n>>>17|n<<15)^(n>>>19|n<<13)^n>>>10,i=e[u-15],i=(i>>>7|i<<25)^(i>>>18|i<<14)^i>>>3,e[u]=n+e[u-7]+i+e[u-16]|0;for(f=t.h0,h=t.h1,l=t.h2,g=t.h3,p=t.h4,d=t.h5,m=t.h6,b=t.h7,u=0;u<64;++u)o=(p>>>6|p<<26)^(p>>>11|p<<21)^(p>>>25|p<<7),a=m^p&(d^m),s=(f>>>2|f<<30)^(f>>>13|f<<19)^(f>>>22|f<<10),c=f&h|l&(f^h),n=b+o+a+vf[u]+e[u],i=s+c,b=m,m=d,d=p,p=g+n>>>0,g=l,l=h,h=f,f=n+i>>>0;t.h0=t.h0+f|0,t.h1=t.h1+h|0,t.h2=t.h2+l|0,t.h3=t.h3+g|0,t.h4=t.h4+p|0,t.h5=t.h5+d|0,t.h6=t.h6+m|0,t.h7=t.h7+b|0,S-=64}}});var Ef=L((yA,xf)=>{var Mt=ie();Re();var cs=null;Mt.util.isNodejs&&!Mt.options.usePureJavaScript&&!process.versions["node-webkit"]&&(cs=un());var ky=xf.exports=Mt.prng=Mt.prng||{};ky.create=function(t){for(var e={plugin:t,key:null,seed:null,time:null,reseeds:0,generated:0,keyBytes:""},r=t.md,n=new Array(32),i=0;i<32;++i)n[i]=r.create();e.pools=n,e.pool=0,e.generate=function(u,f){if(!f)return e.generateSync(u);var h=e.plugin.cipher,l=e.plugin.increment,g=e.plugin.formatKey,p=e.plugin.formatSeed,d=Mt.util.createBuffer();e.key=null,m();function m(b){if(b)return f(b);if(d.length()>=u)return f(null,d.getBytes(u));if(e.generated>1048575&&(e.key=null),e.key===null)return Mt.util.nextTick(function(){s(m)});var S=h(e.key,e.seed);e.generated+=S.length,d.putBytes(S),e.key=g(h(e.key,l(e.seed))),e.seed=p(h(e.key,e.seed)),Mt.util.setImmediate(m)}},e.generateSync=function(u){var f=e.plugin.cipher,h=e.plugin.increment,l=e.plugin.formatKey,g=e.plugin.formatSeed;e.key=null;for(var p=Mt.util.createBuffer();p.length()<u;){e.generated>1048575&&(e.key=null),e.key===null&&o();var d=f(e.key,e.seed);e.generated+=d.length,p.putBytes(d),e.key=l(f(e.key,h(e.seed))),e.seed=g(f(e.key,e.seed))}return p.getBytes(u)};function s(u){if(e.pools[0].messageLength>=32)return a(),u();var f=32-e.pools[0].messageLength<<5;e.seedFile(f,function(h,l){if(h)return u(h);e.collect(l),a(),u()})}function o(){if(e.pools[0].messageLength>=32)return a();var u=32-e.pools[0].messageLength<<5;e.collect(e.seedFileSync(u)),a()}function a(){e.reseeds=e.reseeds===4294967295?0:e.reseeds+1;var u=e.plugin.md.create();u.update(e.keyBytes);for(var f=1,h=0;h<32;++h)e.reseeds%f===0&&(u.update(e.pools[h].digest().getBytes()),e.pools[h].start()),f=f<<1;e.keyBytes=u.digest().getBytes(),u.start(),u.update(e.keyBytes);var l=u.digest().getBytes();e.key=e.plugin.formatKey(e.keyBytes),e.seed=e.plugin.formatSeed(l),e.generated=0}function c(u){var f=null,h=Mt.util.globalScope,l=h.crypto||h.msCrypto;l&&l.getRandomValues&&(f=function(w){return l.getRandomValues(w)});var g=Mt.util.createBuffer();if(f)for(;g.length()<u;){var p=Math.max(1,Math.min(u-g.length(),65536)/4),d=new Uint32Array(Math.floor(p));try{f(d);for(var m=0;m<d.length;++m)g.putInt32(d[m])}catch(w){if(!(typeof QuotaExceededError<"u"&&w instanceof QuotaExceededError))throw w}}if(g.length()<u)for(var b,S,I,R=Math.floor(Math.random()*65536);g.length()<u;){S=16807*(R&65535),b=16807*(R>>16),S+=(b&32767)<<16,S+=b>>15,S=(S&2147483647)+(S>>31),R=S&4294967295;for(var m=0;m<3;++m)I=R>>>(m<<3),I^=Math.floor(Math.random()*256),g.putByte(I&255)}return g.getBytes(u)}return cs?(e.seedFile=function(u,f){cs.randomBytes(u,function(h,l){if(h)return f(h);f(null,l.toString())})},e.seedFileSync=function(u){return cs.randomBytes(u).toString()}):(e.seedFile=function(u,f){try{f(null,c(u))}catch(h){f(h)}},e.seedFileSync=c),e.collect=function(u){for(var f=u.length,h=0;h<f;++h)e.pools[e.pool].update(u.substr(h,1)),e.pool=e.pool===31?0:e.pool+1},e.collectInt=function(u,f){for(var h="",l=0;l<f;l+=8)h+=String.fromCharCode(u>>l&255);e.collect(h)},e.registerWorker=function(u){if(u===self)e.seedFile=function(h,l){function g(p){var d=p.data;d.forge&&d.forge.prng&&(self.removeEventListener("message",g),l(d.forge.prng.err,d.forge.prng.bytes))}self.addEventListener("message",g),self.postMessage({forge:{prng:{needed:h}}})};else{var f=function(h){var l=h.data;l.forge&&l.forge.prng&&e.seedFile(l.forge.prng.needed,function(g,p){u.postMessage({forge:{prng:{err:g,bytes:p}}})})};u.addEventListener("message",f)}},e}});var ii=L((mA,ea)=>{var qe=ie();Qo();wf();Ef();Re();(function(){if(qe.random&&qe.random.getBytes){ea.exports=qe.random;return}(function(t){var e={},r=new Array(4),n=qe.util.createBuffer();e.formatKey=function(h){var l=qe.util.createBuffer(h);return h=new Array(4),h[0]=l.getInt32(),h[1]=l.getInt32(),h[2]=l.getInt32(),h[3]=l.getInt32(),qe.aes._expandKey(h,!1)},e.formatSeed=function(h){var l=qe.util.createBuffer(h);return h=new Array(4),h[0]=l.getInt32(),h[1]=l.getInt32(),h[2]=l.getInt32(),h[3]=l.getInt32(),h},e.cipher=function(h,l){return qe.aes._updateBlock(h,l,r,!1),n.putInt32(r[0]),n.putInt32(r[1]),n.putInt32(r[2]),n.putInt32(r[3]),n.getBytes()},e.increment=function(h){return++h[3],h},e.md=qe.md.sha256;function i(){var h=qe.prng.create(e);return h.getBytes=function(l,g){return h.generate(l,g)},h.getBytesSync=function(l){return h.generate(l)},h}var s=i(),o=null,a=qe.util.globalScope,c=a.crypto||a.msCrypto;if(c&&c.getRandomValues&&(o=function(h){return c.getRandomValues(h)}),qe.options.usePureJavaScript||!qe.util.isNodejs&&!o){if(typeof window>"u"||window.document,s.collectInt(+new Date,32),typeof navigator<"u"){var u="";for(var f in navigator)try{typeof navigator[f]=="string"&&(u+=navigator[f])}catch{}s.collect(u),u=null}t&&(t().mousemove(function(h){s.collectInt(h.clientX,16),s.collectInt(h.clientY,16)}),t().keypress(function(h){s.collectInt(h.charCode,8)}))}if(!qe.random)qe.random=s;else for(var f in s)qe.random[f]=s[f];qe.random.createInstance=i,ea.exports=qe.random})(typeof jQuery<"u"?jQuery:null)})()});var Tf=L((vA,Af)=>{var Qe=ie();Re();var ta=[217,120,249,196,25,221,181,237,40,233,253,121,74,160,216,157,198,126,55,131,43,118,83,142,98,76,100,136,68,139,251,162,23,154,89,245,135,179,79,19,97,69,109,141,9,129,125,50,189,143,64,235,134,183,123,11,240,149,33,34,92,107,78,130,84,214,101,147,206,96,178,28,115,86,192,20,167,140,241,220,18,117,202,31,59,190,228,209,66,61,212,48,163,60,182,38,111,191,14,218,70,105,7,87,39,242,29,155,188,148,67,3,248,17,199,246,144,239,62,231,6,195,213,47,200,102,30,215,8,232,234,222,128,82,238,247,132,170,114,172,53,77,106,42,150,26,210,113,90,21,73,116,75,159,208,94,4,24,164,236,194,224,65,110,15,81,203,204,36,145,175,80,161,244,112,57,153,124,58,133,35,184,180,122,252,2,54,91,37,85,151,49,45,93,250,152,227,138,146,174,5,223,41,16,103,108,186,201,211,0,230,207,225,158,168,44,99,22,1,63,88,226,137,169,13,56,52,27,171,51,255,176,187,72,12,95,185,177,205,46,197,243,219,71,229,165,156,119,10,166,32,104,254,127,193,173],Sf=[1,2,3,5],Fy=function(t,e){return t<<e&65535|(t&65535)>>16-e},Uy=function(t,e){return(t&65535)>>e|t<<16-e&65535};Af.exports=Qe.rc2=Qe.rc2||{};Qe.rc2.expandKey=function(t,e){typeof t=="string"&&(t=Qe.util.createBuffer(t)),e=e||128;var r=t,n=t.length(),i=e,s=Math.ceil(i/8),o=255>>(i&7),a;for(a=n;a<128;a++)r.putByte(ta[r.at(a-1)+r.at(a-n)&255]);for(r.setAt(128-s,ta[r.at(128-s)&o]),a=127-s;a>=0;a--)r.setAt(a,ta[r.at(a+1)^r.at(a+s)]);return r};var _f=function(t,e,r){var n=!1,i=null,s=null,o=null,a,c,u,f,h=[];for(t=Qe.rc2.expandKey(t,e),u=0;u<64;u++)h.push(t.getInt16Le());r?(a=function(p){for(u=0;u<4;u++)p[u]+=h[f]+(p[(u+3)%4]&p[(u+2)%4])+(~p[(u+3)%4]&p[(u+1)%4]),p[u]=Fy(p[u],Sf[u]),f++},c=function(p){for(u=0;u<4;u++)p[u]+=h[p[(u+3)%4]&63]}):(a=function(p){for(u=3;u>=0;u--)p[u]=Uy(p[u],Sf[u]),p[u]-=h[f]+(p[(u+3)%4]&p[(u+2)%4])+(~p[(u+3)%4]&p[(u+1)%4]),f--},c=function(p){for(u=3;u>=0;u--)p[u]-=h[p[(u+3)%4]&63]});var l=function(p){var d=[];for(u=0;u<4;u++){var m=i.getInt16Le();o!==null&&(r?m^=o.getInt16Le():o.putInt16Le(m)),d.push(m&65535)}f=r?0:63;for(var b=0;b<p.length;b++)for(var S=0;S<p[b][0];S++)p[b][1](d);for(u=0;u<4;u++)o!==null&&(r?o.putInt16Le(d[u]):d[u]^=o.getInt16Le()),s.putInt16Le(d[u])},g=null;return g={start:function(p,d){p&&typeof p=="string"&&(p=Qe.util.createBuffer(p)),n=!1,i=Qe.util.createBuffer(),s=d||new Qe.util.createBuffer,o=p,g.output=s},update:function(p){for(n||i.putBuffer(p);i.length()>=8;)l([[5,a],[1,c],[6,a],[1,c],[5,a]])},finish:function(p){var d=!0;if(r)if(p)d=p(8,i,!r);else{var m=i.length()===8?8:8-i.length();i.fillWithByte(m,m)}if(d&&(n=!0,g.update()),!r&&(d=i.length()===0,d))if(p)d=p(8,s,!r);else{var b=s.length(),S=s.at(b-1);S>b?d=!1:s.truncate(S)}return d}},g};Qe.rc2.startEncrypting=function(t,e,r){var n=Qe.rc2.createEncryptionCipher(t,128);return n.start(e,r),n};Qe.rc2.createEncryptionCipher=function(t,e){return _f(t,e,!0)};Qe.rc2.startDecrypting=function(t,e,r){var n=Qe.rc2.createDecryptionCipher(t,128);return n.start(e,r),n};Qe.rc2.createDecryptionCipher=function(t,e){return _f(t,e,!1)}});var hs=L((bA,Lf)=>{var ra=ie();Lf.exports=ra.jsbn=ra.jsbn||{};var jt,Oy=0xdeadbeefcafe,If=(Oy&16777215)==15715070;function _(t,e,r){this.data=[],t!=null&&(typeof t=="number"?this.fromNumber(t,e,r):e==null&&typeof t!="string"?this.fromString(t,256):this.fromString(t,e))}ra.jsbn.BigInteger=_;function J(){return new _(null)}function Ky(t,e,r,n,i,s){for(;--s>=0;){var o=e*this.data[t++]+r.data[n]+i;i=Math.floor(o/67108864),r.data[n++]=o&67108863}return i}function qy(t,e,r,n,i,s){for(var o=e&32767,a=e>>15;--s>=0;){var c=this.data[t]&32767,u=this.data[t++]>>15,f=a*c+u*o;c=o*c+((f&32767)<<15)+r.data[n]+(i&1073741823),i=(c>>>30)+(f>>>15)+a*u+(i>>>30),r.data[n++]=c&1073741823}return i}function Cf(t,e,r,n,i,s){for(var o=e&16383,a=e>>14;--s>=0;){var c=this.data[t]&16383,u=this.data[t++]>>14,f=a*c+u*o;c=o*c+((f&16383)<<14)+r.data[n]+i,i=(c>>28)+(f>>14)+a*u,r.data[n++]=c&268435455}return i}typeof navigator>"u"?(_.prototype.am=Cf,jt=28):If&&navigator.appName=="Microsoft Internet Explorer"?(_.prototype.am=qy,jt=30):If&&navigator.appName!="Netscape"?(_.prototype.am=Ky,jt=26):(_.prototype.am=Cf,jt=28);_.prototype.DB=jt;_.prototype.DM=(1<<jt)-1;_.prototype.DV=1<<jt;var na=52;_.prototype.FV=Math.pow(2,na);_.prototype.F1=na-jt;_.prototype.F2=2*jt-na;var Vy="0123456789abcdefghijklmnopqrstuvwxyz",us=new Array,fn,ht;fn="0".charCodeAt(0);for(ht=0;ht<=9;++ht)us[fn++]=ht;fn="a".charCodeAt(0);for(ht=10;ht<36;++ht)us[fn++]=ht;fn="A".charCodeAt(0);for(ht=10;ht<36;++ht)us[fn++]=ht;function Bf(t){return Vy.charAt(t)}function Rf(t,e){var r=us[t.charCodeAt(e)];return r??-1}function zy(t){for(var e=this.t-1;e>=0;--e)t.data[e]=this.data[e];t.t=this.t,t.s=this.s}function Gy(t){this.t=1,this.s=t<0?-1:0,t>0?this.data[0]=t:t<-1?this.data[0]=t+this.DV:this.t=0}function lr(t){var e=J();return e.fromInt(t),e}function Hy(t,e){var r;if(e==16)r=4;else if(e==8)r=3;else if(e==256)r=8;else if(e==2)r=1;else if(e==32)r=5;else if(e==4)r=2;else{this.fromRadix(t,e);return}this.t=0,this.s=0;for(var n=t.length,i=!1,s=0;--n>=0;){var o=r==8?t[n]&255:Rf(t,n);if(o<0){t.charAt(n)=="-"&&(i=!0);continue}i=!1,s==0?this.data[this.t++]=o:s+r>this.DB?(this.data[this.t-1]|=(o&(1<<this.DB-s)-1)<<s,this.data[this.t++]=o>>this.DB-s):this.data[this.t-1]|=o<<s,s+=r,s>=this.DB&&(s-=this.DB)}r==8&&(t[0]&128)!=0&&(this.s=-1,s>0&&(this.data[this.t-1]|=(1<<this.DB-s)-1<<s)),this.clamp(),i&&_.ZERO.subTo(this,this)}function Wy(){for(var t=this.s&this.DM;this.t>0&&this.data[this.t-1]==t;)--this.t}function $y(t){if(this.s<0)return"-"+this.negate().toString(t);var e;if(t==16)e=4;else if(t==8)e=3;else if(t==2)e=1;else if(t==32)e=5;else if(t==4)e=2;else return this.toRadix(t);var r=(1<<e)-1,n,i=!1,s="",o=this.t,a=this.DB-o*this.DB%e;if(o-- >0)for(a<this.DB&&(n=this.data[o]>>a)>0&&(i=!0,s=Bf(n));o>=0;)a<e?(n=(this.data[o]&(1<<a)-1)<<e-a,n|=this.data[--o]>>(a+=this.DB-e)):(n=this.data[o]>>(a-=e)&r,a<=0&&(a+=this.DB,--o)),n>0&&(i=!0),i&&(s+=Bf(n));return i?s:"0"}function Yy(){var t=J();return _.ZERO.subTo(this,t),t}function Zy(){return this.s<0?this.negate():this}function jy(t){var e=this.s-t.s;if(e!=0)return e;var r=this.t;if(e=r-t.t,e!=0)return this.s<0?-e:e;for(;--r>=0;)if((e=this.data[r]-t.data[r])!=0)return e;return 0}function fs(t){var e=1,r;return(r=t>>>16)!=0&&(t=r,e+=16),(r=t>>8)!=0&&(t=r,e+=8),(r=t>>4)!=0&&(t=r,e+=4),(r=t>>2)!=0&&(t=r,e+=2),(r=t>>1)!=0&&(t=r,e+=1),e}function Xy(){return this.t<=0?0:this.DB*(this.t-1)+fs(this.data[this.t-1]^this.s&this.DM)}function Qy(t,e){var r;for(r=this.t-1;r>=0;--r)e.data[r+t]=this.data[r];for(r=t-1;r>=0;--r)e.data[r]=0;e.t=this.t+t,e.s=this.s}function Jy(t,e){for(var r=t;r<this.t;++r)e.data[r-t]=this.data[r];e.t=Math.max(this.t-t,0),e.s=this.s}function em(t,e){var r=t%this.DB,n=this.DB-r,i=(1<<n)-1,s=Math.floor(t/this.DB),o=this.s<<r&this.DM,a;for(a=this.t-1;a>=0;--a)e.data[a+s+1]=this.data[a]>>n|o,o=(this.data[a]&i)<<r;for(a=s-1;a>=0;--a)e.data[a]=0;e.data[s]=o,e.t=this.t+s+1,e.s=this.s,e.clamp()}function tm(t,e){e.s=this.s;var r=Math.floor(t/this.DB);if(r>=this.t){e.t=0;return}var n=t%this.DB,i=this.DB-n,s=(1<<n)-1;e.data[0]=this.data[r]>>n;for(var o=r+1;o<this.t;++o)e.data[o-r-1]|=(this.data[o]&s)<<i,e.data[o-r]=this.data[o]>>n;n>0&&(e.data[this.t-r-1]|=(this.s&s)<<i),e.t=this.t-r,e.clamp()}function rm(t,e){for(var r=0,n=0,i=Math.min(t.t,this.t);r<i;)n+=this.data[r]-t.data[r],e.data[r++]=n&this.DM,n>>=this.DB;if(t.t<this.t){for(n-=t.s;r<this.t;)n+=this.data[r],e.data[r++]=n&this.DM,n>>=this.DB;n+=this.s}else{for(n+=this.s;r<t.t;)n-=t.data[r],e.data[r++]=n&this.DM,n>>=this.DB;n-=t.s}e.s=n<0?-1:0,n<-1?e.data[r++]=this.DV+n:n>0&&(e.data[r++]=n),e.t=r,e.clamp()}function nm(t,e){var r=this.abs(),n=t.abs(),i=r.t;for(e.t=i+n.t;--i>=0;)e.data[i]=0;for(i=0;i<n.t;++i)e.data[i+r.t]=r.am(0,n.data[i],e,i,0,r.t);e.s=0,e.clamp(),this.s!=t.s&&_.ZERO.subTo(e,e)}function im(t){for(var e=this.abs(),r=t.t=2*e.t;--r>=0;)t.data[r]=0;for(r=0;r<e.t-1;++r){var n=e.am(r,e.data[r],t,2*r,0,1);(t.data[r+e.t]+=e.am(r+1,2*e.data[r],t,2*r+1,n,e.t-r-1))>=e.DV&&(t.data[r+e.t]-=e.DV,t.data[r+e.t+1]=1)}t.t>0&&(t.data[t.t-1]+=e.am(r,e.data[r],t,2*r,0,1)),t.s=0,t.clamp()}function sm(t,e,r){var n=t.abs();if(!(n.t<=0)){var i=this.abs();if(i.t<n.t){e?.fromInt(0),r!=null&&this.copyTo(r);return}r==null&&(r=J());var s=J(),o=this.s,a=t.s,c=this.DB-fs(n.data[n.t-1]);c>0?(n.lShiftTo(c,s),i.lShiftTo(c,r)):(n.copyTo(s),i.copyTo(r));var u=s.t,f=s.data[u-1];if(f!=0){var h=f*(1<<this.F1)+(u>1?s.data[u-2]>>this.F2:0),l=this.FV/h,g=(1<<this.F1)/h,p=1<<this.F2,d=r.t,m=d-u,b=e??J();for(s.dlShiftTo(m,b),r.compareTo(b)>=0&&(r.data[r.t++]=1,r.subTo(b,r)),_.ONE.dlShiftTo(u,b),b.subTo(s,s);s.t<u;)s.data[s.t++]=0;for(;--m>=0;){var S=r.data[--d]==f?this.DM:Math.floor(r.data[d]*l+(r.data[d-1]+p)*g);if((r.data[d]+=s.am(0,S,r,m,0,u))<S)for(s.dlShiftTo(m,b),r.subTo(b,r);r.data[d]<--S;)r.subTo(b,r)}e!=null&&(r.drShiftTo(u,e),o!=a&&_.ZERO.subTo(e,e)),r.t=u,r.clamp(),c>0&&r.rShiftTo(c,r),o<0&&_.ZERO.subTo(r,r)}}}function om(t){var e=J();return this.abs().divRemTo(t,null,e),this.s<0&&e.compareTo(_.ZERO)>0&&t.subTo(e,e),e}function Rr(t){this.m=t}function am(t){return t.s<0||t.compareTo(this.m)>=0?t.mod(this.m):t}function cm(t){return t}function um(t){t.divRemTo(this.m,null,t)}function fm(t,e,r){t.multiplyTo(e,r),this.reduce(r)}function hm(t,e){t.squareTo(e),this.reduce(e)}Rr.prototype.convert=am;Rr.prototype.revert=cm;Rr.prototype.reduce=um;Rr.prototype.mulTo=fm;Rr.prototype.sqrTo=hm;function lm(){if(this.t<1)return 0;var t=this.data[0];if((t&1)==0)return 0;var e=t&3;return e=e*(2-(t&15)*e)&15,e=e*(2-(t&255)*e)&255,e=e*(2-((t&65535)*e&65535))&65535,e=e*(2-t*e%this.DV)%this.DV,e>0?this.DV-e:-e}function Pr(t){this.m=t,this.mp=t.invDigit(),this.mpl=this.mp&32767,this.mph=this.mp>>15,this.um=(1<<t.DB-15)-1,this.mt2=2*t.t}function pm(t){var e=J();return t.abs().dlShiftTo(this.m.t,e),e.divRemTo(this.m,null,e),t.s<0&&e.compareTo(_.ZERO)>0&&this.m.subTo(e,e),e}function dm(t){var e=J();return t.copyTo(e),this.reduce(e),e}function gm(t){for(;t.t<=this.mt2;)t.data[t.t++]=0;for(var e=0;e<this.m.t;++e){var r=t.data[e]&32767,n=r*this.mpl+((r*this.mph+(t.data[e]>>15)*this.mpl&this.um)<<15)&t.DM;for(r=e+this.m.t,t.data[r]+=this.m.am(0,n,t,e,0,this.m.t);t.data[r]>=t.DV;)t.data[r]-=t.DV,t.data[++r]++}t.clamp(),t.drShiftTo(this.m.t,t),t.compareTo(this.m)>=0&&t.subTo(this.m,t)}function ym(t,e){t.squareTo(e),this.reduce(e)}function mm(t,e,r){t.multiplyTo(e,r),this.reduce(r)}Pr.prototype.convert=pm;Pr.prototype.revert=dm;Pr.prototype.reduce=gm;Pr.prototype.mulTo=mm;Pr.prototype.sqrTo=ym;function vm(){return(this.t>0?this.data[0]&1:this.s)==0}function bm(t,e){if(t>4294967295||t<1)return _.ONE;var r=J(),n=J(),i=e.convert(this),s=fs(t)-1;for(i.copyTo(r);--s>=0;)if(e.sqrTo(r,n),(t&1<<s)>0)e.mulTo(n,i,r);else{var o=r;r=n,n=o}return e.revert(r)}function wm(t,e){var r;return t<256||e.isEven()?r=new Rr(e):r=new Pr(e),this.exp(t,r)}_.prototype.copyTo=zy;_.prototype.fromInt=Gy;_.prototype.fromString=Hy;_.prototype.clamp=Wy;_.prototype.dlShiftTo=Qy;_.prototype.drShiftTo=Jy;_.prototype.lShiftTo=em;_.prototype.rShiftTo=tm;_.prototype.subTo=rm;_.prototype.multiplyTo=nm;_.prototype.squareTo=im;_.prototype.divRemTo=sm;_.prototype.invDigit=lm;_.prototype.isEven=vm;_.prototype.exp=bm;_.prototype.toString=$y;_.prototype.negate=Yy;_.prototype.abs=Zy;_.prototype.compareTo=jy;_.prototype.bitLength=Xy;_.prototype.mod=om;_.prototype.modPowInt=wm;_.ZERO=lr(0);_.ONE=lr(1);function xm(){var t=J();return this.copyTo(t),t}function Em(){if(this.s<0){if(this.t==1)return this.data[0]-this.DV;if(this.t==0)return-1}else{if(this.t==1)return this.data[0];if(this.t==0)return 0}return(this.data[1]&(1<<32-this.DB)-1)<<this.DB|this.data[0]}function Sm(){return this.t==0?this.s:this.data[0]<<24>>24}function _m(){return this.t==0?this.s:this.data[0]<<16>>16}function Am(t){return Math.floor(Math.LN2*this.DB/Math.log(t))}function Tm(){return this.s<0?-1:this.t<=0||this.t==1&&this.data[0]<=0?0:1}function Im(t){if(t==null&&(t=10),this.signum()==0||t<2||t>36)return"0";var e=this.chunkSize(t),r=Math.pow(t,e),n=lr(r),i=J(),s=J(),o="";for(this.divRemTo(n,i,s);i.signum()>0;)o=(r+s.intValue()).toString(t).substr(1)+o,i.divRemTo(n,i,s);return s.intValue().toString(t)+o}function Cm(t,e){this.fromInt(0),e==null&&(e=10);for(var r=this.chunkSize(e),n=Math.pow(e,r),i=!1,s=0,o=0,a=0;a<t.length;++a){var c=Rf(t,a);if(c<0){t.charAt(a)=="-"&&this.signum()==0&&(i=!0);continue}o=e*o+c,++s>=r&&(this.dMultiply(n),this.dAddOffset(o,0),s=0,o=0)}s>0&&(this.dMultiply(Math.pow(e,s)),this.dAddOffset(o,0)),i&&_.ZERO.subTo(this,this)}function Bm(t,e,r){if(typeof e=="number")if(t<2)this.fromInt(1);else for(this.fromNumber(t,r),this.testBit(t-1)||this.bitwiseTo(_.ONE.shiftLeft(t-1),ia,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(e);)this.dAddOffset(2,0),this.bitLength()>t&&this.subTo(_.ONE.shiftLeft(t-1),this);else{var n=new Array,i=t&7;n.length=(t>>3)+1,e.nextBytes(n),i>0?n[0]&=(1<<i)-1:n[0]=0,this.fromString(n,256)}}function Rm(){var t=this.t,e=new Array;e[0]=this.s;var r=this.DB-t*this.DB%8,n,i=0;if(t-- >0)for(r<this.DB&&(n=this.data[t]>>r)!=(this.s&this.DM)>>r&&(e[i++]=n|this.s<<this.DB-r);t>=0;)r<8?(n=(this.data[t]&(1<<r)-1)<<8-r,n|=this.data[--t]>>(r+=this.DB-8)):(n=this.data[t]>>(r-=8)&255,r<=0&&(r+=this.DB,--t)),(n&128)!=0&&(n|=-256),i==0&&(this.s&128)!=(n&128)&&++i,(i>0||n!=this.s)&&(e[i++]=n);return e}function Pm(t){return this.compareTo(t)==0}function Dm(t){return this.compareTo(t)<0?this:t}function Mm(t){return this.compareTo(t)>0?this:t}function Lm(t,e,r){var n,i,s=Math.min(t.t,this.t);for(n=0;n<s;++n)r.data[n]=e(this.data[n],t.data[n]);if(t.t<this.t){for(i=t.s&this.DM,n=s;n<this.t;++n)r.data[n]=e(this.data[n],i);r.t=this.t}else{for(i=this.s&this.DM,n=s;n<t.t;++n)r.data[n]=e(i,t.data[n]);r.t=t.t}r.s=e(this.s,t.s),r.clamp()}function Nm(t,e){return t&e}function km(t){var e=J();return this.bitwiseTo(t,Nm,e),e}function ia(t,e){return t|e}function Fm(t){var e=J();return this.bitwiseTo(t,ia,e),e}function Pf(t,e){return t^e}function Um(t){var e=J();return this.bitwiseTo(t,Pf,e),e}function Df(t,e){return t&~e}function Om(t){var e=J();return this.bitwiseTo(t,Df,e),e}function Km(){for(var t=J(),e=0;e<this.t;++e)t.data[e]=this.DM&~this.data[e];return t.t=this.t,t.s=~this.s,t}function qm(t){var e=J();return t<0?this.rShiftTo(-t,e):this.lShiftTo(t,e),e}function Vm(t){var e=J();return t<0?this.lShiftTo(-t,e):this.rShiftTo(t,e),e}function zm(t){if(t==0)return-1;var e=0;return(t&65535)==0&&(t>>=16,e+=16),(t&255)==0&&(t>>=8,e+=8),(t&15)==0&&(t>>=4,e+=4),(t&3)==0&&(t>>=2,e+=2),(t&1)==0&&++e,e}function Gm(){for(var t=0;t<this.t;++t)if(this.data[t]!=0)return t*this.DB+zm(this.data[t]);return this.s<0?this.t*this.DB:-1}function Hm(t){for(var e=0;t!=0;)t&=t-1,++e;return e}function Wm(){for(var t=0,e=this.s&this.DM,r=0;r<this.t;++r)t+=Hm(this.data[r]^e);return t}function $m(t){var e=Math.floor(t/this.DB);return e>=this.t?this.s!=0:(this.data[e]&1<<t%this.DB)!=0}function Ym(t,e){var r=_.ONE.shiftLeft(t);return this.bitwiseTo(r,e,r),r}function Zm(t){return this.changeBit(t,ia)}function jm(t){return this.changeBit(t,Df)}function Xm(t){return this.changeBit(t,Pf)}function Qm(t,e){for(var r=0,n=0,i=Math.min(t.t,this.t);r<i;)n+=this.data[r]+t.data[r],e.data[r++]=n&this.DM,n>>=this.DB;if(t.t<this.t){for(n+=t.s;r<this.t;)n+=this.data[r],e.data[r++]=n&this.DM,n>>=this.DB;n+=this.s}else{for(n+=this.s;r<t.t;)n+=t.data[r],e.data[r++]=n&this.DM,n>>=this.DB;n+=t.s}e.s=n<0?-1:0,n>0?e.data[r++]=n:n<-1&&(e.data[r++]=this.DV+n),e.t=r,e.clamp()}function Jm(t){var e=J();return this.addTo(t,e),e}function e1(t){var e=J();return this.subTo(t,e),e}function t1(t){var e=J();return this.multiplyTo(t,e),e}function r1(t){var e=J();return this.divRemTo(t,e,null),e}function n1(t){var e=J();return this.divRemTo(t,null,e),e}function i1(t){var e=J(),r=J();return this.divRemTo(t,e,r),new Array(e,r)}function s1(t){this.data[this.t]=this.am(0,t-1,this,0,0,this.t),++this.t,this.clamp()}function o1(t,e){if(t!=0){for(;this.t<=e;)this.data[this.t++]=0;for(this.data[e]+=t;this.data[e]>=this.DV;)this.data[e]-=this.DV,++e>=this.t&&(this.data[this.t++]=0),++this.data[e]}}function si(){}function Mf(t){return t}function a1(t,e,r){t.multiplyTo(e,r)}function c1(t,e){t.squareTo(e)}si.prototype.convert=Mf;si.prototype.revert=Mf;si.prototype.mulTo=a1;si.prototype.sqrTo=c1;function u1(t){return this.exp(t,new si)}function f1(t,e,r){var n=Math.min(this.t+t.t,e);for(r.s=0,r.t=n;n>0;)r.data[--n]=0;var i;for(i=r.t-this.t;n<i;++n)r.data[n+this.t]=this.am(0,t.data[n],r,n,0,this.t);for(i=Math.min(t.t,e);n<i;++n)this.am(0,t.data[n],r,n,0,e-n);r.clamp()}function h1(t,e,r){--e;var n=r.t=this.t+t.t-e;for(r.s=0;--n>=0;)r.data[n]=0;for(n=Math.max(e-this.t,0);n<t.t;++n)r.data[this.t+n-e]=this.am(e-n,t.data[n],r,0,0,this.t+n-e);r.clamp(),r.drShiftTo(1,r)}function hn(t){this.r2=J(),this.q3=J(),_.ONE.dlShiftTo(2*t.t,this.r2),this.mu=this.r2.divide(t),this.m=t}function l1(t){if(t.s<0||t.t>2*this.m.t)return t.mod(this.m);if(t.compareTo(this.m)<0)return t;var e=J();return t.copyTo(e),this.reduce(e),e}function p1(t){return t}function d1(t){for(t.drShiftTo(this.m.t-1,this.r2),t.t>this.m.t+1&&(t.t=this.m.t+1,t.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);t.compareTo(this.r2)<0;)t.dAddOffset(1,this.m.t+1);for(t.subTo(this.r2,t);t.compareTo(this.m)>=0;)t.subTo(this.m,t)}function g1(t,e){t.squareTo(e),this.reduce(e)}function y1(t,e,r){t.multiplyTo(e,r),this.reduce(r)}hn.prototype.convert=l1;hn.prototype.revert=p1;hn.prototype.reduce=d1;hn.prototype.mulTo=y1;hn.prototype.sqrTo=g1;function m1(t,e){var r=t.bitLength(),n,i=lr(1),s;if(r<=0)return i;r<18?n=1:r<48?n=3:r<144?n=4:r<768?n=5:n=6,r<8?s=new Rr(e):e.isEven()?s=new hn(e):s=new Pr(e);var o=new Array,a=3,c=n-1,u=(1<<n)-1;if(o[1]=s.convert(this),n>1){var f=J();for(s.sqrTo(o[1],f);a<=u;)o[a]=J(),s.mulTo(f,o[a-2],o[a]),a+=2}var h=t.t-1,l,g=!0,p=J(),d;for(r=fs(t.data[h])-1;h>=0;){for(r>=c?l=t.data[h]>>r-c&u:(l=(t.data[h]&(1<<r+1)-1)<<c-r,h>0&&(l|=t.data[h-1]>>this.DB+r-c)),a=n;(l&1)==0;)l>>=1,--a;if((r-=a)<0&&(r+=this.DB,--h),g)o[l].copyTo(i),g=!1;else{for(;a>1;)s.sqrTo(i,p),s.sqrTo(p,i),a-=2;a>0?s.sqrTo(i,p):(d=i,i=p,p=d),s.mulTo(p,o[l],i)}for(;h>=0&&(t.data[h]&1<<r)==0;)s.sqrTo(i,p),d=i,i=p,p=d,--r<0&&(r=this.DB-1,--h)}return s.revert(i)}function v1(t){var e=this.s<0?this.negate():this.clone(),r=t.s<0?t.negate():t.clone();if(e.compareTo(r)<0){var n=e;e=r,r=n}var i=e.getLowestSetBit(),s=r.getLowestSetBit();if(s<0)return e;for(i<s&&(s=i),s>0&&(e.rShiftTo(s,e),r.rShiftTo(s,r));e.signum()>0;)(i=e.getLowestSetBit())>0&&e.rShiftTo(i,e),(i=r.getLowestSetBit())>0&&r.rShiftTo(i,r),e.compareTo(r)>=0?(e.subTo(r,e),e.rShiftTo(1,e)):(r.subTo(e,r),r.rShiftTo(1,r));return s>0&&r.lShiftTo(s,r),r}function b1(t){if(t<=0)return 0;var e=this.DV%t,r=this.s<0?t-1:0;if(this.t>0)if(e==0)r=this.data[0]%t;else for(var n=this.t-1;n>=0;--n)r=(e*r+this.data[n])%t;return r}function w1(t){var e=t.isEven();if(this.isEven()&&e||t.signum()==0)return _.ZERO;for(var r=t.clone(),n=this.clone(),i=lr(1),s=lr(0),o=lr(0),a=lr(1);r.signum()!=0;){for(;r.isEven();)r.rShiftTo(1,r),e?((!i.isEven()||!s.isEven())&&(i.addTo(this,i),s.subTo(t,s)),i.rShiftTo(1,i)):s.isEven()||s.subTo(t,s),s.rShiftTo(1,s);for(;n.isEven();)n.rShiftTo(1,n),e?((!o.isEven()||!a.isEven())&&(o.addTo(this,o),a.subTo(t,a)),o.rShiftTo(1,o)):a.isEven()||a.subTo(t,a),a.rShiftTo(1,a);r.compareTo(n)>=0?(r.subTo(n,r),e&&i.subTo(o,i),s.subTo(a,s)):(n.subTo(r,n),e&&o.subTo(i,o),a.subTo(s,a))}if(n.compareTo(_.ONE)!=0)return _.ZERO;if(a.compareTo(t)>=0)return a.subtract(t);if(a.signum()<0)a.addTo(t,a);else return a;return a.signum()<0?a.add(t):a}var Et=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509],x1=(1<<26)/Et[Et.length-1];function E1(t){var e,r=this.abs();if(r.t==1&&r.data[0]<=Et[Et.length-1]){for(e=0;e<Et.length;++e)if(r.data[0]==Et[e])return!0;return!1}if(r.isEven())return!1;for(e=1;e<Et.length;){for(var n=Et[e],i=e+1;i<Et.length&&n<x1;)n*=Et[i++];for(n=r.modInt(n);e<i;)if(n%Et[e++]==0)return!1}return r.millerRabin(t)}function S1(t){var e=this.subtract(_.ONE),r=e.getLowestSetBit();if(r<=0)return!1;for(var n=e.shiftRight(r),i=_1(),s,o=0;o<t;++o){do s=new _(this.bitLength(),i);while(s.compareTo(_.ONE)<=0||s.compareTo(e)>=0);var a=s.modPow(n,this);if(a.compareTo(_.ONE)!=0&&a.compareTo(e)!=0){for(var c=1;c++<r&&a.compareTo(e)!=0;)if(a=a.modPowInt(2,this),a.compareTo(_.ONE)==0)return!1;if(a.compareTo(e)!=0)return!1}}return!0}function _1(){return{nextBytes:function(t){for(var e=0;e<t.length;++e)t[e]=Math.floor(Math.random()*256)}}}_.prototype.chunkSize=Am;_.prototype.toRadix=Im;_.prototype.fromRadix=Cm;_.prototype.fromNumber=Bm;_.prototype.bitwiseTo=Lm;_.prototype.changeBit=Ym;_.prototype.addTo=Qm;_.prototype.dMultiply=s1;_.prototype.dAddOffset=o1;_.prototype.multiplyLowerTo=f1;_.prototype.multiplyUpperTo=h1;_.prototype.modInt=b1;_.prototype.millerRabin=S1;_.prototype.clone=xm;_.prototype.intValue=Em;_.prototype.byteValue=Sm;_.prototype.shortValue=_m;_.prototype.signum=Tm;_.prototype.toByteArray=Rm;_.prototype.equals=Pm;_.prototype.min=Dm;_.prototype.max=Mm;_.prototype.and=km;_.prototype.or=Fm;_.prototype.xor=Um;_.prototype.andNot=Om;_.prototype.not=Km;_.prototype.shiftLeft=qm;_.prototype.shiftRight=Vm;_.prototype.getLowestSetBit=Gm;_.prototype.bitCount=Wm;_.prototype.testBit=$m;_.prototype.setBit=Zm;_.prototype.clearBit=jm;_.prototype.flipBit=Xm;_.prototype.add=Jm;_.prototype.subtract=e1;_.prototype.multiply=t1;_.prototype.divide=r1;_.prototype.remainder=n1;_.prototype.divideAndRemainder=i1;_.prototype.modPow=m1;_.prototype.modInverse=w1;_.prototype.pow=u1;_.prototype.gcd=v1;_.prototype.isProbablePrime=E1});var Of=L((wA,Uf)=>{var Lt=ie();Br();Re();var kf=Uf.exports=Lt.sha1=Lt.sha1||{};Lt.md.sha1=Lt.md.algorithms.sha1=kf;kf.create=function(){Ff||A1();var t=null,e=Lt.util.createBuffer(),r=new Array(80),n={algorithm:"sha1",blockLength:64,digestLength:20,messageLength:0,fullMessageLength:null,messageLengthSize:8};return n.start=function(){n.messageLength=0,n.fullMessageLength=n.messageLength64=[];for(var i=n.messageLengthSize/4,s=0;s<i;++s)n.fullMessageLength.push(0);return e=Lt.util.createBuffer(),t={h0:1732584193,h1:4023233417,h2:2562383102,h3:271733878,h4:3285377520},n},n.start(),n.update=function(i,s){s==="utf8"&&(i=Lt.util.encodeUtf8(i));var o=i.length;n.messageLength+=o,o=[o/4294967296>>>0,o>>>0];for(var a=n.fullMessageLength.length-1;a>=0;--a)n.fullMessageLength[a]+=o[1],o[1]=o[0]+(n.fullMessageLength[a]/4294967296>>>0),n.fullMessageLength[a]=n.fullMessageLength[a]>>>0,o[0]=o[1]/4294967296>>>0;return e.putBytes(i),Nf(t,r,e),(e.read>2048||e.length()===0)&&e.compact(),n},n.digest=function(){var i=Lt.util.createBuffer();i.putBytes(e.bytes());var s=n.fullMessageLength[n.fullMessageLength.length-1]+n.messageLengthSize,o=s&n.blockLength-1;i.putBytes(sa.substr(0,n.blockLength-o));for(var a,c,u=n.fullMessageLength[0]*8,f=0;f<n.fullMessageLength.length-1;++f)a=n.fullMessageLength[f+1]*8,c=a/4294967296>>>0,u+=c,i.putInt32(u>>>0),u=a>>>0;i.putInt32(u);var h={h0:t.h0,h1:t.h1,h2:t.h2,h3:t.h3,h4:t.h4};Nf(h,r,i);var l=Lt.util.createBuffer();return l.putInt32(h.h0),l.putInt32(h.h1),l.putInt32(h.h2),l.putInt32(h.h3),l.putInt32(h.h4),l},n};var sa=null,Ff=!1;function A1(){sa=String.fromCharCode(128),sa+=Lt.util.fillString(String.fromCharCode(0),64),Ff=!0}function Nf(t,e,r){for(var n,i,s,o,a,c,u,f,h=r.length();h>=64;){for(i=t.h0,s=t.h1,o=t.h2,a=t.h3,c=t.h4,f=0;f<16;++f)n=r.getInt32(),e[f]=n,u=a^s&(o^a),n=(i<<5|i>>>27)+u+c+1518500249+n,c=a,a=o,o=(s<<30|s>>>2)>>>0,s=i,i=n;for(;f<20;++f)n=e[f-3]^e[f-8]^e[f-14]^e[f-16],n=n<<1|n>>>31,e[f]=n,u=a^s&(o^a),n=(i<<5|i>>>27)+u+c+1518500249+n,c=a,a=o,o=(s<<30|s>>>2)>>>0,s=i,i=n;for(;f<32;++f)n=e[f-3]^e[f-8]^e[f-14]^e[f-16],n=n<<1|n>>>31,e[f]=n,u=s^o^a,n=(i<<5|i>>>27)+u+c+1859775393+n,c=a,a=o,o=(s<<30|s>>>2)>>>0,s=i,i=n;for(;f<40;++f)n=e[f-6]^e[f-16]^e[f-28]^e[f-32],n=n<<2|n>>>30,e[f]=n,u=s^o^a,n=(i<<5|i>>>27)+u+c+1859775393+n,c=a,a=o,o=(s<<30|s>>>2)>>>0,s=i,i=n;for(;f<60;++f)n=e[f-6]^e[f-16]^e[f-28]^e[f-32],n=n<<2|n>>>30,e[f]=n,u=s&o|a&(s^o),n=(i<<5|i>>>27)+u+c+2400959708+n,c=a,a=o,o=(s<<30|s>>>2)>>>0,s=i,i=n;for(;f<80;++f)n=e[f-6]^e[f-16]^e[f-28]^e[f-32],n=n<<2|n>>>30,e[f]=n,u=s^o^a,n=(i<<5|i>>>27)+u+c+3395469782+n,c=a,a=o,o=(s<<30|s>>>2)>>>0,s=i,i=n;t.h0=t.h0+i|0,t.h1=t.h1+s|0,t.h2=t.h2+o|0,t.h3=t.h3+a|0,t.h4=t.h4+c|0,h-=64}}});var Vf=L((xA,qf)=>{var Nt=ie();Re();ii();Of();var Kf=qf.exports=Nt.pkcs1=Nt.pkcs1||{};Kf.encode_rsa_oaep=function(t,e,r){var n,i,s,o;typeof r=="string"?(n=r,i=arguments[3]||void 0,s=arguments[4]||void 0):r&&(n=r.label||void 0,i=r.seed||void 0,s=r.md||void 0,r.mgf1&&r.mgf1.md&&(o=r.mgf1.md)),s?s.start():s=Nt.md.sha1.create(),o||(o=s);var a=Math.ceil(t.n.bitLength()/8),c=a-2*s.digestLength-2;if(e.length>c){var u=new Error("RSAES-OAEP input message length is too long.");throw u.length=e.length,u.maxLength=c,u}n||(n=""),s.update(n,"raw");for(var f=s.digest(),h="",l=c-e.length,g=0;g<l;g++)h+="\0";var p=f.getBytes()+h+""+e;if(!i)i=Nt.random.getBytes(s.digestLength);else if(i.length!==s.digestLength){var u=new Error("Invalid RSAES-OAEP seed. The seed length must match the digest length.");throw u.seedLength=i.length,u.digestLength=s.digestLength,u}var d=ls(i,a-s.digestLength-1,o),m=Nt.util.xorBytes(p,d,p.length),b=ls(m,s.digestLength,o),S=Nt.util.xorBytes(i,b,i.length);return"\0"+S+m};Kf.decode_rsa_oaep=function(t,e,r){var n,i,s;typeof r=="string"?(n=r,i=arguments[3]||void 0):r&&(n=r.label||void 0,i=r.md||void 0,r.mgf1&&r.mgf1.md&&(s=r.mgf1.md));var o=Math.ceil(t.n.bitLength()/8);if(e.length!==o){var m=new Error("RSAES-OAEP encoded message length is invalid.");throw m.length=e.length,m.expectedLength=o,m}if(i===void 0?i=Nt.md.sha1.create():i.start(),s||(s=i),o<2*i.digestLength+2)throw new Error("RSAES-OAEP key is too short for the hash function.");n||(n=""),i.update(n,"raw");for(var a=i.digest().getBytes(),c=e.charAt(0),u=e.substring(1,i.digestLength+1),f=e.substring(1+i.digestLength),h=ls(f,i.digestLength,s),l=Nt.util.xorBytes(u,h,u.length),g=ls(l,o-i.digestLength-1,s),p=Nt.util.xorBytes(f,g,f.length),d=p.substring(0,i.digestLength),m=c!=="\0",b=0;b<i.digestLength;++b)m|=a.charAt(b)!==d.charAt(b);for(var S=1,I=i.digestLength,R=i.digestLength;R<p.length;R++){var w=p.charCodeAt(R),T=w&1^1,D=S?65534:0;m|=w&D,S=S&T,I+=S}if(m||p.charCodeAt(I)!==1)throw new Error("Invalid RSAES-OAEP padding.");return p.substring(I+1)};function ls(t,e,r){r||(r=Nt.md.sha1.create());for(var n="",i=Math.ceil(e/r.digestLength),s=0;s<i;++s){var o=String.fromCharCode(s>>24&255,s>>16&255,s>>8&255,s&255);r.start(),r.update(t+o),n+=r.digest().getBytes()}return n.substring(0,e)}});var zf=L((EA,oa)=>{var pr=ie();Re();hs();ii();(function(){if(pr.prime){oa.exports=pr.prime;return}var t=oa.exports=pr.prime=pr.prime||{},e=pr.jsbn.BigInteger,r=[6,4,2,4,2,4,6,2],n=new e(null);n.fromInt(30);var i=function(h,l){return h|l};t.generateProbablePrime=function(h,l,g){typeof l=="function"&&(g=l,l={}),l=l||{};var p=l.algorithm||"PRIMEINC";typeof p=="string"&&(p={name:p}),p.options=p.options||{};var d=l.prng||pr.random,m={nextBytes:function(b){for(var S=d.getBytesSync(b.length),I=0;I<b.length;++I)b[I]=S.charCodeAt(I)}};if(p.name==="PRIMEINC")return s(h,m,p.options,g);throw new Error("Invalid prime generation algorithm: "+p.name)};function s(h,l,g,p){return"workers"in g?c(h,l,g,p):o(h,l,g,p)}function o(h,l,g,p){var d=u(h,l),m=0,b=f(d.bitLength());"millerRabinTests"in g&&(b=g.millerRabinTests);var S=10;"maxBlockTime"in g&&(S=g.maxBlockTime),a(d,h,l,m,b,S,p)}function a(h,l,g,p,d,m,b){var S=+new Date;do{if(h.bitLength()>l&&(h=u(l,g)),h.isProbablePrime(d))return b(null,h);h.dAddOffset(r[p++%8],0)}while(m<0||+new Date-S<m);pr.util.setImmediate(function(){a(h,l,g,p,d,m,b)})}function c(h,l,g,p){if(typeof Worker>"u")return o(h,l,g,p);var d=u(h,l),m=g.workers,b=g.workLoad||100,S=b*30/8,I=g.workerScript||"forge/prime.worker.js";if(m===-1)return pr.util.estimateCores(function(w,T){w&&(T=2),m=T-1,R()});R();function R(){m=Math.max(1,m);for(var w=[],T=0;T<m;++T)w[T]=new Worker(I);for(var D=m,T=0;T<m;++T)w[T].addEventListener("message",V);var k=!1;function V(me){if(!k){--D;var Fe=me.data;if(Fe.found){for(var We=0;We<w.length;++We)w[We].terminate();return k=!0,p(null,new e(Fe.prime,16))}d.bitLength()>h&&(d=u(h,l));var Jr=d.toString(16);me.target.postMessage({hex:Jr,workLoad:b}),d.dAddOffset(S,0)}}}}function u(h,l){var g=new e(h,l),p=h-1;return g.testBit(p)||g.bitwiseTo(e.ONE.shiftLeft(p),i,g),g.dAddOffset(31-g.mod(n).byteValue(),0),g}function f(h){return h<=100?27:h<=150?18:h<=200?15:h<=250?12:h<=300?9:h<=350?8:h<=400?7:h<=500?6:h<=600?5:h<=800?4:h<=1250?3:2}})()});var ds=L((SA,jf)=>{var N=ie();ni();hs();Ji();Vf();zf();ii();Re();typeof Y>"u"&&(Y=N.jsbn.BigInteger);var Y,aa=N.util.isNodejs?un():null,v=N.asn1,lt=N.util;N.pki=N.pki||{};jf.exports=N.pki.rsa=N.rsa=N.rsa||{};var K=N.pki,T1=[6,4,2,4,2,4,6,2],I1={name:"PrivateKeyInfo",tagClass:v.Class.UNIVERSAL,type:v.Type.SEQUENCE,constructed:!0,value:[{name:"PrivateKeyInfo.version",tagClass:v.Class.UNIVERSAL,type:v.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"PrivateKeyInfo.privateKeyAlgorithm",tagClass:v.Class.UNIVERSAL,type:v.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:v.Class.UNIVERSAL,type:v.Type.OID,constructed:!1,capture:"privateKeyOid"}]},{name:"PrivateKeyInfo",tagClass:v.Class.UNIVERSAL,type:v.Type.OCTETSTRING,constructed:!1,capture:"privateKey"}]},C1={name:"RSAPrivateKey",tagClass:v.Class.UNIVERSAL,type:v.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPrivateKey.version",tagClass:v.Class.UNIVERSAL,type:v.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"RSAPrivateKey.modulus",tagClass:v.Class.UNIVERSAL,type:v.Type.INTEGER,constructed:!1,capture:"privateKeyModulus"},{name:"RSAPrivateKey.publicExponent",tagClass:v.Class.UNIVERSAL,type:v.Type.INTEGER,constructed:!1,capture:"privateKeyPublicExponent"},{name:"RSAPrivateKey.privateExponent",tagClass:v.Class.UNIVERSAL,type:v.Type.INTEGER,constructed:!1,capture:"privateKeyPrivateExponent"},{name:"RSAPrivateKey.prime1",tagClass:v.Class.UNIVERSAL,type:v.Type.INTEGER,constructed:!1,capture:"privateKeyPrime1"},{name:"RSAPrivateKey.prime2",tagClass:v.Class.UNIVERSAL,type:v.Type.INTEGER,constructed:!1,capture:"privateKeyPrime2"},{name:"RSAPrivateKey.exponent1",tagClass:v.Class.UNIVERSAL,type:v.Type.INTEGER,constructed:!1,capture:"privateKeyExponent1"},{name:"RSAPrivateKey.exponent2",tagClass:v.Class.UNIVERSAL,type:v.Type.INTEGER,constructed:!1,capture:"privateKeyExponent2"},{name:"RSAPrivateKey.coefficient",tagClass:v.Class.UNIVERSAL,type:v.Type.INTEGER,constructed:!1,capture:"privateKeyCoefficient"}]},B1={name:"RSAPublicKey",tagClass:v.Class.UNIVERSAL,type:v.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPublicKey.modulus",tagClass:v.Class.UNIVERSAL,type:v.Type.INTEGER,constructed:!1,capture:"publicKeyModulus"},{name:"RSAPublicKey.exponent",tagClass:v.Class.UNIVERSAL,type:v.Type.INTEGER,constructed:!1,capture:"publicKeyExponent"}]},R1=N.pki.rsa.publicKeyValidator={name:"SubjectPublicKeyInfo",tagClass:v.Class.UNIVERSAL,type:v.Type.SEQUENCE,constructed:!0,captureAsn1:"subjectPublicKeyInfo",value:[{name:"SubjectPublicKeyInfo.AlgorithmIdentifier",tagClass:v.Class.UNIVERSAL,type:v.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:v.Class.UNIVERSAL,type:v.Type.OID,constructed:!1,capture:"publicKeyOid"}]},{name:"SubjectPublicKeyInfo.subjectPublicKey",tagClass:v.Class.UNIVERSAL,type:v.Type.BITSTRING,constructed:!1,value:[{name:"SubjectPublicKeyInfo.subjectPublicKey.RSAPublicKey",tagClass:v.Class.UNIVERSAL,type:v.Type.SEQUENCE,constructed:!0,optional:!0,captureAsn1:"rsaPublicKey"}]}]},P1={name:"DigestInfo",tagClass:v.Class.UNIVERSAL,type:v.Type.SEQUENCE,constructed:!0,value:[{name:"DigestInfo.DigestAlgorithm",tagClass:v.Class.UNIVERSAL,type:v.Type.SEQUENCE,constructed:!0,value:[{name:"DigestInfo.DigestAlgorithm.algorithmIdentifier",tagClass:v.Class.UNIVERSAL,type:v.Type.OID,constructed:!1,capture:"algorithmIdentifier"},{name:"DigestInfo.DigestAlgorithm.parameters",tagClass:v.Class.UNIVERSAL,type:v.Type.NULL,capture:"parameters",optional:!0,constructed:!1}]},{name:"DigestInfo.digest",tagClass:v.Class.UNIVERSAL,type:v.Type.OCTETSTRING,constructed:!1,capture:"digest"}]},D1=function(t){var e;if(t.algorithm in K.oids)e=K.oids[t.algorithm];else{var r=new Error("Unknown message digest algorithm.");throw r.algorithm=t.algorithm,r}var n=v.oidToDer(e).getBytes(),i=v.create(v.Class.UNIVERSAL,v.Type.SEQUENCE,!0,[]),s=v.create(v.Class.UNIVERSAL,v.Type.SEQUENCE,!0,[]);s.value.push(v.create(v.Class.UNIVERSAL,v.Type.OID,!1,n)),s.value.push(v.create(v.Class.UNIVERSAL,v.Type.NULL,!1,""));var o=v.create(v.Class.UNIVERSAL,v.Type.OCTETSTRING,!1,t.digest().getBytes());return i.value.push(s),i.value.push(o),v.toDer(i).getBytes()},Yf=function(t,e,r){if(r)return t.modPow(e.e,e.n);if(!e.p||!e.q)return t.modPow(e.d,e.n);e.dP||(e.dP=e.d.mod(e.p.subtract(Y.ONE))),e.dQ||(e.dQ=e.d.mod(e.q.subtract(Y.ONE))),e.qInv||(e.qInv=e.q.modInverse(e.p));var n;do n=new Y(N.util.bytesToHex(N.random.getBytes(e.n.bitLength()/8)),16);while(n.compareTo(e.n)>=0||!n.gcd(e.n).equals(Y.ONE));t=t.multiply(n.modPow(e.e,e.n)).mod(e.n);for(var i=t.mod(e.p).modPow(e.dP,e.p),s=t.mod(e.q).modPow(e.dQ,e.q);i.compareTo(s)<0;)i=i.add(e.p);var o=i.subtract(s).multiply(e.qInv).mod(e.p).multiply(e.q).add(s);return o=o.multiply(n.modInverse(e.n)).mod(e.n),o};K.rsa.encrypt=function(t,e,r){var n=r,i,s=Math.ceil(e.n.bitLength()/8);r!==!1&&r!==!0?(n=r===2,i=Zf(t,e,r)):(i=N.util.createBuffer(),i.putBytes(t));for(var o=new Y(i.toHex(),16),a=Yf(o,e,n),c=a.toString(16),u=N.util.createBuffer(),f=s-Math.ceil(c.length/2);f>0;)u.putByte(0),--f;return u.putBytes(N.util.hexToBytes(c)),u.getBytes()};K.rsa.decrypt=function(t,e,r,n){var i=Math.ceil(e.n.bitLength()/8);if(t.length!==i){var s=new Error("Encrypted message length is invalid.");throw s.length=t.length,s.expected=i,s}var o=new Y(N.util.createBuffer(t).toHex(),16);if(o.compareTo(e.n)>=0)throw new Error("Encrypted message is invalid.");for(var a=Yf(o,e,r),c=a.toString(16),u=N.util.createBuffer(),f=i-Math.ceil(c.length/2);f>0;)u.putByte(0),--f;return u.putBytes(N.util.hexToBytes(c)),n!==!1?ps(u.getBytes(),e,r):u.getBytes()};K.rsa.createKeyPairGenerationState=function(t,e,r){typeof t=="string"&&(t=parseInt(t,10)),t=t||2048,r=r||{};var n=r.prng||N.random,i={nextBytes:function(a){for(var c=n.getBytesSync(a.length),u=0;u<a.length;++u)a[u]=c.charCodeAt(u)}},s=r.algorithm||"PRIMEINC",o;if(s==="PRIMEINC")o={algorithm:s,state:0,bits:t,rng:i,eInt:e||65537,e:new Y(null),p:null,q:null,qBits:t>>1,pBits:t-(t>>1),pqState:0,num:null,keys:null},o.e.fromInt(o.eInt);else throw new Error("Invalid key generation algorithm: "+s);return o};K.rsa.stepKeyPairGenerationState=function(t,e){"algorithm"in t||(t.algorithm="PRIMEINC");var r=new Y(null);r.fromInt(30);for(var n=0,i=function(h,l){return h|l},s=+new Date,o,a=0;t.keys===null&&(e<=0||a<e);){if(t.state===0){var c=t.p===null?t.pBits:t.qBits,u=c-1;t.pqState===0?(t.num=new Y(c,t.rng),t.num.testBit(u)||t.num.bitwiseTo(Y.ONE.shiftLeft(u),i,t.num),t.num.dAddOffset(31-t.num.mod(r).byteValue(),0),n=0,++t.pqState):t.pqState===1?t.num.bitLength()>c?t.pqState=0:t.num.isProbablePrime(L1(t.num.bitLength()))?++t.pqState:t.num.dAddOffset(T1[n++%8],0):t.pqState===2?t.pqState=t.num.subtract(Y.ONE).gcd(t.e).compareTo(Y.ONE)===0?3:0:t.pqState===3&&(t.pqState=0,t.p===null?t.p=t.num:t.q=t.num,t.p!==null&&t.q!==null&&++t.state,t.num=null)}else if(t.state===1)t.p.compareTo(t.q)<0&&(t.num=t.p,t.p=t.q,t.q=t.num),++t.state;else if(t.state===2)t.p1=t.p.subtract(Y.ONE),t.q1=t.q.subtract(Y.ONE),t.phi=t.p1.multiply(t.q1),++t.state;else if(t.state===3)t.phi.gcd(t.e).compareTo(Y.ONE)===0?++t.state:(t.p=null,t.q=null,t.state=0);else if(t.state===4)t.n=t.p.multiply(t.q),t.n.bitLength()===t.bits?++t.state:(t.q=null,t.state=0);else if(t.state===5){var f=t.e.modInverse(t.phi);t.keys={privateKey:K.rsa.setPrivateKey(t.n,t.e,f,t.p,t.q,f.mod(t.p1),f.mod(t.q1),t.q.modInverse(t.p)),publicKey:K.rsa.setPublicKey(t.n,t.e)}}o=+new Date,a+=o-s,s=o}return t.keys!==null};K.rsa.generateKeyPair=function(t,e,r,n){if(arguments.length===1?typeof t=="object"?(r=t,t=void 0):typeof t=="function"&&(n=t,t=void 0):arguments.length===2?typeof t=="number"?typeof e=="function"?(n=e,e=void 0):typeof e!="number"&&(r=e,e=void 0):(r=t,n=e,t=void 0,e=void 0):arguments.length===3&&(typeof e=="number"?typeof r=="function"&&(n=r,r=void 0):(n=r,r=e,e=void 0)),r=r||{},t===void 0&&(t=r.bits||2048),e===void 0&&(e=r.e||65537),!N.options.usePureJavaScript&&!r.prng&&t>=256&&t<=16384&&(e===65537||e===3)){if(n){if(Gf("generateKeyPair"))return aa.generateKeyPair("rsa",{modulusLength:t,publicExponent:e,publicKeyEncoding:{type:"spki",format:"pem"},privateKeyEncoding:{type:"pkcs8",format:"pem"}},function(a,c,u){if(a)return n(a);n(null,{privateKey:K.privateKeyFromPem(u),publicKey:K.publicKeyFromPem(c)})});if(Hf("generateKey")&&Hf("exportKey"))return lt.globalScope.crypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:t,publicExponent:$f(e),hash:{name:"SHA-256"}},!0,["sign","verify"]).then(function(a){return lt.globalScope.crypto.subtle.exportKey("pkcs8",a.privateKey)}).then(void 0,function(a){n(a)}).then(function(a){if(a){var c=K.privateKeyFromAsn1(v.fromDer(N.util.createBuffer(a)));n(null,{privateKey:c,publicKey:K.setRsaPublicKey(c.n,c.e)})}});if(Wf("generateKey")&&Wf("exportKey")){var i=lt.globalScope.msCrypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:t,publicExponent:$f(e),hash:{name:"SHA-256"}},!0,["sign","verify"]);i.oncomplete=function(a){var c=a.target.result,u=lt.globalScope.msCrypto.subtle.exportKey("pkcs8",c.privateKey);u.oncomplete=function(f){var h=f.target.result,l=K.privateKeyFromAsn1(v.fromDer(N.util.createBuffer(h)));n(null,{privateKey:l,publicKey:K.setRsaPublicKey(l.n,l.e)})},u.onerror=function(f){n(f)}},i.onerror=function(a){n(a)};return}}else if(Gf("generateKeyPairSync")){var s=aa.generateKeyPairSync("rsa",{modulusLength:t,publicExponent:e,publicKeyEncoding:{type:"spki",format:"pem"},privateKeyEncoding:{type:"pkcs8",format:"pem"}});return{privateKey:K.privateKeyFromPem(s.privateKey),publicKey:K.publicKeyFromPem(s.publicKey)}}}var o=K.rsa.createKeyPairGenerationState(t,e,r);if(!n)return K.rsa.stepKeyPairGenerationState(o,0),o.keys;M1(o,r,n)};K.setRsaPublicKey=K.rsa.setPublicKey=function(t,e){var r={n:t,e};return r.encrypt=function(n,i,s){if(typeof i=="string"?i=i.toUpperCase():i===void 0&&(i="RSAES-PKCS1-V1_5"),i==="RSAES-PKCS1-V1_5")i={encode:function(a,c,u){return Zf(a,c,2).getBytes()}};else if(i==="RSA-OAEP"||i==="RSAES-OAEP")i={encode:function(a,c){return N.pkcs1.encode_rsa_oaep(c,a,s)}};else if(["RAW","NONE","NULL",null].indexOf(i)!==-1)i={encode:function(a){return a}};else if(typeof i=="string")throw new Error('Unsupported encryption scheme: "'+i+'".');var o=i.encode(n,r,!0);return K.rsa.encrypt(o,r,!0)},r.verify=function(n,i,s,o){typeof s=="string"?s=s.toUpperCase():s===void 0&&(s="RSASSA-PKCS1-V1_5"),o===void 0&&(o={_parseAllDigestBytes:!0}),"_parseAllDigestBytes"in o||(o._parseAllDigestBytes=!0),s==="RSASSA-PKCS1-V1_5"?s={verify:function(c,u){u=ps(u,r,!0);var f=v.fromDer(u,{parseAllBytes:o._parseAllDigestBytes}),h={},l=[];if(!v.validate(f,P1,h,l)){var g=new Error("ASN.1 object does not contain a valid RSASSA-PKCS1-v1_5 DigestInfo value.");throw g.errors=l,g}var p=v.derToOid(h.algorithmIdentifier);if(!(p===N.oids.md2||p===N.oids.md5||p===N.oids.sha1||p===N.oids.sha224||p===N.oids.sha256||p===N.oids.sha384||p===N.oids.sha512||p===N.oids["sha512-224"]||p===N.oids["sha512-256"])){var g=new Error("Unknown RSASSA-PKCS1-v1_5 DigestAlgorithm identifier.");throw g.oid=p,g}if((p===N.oids.md2||p===N.oids.md5)&&!("parameters"in h))throw new Error("ASN.1 object does not contain a valid RSASSA-PKCS1-v1_5 DigestInfo value. Missing algorithm identifer NULL parameters.");return c===h.digest}}:(s==="NONE"||s==="NULL"||s===null)&&(s={verify:function(c,u){return u=ps(u,r,!0),c===u}});var a=K.rsa.decrypt(i,r,!0,!1);return s.verify(n,a,r.n.bitLength())},r};K.setRsaPrivateKey=K.rsa.setPrivateKey=function(t,e,r,n,i,s,o,a){var c={n:t,e,d:r,p:n,q:i,dP:s,dQ:o,qInv:a};return c.decrypt=function(u,f,h){typeof f=="string"?f=f.toUpperCase():f===void 0&&(f="RSAES-PKCS1-V1_5");var l=K.rsa.decrypt(u,c,!1,!1);if(f==="RSAES-PKCS1-V1_5")f={decode:ps};else if(f==="RSA-OAEP"||f==="RSAES-OAEP")f={decode:function(g,p){return N.pkcs1.decode_rsa_oaep(p,g,h)}};else if(["RAW","NONE","NULL",null].indexOf(f)!==-1)f={decode:function(g){return g}};else throw new Error('Unsupported encryption scheme: "'+f+'".');return f.decode(l,c,!1)},c.sign=function(u,f){var h=!1;typeof f=="string"&&(f=f.toUpperCase()),f===void 0||f==="RSASSA-PKCS1-V1_5"?(f={encode:D1},h=1):(f==="NONE"||f==="NULL"||f===null)&&(f={encode:function(){return u}},h=1);var l=f.encode(u,c.n.bitLength());return K.rsa.encrypt(l,c,h)},c};K.wrapRsaPrivateKey=function(t){return v.create(v.Class.UNIVERSAL,v.Type.SEQUENCE,!0,[v.create(v.Class.UNIVERSAL,v.Type.INTEGER,!1,v.integerToDer(0).getBytes()),v.create(v.Class.UNIVERSAL,v.Type.SEQUENCE,!0,[v.create(v.Class.UNIVERSAL,v.Type.OID,!1,v.oidToDer(K.oids.rsaEncryption).getBytes()),v.create(v.Class.UNIVERSAL,v.Type.NULL,!1,"")]),v.create(v.Class.UNIVERSAL,v.Type.OCTETSTRING,!1,v.toDer(t).getBytes())])};K.privateKeyFromAsn1=function(t){var e={},r=[];if(v.validate(t,I1,e,r)&&(t=v.fromDer(N.util.createBuffer(e.privateKey))),e={},r=[],!v.validate(t,C1,e,r)){var n=new Error("Cannot read private key. ASN.1 object does not contain an RSAPrivateKey.");throw n.errors=r,n}var i,s,o,a,c,u,f,h;return i=N.util.createBuffer(e.privateKeyModulus).toHex(),s=N.util.createBuffer(e.privateKeyPublicExponent).toHex(),o=N.util.createBuffer(e.privateKeyPrivateExponent).toHex(),a=N.util.createBuffer(e.privateKeyPrime1).toHex(),c=N.util.createBuffer(e.privateKeyPrime2).toHex(),u=N.util.createBuffer(e.privateKeyExponent1).toHex(),f=N.util.createBuffer(e.privateKeyExponent2).toHex(),h=N.util.createBuffer(e.privateKeyCoefficient).toHex(),K.setRsaPrivateKey(new Y(i,16),new Y(s,16),new Y(o,16),new Y(a,16),new Y(c,16),new Y(u,16),new Y(f,16),new Y(h,16))};K.privateKeyToAsn1=K.privateKeyToRSAPrivateKey=function(t){return v.create(v.Class.UNIVERSAL,v.Type.SEQUENCE,!0,[v.create(v.Class.UNIVERSAL,v.Type.INTEGER,!1,v.integerToDer(0).getBytes()),v.create(v.Class.UNIVERSAL,v.Type.INTEGER,!1,kt(t.n)),v.create(v.Class.UNIVERSAL,v.Type.INTEGER,!1,kt(t.e)),v.create(v.Class.UNIVERSAL,v.Type.INTEGER,!1,kt(t.d)),v.create(v.Class.UNIVERSAL,v.Type.INTEGER,!1,kt(t.p)),v.create(v.Class.UNIVERSAL,v.Type.INTEGER,!1,kt(t.q)),v.create(v.Class.UNIVERSAL,v.Type.INTEGER,!1,kt(t.dP)),v.create(v.Class.UNIVERSAL,v.Type.INTEGER,!1,kt(t.dQ)),v.create(v.Class.UNIVERSAL,v.Type.INTEGER,!1,kt(t.qInv))])};K.publicKeyFromAsn1=function(t){var e={},r=[];if(v.validate(t,R1,e,r)){var n=v.derToOid(e.publicKeyOid);if(n!==K.oids.rsaEncryption){var i=new Error("Cannot read public key. Unknown OID.");throw i.oid=n,i}t=e.rsaPublicKey}if(r=[],!v.validate(t,B1,e,r)){var i=new Error("Cannot read public key. ASN.1 object does not contain an RSAPublicKey.");throw i.errors=r,i}var s=N.util.createBuffer(e.publicKeyModulus).toHex(),o=N.util.createBuffer(e.publicKeyExponent).toHex();return K.setRsaPublicKey(new Y(s,16),new Y(o,16))};K.publicKeyToAsn1=K.publicKeyToSubjectPublicKeyInfo=function(t){return v.create(v.Class.UNIVERSAL,v.Type.SEQUENCE,!0,[v.create(v.Class.UNIVERSAL,v.Type.SEQUENCE,!0,[v.create(v.Class.UNIVERSAL,v.Type.OID,!1,v.oidToDer(K.oids.rsaEncryption).getBytes()),v.create(v.Class.UNIVERSAL,v.Type.NULL,!1,"")]),v.create(v.Class.UNIVERSAL,v.Type.BITSTRING,!1,[K.publicKeyToRSAPublicKey(t)])])};K.publicKeyToRSAPublicKey=function(t){return v.create(v.Class.UNIVERSAL,v.Type.SEQUENCE,!0,[v.create(v.Class.UNIVERSAL,v.Type.INTEGER,!1,kt(t.n)),v.create(v.Class.UNIVERSAL,v.Type.INTEGER,!1,kt(t.e))])};function Zf(t,e,r){var n=N.util.createBuffer(),i=Math.ceil(e.n.bitLength()/8);if(t.length>i-11){var s=new Error("Message is too long for PKCS#1 v1.5 padding.");throw s.length=t.length,s.max=i-11,s}n.putByte(0),n.putByte(r);var o=i-3-t.length,a;if(r===0||r===1){a=r===0?0:255;for(var c=0;c<o;++c)n.putByte(a)}else for(;o>0;){for(var u=0,f=N.random.getBytes(o),c=0;c<o;++c)a=f.charCodeAt(c),a===0?++u:n.putByte(a);o=u}return n.putByte(0),n.putBytes(t),n}function ps(t,e,r,n){var i=Math.ceil(e.n.bitLength()/8),s=N.util.createBuffer(t),o=s.getByte(),a=s.getByte();if(o!==0||r&&a!==0&&a!==1||!r&&a!=2||r&&a===0&&typeof n>"u")throw new Error("Encryption block is invalid.");var c=0;if(a===0){c=i-3-n;for(var u=0;u<c;++u)if(s.getByte()!==0)throw new Error("Encryption block is invalid.")}else if(a===1)for(c=0;s.length()>1;){if(s.getByte()!==255){--s.read;break}++c}else if(a===2)for(c=0;s.length()>1;){if(s.getByte()===0){--s.read;break}++c}var f=s.getByte();if(f!==0||c!==i-3-s.length())throw new Error("Encryption block is invalid.");return s.getBytes()}function M1(t,e,r){typeof e=="function"&&(r=e,e={}),e=e||{};var n={algorithm:{name:e.algorithm||"PRIMEINC",options:{workers:e.workers||2,workLoad:e.workLoad||100,workerScript:e.workerScript}}};"prng"in e&&(n.prng=e.prng),i();function i(){s(t.pBits,function(a,c){if(a)return r(a);if(t.p=c,t.q!==null)return o(a,t.q);s(t.qBits,o)})}function s(a,c){N.prime.generateProbablePrime(a,n,c)}function o(a,c){if(a)return r(a);if(t.q=c,t.p.compareTo(t.q)<0){var u=t.p;t.p=t.q,t.q=u}if(t.p.subtract(Y.ONE).gcd(t.e).compareTo(Y.ONE)!==0){t.p=null,i();return}if(t.q.subtract(Y.ONE).gcd(t.e).compareTo(Y.ONE)!==0){t.q=null,s(t.qBits,o);return}if(t.p1=t.p.subtract(Y.ONE),t.q1=t.q.subtract(Y.ONE),t.phi=t.p1.multiply(t.q1),t.phi.gcd(t.e).compareTo(Y.ONE)!==0){t.p=t.q=null,i();return}if(t.n=t.p.multiply(t.q),t.n.bitLength()!==t.bits){t.q=null,s(t.qBits,o);return}var f=t.e.modInverse(t.phi);t.keys={privateKey:K.rsa.setPrivateKey(t.n,t.e,f,t.p,t.q,f.mod(t.p1),f.mod(t.q1),t.q.modInverse(t.p)),publicKey:K.rsa.setPublicKey(t.n,t.e)},r(null,t.keys)}}function kt(t){var e=t.toString(16);e[0]>="8"&&(e="00"+e);var r=N.util.hexToBytes(e);return r.length>1&&(r.charCodeAt(0)===0&&(r.charCodeAt(1)&128)===0||r.charCodeAt(0)===255&&(r.charCodeAt(1)&128)===128)?r.substr(1):r}function L1(t){return t<=100?27:t<=150?18:t<=200?15:t<=250?12:t<=300?9:t<=350?8:t<=400?7:t<=500?6:t<=600?5:t<=800?4:t<=1250?3:2}function Gf(t){return N.util.isNodejs&&typeof aa[t]=="function"}function Hf(t){return typeof lt.globalScope<"u"&&typeof lt.globalScope.crypto=="object"&&typeof lt.globalScope.crypto.subtle=="object"&&typeof lt.globalScope.crypto.subtle[t]=="function"}function Wf(t){return typeof lt.globalScope<"u"&&typeof lt.globalScope.msCrypto=="object"&&typeof lt.globalScope.msCrypto.subtle=="object"&&typeof lt.globalScope.msCrypto.subtle[t]=="function"}function $f(t){for(var e=N.util.hexToBytes(t.toString(16)),r=new Uint8Array(e.length),n=0;n<e.length;++n)r[n]=e.charCodeAt(n);return r}});var rh=L((_A,th)=>{var P=ie();Qo();ni();of();Br();Ji();hf();df();ii();Tf();ds();Re();typeof Xf>"u"&&(Xf=P.jsbn.BigInteger);var Xf,x=P.asn1,z=P.pki=P.pki||{};th.exports=z.pbe=P.pbe=P.pbe||{};var Dr=z.oids,N1={name:"EncryptedPrivateKeyInfo",tagClass:x.Class.UNIVERSAL,type:x.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedPrivateKeyInfo.encryptionAlgorithm",tagClass:x.Class.UNIVERSAL,type:x.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:x.Class.UNIVERSAL,type:x.Type.OID,constructed:!1,capture:"encryptionOid"},{name:"AlgorithmIdentifier.parameters",tagClass:x.Class.UNIVERSAL,type:x.Type.SEQUENCE,constructed:!0,captureAsn1:"encryptionParams"}]},{name:"EncryptedPrivateKeyInfo.encryptedData",tagClass:x.Class.UNIVERSAL,type:x.Type.OCTETSTRING,constructed:!1,capture:"encryptedData"}]},k1={name:"PBES2Algorithms",tagClass:x.Class.UNIVERSAL,type:x.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc",tagClass:x.Class.UNIVERSAL,type:x.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc.oid",tagClass:x.Class.UNIVERSAL,type:x.Type.OID,constructed:!1,capture:"kdfOid"},{name:"PBES2Algorithms.params",tagClass:x.Class.UNIVERSAL,type:x.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.params.salt",tagClass:x.Class.UNIVERSAL,type:x.Type.OCTETSTRING,constructed:!1,capture:"kdfSalt"},{name:"PBES2Algorithms.params.iterationCount",tagClass:x.Class.UNIVERSAL,type:x.Type.INTEGER,constructed:!1,capture:"kdfIterationCount"},{name:"PBES2Algorithms.params.keyLength",tagClass:x.Class.UNIVERSAL,type:x.Type.INTEGER,constructed:!1,optional:!0,capture:"keyLength"},{name:"PBES2Algorithms.params.prf",tagClass:x.Class.UNIVERSAL,type:x.Type.SEQUENCE,constructed:!0,optional:!0,value:[{name:"PBES2Algorithms.params.prf.algorithm",tagClass:x.Class.UNIVERSAL,type:x.Type.OID,constructed:!1,capture:"prfOid"}]}]}]},{name:"PBES2Algorithms.encryptionScheme",tagClass:x.Class.UNIVERSAL,type:x.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.encryptionScheme.oid",tagClass:x.Class.UNIVERSAL,type:x.Type.OID,constructed:!1,capture:"encOid"},{name:"PBES2Algorithms.encryptionScheme.iv",tagClass:x.Class.UNIVERSAL,type:x.Type.OCTETSTRING,constructed:!1,capture:"encIv"}]}]},F1={name:"pkcs-12PbeParams",tagClass:x.Class.UNIVERSAL,type:x.Type.SEQUENCE,constructed:!0,value:[{name:"pkcs-12PbeParams.salt",tagClass:x.Class.UNIVERSAL,type:x.Type.OCTETSTRING,constructed:!1,capture:"salt"},{name:"pkcs-12PbeParams.iterations",tagClass:x.Class.UNIVERSAL,type:x.Type.INTEGER,constructed:!1,capture:"iterations"}]};z.encryptPrivateKeyInfo=function(t,e,r){r=r||{},r.saltSize=r.saltSize||8,r.count=r.count||2048,r.algorithm=r.algorithm||"aes128",r.prfAlgorithm=r.prfAlgorithm||"sha1";var n=P.random.getBytesSync(r.saltSize),i=r.count,s=x.integerToDer(i),o,a,c;if(r.algorithm.indexOf("aes")===0||r.algorithm==="des"){var u,f,h;switch(r.algorithm){case"aes128":o=16,u=16,f=Dr["aes128-CBC"],h=P.aes.createEncryptionCipher;break;case"aes192":o=24,u=16,f=Dr["aes192-CBC"],h=P.aes.createEncryptionCipher;break;case"aes256":o=32,u=16,f=Dr["aes256-CBC"],h=P.aes.createEncryptionCipher;break;case"des":o=8,u=8,f=Dr.desCBC,h=P.des.createEncryptionCipher;break;default:var l=new Error("Cannot encrypt private key. Unknown encryption algorithm.");throw l.algorithm=r.algorithm,l}var g="hmacWith"+r.prfAlgorithm.toUpperCase(),p=eh(g),d=P.pkcs5.pbkdf2(e,n,i,o,p),m=P.random.getBytesSync(u),b=h(d);b.start(m),b.update(x.toDer(t)),b.finish(),c=b.output.getBytes();var S=U1(n,s,o,g);a=x.create(x.Class.UNIVERSAL,x.Type.SEQUENCE,!0,[x.create(x.Class.UNIVERSAL,x.Type.OID,!1,x.oidToDer(Dr.pkcs5PBES2).getBytes()),x.create(x.Class.UNIVERSAL,x.Type.SEQUENCE,!0,[x.create(x.Class.UNIVERSAL,x.Type.SEQUENCE,!0,[x.create(x.Class.UNIVERSAL,x.Type.OID,!1,x.oidToDer(Dr.pkcs5PBKDF2).getBytes()),S]),x.create(x.Class.UNIVERSAL,x.Type.SEQUENCE,!0,[x.create(x.Class.UNIVERSAL,x.Type.OID,!1,x.oidToDer(f).getBytes()),x.create(x.Class.UNIVERSAL,x.Type.OCTETSTRING,!1,m)])])])}else if(r.algorithm==="3des"){o=24;var I=new P.util.ByteBuffer(n),d=z.pbe.generatePkcs12Key(e,I,1,i,o),m=z.pbe.generatePkcs12Key(e,I,2,i,o),b=P.des.createEncryptionCipher(d);b.start(m),b.update(x.toDer(t)),b.finish(),c=b.output.getBytes(),a=x.create(x.Class.UNIVERSAL,x.Type.SEQUENCE,!0,[x.create(x.Class.UNIVERSAL,x.Type.OID,!1,x.oidToDer(Dr["pbeWithSHAAnd3-KeyTripleDES-CBC"]).getBytes()),x.create(x.Class.UNIVERSAL,x.Type.SEQUENCE,!0,[x.create(x.Class.UNIVERSAL,x.Type.OCTETSTRING,!1,n),x.create(x.Class.UNIVERSAL,x.Type.INTEGER,!1,s.getBytes())])])}else{var l=new Error("Cannot encrypt private key. Unknown encryption algorithm.");throw l.algorithm=r.algorithm,l}var R=x.create(x.Class.UNIVERSAL,x.Type.SEQUENCE,!0,[a,x.create(x.Class.UNIVERSAL,x.Type.OCTETSTRING,!1,c)]);return R};z.decryptPrivateKeyInfo=function(t,e){var r=null,n={},i=[];if(!x.validate(t,N1,n,i)){var s=new Error("Cannot read encrypted private key. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw s.errors=i,s}var o=x.derToOid(n.encryptionOid),a=z.pbe.getCipher(o,n.encryptionParams,e),c=P.util.createBuffer(n.encryptedData);return a.update(c),a.finish()&&(r=x.fromDer(a.output)),r};z.encryptedPrivateKeyToPem=function(t,e){var r={type:"ENCRYPTED PRIVATE KEY",body:x.toDer(t).getBytes()};return P.pem.encode(r,{maxline:e})};z.encryptedPrivateKeyFromPem=function(t){var e=P.pem.decode(t)[0];if(e.type!=="ENCRYPTED PRIVATE KEY"){var r=new Error('Could not convert encrypted private key from PEM; PEM header type is "ENCRYPTED PRIVATE KEY".');throw r.headerType=e.type,r}if(e.procType&&e.procType.type==="ENCRYPTED")throw new Error("Could not convert encrypted private key from PEM; PEM is encrypted.");return x.fromDer(e.body)};z.encryptRsaPrivateKey=function(t,e,r){if(r=r||{},!r.legacy){var n=z.wrapRsaPrivateKey(z.privateKeyToAsn1(t));return n=z.encryptPrivateKeyInfo(n,e,r),z.encryptedPrivateKeyToPem(n)}var i,s,o,a;switch(r.algorithm){case"aes128":i="AES-128-CBC",o=16,s=P.random.getBytesSync(16),a=P.aes.createEncryptionCipher;break;case"aes192":i="AES-192-CBC",o=24,s=P.random.getBytesSync(16),a=P.aes.createEncryptionCipher;break;case"aes256":i="AES-256-CBC",o=32,s=P.random.getBytesSync(16),a=P.aes.createEncryptionCipher;break;case"3des":i="DES-EDE3-CBC",o=24,s=P.random.getBytesSync(8),a=P.des.createEncryptionCipher;break;case"des":i="DES-CBC",o=8,s=P.random.getBytesSync(8),a=P.des.createEncryptionCipher;break;default:var c=new Error('Could not encrypt RSA private key; unsupported encryption algorithm "'+r.algorithm+'".');throw c.algorithm=r.algorithm,c}var u=P.pbe.opensslDeriveBytes(e,s.substr(0,8),o),f=a(u);f.start(s),f.update(x.toDer(z.privateKeyToAsn1(t))),f.finish();var h={type:"RSA PRIVATE KEY",procType:{version:"4",type:"ENCRYPTED"},dekInfo:{algorithm:i,parameters:P.util.bytesToHex(s).toUpperCase()},body:f.output.getBytes()};return P.pem.encode(h)};z.decryptRsaPrivateKey=function(t,e){var r=null,n=P.pem.decode(t)[0];if(n.type!=="ENCRYPTED PRIVATE KEY"&&n.type!=="PRIVATE KEY"&&n.type!=="RSA PRIVATE KEY"){var i=new Error('Could not convert private key from PEM; PEM header type is not "ENCRYPTED PRIVATE KEY", "PRIVATE KEY", or "RSA PRIVATE KEY".');throw i.headerType=i,i}if(n.procType&&n.procType.type==="ENCRYPTED"){var s,o;switch(n.dekInfo.algorithm){case"DES-CBC":s=8,o=P.des.createDecryptionCipher;break;case"DES-EDE3-CBC":s=24,o=P.des.createDecryptionCipher;break;case"AES-128-CBC":s=16,o=P.aes.createDecryptionCipher;break;case"AES-192-CBC":s=24,o=P.aes.createDecryptionCipher;break;case"AES-256-CBC":s=32,o=P.aes.createDecryptionCipher;break;case"RC2-40-CBC":s=5,o=function(h){return P.rc2.createDecryptionCipher(h,40)};break;case"RC2-64-CBC":s=8,o=function(h){return P.rc2.createDecryptionCipher(h,64)};break;case"RC2-128-CBC":s=16,o=function(h){return P.rc2.createDecryptionCipher(h,128)};break;default:var i=new Error('Could not decrypt private key; unsupported encryption algorithm "'+n.dekInfo.algorithm+'".');throw i.algorithm=n.dekInfo.algorithm,i}var a=P.util.hexToBytes(n.dekInfo.parameters),c=P.pbe.opensslDeriveBytes(e,a.substr(0,8),s),u=o(c);if(u.start(a),u.update(P.util.createBuffer(n.body)),u.finish())r=u.output.getBytes();else return r}else r=n.body;return n.type==="ENCRYPTED PRIVATE KEY"?r=z.decryptPrivateKeyInfo(x.fromDer(r),e):r=x.fromDer(r),r!==null&&(r=z.privateKeyFromAsn1(r)),r};z.pbe.generatePkcs12Key=function(t,e,r,n,i,s){var o,a;if(typeof s>"u"||s===null){if(!("sha1"in P.md))throw new Error('"sha1" hash algorithm unavailable.');s=P.md.sha1.create()}var c=s.digestLength,u=s.blockLength,f=new P.util.ByteBuffer,h=new P.util.ByteBuffer;if(t!=null){for(a=0;a<t.length;a++)h.putInt16(t.charCodeAt(a));h.putInt16(0)}var l=h.length(),g=e.length(),p=new P.util.ByteBuffer;p.fillWithByte(r,u);var d=u*Math.ceil(g/u),m=new P.util.ByteBuffer;for(a=0;a<d;a++)m.putByte(e.at(a%g));var b=u*Math.ceil(l/u),S=new P.util.ByteBuffer;for(a=0;a<b;a++)S.putByte(h.at(a%l));var I=m;I.putBuffer(S);for(var R=Math.ceil(i/c),w=1;w<=R;w++){var T=new P.util.ByteBuffer;T.putBytes(p.bytes()),T.putBytes(I.bytes());for(var D=0;D<n;D++)s.start(),s.update(T.getBytes()),T=s.digest();var k=new P.util.ByteBuffer;for(a=0;a<u;a++)k.putByte(T.at(a%c));var V=Math.ceil(g/u)+Math.ceil(l/u),me=new P.util.ByteBuffer;for(o=0;o<V;o++){var Fe=new P.util.ByteBuffer(I.getBytes(u)),We=511;for(a=k.length()-1;a>=0;a--)We=We>>8,We+=k.at(a)+Fe.at(a),Fe.setAt(a,We&255);me.putBuffer(Fe)}I=me,f.putBuffer(T)}return f.truncate(f.length()-i),f};z.pbe.getCipher=function(t,e,r){switch(t){case z.oids.pkcs5PBES2:return z.pbe.getCipherForPBES2(t,e,r);case z.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:case z.oids["pbewithSHAAnd40BitRC2-CBC"]:return z.pbe.getCipherForPKCS12PBE(t,e,r);default:var n=new Error("Cannot read encrypted PBE data block. Unsupported OID.");throw n.oid=t,n.supportedOids=["pkcs5PBES2","pbeWithSHAAnd3-KeyTripleDES-CBC","pbewithSHAAnd40BitRC2-CBC"],n}};z.pbe.getCipherForPBES2=function(t,e,r){var n={},i=[];if(!x.validate(e,k1,n,i)){var s=new Error("Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw s.errors=i,s}if(t=x.derToOid(n.kdfOid),t!==z.oids.pkcs5PBKDF2){var s=new Error("Cannot read encrypted private key. Unsupported key derivation function OID.");throw s.oid=t,s.supportedOids=["pkcs5PBKDF2"],s}if(t=x.derToOid(n.encOid),t!==z.oids["aes128-CBC"]&&t!==z.oids["aes192-CBC"]&&t!==z.oids["aes256-CBC"]&&t!==z.oids["des-EDE3-CBC"]&&t!==z.oids.desCBC){var s=new Error("Cannot read encrypted private key. Unsupported encryption scheme OID.");throw s.oid=t,s.supportedOids=["aes128-CBC","aes192-CBC","aes256-CBC","des-EDE3-CBC","desCBC"],s}var o=n.kdfSalt,a=P.util.createBuffer(n.kdfIterationCount);a=a.getInt(a.length()<<3);var c,u;switch(z.oids[t]){case"aes128-CBC":c=16,u=P.aes.createDecryptionCipher;break;case"aes192-CBC":c=24,u=P.aes.createDecryptionCipher;break;case"aes256-CBC":c=32,u=P.aes.createDecryptionCipher;break;case"des-EDE3-CBC":c=24,u=P.des.createDecryptionCipher;break;case"desCBC":c=8,u=P.des.createDecryptionCipher;break}var f=Jf(n.prfOid),h=P.pkcs5.pbkdf2(r,o,a,c,f),l=n.encIv,g=u(h);return g.start(l),g};z.pbe.getCipherForPKCS12PBE=function(t,e,r){var n={},i=[];if(!x.validate(e,F1,n,i)){var s=new Error("Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw s.errors=i,s}var o=P.util.createBuffer(n.salt),a=P.util.createBuffer(n.iterations);a=a.getInt(a.length()<<3);var c,u,f;switch(t){case z.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:c=24,u=8,f=P.des.startDecrypting;break;case z.oids["pbewithSHAAnd40BitRC2-CBC"]:c=5,u=8,f=function(d,m){var b=P.rc2.createDecryptionCipher(d,40);return b.start(m,null),b};break;default:var s=new Error("Cannot read PKCS #12 PBE data block. Unsupported OID.");throw s.oid=t,s}var h=Jf(n.prfOid),l=z.pbe.generatePkcs12Key(r,o,1,a,c,h);h.start();var g=z.pbe.generatePkcs12Key(r,o,2,a,u,h);return f(l,g)};z.pbe.opensslDeriveBytes=function(t,e,r,n){if(typeof n>"u"||n===null){if(!("md5"in P.md))throw new Error('"md5" hash algorithm unavailable.');n=P.md.md5.create()}e===null&&(e="");for(var i=[Qf(n,t+e)],s=16,o=1;s<r;++o,s+=16)i.push(Qf(n,i[o-1]+t+e));return i.join("").substr(0,r)};function Qf(t,e){return t.start().update(e).digest().getBytes()}function Jf(t){var e;if(!t)e="hmacWithSHA1";else if(e=z.oids[x.derToOid(t)],!e){var r=new Error("Unsupported PRF OID.");throw r.oid=t,r.supported=["hmacWithSHA1","hmacWithSHA224","hmacWithSHA256","hmacWithSHA384","hmacWithSHA512"],r}return eh(e)}function eh(t){var e=P.md;switch(t){case"hmacWithSHA224":e=P.md.sha512;case"hmacWithSHA1":case"hmacWithSHA256":case"hmacWithSHA384":case"hmacWithSHA512":t=t.substr(8).toLowerCase();break;default:var r=new Error("Unsupported PRF algorithm.");throw r.algorithm=t,r.supported=["hmacWithSHA1","hmacWithSHA224","hmacWithSHA256","hmacWithSHA384","hmacWithSHA512"],r}if(!e||!(t in e))throw new Error("Unknown hash algorithm: "+t);return e[t].create()}function U1(t,e,r,n){var i=x.create(x.Class.UNIVERSAL,x.Type.SEQUENCE,!0,[x.create(x.Class.UNIVERSAL,x.Type.OCTETSTRING,!1,t),x.create(x.Class.UNIVERSAL,x.Type.INTEGER,!1,e.getBytes())]);return n!=="hmacWithSHA1"&&i.value.push(x.create(x.Class.UNIVERSAL,x.Type.INTEGER,!1,P.util.hexToBytes(r.toString(16))),x.create(x.Class.UNIVERSAL,x.Type.SEQUENCE,!0,[x.create(x.Class.UNIVERSAL,x.Type.OID,!1,x.oidToDer(z.oids[n]).getBytes()),x.create(x.Class.UNIVERSAL,x.Type.NULL,!1,"")])),i}});var fh=L((tT,uh)=>{var ge=ie();Br();Re();var oi=uh.exports=ge.sha512=ge.sha512||{};ge.md.sha512=ge.md.algorithms.sha512=oi;var ah=ge.sha384=ge.sha512.sha384=ge.sha512.sha384||{};ah.create=function(){return oi.create("SHA-384")};ge.md.sha384=ge.md.algorithms.sha384=ah;ge.sha512.sha256=ge.sha512.sha256||{create:function(){return oi.create("SHA-512/256")}};ge.md["sha512/256"]=ge.md.algorithms["sha512/256"]=ge.sha512.sha256;ge.sha512.sha224=ge.sha512.sha224||{create:function(){return oi.create("SHA-512/224")}};ge.md["sha512/224"]=ge.md.algorithms["sha512/224"]=ge.sha512.sha224;oi.create=function(t){if(ch||G1(),typeof t>"u"&&(t="SHA-512"),!(t in Mr))throw new Error("Invalid SHA-512 algorithm: "+t);for(var e=Mr[t],r=null,n=ge.util.createBuffer(),i=new Array(80),s=0;s<80;++s)i[s]=new Array(2);var o=64;switch(t){case"SHA-384":o=48;break;case"SHA-512/256":o=32;break;case"SHA-512/224":o=28;break}var a={algorithm:t.replace("-","").toLowerCase(),blockLength:128,digestLength:o,messageLength:0,fullMessageLength:null,messageLengthSize:16};return a.start=function(){a.messageLength=0,a.fullMessageLength=a.messageLength128=[];for(var c=a.messageLengthSize/4,u=0;u<c;++u)a.fullMessageLength.push(0);n=ge.util.createBuffer(),r=new Array(e.length);for(var u=0;u<e.length;++u)r[u]=e[u].slice(0);return a},a.start(),a.update=function(c,u){u==="utf8"&&(c=ge.util.encodeUtf8(c));var f=c.length;a.messageLength+=f,f=[f/4294967296>>>0,f>>>0];for(var h=a.fullMessageLength.length-1;h>=0;--h)a.fullMessageLength[h]+=f[1],f[1]=f[0]+(a.fullMessageLength[h]/4294967296>>>0),a.fullMessageLength[h]=a.fullMessageLength[h]>>>0,f[0]=f[1]/4294967296>>>0;return n.putBytes(c),oh(r,i,n),(n.read>2048||n.length()===0)&&n.compact(),a},a.digest=function(){var c=ge.util.createBuffer();c.putBytes(n.bytes());var u=a.fullMessageLength[a.fullMessageLength.length-1]+a.messageLengthSize,f=u&a.blockLength-1;c.putBytes(ua.substr(0,a.blockLength-f));for(var h,l,g=a.fullMessageLength[0]*8,p=0;p<a.fullMessageLength.length-1;++p)h=a.fullMessageLength[p+1]*8,l=h/4294967296>>>0,g+=l,c.putInt32(g>>>0),g=h>>>0;c.putInt32(g);for(var d=new Array(r.length),p=0;p<r.length;++p)d[p]=r[p].slice(0);oh(d,i,c);var m=ge.util.createBuffer(),b;t==="SHA-512"?b=d.length:t==="SHA-384"?b=d.length-2:b=d.length-4;for(var p=0;p<b;++p)m.putInt32(d[p][0]),(p!==b-1||t!=="SHA-512/224")&&m.putInt32(d[p][1]);return m},a};var ua=null,ch=!1,fa=null,Mr=null;function G1(){ua=String.fromCharCode(128),ua+=ge.util.fillString(String.fromCharCode(0),128),fa=[[1116352408,3609767458],[1899447441,602891725],[3049323471,3964484399],[3921009573,2173295548],[961987163,4081628472],[1508970993,3053834265],[2453635748,2937671579],[2870763221,3664609560],[3624381080,2734883394],[310598401,1164996542],[607225278,1323610764],[1426881987,3590304994],[1925078388,4068182383],[2162078206,991336113],[2614888103,633803317],[3248222580,3479774868],[3835390401,2666613458],[4022224774,944711139],[264347078,2341262773],[604807628,2007800933],[770255983,1495990901],[1249150122,1856431235],[1555081692,3175218132],[1996064986,2198950837],[2554220882,3999719339],[2821834349,766784016],[2952996808,2566594879],[3210313671,3203337956],[3336571891,1034457026],[3584528711,2466948901],[113926993,3758326383],[338241895,168717936],[666307205,1188179964],[773529912,1546045734],[1294757372,1522805485],[1396182291,2643833823],[1695183700,2343527390],[1986661051,1014477480],[2177026350,1206759142],[2456956037,344077627],[2730485921,1290863460],[2820302411,3158454273],[3259730800,3505952657],[3345764771,106217008],[3516065817,3606008344],[3600352804,1432725776],[4094571909,1467031594],[275423344,851169720],[430227734,3100823752],[506948616,1363258195],[659060556,3750685593],[883997877,3785050280],[958139571,3318307427],[1322822218,3812723403],[1537002063,2003034995],[1747873779,3602036899],[1955562222,1575990012],[2024104815,1125592928],[2227730452,2716904306],[2361852424,442776044],[2428436474,593698344],[2756734187,3733110249],[3204031479,2999351573],[3329325298,3815920427],[3391569614,3928383900],[3515267271,566280711],[3940187606,3454069534],[4118630271,4000239992],[116418474,1914138554],[174292421,2731055270],[289380356,3203993006],[460393269,320620315],[685471733,587496836],[852142971,1086792851],[1017036298,365543100],[1126000580,2618297676],[1288033470,3409855158],[1501505948,4234509866],[1607167915,987167468],[1816402316,1246189591]],Mr={},Mr["SHA-512"]=[[1779033703,4089235720],[3144134277,2227873595],[1013904242,4271175723],[2773480762,1595750129],[1359893119,2917565137],[2600822924,725511199],[528734635,4215389547],[1541459225,327033209]],Mr["SHA-384"]=[[3418070365,3238371032],[1654270250,914150663],[2438529370,812702999],[355462360,4144912697],[1731405415,4290775857],[2394180231,1750603025],[3675008525,1694076839],[1203062813,3204075428]],Mr["SHA-512/256"]=[[573645204,4230739756],[2673172387,3360449730],[596883563,1867755857],[2520282905,1497426621],[2519219938,2827943907],[3193839141,1401305490],[721525244,746961066],[246885852,2177182882]],Mr["SHA-512/224"]=[[2352822216,424955298],[1944164710,2312950998],[502970286,855612546],[1738396948,1479516111],[258812777,2077511080],[2011393907,79989058],[1067287976,1780299464],[286451373,2446758561]],ch=!0}function oh(t,e,r){for(var n,i,s,o,a,c,u,f,h,l,g,p,d,m,b,S,I,R,w,T,D,k,V,me,Fe,We,Jr,Ui,Ie,Xe,F,ho,lo,po,go,Gc=r.length();Gc>=128;){for(Ie=0;Ie<16;++Ie)e[Ie][0]=r.getInt32()>>>0,e[Ie][1]=r.getInt32()>>>0;for(;Ie<80;++Ie)ho=e[Ie-2],Xe=ho[0],F=ho[1],n=((Xe>>>19|F<<13)^(F>>>29|Xe<<3)^Xe>>>6)>>>0,i=((Xe<<13|F>>>19)^(F<<3|Xe>>>29)^(Xe<<26|F>>>6))>>>0,po=e[Ie-15],Xe=po[0],F=po[1],s=((Xe>>>1|F<<31)^(Xe>>>8|F<<24)^Xe>>>7)>>>0,o=((Xe<<31|F>>>1)^(Xe<<24|F>>>8)^(Xe<<25|F>>>7))>>>0,lo=e[Ie-7],go=e[Ie-16],F=i+lo[1]+o+go[1],e[Ie][0]=n+lo[0]+s+go[0]+(F/4294967296>>>0)>>>0,e[Ie][1]=F>>>0;for(d=t[0][0],m=t[0][1],b=t[1][0],S=t[1][1],I=t[2][0],R=t[2][1],w=t[3][0],T=t[3][1],D=t[4][0],k=t[4][1],V=t[5][0],me=t[5][1],Fe=t[6][0],We=t[6][1],Jr=t[7][0],Ui=t[7][1],Ie=0;Ie<80;++Ie)u=((D>>>14|k<<18)^(D>>>18|k<<14)^(k>>>9|D<<23))>>>0,f=((D<<18|k>>>14)^(D<<14|k>>>18)^(k<<23|D>>>9))>>>0,h=(Fe^D&(V^Fe))>>>0,l=(We^k&(me^We))>>>0,a=((d>>>28|m<<4)^(m>>>2|d<<30)^(m>>>7|d<<25))>>>0,c=((d<<4|m>>>28)^(m<<30|d>>>2)^(m<<25|d>>>7))>>>0,g=(d&b|I&(d^b))>>>0,p=(m&S|R&(m^S))>>>0,F=Ui+f+l+fa[Ie][1]+e[Ie][1],n=Jr+u+h+fa[Ie][0]+e[Ie][0]+(F/4294967296>>>0)>>>0,i=F>>>0,F=c+p,s=a+g+(F/4294967296>>>0)>>>0,o=F>>>0,Jr=Fe,Ui=We,Fe=V,We=me,V=D,me=k,F=T+i,D=w+n+(F/4294967296>>>0)>>>0,k=F>>>0,w=I,T=R,I=b,R=S,b=d,S=m,F=i+o,d=n+s+(F/4294967296>>>0)>>>0,m=F>>>0;F=t[0][1]+m,t[0][0]=t[0][0]+d+(F/4294967296>>>0)>>>0,t[0][1]=F>>>0,F=t[1][1]+S,t[1][0]=t[1][0]+b+(F/4294967296>>>0)>>>0,t[1][1]=F>>>0,F=t[2][1]+R,t[2][0]=t[2][0]+I+(F/4294967296>>>0)>>>0,t[2][1]=F>>>0,F=t[3][1]+T,t[3][0]=t[3][0]+w+(F/4294967296>>>0)>>>0,t[3][1]=F>>>0,F=t[4][1]+k,t[4][0]=t[4][0]+D+(F/4294967296>>>0)>>>0,t[4][1]=F>>>0,F=t[5][1]+me,t[5][0]=t[5][0]+V+(F/4294967296>>>0)>>>0,t[5][1]=F>>>0,F=t[6][1]+We,t[6][0]=t[6][0]+Fe+(F/4294967296>>>0)>>>0,t[6][1]=F>>>0,F=t[7][1]+Ui,t[7][0]=t[7][0]+Jr+(F/4294967296>>>0)>>>0,t[7][1]=F>>>0,Gc-=128}}});var ha=L((rT,hh)=>{"use strict";function H1(t){let e=new Uint8Array(t),r=0;if(t>0)if(t>65536)for(;r<t;)r+65536>t?(crypto.getRandomValues(e.subarray(r,r+(t-r))),r+=t-r):(crypto.getRandomValues(e.subarray(r,r+65536)),r+=65536);else crypto.getRandomValues(e);return e}hh.exports=H1});var fl=L((HT,ul)=>{ul.exports=La;var cl=128,Nv=127,kv=~Nv,Fv=Math.pow(2,31);function La(t,e,r){if(Number.MAX_SAFE_INTEGER&&t>Number.MAX_SAFE_INTEGER)throw La.bytes=0,new RangeError("Could not encode varint");e=e||[],r=r||0;for(var n=r;t>=Fv;)e[r++]=t&255|cl,t/=128;for(;t&kv;)e[r++]=t&255|cl,t>>>=7;return e[r]=t|0,La.bytes=r-n+1,e}});var pl=L((WT,ll)=>{ll.exports=Na;var Uv=128,hl=127;function Na(t,n){var r=0,n=n||0,i=0,s=n,o,a=t.length;do{if(s>=a||i>49)throw Na.bytes=0,new RangeError("Could not decode varint");o=t[s++],r+=i<28?(o&hl)<<i:(o&hl)*Math.pow(2,i),i+=7}while(o>=Uv);return Na.bytes=s-n,r}});var gl=L(($T,dl)=>{var Ov=Math.pow(2,7),Kv=Math.pow(2,14),qv=Math.pow(2,21),Vv=Math.pow(2,28),zv=Math.pow(2,35),Gv=Math.pow(2,42),Hv=Math.pow(2,49),Wv=Math.pow(2,56),$v=Math.pow(2,63);dl.exports=function(t){return t<Ov?1:t<Kv?2:t<qv?3:t<Vv?4:t<zv?5:t<Gv?6:t<Hv?7:t<Wv?8:t<$v?9:10}});var Or=L((YT,yl)=>{yl.exports={encode:fl(),decode:pl(),encodingLength:gl()}});var zl=L((JI,Vl)=>{var An=1e3,Tn=An*60,In=Tn*60,qr=In*24,vb=qr*7,bb=qr*365.25;Vl.exports=function(t,e){e=e||{};var r=typeof t;if(r==="string"&&t.length>0)return wb(t);if(r==="number"&&isFinite(t))return e.long?Eb(t):xb(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))};function wb(t){if(t=String(t),!(t.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(!!e){var r=parseFloat(e[1]),n=(e[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return r*bb;case"weeks":case"week":case"w":return r*vb;case"days":case"day":case"d":return r*qr;case"hours":case"hour":case"hrs":case"hr":case"h":return r*In;case"minutes":case"minute":case"mins":case"min":case"m":return r*Tn;case"seconds":case"second":case"secs":case"sec":case"s":return r*An;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}}}function xb(t){var e=Math.abs(t);return e>=qr?Math.round(t/qr)+"d":e>=In?Math.round(t/In)+"h":e>=Tn?Math.round(t/Tn)+"m":e>=An?Math.round(t/An)+"s":t+"ms"}function Eb(t){var e=Math.abs(t);return e>=qr?Ms(t,e,qr,"day"):e>=In?Ms(t,e,In,"hour"):e>=Tn?Ms(t,e,Tn,"minute"):e>=An?Ms(t,e,An,"second"):t+" ms"}function Ms(t,e,r,n){var i=e>=r*1.5;return Math.round(t/r)+" "+n+(i?"s":"")}});var Hl=L((e8,Gl)=>{function Sb(t){r.debug=r,r.default=r,r.coerce=c,r.disable=s,r.enable=i,r.enabled=o,r.humanize=zl(),r.destroy=u,Object.keys(t).forEach(f=>{r[f]=t[f]}),r.names=[],r.skips=[],r.formatters={};function e(f){let h=0;for(let l=0;l<f.length;l++)h=(h<<5)-h+f.charCodeAt(l),h|=0;return r.colors[Math.abs(h)%r.colors.length]}r.selectColor=e;function r(f){let h,l=null,g,p;function d(...m){if(!d.enabled)return;let b=d,S=Number(new Date),I=S-(h||S);b.diff=I,b.prev=h,b.curr=S,h=S,m[0]=r.coerce(m[0]),typeof m[0]!="string"&&m.unshift("%O");let R=0;m[0]=m[0].replace(/%([a-zA-Z%])/g,(T,D)=>{if(T==="%%")return"%";R++;let k=r.formatters[D];if(typeof k=="function"){let V=m[R];T=k.call(b,V),m.splice(R,1),R--}return T}),r.formatArgs.call(b,m),(b.log||r.log).apply(b,m)}return d.namespace=f,d.useColors=r.useColors(),d.color=r.selectColor(f),d.extend=n,d.destroy=r.destroy,Object.defineProperty(d,"enabled",{enumerable:!0,configurable:!1,get:()=>l!==null?l:(g!==r.namespaces&&(g=r.namespaces,p=r.enabled(f)),p),set:m=>{l=m}}),typeof r.init=="function"&&r.init(d),d}function n(f,h){let l=r(this.namespace+(typeof h>"u"?":":h)+f);return l.log=this.log,l}function i(f){r.save(f),r.namespaces=f,r.names=[],r.skips=[];let h,l=(typeof f=="string"?f:"").split(/[\s,]+/),g=l.length;for(h=0;h<g;h++)!l[h]||(f=l[h].replace(/\*/g,".*?"),f[0]==="-"?r.skips.push(new RegExp("^"+f.slice(1)+"$")):r.names.push(new RegExp("^"+f+"$")))}function s(){let f=[...r.names.map(a),...r.skips.map(a).map(h=>"-"+h)].join(",");return r.enable(""),f}function o(f){if(f[f.length-1]==="*")return!0;let h,l;for(h=0,l=r.skips.length;h<l;h++)if(r.skips[h].test(f))return!1;for(h=0,l=r.names.length;h<l;h++)if(r.names[h].test(f))return!0;return!1}function a(f){return f.toString().substring(2,f.toString().length-2).replace(/\.\*\?$/,"*")}function c(f){return f instanceof Error?f.stack||f.message:f}function u(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return r.enable(r.load()),r}Gl.exports=Sb});var Wl=L((ct,Ls)=>{ct.formatArgs=Ab;ct.save=Tb;ct.load=Ib;ct.useColors=_b;ct.storage=Cb();ct.destroy=(()=>{let t=!1;return()=>{t||(t=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();ct.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function _b(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function Ab(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+Ls.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;t.splice(1,0,e,"color: inherit");let r=0,n=0;t[0].replace(/%[a-zA-Z%]/g,i=>{i!=="%%"&&(r++,i==="%c"&&(n=r))}),t.splice(n,0,e)}ct.log=console.debug||console.log||(()=>{});function Tb(t){try{t?ct.storage.setItem("debug",t):ct.storage.removeItem("debug")}catch{}}function Ib(){let t;try{t=ct.storage.getItem("debug")}catch{}return!t&&typeof process<"u"&&"env"in process&&(t=process.env.DEBUG),t}function Cb(){try{return localStorage}catch{}}Ls.exports=Hl()(ct);var{formatters:Bb}=Ls.exports;Bb.j=function(t){try{return JSON.stringify(t)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var f0=L((p4,u0)=>{"use strict";function Se(t,r){var r=r||{};this._head=0,this._tail=0,this._capacity=r.capacity,this._capacityMask=3,this._list=new Array(4),Array.isArray(t)&&this._fromArray(t)}Se.prototype.peekAt=function(e){var r=e;if(r===(r|0)){var n=this.size();if(!(r>=n||r<-n))return r<0&&(r+=n),r=this._head+r&this._capacityMask,this._list[r]}};Se.prototype.get=function(e){return this.peekAt(e)};Se.prototype.peek=function(){if(this._head!==this._tail)return this._list[this._head]};Se.prototype.peekFront=function(){return this.peek()};Se.prototype.peekBack=function(){return this.peekAt(-1)};Object.defineProperty(Se.prototype,"length",{get:function(){return this.size()}});Se.prototype.size=function(){return this._head===this._tail?0:this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)};Se.prototype.unshift=function(e){if(e===void 0)return this.size();var r=this._list.length;return this._head=this._head-1+r&this._capacityMask,this._list[this._head]=e,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.pop(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)};Se.prototype.shift=function(){var e=this._head;if(e!==this._tail){var r=this._list[e];return this._list[e]=void 0,this._head=e+1&this._capacityMask,e<2&&this._tail>1e4&&this._tail<=this._list.length>>>2&&this._shrinkArray(),r}};Se.prototype.push=function(e){if(e===void 0)return this.size();var r=this._tail;return this._list[r]=e,this._tail=r+1&this._capacityMask,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.shift(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)};Se.prototype.pop=function(){var e=this._tail;if(e!==this._head){var r=this._list.length;this._tail=e-1+r&this._capacityMask;var n=this._list[this._tail];return this._list[this._tail]=void 0,this._head<2&&e>1e4&&e<=r>>>2&&this._shrinkArray(),n}};Se.prototype.removeOne=function(e){var r=e;if(r===(r|0)&&this._head!==this._tail){var n=this.size(),i=this._list.length;if(!(r>=n||r<-n)){r<0&&(r+=n),r=this._head+r&this._capacityMask;var s=this._list[r],o;if(e<n/2){for(o=e;o>0;o--)this._list[r]=this._list[r=r-1+i&this._capacityMask];this._list[r]=void 0,this._head=this._head+1+i&this._capacityMask}else{for(o=n-1-e;o>0;o--)this._list[r]=this._list[r=r+1+i&this._capacityMask];this._list[r]=void 0,this._tail=this._tail-1+i&this._capacityMask}return s}}};Se.prototype.remove=function(e,r){var n=e,i,s=r;if(n===(n|0)&&this._head!==this._tail){var o=this.size(),a=this._list.length;if(!(n>=o||n<-o||r<1)){if(n<0&&(n+=o),r===1||!r)return i=new Array(1),i[0]=this.removeOne(n),i;if(n===0&&n+r>=o)return i=this.toArray(),this.clear(),i;n+r>o&&(r=o-n);var c;for(i=new Array(r),c=0;c<r;c++)i[c]=this._list[this._head+n+c&this._capacityMask];if(n=this._head+n&this._capacityMask,e+r===o){for(this._tail=this._tail-r+a&this._capacityMask,c=r;c>0;c--)this._list[n=n+1+a&this._capacityMask]=void 0;return i}if(e===0){for(this._head=this._head+r+a&this._capacityMask,c=r-1;c>0;c--)this._list[n=n+1+a&this._capacityMask]=void 0;return i}if(n<o/2){for(this._head=this._head+e+r+a&this._capacityMask,c=e;c>0;c--)this.unshift(this._list[n=n-1+a&this._capacityMask]);for(n=this._head-1+a&this._capacityMask;s>0;)this._list[n=n-1+a&this._capacityMask]=void 0,s--;e<0&&(this._tail=n)}else{for(this._tail=n,n=n+r+a&this._capacityMask,c=o-(r+e);c>0;c--)this.push(this._list[n++]);for(n=this._tail;s>0;)this._list[n=n+1+a&this._capacityMask]=void 0,s--}return this._head<2&&this._tail>1e4&&this._tail<=a>>>2&&this._shrinkArray(),i}}};Se.prototype.splice=function(e,r){var n=e;if(n===(n|0)){var i=this.size();if(n<0&&(n+=i),!(n>i))if(arguments.length>2){var s,o,a,c=arguments.length,u=this._list.length,f=2;if(!i||n<i/2){for(o=new Array(n),s=0;s<n;s++)o[s]=this._list[this._head+s&this._capacityMask];for(r===0?(a=[],n>0&&(this._head=this._head+n+u&this._capacityMask)):(a=this.remove(n,r),this._head=this._head+n+u&this._capacityMask);c>f;)this.unshift(arguments[--c]);for(s=n;s>0;s--)this.unshift(o[s-1])}else{o=new Array(i-(n+r));var h=o.length;for(s=0;s<h;s++)o[s]=this._list[this._head+n+r+s&this._capacityMask];for(r===0?(a=[],n!=i&&(this._tail=this._head+n+u&this._capacityMask)):(a=this.remove(n,r),this._tail=this._tail-h+u&this._capacityMask);f<c;)this.push(arguments[f++]);for(s=0;s<h;s++)this.push(o[s])}return a}else return this.remove(n,r)}};Se.prototype.clear=function(){this._head=0,this._tail=0};Se.prototype.isEmpty=function(){return this._head===this._tail};Se.prototype.toArray=function(){return this._copyArray(!1)};Se.prototype._fromArray=function(e){for(var r=0;r<e.length;r++)this.push(e[r])};Se.prototype._copyArray=function(e){var r=[],n=this._list,i=n.length,s;if(e||this._head>this._tail){for(s=this._head;s<i;s++)r.push(n[s]);for(s=0;s<this._tail;s++)r.push(n[s])}else for(s=this._head;s<this._tail;s++)r.push(n[s]);return r};Se.prototype._growArray=function(){this._head&&(this._list=this._copyArray(!0),this._head=0),this._tail=this._list.length,this._list.length<<=1,this._capacityMask=this._capacityMask<<1|1};Se.prototype._shrinkArray=function(){this._list.length>>>=1,this._capacityMask>>>=1};u0.exports=Se});var rc=L((k4,tc)=>{"use strict";var On=typeof Reflect=="object"?Reflect:null,d0=On&&typeof On.apply=="function"?On.apply:function(e,r,n){return Function.prototype.apply.call(e,r,n)},zs;On&&typeof On.ownKeys=="function"?zs=On.ownKeys:Object.getOwnPropertySymbols?zs=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:zs=function(e){return Object.getOwnPropertyNames(e)};function Hb(t){console&&console.warn&&console.warn(t)}var y0=Number.isNaN||function(e){return e!==e};function ae(){ae.init.call(this)}tc.exports=ae;tc.exports.once=Zb;ae.EventEmitter=ae;ae.prototype._events=void 0;ae.prototype._eventsCount=0;ae.prototype._maxListeners=void 0;var g0=10;function Gs(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(ae,"defaultMaxListeners",{enumerable:!0,get:function(){return g0},set:function(t){if(typeof t!="number"||t<0||y0(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");g0=t}});ae.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};ae.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||y0(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function m0(t){return t._maxListeners===void 0?ae.defaultMaxListeners:t._maxListeners}ae.prototype.getMaxListeners=function(){return m0(this)};ae.prototype.emit=function(e){for(var r=[],n=1;n<arguments.length;n++)r.push(arguments[n]);var i=e==="error",s=this._events;if(s!==void 0)i=i&&s.error===void 0;else if(!i)return!1;if(i){var o;if(r.length>0&&(o=r[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var c=s[e];if(c===void 0)return!1;if(typeof c=="function")d0(c,this,r);else for(var u=c.length,f=E0(c,u),n=0;n<u;++n)d0(f[n],this,r);return!0};function v0(t,e,r,n){var i,s,o;if(Gs(r),s=t._events,s===void 0?(s=t._events=Object.create(null),t._eventsCount=0):(s.newListener!==void 0&&(t.emit("newListener",e,r.listener?r.listener:r),s=t._events),o=s[e]),o===void 0)o=s[e]=r,++t._eventsCount;else if(typeof o=="function"?o=s[e]=n?[r,o]:[o,r]:n?o.unshift(r):o.push(r),i=m0(t),i>0&&o.length>i&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=t,a.type=e,a.count=o.length,Hb(a)}return t}ae.prototype.addListener=function(e,r){return v0(this,e,r,!1)};ae.prototype.on=ae.prototype.addListener;ae.prototype.prependListener=function(e,r){return v0(this,e,r,!0)};function Wb(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function b0(t,e,r){var n={fired:!1,wrapFn:void 0,target:t,type:e,listener:r},i=Wb.bind(n);return i.listener=r,n.wrapFn=i,i}ae.prototype.once=function(e,r){return Gs(r),this.on(e,b0(this,e,r)),this};ae.prototype.prependOnceListener=function(e,r){return Gs(r),this.prependListener(e,b0(this,e,r)),this};ae.prototype.removeListener=function(e,r){var n,i,s,o,a;if(Gs(r),i=this._events,i===void 0)return this;if(n=i[e],n===void 0)return this;if(n===r||n.listener===r)--this._eventsCount===0?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||r));else if(typeof n!="function"){for(s=-1,o=n.length-1;o>=0;o--)if(n[o]===r||n[o].listener===r){a=n[o].listener,s=o;break}if(s<0)return this;s===0?n.shift():$b(n,s),n.length===1&&(i[e]=n[0]),i.removeListener!==void 0&&this.emit("removeListener",e,a||r)}return this};ae.prototype.off=ae.prototype.removeListener;ae.prototype.removeAllListeners=function(e){var r,n,i;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[e]),this;if(arguments.length===0){var s=Object.keys(n),o;for(i=0;i<s.length;++i)o=s[i],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(r=n[e],typeof r=="function")this.removeListener(e,r);else if(r!==void 0)for(i=r.length-1;i>=0;i--)this.removeListener(e,r[i]);return this};function w0(t,e,r){var n=t._events;if(n===void 0)return[];var i=n[e];return i===void 0?[]:typeof i=="function"?r?[i.listener||i]:[i]:r?Yb(i):E0(i,i.length)}ae.prototype.listeners=function(e){return w0(this,e,!0)};ae.prototype.rawListeners=function(e){return w0(this,e,!1)};ae.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):x0.call(t,e)};ae.prototype.listenerCount=x0;function x0(t){var e=this._events;if(e!==void 0){var r=e[t];if(typeof r=="function")return 1;if(r!==void 0)return r.length}return 0}ae.prototype.eventNames=function(){return this._eventsCount>0?zs(this._events):[]};function E0(t,e){for(var r=new Array(e),n=0;n<e;++n)r[n]=t[n];return r}function $b(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function Yb(t){for(var e=new Array(t.length),r=0;r<e.length;++r)e[r]=t[r].listener||t[r];return e}function Zb(t,e){return new Promise(function(r,n){function i(o){t.removeListener(e,s),n(o)}function s(){typeof t.removeListener=="function"&&t.removeListener("error",i),r([].slice.call(arguments))}S0(t,e,s,{once:!0}),e!=="error"&&jb(t,i,{once:!0})})}function jb(t,e,r){typeof t.on=="function"&&S0(t,"error",e,r)}function S0(t,e,r,n){if(typeof t.on=="function")n.once?t.once(e,r):t.on(e,r);else if(typeof t.addEventListener=="function")t.addEventListener(e,function i(s){n.once&&t.removeEventListener(e,i),r(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}});var nc=L((F4,_0)=>{_0.exports=rc().EventEmitter});var I0=L(Hs=>{"use strict";Hs.byteLength=Qb;Hs.toByteArray=ew;Hs.fromByteArray=nw;var Gt=[],mt=[],Xb=typeof Uint8Array<"u"?Uint8Array:Array,ic="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(Wr=0,A0=ic.length;Wr<A0;++Wr)Gt[Wr]=ic[Wr],mt[ic.charCodeAt(Wr)]=Wr;var Wr,A0;mt["-".charCodeAt(0)]=62;mt["_".charCodeAt(0)]=63;function T0(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=t.indexOf("=");r===-1&&(r=e);var n=r===e?0:4-r%4;return[r,n]}function Qb(t){var e=T0(t),r=e[0],n=e[1];return(r+n)*3/4-n}function Jb(t,e,r){return(e+r)*3/4-r}function ew(t){var e,r=T0(t),n=r[0],i=r[1],s=new Xb(Jb(t,n,i)),o=0,a=i>0?n-4:n,c;for(c=0;c<a;c+=4)e=mt[t.charCodeAt(c)]<<18|mt[t.charCodeAt(c+1)]<<12|mt[t.charCodeAt(c+2)]<<6|mt[t.charCodeAt(c+3)],s[o++]=e>>16&255,s[o++]=e>>8&255,s[o++]=e&255;return i===2&&(e=mt[t.charCodeAt(c)]<<2|mt[t.charCodeAt(c+1)]>>4,s[o++]=e&255),i===1&&(e=mt[t.charCodeAt(c)]<<10|mt[t.charCodeAt(c+1)]<<4|mt[t.charCodeAt(c+2)]>>2,s[o++]=e>>8&255,s[o++]=e&255),s}function tw(t){return Gt[t>>18&63]+Gt[t>>12&63]+Gt[t>>6&63]+Gt[t&63]}function rw(t,e,r){for(var n,i=[],s=e;s<r;s+=3)n=(t[s]<<16&16711680)+(t[s+1]<<8&65280)+(t[s+2]&255),i.push(tw(n));return i.join("")}function nw(t){for(var e,r=t.length,n=r%3,i=[],s=16383,o=0,a=r-n;o<a;o+=s)i.push(rw(t,o,o+s>a?a:o+s));return n===1?(e=t[r-1],i.push(Gt[e>>2]+Gt[e<<4&63]+"==")):n===2&&(e=(t[r-2]<<8)+t[r-1],i.push(Gt[e>>10]+Gt[e>>4&63]+Gt[e<<2&63]+"=")),i.join("")}});var C0=L(sc=>{sc.read=function(t,e,r,n,i){var s,o,a=i*8-n-1,c=(1<<a)-1,u=c>>1,f=-7,h=r?i-1:0,l=r?-1:1,g=t[e+h];for(h+=l,s=g&(1<<-f)-1,g>>=-f,f+=a;f>0;s=s*256+t[e+h],h+=l,f-=8);for(o=s&(1<<-f)-1,s>>=-f,f+=n;f>0;o=o*256+t[e+h],h+=l,f-=8);if(s===0)s=1-u;else{if(s===c)return o?NaN:(g?-1:1)*(1/0);o=o+Math.pow(2,n),s=s-u}return(g?-1:1)*o*Math.pow(2,s-n)};sc.write=function(t,e,r,n,i,s){var o,a,c,u=s*8-i-1,f=(1<<u)-1,h=f>>1,l=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,g=n?0:s-1,p=n?1:-1,d=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=f):(o=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-o))<1&&(o--,c*=2),o+h>=1?e+=l/c:e+=l*Math.pow(2,1-h),e*c>=2&&(o++,c/=2),o+h>=f?(a=0,o=f):o+h>=1?(a=(e*c-1)*Math.pow(2,i),o=o+h):(a=e*Math.pow(2,h-1)*Math.pow(2,i),o=0));i>=8;t[r+g]=a&255,g+=p,a/=256,i-=8);for(o=o<<i|a,u+=i;u>0;t[r+g]=o&255,g+=p,o/=256,u-=8);t[r+g-p]|=d*128}});var Ri=L(qn=>{"use strict";var oc=I0(),Kn=C0(),B0=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;qn.Buffer=E;qn.SlowBuffer=uw;qn.INSPECT_MAX_BYTES=50;var Ws=2147483647;qn.kMaxLength=Ws;E.TYPED_ARRAY_SUPPORT=iw();!E.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function iw(){try{var t=new Uint8Array(1),e={foo:function(){return 42}};return Object.setPrototypeOf(e,Uint8Array.prototype),Object.setPrototypeOf(t,e),t.foo()===42}catch{return!1}}Object.defineProperty(E.prototype,"parent",{enumerable:!0,get:function(){if(!!E.isBuffer(this))return this.buffer}});Object.defineProperty(E.prototype,"offset",{enumerable:!0,get:function(){if(!!E.isBuffer(this))return this.byteOffset}});function ir(t){if(t>Ws)throw new RangeError('The value "'+t+'" is invalid for option "size"');var e=new Uint8Array(t);return Object.setPrototypeOf(e,E.prototype),e}function E(t,e,r){if(typeof t=="number"){if(typeof e=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return fc(t)}return D0(t,e,r)}E.poolSize=8192;function D0(t,e,r){if(typeof t=="string")return ow(t,e);if(ArrayBuffer.isView(t))return aw(t);if(t==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t);if(Ht(t,ArrayBuffer)||t&&Ht(t.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(Ht(t,SharedArrayBuffer)||t&&Ht(t.buffer,SharedArrayBuffer)))return cc(t,e,r);if(typeof t=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');var n=t.valueOf&&t.valueOf();if(n!=null&&n!==t)return E.from(n,e,r);var i=cw(t);if(i)return i;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof t[Symbol.toPrimitive]=="function")return E.from(t[Symbol.toPrimitive]("string"),e,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t)}E.from=function(t,e,r){return D0(t,e,r)};Object.setPrototypeOf(E.prototype,Uint8Array.prototype);Object.setPrototypeOf(E,Uint8Array);function M0(t){if(typeof t!="number")throw new TypeError('"size" argument must be of type number');if(t<0)throw new RangeError('The value "'+t+'" is invalid for option "size"')}function sw(t,e,r){return M0(t),t<=0?ir(t):e!==void 0?typeof r=="string"?ir(t).fill(e,r):ir(t).fill(e):ir(t)}E.alloc=function(t,e,r){return sw(t,e,r)};function fc(t){return M0(t),ir(t<0?0:hc(t)|0)}E.allocUnsafe=function(t){return fc(t)};E.allocUnsafeSlow=function(t){return fc(t)};function ow(t,e){if((typeof e!="string"||e==="")&&(e="utf8"),!E.isEncoding(e))throw new TypeError("Unknown encoding: "+e);var r=L0(t,e)|0,n=ir(r),i=n.write(t,e);return i!==r&&(n=n.slice(0,i)),n}function ac(t){for(var e=t.length<0?0:hc(t.length)|0,r=ir(e),n=0;n<e;n+=1)r[n]=t[n]&255;return r}function aw(t){if(Ht(t,Uint8Array)){var e=new Uint8Array(t);return cc(e.buffer,e.byteOffset,e.byteLength)}return ac(t)}function cc(t,e,r){if(e<0||t.byteLength<e)throw new RangeError('"offset" is outside of buffer bounds');if(t.byteLength<e+(r||0))throw new RangeError('"length" is outside of buffer bounds');var n;return e===void 0&&r===void 0?n=new Uint8Array(t):r===void 0?n=new Uint8Array(t,e):n=new Uint8Array(t,e,r),Object.setPrototypeOf(n,E.prototype),n}function cw(t){if(E.isBuffer(t)){var e=hc(t.length)|0,r=ir(e);return r.length===0||t.copy(r,0,0,e),r}if(t.length!==void 0)return typeof t.length!="number"||lc(t.length)?ir(0):ac(t);if(t.type==="Buffer"&&Array.isArray(t.data))return ac(t.data)}function hc(t){if(t>=Ws)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+Ws.toString(16)+" bytes");return t|0}function uw(t){return+t!=t&&(t=0),E.alloc(+t)}E.isBuffer=function(e){return e!=null&&e._isBuffer===!0&&e!==E.prototype};E.compare=function(e,r){if(Ht(e,Uint8Array)&&(e=E.from(e,e.offset,e.byteLength)),Ht(r,Uint8Array)&&(r=E.from(r,r.offset,r.byteLength)),!E.isBuffer(e)||!E.isBuffer(r))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===r)return 0;for(var n=e.length,i=r.length,s=0,o=Math.min(n,i);s<o;++s)if(e[s]!==r[s]){n=e[s],i=r[s];break}return n<i?-1:i<n?1:0};E.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}};E.concat=function(e,r){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(e.length===0)return E.alloc(0);var n;if(r===void 0)for(r=0,n=0;n<e.length;++n)r+=e[n].length;var i=E.allocUnsafe(r),s=0;for(n=0;n<e.length;++n){var o=e[n];if(Ht(o,Uint8Array))s+o.length>i.length?E.from(o).copy(i,s):Uint8Array.prototype.set.call(i,o,s);else if(E.isBuffer(o))o.copy(i,s);else throw new TypeError('"list" argument must be an Array of Buffers');s+=o.length}return i};function L0(t,e){if(E.isBuffer(t))return t.length;if(ArrayBuffer.isView(t)||Ht(t,ArrayBuffer))return t.byteLength;if(typeof t!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof t);var r=t.length,n=arguments.length>2&&arguments[2]===!0;if(!n&&r===0)return 0;for(var i=!1;;)switch(e){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return uc(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return r*2;case"hex":return r>>>1;case"base64":return K0(t).length;default:if(i)return n?-1:uc(t).length;e=(""+e).toLowerCase(),i=!0}}E.byteLength=L0;function fw(t,e,r){var n=!1;if((e===void 0||e<0)&&(e=0),e>this.length||((r===void 0||r>this.length)&&(r=this.length),r<=0)||(r>>>=0,e>>>=0,r<=e))return"";for(t||(t="utf8");;)switch(t){case"hex":return ww(this,e,r);case"utf8":case"utf-8":return k0(this,e,r);case"ascii":return vw(this,e,r);case"latin1":case"binary":return bw(this,e,r);case"base64":return yw(this,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return xw(this,e,r);default:if(n)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),n=!0}}E.prototype._isBuffer=!0;function $r(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}E.prototype.swap16=function(){var e=this.length;if(e%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var r=0;r<e;r+=2)$r(this,r,r+1);return this};E.prototype.swap32=function(){var e=this.length;if(e%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var r=0;r<e;r+=4)$r(this,r,r+3),$r(this,r+1,r+2);return this};E.prototype.swap64=function(){var e=this.length;if(e%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var r=0;r<e;r+=8)$r(this,r,r+7),$r(this,r+1,r+6),$r(this,r+2,r+5),$r(this,r+3,r+4);return this};E.prototype.toString=function(){var e=this.length;return e===0?"":arguments.length===0?k0(this,0,e):fw.apply(this,arguments)};E.prototype.toLocaleString=E.prototype.toString;E.prototype.equals=function(e){if(!E.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e?!0:E.compare(this,e)===0};E.prototype.inspect=function(){var e="",r=qn.INSPECT_MAX_BYTES;return e=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(e+=" ... "),"<Buffer "+e+">"};B0&&(E.prototype[B0]=E.prototype.inspect);E.prototype.compare=function(e,r,n,i,s){if(Ht(e,Uint8Array)&&(e=E.from(e,e.offset,e.byteLength)),!E.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(r===void 0&&(r=0),n===void 0&&(n=e?e.length:0),i===void 0&&(i=0),s===void 0&&(s=this.length),r<0||n>e.length||i<0||s>this.length)throw new RangeError("out of range index");if(i>=s&&r>=n)return 0;if(i>=s)return-1;if(r>=n)return 1;if(r>>>=0,n>>>=0,i>>>=0,s>>>=0,this===e)return 0;for(var o=s-i,a=n-r,c=Math.min(o,a),u=this.slice(i,s),f=e.slice(r,n),h=0;h<c;++h)if(u[h]!==f[h]){o=u[h],a=f[h];break}return o<a?-1:a<o?1:0};function N0(t,e,r,n,i){if(t.length===0)return-1;if(typeof r=="string"?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,lc(r)&&(r=i?0:t.length-1),r<0&&(r=t.length+r),r>=t.length){if(i)return-1;r=t.length-1}else if(r<0)if(i)r=0;else return-1;if(typeof e=="string"&&(e=E.from(e,n)),E.isBuffer(e))return e.length===0?-1:R0(t,e,r,n,i);if(typeof e=="number")return e=e&255,typeof Uint8Array.prototype.indexOf=="function"?i?Uint8Array.prototype.indexOf.call(t,e,r):Uint8Array.prototype.lastIndexOf.call(t,e,r):R0(t,[e],r,n,i);throw new TypeError("val must be string, number or Buffer")}function R0(t,e,r,n,i){var s=1,o=t.length,a=e.length;if(n!==void 0&&(n=String(n).toLowerCase(),n==="ucs2"||n==="ucs-2"||n==="utf16le"||n==="utf-16le")){if(t.length<2||e.length<2)return-1;s=2,o/=2,a/=2,r/=2}function c(g,p){return s===1?g[p]:g.readUInt16BE(p*s)}var u;if(i){var f=-1;for(u=r;u<o;u++)if(c(t,u)===c(e,f===-1?0:u-f)){if(f===-1&&(f=u),u-f+1===a)return f*s}else f!==-1&&(u-=u-f),f=-1}else for(r+a>o&&(r=o-a),u=r;u>=0;u--){for(var h=!0,l=0;l<a;l++)if(c(t,u+l)!==c(e,l)){h=!1;break}if(h)return u}return-1}E.prototype.includes=function(e,r,n){return this.indexOf(e,r,n)!==-1};E.prototype.indexOf=function(e,r,n){return N0(this,e,r,n,!0)};E.prototype.lastIndexOf=function(e,r,n){return N0(this,e,r,n,!1)};function hw(t,e,r,n){r=Number(r)||0;var i=t.length-r;n?(n=Number(n),n>i&&(n=i)):n=i;var s=e.length;n>s/2&&(n=s/2);for(var o=0;o<n;++o){var a=parseInt(e.substr(o*2,2),16);if(lc(a))return o;t[r+o]=a}return o}function lw(t,e,r,n){return $s(uc(e,t.length-r),t,r,n)}function pw(t,e,r,n){return $s(_w(e),t,r,n)}function dw(t,e,r,n){return $s(K0(e),t,r,n)}function gw(t,e,r,n){return $s(Aw(e,t.length-r),t,r,n)}E.prototype.write=function(e,r,n,i){if(r===void 0)i="utf8",n=this.length,r=0;else if(n===void 0&&typeof r=="string")i=r,n=this.length,r=0;else if(isFinite(r))r=r>>>0,isFinite(n)?(n=n>>>0,i===void 0&&(i="utf8")):(i=n,n=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var s=this.length-r;if((n===void 0||n>s)&&(n=s),e.length>0&&(n<0||r<0)||r>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");for(var o=!1;;)switch(i){case"hex":return hw(this,e,r,n);case"utf8":case"utf-8":return lw(this,e,r,n);case"ascii":case"latin1":case"binary":return pw(this,e,r,n);case"base64":return dw(this,e,r,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return gw(this,e,r,n);default:if(o)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),o=!0}};E.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function yw(t,e,r){return e===0&&r===t.length?oc.fromByteArray(t):oc.fromByteArray(t.slice(e,r))}function k0(t,e,r){r=Math.min(t.length,r);for(var n=[],i=e;i<r;){var s=t[i],o=null,a=s>239?4:s>223?3:s>191?2:1;if(i+a<=r){var c,u,f,h;switch(a){case 1:s<128&&(o=s);break;case 2:c=t[i+1],(c&192)===128&&(h=(s&31)<<6|c&63,h>127&&(o=h));break;case 3:c=t[i+1],u=t[i+2],(c&192)===128&&(u&192)===128&&(h=(s&15)<<12|(c&63)<<6|u&63,h>2047&&(h<55296||h>57343)&&(o=h));break;case 4:c=t[i+1],u=t[i+2],f=t[i+3],(c&192)===128&&(u&192)===128&&(f&192)===128&&(h=(s&15)<<18|(c&63)<<12|(u&63)<<6|f&63,h>65535&&h<1114112&&(o=h))}}o===null?(o=65533,a=1):o>65535&&(o-=65536,n.push(o>>>10&1023|55296),o=56320|o&1023),n.push(o),i+=a}return mw(n)}var P0=4096;function mw(t){var e=t.length;if(e<=P0)return String.fromCharCode.apply(String,t);for(var r="",n=0;n<e;)r+=String.fromCharCode.apply(String,t.slice(n,n+=P0));return r}function vw(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(t[i]&127);return n}function bw(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(t[i]);return n}function ww(t,e,r){var n=t.length;(!e||e<0)&&(e=0),(!r||r<0||r>n)&&(r=n);for(var i="",s=e;s<r;++s)i+=Tw[t[s]];return i}function xw(t,e,r){for(var n=t.slice(e,r),i="",s=0;s<n.length-1;s+=2)i+=String.fromCharCode(n[s]+n[s+1]*256);return i}E.prototype.slice=function(e,r){var n=this.length;e=~~e,r=r===void 0?n:~~r,e<0?(e+=n,e<0&&(e=0)):e>n&&(e=n),r<0?(r+=n,r<0&&(r=0)):r>n&&(r=n),r<e&&(r=e);var i=this.subarray(e,r);return Object.setPrototypeOf(i,E.prototype),i};function Ve(t,e,r){if(t%1!==0||t<0)throw new RangeError("offset is not uint");if(t+e>r)throw new RangeError("Trying to access beyond buffer length")}E.prototype.readUintLE=E.prototype.readUIntLE=function(e,r,n){e=e>>>0,r=r>>>0,n||Ve(e,r,this.length);for(var i=this[e],s=1,o=0;++o<r&&(s*=256);)i+=this[e+o]*s;return i};E.prototype.readUintBE=E.prototype.readUIntBE=function(e,r,n){e=e>>>0,r=r>>>0,n||Ve(e,r,this.length);for(var i=this[e+--r],s=1;r>0&&(s*=256);)i+=this[e+--r]*s;return i};E.prototype.readUint8=E.prototype.readUInt8=function(e,r){return e=e>>>0,r||Ve(e,1,this.length),this[e]};E.prototype.readUint16LE=E.prototype.readUInt16LE=function(e,r){return e=e>>>0,r||Ve(e,2,this.length),this[e]|this[e+1]<<8};E.prototype.readUint16BE=E.prototype.readUInt16BE=function(e,r){return e=e>>>0,r||Ve(e,2,this.length),this[e]<<8|this[e+1]};E.prototype.readUint32LE=E.prototype.readUInt32LE=function(e,r){return e=e>>>0,r||Ve(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+this[e+3]*16777216};E.prototype.readUint32BE=E.prototype.readUInt32BE=function(e,r){return e=e>>>0,r||Ve(e,4,this.length),this[e]*16777216+(this[e+1]<<16|this[e+2]<<8|this[e+3])};E.prototype.readIntLE=function(e,r,n){e=e>>>0,r=r>>>0,n||Ve(e,r,this.length);for(var i=this[e],s=1,o=0;++o<r&&(s*=256);)i+=this[e+o]*s;return s*=128,i>=s&&(i-=Math.pow(2,8*r)),i};E.prototype.readIntBE=function(e,r,n){e=e>>>0,r=r>>>0,n||Ve(e,r,this.length);for(var i=r,s=1,o=this[e+--i];i>0&&(s*=256);)o+=this[e+--i]*s;return s*=128,o>=s&&(o-=Math.pow(2,8*r)),o};E.prototype.readInt8=function(e,r){return e=e>>>0,r||Ve(e,1,this.length),this[e]&128?(255-this[e]+1)*-1:this[e]};E.prototype.readInt16LE=function(e,r){e=e>>>0,r||Ve(e,2,this.length);var n=this[e]|this[e+1]<<8;return n&32768?n|4294901760:n};E.prototype.readInt16BE=function(e,r){e=e>>>0,r||Ve(e,2,this.length);var n=this[e+1]|this[e]<<8;return n&32768?n|4294901760:n};E.prototype.readInt32LE=function(e,r){return e=e>>>0,r||Ve(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24};E.prototype.readInt32BE=function(e,r){return e=e>>>0,r||Ve(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]};E.prototype.readFloatLE=function(e,r){return e=e>>>0,r||Ve(e,4,this.length),Kn.read(this,e,!0,23,4)};E.prototype.readFloatBE=function(e,r){return e=e>>>0,r||Ve(e,4,this.length),Kn.read(this,e,!1,23,4)};E.prototype.readDoubleLE=function(e,r){return e=e>>>0,r||Ve(e,8,this.length),Kn.read(this,e,!0,52,8)};E.prototype.readDoubleBE=function(e,r){return e=e>>>0,r||Ve(e,8,this.length),Kn.read(this,e,!1,52,8)};function it(t,e,r,n,i,s){if(!E.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>i||e<s)throw new RangeError('"value" argument is out of bounds');if(r+n>t.length)throw new RangeError("Index out of range")}E.prototype.writeUintLE=E.prototype.writeUIntLE=function(e,r,n,i){if(e=+e,r=r>>>0,n=n>>>0,!i){var s=Math.pow(2,8*n)-1;it(this,e,r,n,s,0)}var o=1,a=0;for(this[r]=e&255;++a<n&&(o*=256);)this[r+a]=e/o&255;return r+n};E.prototype.writeUintBE=E.prototype.writeUIntBE=function(e,r,n,i){if(e=+e,r=r>>>0,n=n>>>0,!i){var s=Math.pow(2,8*n)-1;it(this,e,r,n,s,0)}var o=n-1,a=1;for(this[r+o]=e&255;--o>=0&&(a*=256);)this[r+o]=e/a&255;return r+n};E.prototype.writeUint8=E.prototype.writeUInt8=function(e,r,n){return e=+e,r=r>>>0,n||it(this,e,r,1,255,0),this[r]=e&255,r+1};E.prototype.writeUint16LE=E.prototype.writeUInt16LE=function(e,r,n){return e=+e,r=r>>>0,n||it(this,e,r,2,65535,0),this[r]=e&255,this[r+1]=e>>>8,r+2};E.prototype.writeUint16BE=E.prototype.writeUInt16BE=function(e,r,n){return e=+e,r=r>>>0,n||it(this,e,r,2,65535,0),this[r]=e>>>8,this[r+1]=e&255,r+2};E.prototype.writeUint32LE=E.prototype.writeUInt32LE=function(e,r,n){return e=+e,r=r>>>0,n||it(this,e,r,4,4294967295,0),this[r+3]=e>>>24,this[r+2]=e>>>16,this[r+1]=e>>>8,this[r]=e&255,r+4};E.prototype.writeUint32BE=E.prototype.writeUInt32BE=function(e,r,n){return e=+e,r=r>>>0,n||it(this,e,r,4,4294967295,0),this[r]=e>>>24,this[r+1]=e>>>16,this[r+2]=e>>>8,this[r+3]=e&255,r+4};E.prototype.writeIntLE=function(e,r,n,i){if(e=+e,r=r>>>0,!i){var s=Math.pow(2,8*n-1);it(this,e,r,n,s-1,-s)}var o=0,a=1,c=0;for(this[r]=e&255;++o<n&&(a*=256);)e<0&&c===0&&this[r+o-1]!==0&&(c=1),this[r+o]=(e/a>>0)-c&255;return r+n};E.prototype.writeIntBE=function(e,r,n,i){if(e=+e,r=r>>>0,!i){var s=Math.pow(2,8*n-1);it(this,e,r,n,s-1,-s)}var o=n-1,a=1,c=0;for(this[r+o]=e&255;--o>=0&&(a*=256);)e<0&&c===0&&this[r+o+1]!==0&&(c=1),this[r+o]=(e/a>>0)-c&255;return r+n};E.prototype.writeInt8=function(e,r,n){return e=+e,r=r>>>0,n||it(this,e,r,1,127,-128),e<0&&(e=255+e+1),this[r]=e&255,r+1};E.prototype.writeInt16LE=function(e,r,n){return e=+e,r=r>>>0,n||it(this,e,r,2,32767,-32768),this[r]=e&255,this[r+1]=e>>>8,r+2};E.prototype.writeInt16BE=function(e,r,n){return e=+e,r=r>>>0,n||it(this,e,r,2,32767,-32768),this[r]=e>>>8,this[r+1]=e&255,r+2};E.prototype.writeInt32LE=function(e,r,n){return e=+e,r=r>>>0,n||it(this,e,r,4,2147483647,-2147483648),this[r]=e&255,this[r+1]=e>>>8,this[r+2]=e>>>16,this[r+3]=e>>>24,r+4};E.prototype.writeInt32BE=function(e,r,n){return e=+e,r=r>>>0,n||it(this,e,r,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[r]=e>>>24,this[r+1]=e>>>16,this[r+2]=e>>>8,this[r+3]=e&255,r+4};function F0(t,e,r,n,i,s){if(r+n>t.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function U0(t,e,r,n,i){return e=+e,r=r>>>0,i||F0(t,e,r,4,34028234663852886e22,-34028234663852886e22),Kn.write(t,e,r,n,23,4),r+4}E.prototype.writeFloatLE=function(e,r,n){return U0(this,e,r,!0,n)};E.prototype.writeFloatBE=function(e,r,n){return U0(this,e,r,!1,n)};function O0(t,e,r,n,i){return e=+e,r=r>>>0,i||F0(t,e,r,8,17976931348623157e292,-17976931348623157e292),Kn.write(t,e,r,n,52,8),r+8}E.prototype.writeDoubleLE=function(e,r,n){return O0(this,e,r,!0,n)};E.prototype.writeDoubleBE=function(e,r,n){return O0(this,e,r,!1,n)};E.prototype.copy=function(e,r,n,i){if(!E.isBuffer(e))throw new TypeError("argument should be a Buffer");if(n||(n=0),!i&&i!==0&&(i=this.length),r>=e.length&&(r=e.length),r||(r=0),i>0&&i<n&&(i=n),i===n||e.length===0||this.length===0)return 0;if(r<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-r<i-n&&(i=e.length-r+n);var s=i-n;return this===e&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(r,n,i):Uint8Array.prototype.set.call(e,this.subarray(n,i),r),s};E.prototype.fill=function(e,r,n,i){if(typeof e=="string"){if(typeof r=="string"?(i=r,r=0,n=this.length):typeof n=="string"&&(i=n,n=this.length),i!==void 0&&typeof i!="string")throw new TypeError("encoding must be a string");if(typeof i=="string"&&!E.isEncoding(i))throw new TypeError("Unknown encoding: "+i);if(e.length===1){var s=e.charCodeAt(0);(i==="utf8"&&s<128||i==="latin1")&&(e=s)}}else typeof e=="number"?e=e&255:typeof e=="boolean"&&(e=Number(e));if(r<0||this.length<r||this.length<n)throw new RangeError("Out of range index");if(n<=r)return this;r=r>>>0,n=n===void 0?this.length:n>>>0,e||(e=0);var o;if(typeof e=="number")for(o=r;o<n;++o)this[o]=e;else{var a=E.isBuffer(e)?e:E.from(e,i),c=a.length;if(c===0)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(o=0;o<n-r;++o)this[o+r]=a[o%c]}return this};var Ew=/[^+/0-9A-Za-z-_]/g;function Sw(t){if(t=t.split("=")[0],t=t.trim().replace(Ew,""),t.length<2)return"";for(;t.length%4!==0;)t=t+"=";return t}function uc(t,e){e=e||1/0;for(var r,n=t.length,i=null,s=[],o=0;o<n;++o){if(r=t.charCodeAt(o),r>55295&&r<57344){if(!i){if(r>56319){(e-=3)>-1&&s.push(239,191,189);continue}else if(o+1===n){(e-=3)>-1&&s.push(239,191,189);continue}i=r;continue}if(r<56320){(e-=3)>-1&&s.push(239,191,189),i=r;continue}r=(i-55296<<10|r-56320)+65536}else i&&(e-=3)>-1&&s.push(239,191,189);if(i=null,r<128){if((e-=1)<0)break;s.push(r)}else if(r<2048){if((e-=2)<0)break;s.push(r>>6|192,r&63|128)}else if(r<65536){if((e-=3)<0)break;s.push(r>>12|224,r>>6&63|128,r&63|128)}else if(r<1114112){if((e-=4)<0)break;s.push(r>>18|240,r>>12&63|128,r>>6&63|128,r&63|128)}else throw new Error("Invalid code point")}return s}function _w(t){for(var e=[],r=0;r<t.length;++r)e.push(t.charCodeAt(r)&255);return e}function Aw(t,e){for(var r,n,i,s=[],o=0;o<t.length&&!((e-=2)<0);++o)r=t.charCodeAt(o),n=r>>8,i=r%256,s.push(i),s.push(n);return s}function K0(t){return oc.toByteArray(Sw(t))}function $s(t,e,r,n){for(var i=0;i<n&&!(i+r>=e.length||i>=t.length);++i)e[i+r]=t[i];return i}function Ht(t,e){return t instanceof e||t!=null&&t.constructor!=null&&t.constructor.name!=null&&t.constructor.name===e.name}function lc(t){return t!==t}var Tw=function(){for(var t="0123456789abcdef",e=new Array(256),r=0;r<16;++r)for(var n=r*16,i=0;i<16;++i)e[n+i]=t[r]+t[i];return e}()});var pc=L(()=>{});var G0=L((z4,z0)=>{"use strict";function q0(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function Iw(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?q0(Object(r),!0).forEach(function(n){Cw(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):q0(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function Cw(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Bw(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function V0(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Rw(t,e,r){return e&&V0(t.prototype,e),r&&V0(t,r),t}var Pw=Ri(),Ys=Pw.Buffer,Dw=pc(),dc=Dw.inspect,Mw=dc&&dc.custom||"inspect";function Lw(t,e,r){Ys.prototype.copy.call(t,e,r)}z0.exports=function(){function t(){Bw(this,t),this.head=null,this.tail=null,this.length=0}return Rw(t,[{key:"push",value:function(r){var n={data:r,next:null};this.length>0?this.tail.next=n:this.head=n,this.tail=n,++this.length}},{key:"unshift",value:function(r){var n={data:r,next:this.head};this.length===0&&(this.tail=n),this.head=n,++this.length}},{key:"shift",value:function(){if(this.length!==0){var r=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,r}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(r){if(this.length===0)return"";for(var n=this.head,i=""+n.data;n=n.next;)i+=r+n.data;return i}},{key:"concat",value:function(r){if(this.length===0)return Ys.alloc(0);for(var n=Ys.allocUnsafe(r>>>0),i=this.head,s=0;i;)Lw(i.data,n,s),s+=i.data.length,i=i.next;return n}},{key:"consume",value:function(r,n){var i;return r<this.head.data.length?(i=this.head.data.slice(0,r),this.head.data=this.head.data.slice(r)):r===this.head.data.length?i=this.shift():i=n?this._getString(r):this._getBuffer(r),i}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(r){var n=this.head,i=1,s=n.data;for(r-=s.length;n=n.next;){var o=n.data,a=r>o.length?o.length:r;if(a===o.length?s+=o:s+=o.slice(0,r),r-=a,r===0){a===o.length?(++i,n.next?this.head=n.next:this.head=this.tail=null):(this.head=n,n.data=o.slice(a));break}++i}return this.length-=i,s}},{key:"_getBuffer",value:function(r){var n=Ys.allocUnsafe(r),i=this.head,s=1;for(i.data.copy(n),r-=i.data.length;i=i.next;){var o=i.data,a=r>o.length?o.length:r;if(o.copy(n,n.length-r,0,a),r-=a,r===0){a===o.length?(++s,i.next?this.head=i.next:this.head=this.tail=null):(this.head=i,i.data=o.slice(a));break}++s}return this.length-=s,n}},{key:Mw,value:function(r,n){return dc(this,Iw({},n,{depth:0,customInspect:!1}))}}]),t}()});var yc=L((G4,W0)=>{"use strict";function Nw(t,e){var r=this,n=this._readableState&&this._readableState.destroyed,i=this._writableState&&this._writableState.destroyed;return n||i?(e?e(t):t&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,process.nextTick(gc,this,t)):process.nextTick(gc,this,t)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(t||null,function(s){!e&&s?r._writableState?r._writableState.errorEmitted?process.nextTick(Zs,r):(r._writableState.errorEmitted=!0,process.nextTick(H0,r,s)):process.nextTick(H0,r,s):e?(process.nextTick(Zs,r),e(s)):process.nextTick(Zs,r)}),this)}function H0(t,e){gc(t,e),Zs(t)}function Zs(t){t._writableState&&!t._writableState.emitClose||t._readableState&&!t._readableState.emitClose||t.emit("close")}function kw(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function gc(t,e){t.emit("error",e)}function Fw(t,e){var r=t._readableState,n=t._writableState;r&&r.autoDestroy||n&&n.autoDestroy?t.destroy(e):t.emit("error",e)}W0.exports={destroy:Nw,undestroy:kw,errorOrDestroy:Fw}});var Yr=L((H4,Z0)=>{"use strict";function Uw(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}var Y0={};function vt(t,e,r){r||(r=Error);function n(s,o,a){return typeof e=="string"?e:e(s,o,a)}var i=function(s){Uw(o,s);function o(a,c,u){return s.call(this,n(a,c,u))||this}return o}(r);i.prototype.name=r.name,i.prototype.code=t,Y0[t]=i}function $0(t,e){if(Array.isArray(t)){var r=t.length;return t=t.map(function(n){return String(n)}),r>2?"one of ".concat(e," ").concat(t.slice(0,r-1).join(", "),", or ")+t[r-1]:r===2?"one of ".concat(e," ").concat(t[0]," or ").concat(t[1]):"of ".concat(e," ").concat(t[0])}else return"of ".concat(e," ").concat(String(t))}function Ow(t,e,r){return t.substr(!r||r<0?0:+r,e.length)===e}function Kw(t,e,r){return(r===void 0||r>t.length)&&(r=t.length),t.substring(r-e.length,r)===e}function qw(t,e,r){return typeof r!="number"&&(r=0),r+e.length>t.length?!1:t.indexOf(e,r)!==-1}vt("ERR_INVALID_OPT_VALUE",function(t,e){return'The value "'+e+'" is invalid for option "'+t+'"'},TypeError);vt("ERR_INVALID_ARG_TYPE",function(t,e,r){var n;typeof e=="string"&&Ow(e,"not ")?(n="must not be",e=e.replace(/^not /,"")):n="must be";var i;if(Kw(t," argument"))i="The ".concat(t," ").concat(n," ").concat($0(e,"type"));else{var s=qw(t,".")?"property":"argument";i='The "'.concat(t,'" ').concat(s," ").concat(n," ").concat($0(e,"type"))}return i+=". Received type ".concat(typeof r),i},TypeError);vt("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF");vt("ERR_METHOD_NOT_IMPLEMENTED",function(t){return"The "+t+" method is not implemented"});vt("ERR_STREAM_PREMATURE_CLOSE","Premature close");vt("ERR_STREAM_DESTROYED",function(t){return"Cannot call "+t+" after a stream was destroyed"});vt("ERR_MULTIPLE_CALLBACK","Callback called multiple times");vt("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable");vt("ERR_STREAM_WRITE_AFTER_END","write after end");vt("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError);vt("ERR_UNKNOWN_ENCODING",function(t){return"Unknown encoding: "+t},TypeError);vt("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event");Z0.exports.codes=Y0});var mc=L((W4,j0)=>{"use strict";var Vw=Yr().codes.ERR_INVALID_OPT_VALUE;function zw(t,e,r){return t.highWaterMark!=null?t.highWaterMark:e?t[r]:null}function Gw(t,e,r,n){var i=zw(e,n,r);if(i!=null){if(!(isFinite(i)&&Math.floor(i)===i)||i<0){var s=n?r:"highWaterMark";throw new Vw(s,i)}return Math.floor(i)}return t.objectMode?16:16*1024}j0.exports={getHighWaterMark:Gw}});var Vn=L(($4,vc)=>{typeof Object.create=="function"?vc.exports=function(e,r){r&&(e.super_=r,e.prototype=Object.create(r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:vc.exports=function(e,r){if(r){e.super_=r;var n=function(){};n.prototype=r.prototype,e.prototype=new n,e.prototype.constructor=e}}});var Q0=L((Y4,X0)=>{X0.exports=Hw;function Hw(t,e){if(bc("noDeprecation"))return t;var r=!1;function n(){if(!r){if(bc("throwDeprecation"))throw new Error(e);bc("traceDeprecation")?console.trace(e):console.warn(e),r=!0}return t.apply(this,arguments)}return n}function bc(t){try{if(!globalThis.localStorage)return!1}catch{return!1}var e=globalThis.localStorage[t];return e==null?!1:String(e).toLowerCase()==="true"}});var Ec=L((Z4,ip)=>{"use strict";ip.exports=_e;function ep(t){var e=this;this.next=null,this.entry=null,this.finish=function(){vx(e,t)}}var zn;_e.WritableState=Di;var Ww={deprecate:Q0()},tp=nc(),Xs=Ri().Buffer,$w=globalThis.Uint8Array||function(){};function Yw(t){return Xs.from(t)}function Zw(t){return Xs.isBuffer(t)||t instanceof $w}var xc=yc(),jw=mc(),Xw=jw.getHighWaterMark,xr=Yr().codes,Qw=xr.ERR_INVALID_ARG_TYPE,Jw=xr.ERR_METHOD_NOT_IMPLEMENTED,ex=xr.ERR_MULTIPLE_CALLBACK,tx=xr.ERR_STREAM_CANNOT_PIPE,rx=xr.ERR_STREAM_DESTROYED,nx=xr.ERR_STREAM_NULL_VALUES,ix=xr.ERR_STREAM_WRITE_AFTER_END,sx=xr.ERR_UNKNOWN_ENCODING,Gn=xc.errorOrDestroy;Vn()(_e,tp);function ox(){}function Di(t,e,r){zn=zn||Zr(),t=t||{},typeof r!="boolean"&&(r=e instanceof zn),this.objectMode=!!t.objectMode,r&&(this.objectMode=this.objectMode||!!t.writableObjectMode),this.highWaterMark=Xw(this,t,"writableHighWaterMark",r),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var n=t.decodeStrings===!1;this.decodeStrings=!n,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(i){px(e,i)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=t.emitClose!==!1,this.autoDestroy=!!t.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new ep(this)}Di.prototype.getBuffer=function(){for(var e=this.bufferedRequest,r=[];e;)r.push(e),e=e.next;return r};(function(){try{Object.defineProperty(Di.prototype,"buffer",{get:Ww.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}})();var js;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(js=Function.prototype[Symbol.hasInstance],Object.defineProperty(_e,Symbol.hasInstance,{value:function(e){return js.call(this,e)?!0:this!==_e?!1:e&&e._writableState instanceof Di}})):js=function(e){return e instanceof this};function _e(t){zn=zn||Zr();var e=this instanceof zn;if(!e&&!js.call(_e,this))return new _e(t);this._writableState=new Di(t,this,e),this.writable=!0,t&&(typeof t.write=="function"&&(this._write=t.write),typeof t.writev=="function"&&(this._writev=t.writev),typeof t.destroy=="function"&&(this._destroy=t.destroy),typeof t.final=="function"&&(this._final=t.final)),tp.call(this)}_e.prototype.pipe=function(){Gn(this,new tx)};function ax(t,e){var r=new ix;Gn(t,r),process.nextTick(e,r)}function cx(t,e,r,n){var i;return r===null?i=new nx:typeof r!="string"&&!e.objectMode&&(i=new Qw("chunk",["string","Buffer"],r)),i?(Gn(t,i),process.nextTick(n,i),!1):!0}_e.prototype.write=function(t,e,r){var n=this._writableState,i=!1,s=!n.objectMode&&Zw(t);return s&&!Xs.isBuffer(t)&&(t=Yw(t)),typeof e=="function"&&(r=e,e=null),s?e="buffer":e||(e=n.defaultEncoding),typeof r!="function"&&(r=ox),n.ending?ax(this,r):(s||cx(this,n,t,r))&&(n.pendingcb++,i=fx(this,n,s,t,e,r)),i};_e.prototype.cork=function(){this._writableState.corked++};_e.prototype.uncork=function(){var t=this._writableState;t.corked&&(t.corked--,!t.writing&&!t.corked&&!t.bufferProcessing&&t.bufferedRequest&&rp(this,t))};_e.prototype.setDefaultEncoding=function(e){if(typeof e=="string"&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new sx(e);return this._writableState.defaultEncoding=e,this};Object.defineProperty(_e.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}});function ux(t,e,r){return!t.objectMode&&t.decodeStrings!==!1&&typeof e=="string"&&(e=Xs.from(e,r)),e}Object.defineProperty(_e.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function fx(t,e,r,n,i,s){if(!r){var o=ux(e,n,i);n!==o&&(r=!0,i="buffer",n=o)}var a=e.objectMode?1:n.length;e.length+=a;var c=e.length<e.highWaterMark;if(c||(e.needDrain=!0),e.writing||e.corked){var u=e.lastBufferedRequest;e.lastBufferedRequest={chunk:n,encoding:i,isBuf:r,callback:s,next:null},u?u.next=e.lastBufferedRequest:e.bufferedRequest=e.lastBufferedRequest,e.bufferedRequestCount+=1}else wc(t,e,!1,a,n,i,s);return c}function wc(t,e,r,n,i,s,o){e.writelen=n,e.writecb=o,e.writing=!0,e.sync=!0,e.destroyed?e.onwrite(new rx("write")):r?t._writev(i,e.onwrite):t._write(i,s,e.onwrite),e.sync=!1}function hx(t,e,r,n,i){--e.pendingcb,r?(process.nextTick(i,n),process.nextTick(Pi,t,e),t._writableState.errorEmitted=!0,Gn(t,n)):(i(n),t._writableState.errorEmitted=!0,Gn(t,n),Pi(t,e))}function lx(t){t.writing=!1,t.writecb=null,t.length-=t.writelen,t.writelen=0}function px(t,e){var r=t._writableState,n=r.sync,i=r.writecb;if(typeof i!="function")throw new ex;if(lx(r),e)hx(t,r,n,e,i);else{var s=np(r)||t.destroyed;!s&&!r.corked&&!r.bufferProcessing&&r.bufferedRequest&&rp(t,r),n?process.nextTick(J0,t,r,s,i):J0(t,r,s,i)}}function J0(t,e,r,n){r||dx(t,e),e.pendingcb--,n(),Pi(t,e)}function dx(t,e){e.length===0&&e.needDrain&&(e.needDrain=!1,t.emit("drain"))}function rp(t,e){e.bufferProcessing=!0;var r=e.bufferedRequest;if(t._writev&&r&&r.next){var n=e.bufferedRequestCount,i=new Array(n),s=e.corkedRequestsFree;s.entry=r;for(var o=0,a=!0;r;)i[o]=r,r.isBuf||(a=!1),r=r.next,o+=1;i.allBuffers=a,wc(t,e,!0,e.length,i,"",s.finish),e.pendingcb++,e.lastBufferedRequest=null,s.next?(e.corkedRequestsFree=s.next,s.next=null):e.corkedRequestsFree=new ep(e),e.bufferedRequestCount=0}else{for(;r;){var c=r.chunk,u=r.encoding,f=r.callback,h=e.objectMode?1:c.length;if(wc(t,e,!1,h,c,u,f),r=r.next,e.bufferedRequestCount--,e.writing)break}r===null&&(e.lastBufferedRequest=null)}e.bufferedRequest=r,e.bufferProcessing=!1}_e.prototype._write=function(t,e,r){r(new Jw("_write()"))};_e.prototype._writev=null;_e.prototype.end=function(t,e,r){var n=this._writableState;return typeof t=="function"?(r=t,t=null,e=null):typeof e=="function"&&(r=e,e=null),t!=null&&this.write(t,e),n.corked&&(n.corked=1,this.uncork()),n.ending||mx(this,n,r),this};Object.defineProperty(_e.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function np(t){return t.ending&&t.length===0&&t.bufferedRequest===null&&!t.finished&&!t.writing}function gx(t,e){t._final(function(r){e.pendingcb--,r&&Gn(t,r),e.prefinished=!0,t.emit("prefinish"),Pi(t,e)})}function yx(t,e){!e.prefinished&&!e.finalCalled&&(typeof t._final=="function"&&!e.destroyed?(e.pendingcb++,e.finalCalled=!0,process.nextTick(gx,t,e)):(e.prefinished=!0,t.emit("prefinish")))}function Pi(t,e){var r=np(e);if(r&&(yx(t,e),e.pendingcb===0&&(e.finished=!0,t.emit("finish"),e.autoDestroy))){var n=t._readableState;(!n||n.autoDestroy&&n.endEmitted)&&t.destroy()}return r}function mx(t,e,r){e.ending=!0,Pi(t,e),r&&(e.finished?process.nextTick(r):t.once("finish",r)),e.ended=!0,t.writable=!1}function vx(t,e,r){var n=t.entry;for(t.entry=null;n;){var i=n.callback;e.pendingcb--,i(r),n=n.next}e.corkedRequestsFree.next=t}Object.defineProperty(_e.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState===void 0?!1:this._writableState.destroyed},set:function(e){!this._writableState||(this._writableState.destroyed=e)}});_e.prototype.destroy=xc.destroy;_e.prototype._undestroy=xc.undestroy;_e.prototype._destroy=function(t,e){e(t)}});var Zr=L((j4,op)=>{"use strict";var bx=Object.keys||function(t){var e=[];for(var r in t)e.push(r);return e};op.exports=Wt;var sp=Ac(),_c=Ec();Vn()(Wt,sp);for(Sc=bx(_c.prototype),Qs=0;Qs<Sc.length;Qs++)Js=Sc[Qs],Wt.prototype[Js]||(Wt.prototype[Js]=_c.prototype[Js]);var Sc,Js,Qs;function Wt(t){if(!(this instanceof Wt))return new Wt(t);sp.call(this,t),_c.call(this,t),this.allowHalfOpen=!0,t&&(t.readable===!1&&(this.readable=!1),t.writable===!1&&(this.writable=!1),t.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",wx)))}Object.defineProperty(Wt.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});Object.defineProperty(Wt.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}});Object.defineProperty(Wt.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function wx(){this._writableState.ended||process.nextTick(xx,this)}function xx(t){t.end()}Object.defineProperty(Wt.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set:function(e){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=e,this._writableState.destroyed=e)}})});var up=L((Tc,cp)=>{var eo=Ri(),sr=eo.Buffer;function ap(t,e){for(var r in t)e[r]=t[r]}sr.from&&sr.alloc&&sr.allocUnsafe&&sr.allocUnsafeSlow?cp.exports=eo:(ap(eo,Tc),Tc.Buffer=Hn);function Hn(t,e,r){return sr(t,e,r)}ap(sr,Hn);Hn.from=function(t,e,r){if(typeof t=="number")throw new TypeError("Argument must not be a number");return sr(t,e,r)};Hn.alloc=function(t,e,r){if(typeof t!="number")throw new TypeError("Argument must be a number");var n=sr(t);return e!==void 0?typeof r=="string"?n.fill(e,r):n.fill(e):n.fill(0),n};Hn.allocUnsafe=function(t){if(typeof t!="number")throw new TypeError("Argument must be a number");return sr(t)};Hn.allocUnsafeSlow=function(t){if(typeof t!="number")throw new TypeError("Argument must be a number");return eo.SlowBuffer(t)}});var Bc=L(hp=>{"use strict";var Cc=up().Buffer,fp=Cc.isEncoding||function(t){switch(t=""+t,t&&t.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function Ex(t){if(!t)return"utf8";for(var e;;)switch(t){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return t;default:if(e)return;t=(""+t).toLowerCase(),e=!0}}function Sx(t){var e=Ex(t);if(typeof e!="string"&&(Cc.isEncoding===fp||!fp(t)))throw new Error("Unknown encoding: "+t);return e||t}hp.StringDecoder=Mi;function Mi(t){this.encoding=Sx(t);var e;switch(this.encoding){case"utf16le":this.text=Bx,this.end=Rx,e=4;break;case"utf8":this.fillLast=Tx,e=4;break;case"base64":this.text=Px,this.end=Dx,e=3;break;default:this.write=Mx,this.end=Lx;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=Cc.allocUnsafe(e)}Mi.prototype.write=function(t){if(t.length===0)return"";var e,r;if(this.lastNeed){if(e=this.fillLast(t),e===void 0)return"";r=this.lastNeed,this.lastNeed=0}else r=0;return r<t.length?e?e+this.text(t,r):this.text(t,r):e||""};Mi.prototype.end=Cx;Mi.prototype.text=Ix;Mi.prototype.fillLast=function(t){if(this.lastNeed<=t.length)return t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,t.length),this.lastNeed-=t.length};function Ic(t){return t<=127?0:t>>5===6?2:t>>4===14?3:t>>3===30?4:t>>6===2?-1:-2}function _x(t,e,r){var n=e.length-1;if(n<r)return 0;var i=Ic(e[n]);return i>=0?(i>0&&(t.lastNeed=i-1),i):--n<r||i===-2?0:(i=Ic(e[n]),i>=0?(i>0&&(t.lastNeed=i-2),i):--n<r||i===-2?0:(i=Ic(e[n]),i>=0?(i>0&&(i===2?i=0:t.lastNeed=i-3),i):0))}function Ax(t,e,r){if((e[0]&192)!==128)return t.lastNeed=0,"\uFFFD";if(t.lastNeed>1&&e.length>1){if((e[1]&192)!==128)return t.lastNeed=1,"\uFFFD";if(t.lastNeed>2&&e.length>2&&(e[2]&192)!==128)return t.lastNeed=2,"\uFFFD"}}function Tx(t){var e=this.lastTotal-this.lastNeed,r=Ax(this,t,e);if(r!==void 0)return r;if(this.lastNeed<=t.length)return t.copy(this.lastChar,e,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);t.copy(this.lastChar,e,0,t.length),this.lastNeed-=t.length}function Ix(t,e){var r=_x(this,t,e);if(!this.lastNeed)return t.toString("utf8",e);this.lastTotal=r;var n=t.length-(r-this.lastNeed);return t.copy(this.lastChar,0,n),t.toString("utf8",e,n)}function Cx(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+"\uFFFD":e}function Bx(t,e){if((t.length-e)%2===0){var r=t.toString("utf16le",e);if(r){var n=r.charCodeAt(r.length-1);if(n>=55296&&n<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1],r.slice(0,-1)}return r}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=t[t.length-1],t.toString("utf16le",e,t.length-1)}function Rx(t){var e=t&&t.length?this.write(t):"";if(this.lastNeed){var r=this.lastTotal-this.lastNeed;return e+this.lastChar.toString("utf16le",0,r)}return e}function Px(t,e){var r=(t.length-e)%3;return r===0?t.toString("base64",e):(this.lastNeed=3-r,this.lastTotal=3,r===1?this.lastChar[0]=t[t.length-1]:(this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1]),t.toString("base64",e,t.length-r))}function Dx(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+this.lastChar.toString("base64",0,3-this.lastNeed):e}function Mx(t){return t.toString(this.encoding)}function Lx(t){return t&&t.length?this.write(t):""}});var to=L((Q4,dp)=>{"use strict";var lp=Yr().codes.ERR_STREAM_PREMATURE_CLOSE;function Nx(t){var e=!1;return function(){if(!e){e=!0;for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];t.apply(this,n)}}}function kx(){}function Fx(t){return t.setHeader&&typeof t.abort=="function"}function pp(t,e,r){if(typeof e=="function")return pp(t,null,e);e||(e={}),r=Nx(r||kx);var n=e.readable||e.readable!==!1&&t.readable,i=e.writable||e.writable!==!1&&t.writable,s=function(){t.writable||a()},o=t._writableState&&t._writableState.finished,a=function(){i=!1,o=!0,n||r.call(t)},c=t._readableState&&t._readableState.endEmitted,u=function(){n=!1,c=!0,i||r.call(t)},f=function(p){r.call(t,p)},h=function(){var p;if(n&&!c)return(!t._readableState||!t._readableState.ended)&&(p=new lp),r.call(t,p);if(i&&!o)return(!t._writableState||!t._writableState.ended)&&(p=new lp),r.call(t,p)},l=function(){t.req.on("finish",a)};return Fx(t)?(t.on("complete",a),t.on("abort",h),t.req?l():t.on("request",l)):i&&!t._writableState&&(t.on("end",s),t.on("close",s)),t.on("end",u),t.on("finish",a),e.error!==!1&&t.on("error",f),t.on("close",h),function(){t.removeListener("complete",a),t.removeListener("abort",h),t.removeListener("request",l),t.req&&t.req.removeListener("finish",a),t.removeListener("end",s),t.removeListener("close",s),t.removeListener("finish",a),t.removeListener("end",u),t.removeListener("error",f),t.removeListener("close",h)}}dp.exports=pp});var yp=L((J4,gp)=>{"use strict";var ro;function Er(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var Ux=to(),Sr=Symbol("lastResolve"),jr=Symbol("lastReject"),Li=Symbol("error"),no=Symbol("ended"),Xr=Symbol("lastPromise"),Rc=Symbol("handlePromise"),Qr=Symbol("stream");function _r(t,e){return{value:t,done:e}}function Ox(t){var e=t[Sr];if(e!==null){var r=t[Qr].read();r!==null&&(t[Xr]=null,t[Sr]=null,t[jr]=null,e(_r(r,!1)))}}function Kx(t){process.nextTick(Ox,t)}function qx(t,e){return function(r,n){t.then(function(){if(e[no]){r(_r(void 0,!0));return}e[Rc](r,n)},n)}}var Vx=Object.getPrototypeOf(function(){}),zx=Object.setPrototypeOf((ro={get stream(){return this[Qr]},next:function(){var e=this,r=this[Li];if(r!==null)return Promise.reject(r);if(this[no])return Promise.resolve(_r(void 0,!0));if(this[Qr].destroyed)return new Promise(function(o,a){process.nextTick(function(){e[Li]?a(e[Li]):o(_r(void 0,!0))})});var n=this[Xr],i;if(n)i=new Promise(qx(n,this));else{var s=this[Qr].read();if(s!==null)return Promise.resolve(_r(s,!1));i=new Promise(this[Rc])}return this[Xr]=i,i}},Er(ro,Symbol.asyncIterator,function(){return this}),Er(ro,"return",function(){var e=this;return new Promise(function(r,n){e[Qr].destroy(null,function(i){if(i){n(i);return}r(_r(void 0,!0))})})}),ro),Vx),Gx=function(e){var r,n=Object.create(zx,(r={},Er(r,Qr,{value:e,writable:!0}),Er(r,Sr,{value:null,writable:!0}),Er(r,jr,{value:null,writable:!0}),Er(r,Li,{value:null,writable:!0}),Er(r,no,{value:e._readableState.endEmitted,writable:!0}),Er(r,Rc,{value:function(s,o){var a=n[Qr].read();a?(n[Xr]=null,n[Sr]=null,n[jr]=null,s(_r(a,!1))):(n[Sr]=s,n[jr]=o)},writable:!0}),r));return n[Xr]=null,Ux(e,function(i){if(i&&i.code!=="ERR_STREAM_PREMATURE_CLOSE"){var s=n[jr];s!==null&&(n[Xr]=null,n[Sr]=null,n[jr]=null,s(i)),n[Li]=i;return}var o=n[Sr];o!==null&&(n[Xr]=null,n[Sr]=null,n[jr]=null,o(_r(void 0,!0))),n[no]=!0}),e.on("readable",Kx.bind(null,n)),n};gp.exports=Gx});var vp=L((eC,mp)=>{mp.exports=function(){throw new Error("Readable.from is not available in the browser")}});var Ac=L((rC,Cp)=>{"use strict";Cp.exports=ee;var Wn;ee.ReadableState=Ep;var tC=rc().EventEmitter,xp=function(e,r){return e.listeners(r).length},ki=nc(),io=Ri().Buffer,Hx=globalThis.Uint8Array||function(){};function Wx(t){return io.from(t)}function $x(t){return io.isBuffer(t)||t instanceof Hx}var Pc=pc(),G;Pc&&Pc.debuglog?G=Pc.debuglog("stream"):G=function(){};var Yx=G0(),Uc=yc(),Zx=mc(),jx=Zx.getHighWaterMark,so=Yr().codes,Xx=so.ERR_INVALID_ARG_TYPE,Qx=so.ERR_STREAM_PUSH_AFTER_EOF,Jx=so.ERR_METHOD_NOT_IMPLEMENTED,e2=so.ERR_STREAM_UNSHIFT_AFTER_END_EVENT,$n,Dc,Mc;Vn()(ee,ki);var Ni=Uc.errorOrDestroy,Lc=["error","close","destroy","pause","resume"];function t2(t,e,r){if(typeof t.prependListener=="function")return t.prependListener(e,r);!t._events||!t._events[e]?t.on(e,r):Array.isArray(t._events[e])?t._events[e].unshift(r):t._events[e]=[r,t._events[e]]}function Ep(t,e,r){Wn=Wn||Zr(),t=t||{},typeof r!="boolean"&&(r=e instanceof Wn),this.objectMode=!!t.objectMode,r&&(this.objectMode=this.objectMode||!!t.readableObjectMode),this.highWaterMark=jx(this,t,"readableHighWaterMark",r),this.buffer=new Yx,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=t.emitClose!==!1,this.autoDestroy=!!t.autoDestroy,this.destroyed=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&($n||($n=Bc().StringDecoder),this.decoder=new $n(t.encoding),this.encoding=t.encoding)}function ee(t){if(Wn=Wn||Zr(),!(this instanceof ee))return new ee(t);var e=this instanceof Wn;this._readableState=new Ep(t,this,e),this.readable=!0,t&&(typeof t.read=="function"&&(this._read=t.read),typeof t.destroy=="function"&&(this._destroy=t.destroy)),ki.call(this)}Object.defineProperty(ee.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0?!1:this._readableState.destroyed},set:function(e){!this._readableState||(this._readableState.destroyed=e)}});ee.prototype.destroy=Uc.destroy;ee.prototype._undestroy=Uc.undestroy;ee.prototype._destroy=function(t,e){e(t)};ee.prototype.push=function(t,e){var r=this._readableState,n;return r.objectMode?n=!0:typeof t=="string"&&(e=e||r.defaultEncoding,e!==r.encoding&&(t=io.from(t,e),e=""),n=!0),Sp(this,t,e,!1,n)};ee.prototype.unshift=function(t){return Sp(this,t,null,!0,!1)};function Sp(t,e,r,n,i){G("readableAddChunk",e);var s=t._readableState;if(e===null)s.reading=!1,i2(t,s);else{var o;if(i||(o=r2(s,e)),o)Ni(t,o);else if(s.objectMode||e&&e.length>0)if(typeof e!="string"&&!s.objectMode&&Object.getPrototypeOf(e)!==io.prototype&&(e=Wx(e)),n)s.endEmitted?Ni(t,new e2):Nc(t,s,e,!0);else if(s.ended)Ni(t,new Qx);else{if(s.destroyed)return!1;s.reading=!1,s.decoder&&!r?(e=s.decoder.write(e),s.objectMode||e.length!==0?Nc(t,s,e,!1):Fc(t,s)):Nc(t,s,e,!1)}else n||(s.reading=!1,Fc(t,s))}return!s.ended&&(s.length<s.highWaterMark||s.length===0)}function Nc(t,e,r,n){e.flowing&&e.length===0&&!e.sync?(e.awaitDrain=0,t.emit("data",r)):(e.length+=e.objectMode?1:r.length,n?e.buffer.unshift(r):e.buffer.push(r),e.needReadable&&oo(t)),Fc(t,e)}function r2(t,e){var r;return!$x(e)&&typeof e!="string"&&e!==void 0&&!t.objectMode&&(r=new Xx("chunk",["string","Buffer","Uint8Array"],e)),r}ee.prototype.isPaused=function(){return this._readableState.flowing===!1};ee.prototype.setEncoding=function(t){$n||($n=Bc().StringDecoder);var e=new $n(t);this._readableState.decoder=e,this._readableState.encoding=this._readableState.decoder.encoding;for(var r=this._readableState.buffer.head,n="";r!==null;)n+=e.write(r.data),r=r.next;return this._readableState.buffer.clear(),n!==""&&this._readableState.buffer.push(n),this._readableState.length=n.length,this};var bp=1073741824;function n2(t){return t>=bp?t=bp:(t--,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,t|=t>>>16,t++),t}function wp(t,e){return t<=0||e.length===0&&e.ended?0:e.objectMode?1:t!==t?e.flowing&&e.length?e.buffer.head.data.length:e.length:(t>e.highWaterMark&&(e.highWaterMark=n2(t)),t<=e.length?t:e.ended?e.length:(e.needReadable=!0,0))}ee.prototype.read=function(t){G("read",t),t=parseInt(t,10);var e=this._readableState,r=t;if(t!==0&&(e.emittedReadable=!1),t===0&&e.needReadable&&((e.highWaterMark!==0?e.length>=e.highWaterMark:e.length>0)||e.ended))return G("read: emitReadable",e.length,e.ended),e.length===0&&e.ended?kc(this):oo(this),null;if(t=wp(t,e),t===0&&e.ended)return e.length===0&&kc(this),null;var n=e.needReadable;G("need readable",n),(e.length===0||e.length-t<e.highWaterMark)&&(n=!0,G("length less than watermark",n)),e.ended||e.reading?(n=!1,G("reading or ended",n)):n&&(G("do read"),e.reading=!0,e.sync=!0,e.length===0&&(e.needReadable=!0),this._read(e.highWaterMark),e.sync=!1,e.reading||(t=wp(r,e)));var i;return t>0?i=Tp(t,e):i=null,i===null?(e.needReadable=e.length<=e.highWaterMark,t=0):(e.length-=t,e.awaitDrain=0),e.length===0&&(e.ended||(e.needReadable=!0),r!==t&&e.ended&&kc(this)),i!==null&&this.emit("data",i),i};function i2(t,e){if(G("onEofChunk"),!e.ended){if(e.decoder){var r=e.decoder.end();r&&r.length&&(e.buffer.push(r),e.length+=e.objectMode?1:r.length)}e.ended=!0,e.sync?oo(t):(e.needReadable=!1,e.emittedReadable||(e.emittedReadable=!0,_p(t)))}}function oo(t){var e=t._readableState;G("emitReadable",e.needReadable,e.emittedReadable),e.needReadable=!1,e.emittedReadable||(G("emitReadable",e.flowing),e.emittedReadable=!0,process.nextTick(_p,t))}function _p(t){var e=t._readableState;G("emitReadable_",e.destroyed,e.length,e.ended),!e.destroyed&&(e.length||e.ended)&&(t.emit("readable"),e.emittedReadable=!1),e.needReadable=!e.flowing&&!e.ended&&e.length<=e.highWaterMark,Oc(t)}function Fc(t,e){e.readingMore||(e.readingMore=!0,process.nextTick(s2,t,e))}function s2(t,e){for(;!e.reading&&!e.ended&&(e.length<e.highWaterMark||e.flowing&&e.length===0);){var r=e.length;if(G("maybeReadMore read 0"),t.read(0),r===e.length)break}e.readingMore=!1}ee.prototype._read=function(t){Ni(this,new Jx("_read()"))};ee.prototype.pipe=function(t,e){var r=this,n=this._readableState;switch(n.pipesCount){case 0:n.pipes=t;break;case 1:n.pipes=[n.pipes,t];break;default:n.pipes.push(t);break}n.pipesCount+=1,G("pipe count=%d opts=%j",n.pipesCount,e);var i=(!e||e.end!==!1)&&t!==process.stdout&&t!==process.stderr,s=i?a:d;n.endEmitted?process.nextTick(s):r.once("end",s),t.on("unpipe",o);function o(m,b){G("onunpipe"),m===r&&b&&b.hasUnpiped===!1&&(b.hasUnpiped=!0,f())}function a(){G("onend"),t.end()}var c=o2(r);t.on("drain",c);var u=!1;function f(){G("cleanup"),t.removeListener("close",g),t.removeListener("finish",p),t.removeListener("drain",c),t.removeListener("error",l),t.removeListener("unpipe",o),r.removeListener("end",a),r.removeListener("end",d),r.removeListener("data",h),u=!0,n.awaitDrain&&(!t._writableState||t._writableState.needDrain)&&c()}r.on("data",h);function h(m){G("ondata");var b=t.write(m);G("dest.write",b),b===!1&&((n.pipesCount===1&&n.pipes===t||n.pipesCount>1&&Ip(n.pipes,t)!==-1)&&!u&&(G("false write response, pause",n.awaitDrain),n.awaitDrain++),r.pause())}function l(m){G("onerror",m),d(),t.removeListener("error",l),xp(t,"error")===0&&Ni(t,m)}t2(t,"error",l);function g(){t.removeListener("finish",p),d()}t.once("close",g);function p(){G("onfinish"),t.removeListener("close",g),d()}t.once("finish",p);function d(){G("unpipe"),r.unpipe(t)}return t.emit("pipe",r),n.flowing||(G("pipe resume"),r.resume()),t};function o2(t){return function(){var r=t._readableState;G("pipeOnDrain",r.awaitDrain),r.awaitDrain&&r.awaitDrain--,r.awaitDrain===0&&xp(t,"data")&&(r.flowing=!0,Oc(t))}}ee.prototype.unpipe=function(t){var e=this._readableState,r={hasUnpiped:!1};if(e.pipesCount===0)return this;if(e.pipesCount===1)return t&&t!==e.pipes?this:(t||(t=e.pipes),e.pipes=null,e.pipesCount=0,e.flowing=!1,t&&t.emit("unpipe",this,r),this);if(!t){var n=e.pipes,i=e.pipesCount;e.pipes=null,e.pipesCount=0,e.flowing=!1;for(var s=0;s<i;s++)n[s].emit("unpipe",this,{hasUnpiped:!1});return this}var o=Ip(e.pipes,t);return o===-1?this:(e.pipes.splice(o,1),e.pipesCount-=1,e.pipesCount===1&&(e.pipes=e.pipes[0]),t.emit("unpipe",this,r),this)};ee.prototype.on=function(t,e){var r=ki.prototype.on.call(this,t,e),n=this._readableState;return t==="data"?(n.readableListening=this.listenerCount("readable")>0,n.flowing!==!1&&this.resume()):t==="readable"&&!n.endEmitted&&!n.readableListening&&(n.readableListening=n.needReadable=!0,n.flowing=!1,n.emittedReadable=!1,G("on readable",n.length,n.reading),n.length?oo(this):n.reading||process.nextTick(a2,this)),r};ee.prototype.addListener=ee.prototype.on;ee.prototype.removeListener=function(t,e){var r=ki.prototype.removeListener.call(this,t,e);return t==="readable"&&process.nextTick(Ap,this),r};ee.prototype.removeAllListeners=function(t){var e=ki.prototype.removeAllListeners.apply(this,arguments);return(t==="readable"||t===void 0)&&process.nextTick(Ap,this),e};function Ap(t){var e=t._readableState;e.readableListening=t.listenerCount("readable")>0,e.resumeScheduled&&!e.paused?e.flowing=!0:t.listenerCount("data")>0&&t.resume()}function a2(t){G("readable nexttick read 0"),t.read(0)}ee.prototype.resume=function(){var t=this._readableState;return t.flowing||(G("resume"),t.flowing=!t.readableListening,c2(this,t)),t.paused=!1,this};function c2(t,e){e.resumeScheduled||(e.resumeScheduled=!0,process.nextTick(u2,t,e))}function u2(t,e){G("resume",e.reading),e.reading||t.read(0),e.resumeScheduled=!1,t.emit("resume"),Oc(t),e.flowing&&!e.reading&&t.read(0)}ee.prototype.pause=function(){return G("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(G("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this};function Oc(t){var e=t._readableState;for(G("flow",e.flowing);e.flowing&&t.read()!==null;);}ee.prototype.wrap=function(t){var e=this,r=this._readableState,n=!1;t.on("end",function(){if(G("wrapped end"),r.decoder&&!r.ended){var o=r.decoder.end();o&&o.length&&e.push(o)}e.push(null)}),t.on("data",function(o){if(G("wrapped data"),r.decoder&&(o=r.decoder.write(o)),!(r.objectMode&&o==null)&&!(!r.objectMode&&(!o||!o.length))){var a=e.push(o);a||(n=!0,t.pause())}});for(var i in t)this[i]===void 0&&typeof t[i]=="function"&&(this[i]=function(a){return function(){return t[a].apply(t,arguments)}}(i));for(var s=0;s<Lc.length;s++)t.on(Lc[s],this.emit.bind(this,Lc[s]));return this._read=function(o){G("wrapped _read",o),n&&(n=!1,t.resume())},this};typeof Symbol=="function"&&(ee.prototype[Symbol.asyncIterator]=function(){return Dc===void 0&&(Dc=yp()),Dc(this)});Object.defineProperty(ee.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}});Object.defineProperty(ee.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}});Object.defineProperty(ee.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(e){this._readableState&&(this._readableState.flowing=e)}});ee._fromList=Tp;Object.defineProperty(ee.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}});function Tp(t,e){if(e.length===0)return null;var r;return e.objectMode?r=e.buffer.shift():!t||t>=e.length?(e.decoder?r=e.buffer.join(""):e.buffer.length===1?r=e.buffer.first():r=e.buffer.concat(e.length),e.buffer.clear()):r=e.buffer.consume(t,e.decoder),r}function kc(t){var e=t._readableState;G("endReadable",e.endEmitted),e.endEmitted||(e.ended=!0,process.nextTick(f2,e,t))}function f2(t,e){if(G("endReadableNT",t.endEmitted,t.length),!t.endEmitted&&t.length===0&&(t.endEmitted=!0,e.readable=!1,e.emit("end"),t.autoDestroy)){var r=e._writableState;(!r||r.autoDestroy&&r.finished)&&e.destroy()}}typeof Symbol=="function"&&(ee.from=function(t,e){return Mc===void 0&&(Mc=vp()),Mc(ee,t,e)});function Ip(t,e){for(var r=0,n=t.length;r<n;r++)if(t[r]===e)return r;return-1}});var Kc=L((nC,Rp)=>{"use strict";Rp.exports=or;var ao=Yr().codes,h2=ao.ERR_METHOD_NOT_IMPLEMENTED,l2=ao.ERR_MULTIPLE_CALLBACK,p2=ao.ERR_TRANSFORM_ALREADY_TRANSFORMING,d2=ao.ERR_TRANSFORM_WITH_LENGTH_0,co=Zr();Vn()(or,co);function g2(t,e){var r=this._transformState;r.transforming=!1;var n=r.writecb;if(n===null)return this.emit("error",new l2);r.writechunk=null,r.writecb=null,e!=null&&this.push(e),n(t);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}function or(t){if(!(this instanceof or))return new or(t);co.call(this,t),this._transformState={afterTransform:g2.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,t&&(typeof t.transform=="function"&&(this._transform=t.transform),typeof t.flush=="function"&&(this._flush=t.flush)),this.on("prefinish",y2)}function y2(){var t=this;typeof this._flush=="function"&&!this._readableState.destroyed?this._flush(function(e,r){Bp(t,e,r)}):Bp(this,null,null)}or.prototype.push=function(t,e){return this._transformState.needTransform=!1,co.prototype.push.call(this,t,e)};or.prototype._transform=function(t,e,r){r(new h2("_transform()"))};or.prototype._write=function(t,e,r){var n=this._transformState;if(n.writecb=r,n.writechunk=t,n.writeencoding=e,!n.transforming){var i=this._readableState;(n.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}};or.prototype._read=function(t){var e=this._transformState;e.writechunk!==null&&!e.transforming?(e.transforming=!0,this._transform(e.writechunk,e.writeencoding,e.afterTransform)):e.needTransform=!0};or.prototype._destroy=function(t,e){co.prototype._destroy.call(this,t,function(r){e(r)})};function Bp(t,e,r){if(e)return t.emit("error",e);if(r!=null&&t.push(r),t._writableState.length)throw new d2;if(t._transformState.transforming)throw new p2;return t.push(null)}});var Mp=L((iC,Dp)=>{"use strict";Dp.exports=Fi;var Pp=Kc();Vn()(Fi,Pp);function Fi(t){if(!(this instanceof Fi))return new Fi(t);Pp.call(this,t)}Fi.prototype._transform=function(t,e,r){r(null,t)}});var Up=L((sC,Fp)=>{"use strict";var qc;function m2(t){var e=!1;return function(){e||(e=!0,t.apply(void 0,arguments))}}var kp=Yr().codes,v2=kp.ERR_MISSING_ARGS,b2=kp.ERR_STREAM_DESTROYED;function Lp(t){if(t)throw t}function w2(t){return t.setHeader&&typeof t.abort=="function"}function x2(t,e,r,n){n=m2(n);var i=!1;t.on("close",function(){i=!0}),qc===void 0&&(qc=to()),qc(t,{readable:e,writable:r},function(o){if(o)return n(o);i=!0,n()});var s=!1;return function(o){if(!i&&!s){if(s=!0,w2(t))return t.abort();if(typeof t.destroy=="function")return t.destroy();n(o||new b2("pipe"))}}}function Np(t){t()}function E2(t,e){return t.pipe(e)}function S2(t){return!t.length||typeof t[t.length-1]!="function"?Lp:t.pop()}function _2(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];var n=S2(e);if(Array.isArray(e[0])&&(e=e[0]),e.length<2)throw new v2("streams");var i,s=e.map(function(o,a){var c=a<e.length-1,u=a>0;return x2(o,c,u,function(f){i||(i=f),f&&s.forEach(Np),!c&&(s.forEach(Np),n(i))})});return e.reduce(E2)}Fp.exports=_2});var Kp=L((bt,Op)=>{bt=Op.exports=Ac();bt.Stream=bt;bt.Readable=bt;bt.Writable=Ec();bt.Duplex=Zr();bt.Transform=Kc();bt.PassThrough=Mp();bt.finished=to();bt.pipeline=Up()});var Vc=L((oC,Vp)=>{"use strict";var{Readable:A2}=Kp(),qp=ha(),T2=(t=1/0)=>{let e=0;return new A2({read(r){if(e>=t)return this.push(null);e+r>=t&&(r=t-e),e+=r,this.push(qp(r))}})};Vp.exports={randomStream:T2,randomBytes:qp}});var iE={};Ge(iE,{GossipSub:()=>fo,multicodec:()=>nE});var Ki=class{constructor(e){if(!(e>0)||(e-1&e)!==0)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){let e=this.buffer[this.btm];if(e!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}isEmpty(){return this.buffer[this.btm]===void 0}},en=class{constructor(e){this.hwm=e??16,this.head=new Ki(this.hwm),this.tail=this.head}push(e){if(!this.head.push(e)){let r=this.head;this.head=r.next=new Ki(2*this.head.buffer.length),this.head.push(e)}}shift(){let e=this.tail.shift();if(e===void 0&&this.tail.next!=null){let r=this.tail.next;return this.tail.next=null,this.tail=r,this.tail.shift()}return e}isEmpty(){return this.head.isEmpty()}};function qi(t){return id(r=>{let n=r.shift();if(n==null)return{done:!0};if(n.error!=null)throw n.error;return{done:n.done===!0,value:n.value}},t)}function id(t,e){e=e??{};let r=e.onEnd,n=new en,i,s,o,a=async()=>n.isEmpty()?o?{done:!0}:await new Promise((d,m)=>{s=b=>{s=null,n.push(b);try{d(t(n))}catch(S){m(S)}return i}}):t(n),c=d=>s!=null?s(d):(n.push(d),i),u=d=>(n=new en,s!=null?s({error:d}):(n.push({error:d}),i)),f=d=>o?i:c({done:!1,value:d}),h=d=>o?i:(o=!0,d!=null?u(d):c({done:!0})),l=()=>(n=new en,h(),{done:!0}),g=d=>(h(d),{done:!0});if(i={[Symbol.asyncIterator](){return this},next:a,return:l,throw:g,push:f,end:h},r==null)return i;let p=i;return i={[Symbol.asyncIterator](){return this},next(){return p.next()},throw(d){return p.throw(d),r!=null&&(r(d),r=void 0),{done:!0}},return(){return p.return(),r!=null&&(r(),r=void 0),{done:!0}},push:f,end(d){return p.end(d),r!=null&&(r(d),r=void 0),i}},i}var tu=O(eu(),1),ad=(...t)=>{let e;for(;t.length>0;)e=t.shift()(e);return e},ru=t=>t!=null&&(typeof t[Symbol.asyncIterator]=="function"||typeof t[Symbol.iterator]=="function"||typeof t.next=="function"),mo=t=>t!=null&&typeof t.sink=="function"&&ru(t.source),cd=t=>e=>{let r=t.sink(e);if(r.then!=null){let n=qi();return r.then(()=>{n.end()},s=>{n.end(s)}),(0,tu.default)(n,async function*(){yield*t.source,n.end()}())}return t.source};function Zn(t,...e){if(mo(t)){let n=t;t=()=>n.source}else if(ru(t)){let n=t;t=()=>n}let r=[t,...e];if(r.length>1&&mo(r[r.length-1])&&(r[r.length-1]=r[r.length-1].sink),r.length>2)for(let n=1;n<r.length-1;n++)mo(r[n])&&(r[n]=cd(r[n]));return ad(...r)}var El=O(De(),1);function le(t,e){e||(e=t.reduce((i,s)=>i+s.length,0));let r=new Uint8Array(e),n=0;for(let i of t)r.set(i,n),n+=i.length;return r}var Eo={};Ge(Eo,{identity:()=>gd});function fd(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<t.length;i++){var s=t.charAt(i),o=s.charCodeAt(0);if(r[o]!==255)throw new TypeError(s+" is ambiguous");r[o]=i}var a=t.length,c=t.charAt(0),u=Math.log(a)/Math.log(256),f=Math.log(256)/Math.log(a);function h(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var d=0,m=0,b=0,S=p.length;b!==S&&p[b]===0;)b++,d++;for(var I=(S-b)*f+1>>>0,R=new Uint8Array(I);b!==S;){for(var w=p[b],T=0,D=I-1;(w!==0||T<m)&&D!==-1;D--,T++)w+=256*R[D]>>>0,R[D]=w%a>>>0,w=w/a>>>0;if(w!==0)throw new Error("Non-zero carry");m=T,b++}for(var k=I-m;k!==I&&R[k]===0;)k++;for(var V=c.repeat(d);k<I;++k)V+=t.charAt(R[k]);return V}function l(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;var d=0;if(p[d]!==" "){for(var m=0,b=0;p[d]===c;)m++,d++;for(var S=(p.length-d)*u+1>>>0,I=new Uint8Array(S);p[d];){var R=r[p.charCodeAt(d)];if(R===255)return;for(var w=0,T=S-1;(R!==0||w<b)&&T!==-1;T--,w++)R+=a*I[T]>>>0,I[T]=R%256>>>0,R=R/256>>>0;if(R!==0)throw new Error("Non-zero carry");b=w,d++}if(p[d]!==" "){for(var D=S-b;D!==S&&I[D]===0;)D++;for(var k=new Uint8Array(m+(S-D)),V=m;D!==S;)k[V++]=I[D++];return k}}}function g(p){var d=l(p);if(d)return d;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:l,decode:g}}var hd=fd,ld=hd,su=ld;var wE=new Uint8Array(0);var ou=(t,e)=>{if(t===e)return!0;if(t.byteLength!==e.byteLength)return!1;for(let r=0;r<t.byteLength;r++)if(t[r]!==e[r])return!1;return!0},$t=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")};var au=t=>new TextEncoder().encode(t),cu=t=>new TextDecoder().decode(t);var vo=class{constructor(e,r,n){this.name=e,this.prefix=r,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},bo=class{constructor(e,r,n){this.name=e,this.prefix=r,this.baseDecode=n}decode(e){if(typeof e=="string")switch(e[0]){case this.prefix:return this.baseDecode(e.slice(1));default:throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`)}else throw Error("Can only multibase decode strings")}or(e){return fu(this,e)}},wo=class{constructor(e){this.decoders=e}or(e){return fu(this,e)}decode(e){let r=e[0],n=this.decoders[r];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}},fu=(t,e)=>new wo({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}}),xo=class{constructor(e,r,n,i){this.name=e,this.prefix=r,this.baseEncode=n,this.baseDecode=i,this.encoder=new vo(e,r,n),this.decoder=new bo(e,r,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}},Vi=({name:t,prefix:e,encode:r,decode:n})=>new xo(t,e,r,n),ar=({prefix:t,name:e,alphabet:r})=>{let{encode:n,decode:i}=su(r,e);return Vi({prefix:t,name:e,encode:n,decode:s=>$t(i(s))})},pd=(t,e,r,n)=>{let i={};for(let f=0;f<e.length;++f)i[e[f]]=f;let s=t.length;for(;t[s-1]==="=";)--s;let o=new Uint8Array(s*r/8|0),a=0,c=0,u=0;for(let f=0;f<s;++f){let h=i[t[f]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<r|h,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},dd=(t,e,r)=>{let n=e[e.length-1]==="=",i=(1<<r)-1,s="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,s+=e[i&a>>o];if(o&&(s+=e[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s},we=({name:t,prefix:e,bitsPerChar:r,alphabet:n})=>Vi({prefix:e,name:t,encode(i){return dd(i,n,r)},decode(i){return pd(i,n,r,t)}});var gd=Vi({prefix:"\0",name:"identity",encode:t=>cu(t),decode:t=>au(t)});var So={};Ge(So,{base2:()=>yd});var yd=we({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var _o={};Ge(_o,{base8:()=>md});var md=we({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Ao={};Ge(Ao,{base10:()=>vd});var vd=ar({prefix:"9",name:"base10",alphabet:"0123456789"});var To={};Ge(To,{base16:()=>bd,base16upper:()=>wd});var bd=we({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),wd=we({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Io={};Ge(Io,{base32:()=>wt,base32hex:()=>_d,base32hexpad:()=>Td,base32hexpadupper:()=>Id,base32hexupper:()=>Ad,base32pad:()=>Ed,base32padupper:()=>Sd,base32upper:()=>xd,base32z:()=>Cd});var wt=we({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),xd=we({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Ed=we({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Sd=we({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),_d=we({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Ad=we({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Td=we({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Id=we({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Cd=we({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var Co={};Ge(Co,{base36:()=>Bd,base36upper:()=>Rd});var Bd=ar({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Rd=ar({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Bo={};Ge(Bo,{base58btc:()=>Ae,base58flickr:()=>Pd});var Ae=ar({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Pd=ar({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Ro={};Ge(Ro,{base64:()=>tn,base64pad:()=>Dd,base64url:()=>Md,base64urlpad:()=>Ld});var tn=we({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Dd=we({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Md=we({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Ld=we({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Lo={};Ge(Lo,{sha256:()=>Ce,sha512:()=>Jd});var Nd=pu,hu=128,kd=127,Fd=~kd,Ud=Math.pow(2,31);function pu(t,e,r){e=e||[],r=r||0;for(var n=r;t>=Ud;)e[r++]=t&255|hu,t/=128;for(;t&Fd;)e[r++]=t&255|hu,t>>>=7;return e[r]=t|0,pu.bytes=r-n+1,e}var Od=Po,Kd=128,lu=127;function Po(t,n){var r=0,n=n||0,i=0,s=n,o,a=t.length;do{if(s>=a)throw Po.bytes=0,new RangeError("Could not decode varint");o=t[s++],r+=i<28?(o&lu)<<i:(o&lu)*Math.pow(2,i),i+=7}while(o>=Kd);return Po.bytes=s-n,r}var qd=Math.pow(2,7),Vd=Math.pow(2,14),zd=Math.pow(2,21),Gd=Math.pow(2,28),Hd=Math.pow(2,35),Wd=Math.pow(2,42),$d=Math.pow(2,49),Yd=Math.pow(2,56),Zd=Math.pow(2,63),jd=function(t){return t<qd?1:t<Vd?2:t<zd?3:t<Gd?4:t<Hd?5:t<Wd?6:t<$d?7:t<Yd?8:t<Zd?9:10},Xd={encode:Nd,decode:Od,encodingLength:jd},Qd=Xd,jn=Qd;var Xn=t=>[jn.decode(t),jn.decode.bytes],rn=(t,e,r=0)=>(jn.encode(t,e,r),e),nn=t=>jn.encodingLength(t);var It=(t,e)=>{let r=e.byteLength,n=nn(t),i=n+nn(r),s=new Uint8Array(i+r);return rn(t,s,0),rn(r,s,n),s.set(e,i),new sn(t,r,e,s)},Ar=t=>{let e=$t(t),[r,n]=Xn(e),[i,s]=Xn(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new sn(r,i,o,e)},du=(t,e)=>t===e?!0:t.code===e.code&&t.size===e.size&&ou(t.bytes,e.bytes),sn=class{constructor(e,r,n,i){this.code=e,this.size=r,this.digest=n,this.bytes=i}};var Mo=({name:t,code:e,encode:r})=>new Do(t,e,r),Do=class{constructor(e,r,n){this.name=e,this.code=r,this.encode=n}digest(e){if(e instanceof Uint8Array){let r=this.encode(e);return r instanceof Uint8Array?It(this.code,r):r.then(n=>It(this.code,n))}else throw Error("Unknown type, must be binary type")}};var yu=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),Ce=Mo({name:"sha2-256",code:18,encode:yu("SHA-256")}),Jd=Mo({name:"sha2-512",code:19,encode:yu("SHA-512")});var No={};Ge(No,{identity:()=>cr});var mu=0,eg="identity",vu=$t,tg=t=>It(mu,vu(t)),cr={code:mu,name:eg,encode:vu,digest:tg};var KE=new TextEncoder,qE=new TextDecoder;var ue=class{constructor(e,r,n,i){this.code=r,this.version=e,this.multihash=n,this.bytes=i,this.byteOffset=i.byteOffset,this.byteLength=i.byteLength,this.asCID=this,this._baseCache=new Map,Object.defineProperties(this,{byteOffset:Hi,byteLength:Hi,code:Gi,version:Gi,multihash:Gi,bytes:Gi,_baseCache:Hi,asCID:Hi})}toV0(){switch(this.version){case 0:return this;default:{let{code:e,multihash:r}=this;if(e!==Qn)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(r.code!==ag)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return ue.createV0(r)}}}toV1(){switch(this.version){case 0:{let{code:e,digest:r}=this.multihash,n=It(e,r);return ue.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}equals(e){return e&&this.code===e.code&&this.version===e.version&&du(this.multihash,e.multihash)}toString(e){let{bytes:r,version:n,_baseCache:i}=this;switch(n){case 0:return sg(r,i,e||Ae.encoder);default:return og(r,i,e||wt.encoder)}}toJSON(){return{code:this.code,version:this.version,hash:this.multihash.bytes}}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return"CID("+this.toString()+")"}static isCID(e){return ug(/^0\.0/,fg),!!(e&&(e[wu]||e.asCID===e))}get toBaseEncodedString(){throw new Error("Deprecated, use .toString()")}get codec(){throw new Error('"codec" property is deprecated, use integer "code" property instead')}get buffer(){throw new Error("Deprecated .buffer property, use .bytes to get Uint8Array instead")}get multibaseName(){throw new Error('"multibaseName" property is deprecated')}get prefix(){throw new Error('"prefix" property is deprecated')}static asCID(e){if(e instanceof ue)return e;if(e!=null&&e.asCID===e){let{version:r,code:n,multihash:i,bytes:s}=e;return new ue(r,n,i,s||bu(r,n,i.bytes))}else if(e!=null&&e[wu]===!0){let{version:r,multihash:n,code:i}=e,s=Ar(n);return ue.create(r,i,s)}else return null}static create(e,r,n){if(typeof r!="number")throw new Error("String codecs are no longer supported");switch(e){case 0:{if(r!==Qn)throw new Error(`Version 0 CID must use dag-pb (code: ${Qn}) block encoding`);return new ue(e,r,n,n.bytes)}case 1:{let i=bu(e,r,n.bytes);return new ue(e,r,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return ue.create(0,Qn,e)}static createV1(e,r){return ue.create(1,e,r)}static decode(e){let[r,n]=ue.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return r}static decodeFirst(e){let r=ue.inspectBytes(e),n=r.size-r.multihashSize,i=$t(e.subarray(n,n+r.multihashSize));if(i.byteLength!==r.multihashSize)throw new Error("Incorrect length");let s=i.subarray(r.multihashSize-r.digestSize),o=new sn(r.multihashCode,r.digestSize,s,i);return[r.version===0?ue.createV0(o):ue.createV1(r.codec,o),e.subarray(r.size)]}static inspectBytes(e){let r=0,n=()=>{let[h,l]=Xn(e.subarray(r));return r+=l,h},i=n(),s=Qn;if(i===18?(i=0,r=0):i===1&&(s=n()),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);let o=r,a=n(),c=n(),u=r+c,f=u-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:f,size:u}}static parse(e,r){let[n,i]=ig(e,r),s=ue.decode(i);return s._baseCache.set(n,e),s}},ig=(t,e)=>{switch(t[0]){case"Q":{let r=e||Ae;return[Ae.prefix,r.decode(`${Ae.prefix}${t}`)]}case Ae.prefix:{let r=e||Ae;return[Ae.prefix,r.decode(t)]}case wt.prefix:{let r=e||wt;return[wt.prefix,r.decode(t)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[t[0],e.decode(t)]}}},sg=(t,e,r)=>{let{prefix:n}=r;if(n!==Ae.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);let i=e.get(n);if(i==null){let s=r.encode(t).slice(1);return e.set(n,s),s}else return i},og=(t,e,r)=>{let{prefix:n}=r,i=e.get(n);if(i==null){let s=r.encode(t);return e.set(n,s),s}else return i},Qn=112,ag=18,bu=(t,e,r)=>{let n=nn(t),i=n+nn(e),s=new Uint8Array(i+r.byteLength);return rn(t,s,0),rn(e,s,n),s.set(r,i),s},wu=Symbol.for("@ipld/js-cid/CID"),Gi={writable:!1,configurable:!1,enumerable:!0},Hi={writable:!1,enumerable:!1,configurable:!1},cg="0.0.0-dev",ug=(t,e)=>{if(t.test(cg))console.warn(e);else throw new Error(e)},fg=`CID.isCID(v) is deprecated and will be removed in the next major release.
Following code pattern:

if (CID.isCID(value)) {
  doSomethingWithCID(value)
}

Is replaced with:

const cid = CID.asCID(value)
if (cid) {
  // Make sure to use cid instead of value
  doSomethingWithCID(cid)
}
`;var on={...Eo,...So,..._o,...Ao,...To,...Io,...Co,...Bo,...Ro},ZE={...Lo,...No};function Eu(t,e,r,n){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:n}}}var xu=Eu("utf8","u",t=>{let e=new TextDecoder("utf8");return"u"+e.decode(t)},t=>new TextEncoder().encode(t.substring(1))),ko=Eu("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);let e=new Uint8Array(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),hg={utf8:xu,"utf-8":xu,hex:on.base16,latin1:ko,ascii:ko,binary:ko,...on},Wi=hg;function pe(t,e="utf8"){let r=Wi[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return r.decoder.decode(`${r.prefix}${t}`)}function Be(t,e){if(t===e)return!0;if(t.byteLength!==e.byteLength)return!1;for(let r=0;r<t.byteLength;r++)if(t[r]!==e[r])return!1;return!0}function H(t,e="utf8"){let r=Wi[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return r.encoder.encode(t).substring(1)}var Au=Symbol.for("@achingbrain/uint8arraylist");function Su(t,e,r){if(e==null||e<0||e>=r)throw new RangeError("index is out of bounds");let n=0;for(let i of t){let s=n+i.byteLength;if(e<s)return{buf:i,index:e-n};n=s}throw new RangeError("index is out of bounds")}function _u(t){return Boolean(t?.[Au])}var Q=class{constructor(...e){Object.defineProperty(this,Au,{value:!0}),this.bufs=[],this.length=0,this.appendAll(e)}*[Symbol.iterator](){yield*this.bufs}get byteLength(){return this.length}append(...e){this.appendAll(e)}appendAll(e){let r=0;for(let n of e)if(n instanceof Uint8Array)r+=n.byteLength,this.bufs.push(n);else if(_u(n))r+=n.length,this.bufs=this.bufs.concat(n.bufs);else throw new Error("Could not append value, must be an Uint8Array or a Uint8ArrayList");this.length+=r}get(e){let r=Su(this.bufs,e,this.length);return r.buf[r.index]}set(e,r){let n=Su(this.bufs,e,this.length);n.buf[n.index]=r}write(e,r=0){if(e instanceof Uint8Array)for(let n=0;n<e.length;n++)this.set(r+n,e[n]);else if(_u(e))for(let n=0;n<e.length;n++)this.set(r+n,e.get(n));else throw new Error("Could not write value, must be an Uint8Array or a Uint8ArrayList")}consume(e){if(e=Math.trunc(e),!(Number.isNaN(e)||e<=0))for(;this.bufs.length>0;)if(e>=this.bufs[0].byteLength)e-=this.bufs[0].byteLength,this.length-=this.bufs[0].byteLength,this.bufs.shift();else{this.bufs[0]=this.bufs[0].subarray(e),this.length-=e;break}}slice(e,r){let{bufs:n,length:i}=this._subList(e,r);return le(n,i)}subarray(e,r){let{bufs:n}=this._subList(e,r),i=new Q;return i.appendAll(n),i}_subList(e,r){if(e==null&&r==null)return{bufs:this.bufs,length:this.length};if(e=e??0,r=r??(this.length>0?this.length:0),e<0||r>this.length)throw new RangeError("index out of bounds");if(e===r)return{bufs:[],length:0};let n=[],i=0;for(let s of this.bufs){let o=i,a=o+s.byteLength,c=e>=o&&e<a,u=r>o&&r<=a,f=e<o&&r>=a;i=a;let h,l;if(c&&(h=e-o,l=s.byteLength),u&&(l=r-o,h==null&&(h=0)),f&&(h=0,l=s.byteLength),h!=null&&l!=null&&n.push(s.subarray(h,l)),u)break}return{bufs:n,length:r-e}}getInt8(e){let r=this.slice(e,e+1);return new DataView(r.buffer,r.byteOffset,r.byteLength).getInt8(0)}setInt8(e,r){let n=new Uint8Array(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setInt8(0,r),this.write(n,e)}getInt16(e,r){let n=this.slice(e,e+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt16(0,r)}setInt16(e,r,n){let i=new Uint8Array(2);new DataView(i.buffer,i.byteOffset,i.byteLength).setInt16(0,r,n),this.write(i,e)}getInt32(e,r){let n=this.slice(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt32(0,r)}setInt32(e,r,n){let i=new Uint8Array(4);new DataView(i.buffer,i.byteOffset,i.byteLength).setInt32(0,r,n),this.write(i,e)}getBigInt64(e,r){let n=this.slice(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigInt64(0,r)}setBigInt64(e,r,n){let i=new Uint8Array(8);new DataView(i.buffer,i.byteOffset,i.byteLength).setBigInt64(0,r,n),this.write(i,e)}getUint8(e){let r=this.slice(e,e+1);return new DataView(r.buffer,r.byteOffset,r.byteLength).getUint8(0)}setUint8(e,r){let n=new Uint8Array(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setUint8(0,r),this.write(n,e)}getUint16(e,r){let n=this.slice(e,e+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint16(0,r)}setUint16(e,r,n){let i=new Uint8Array(2);new DataView(i.buffer,i.byteOffset,i.byteLength).setUint16(0,r,n),this.write(i,e)}getUint32(e,r){let n=this.slice(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint32(0,r)}setUint32(e,r,n){let i=new Uint8Array(4);new DataView(i.buffer,i.byteOffset,i.byteLength).setUint32(0,r,n),this.write(i,e)}getBigUint64(e,r){let n=this.slice(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigUint64(0,r)}setBigUint64(e,r,n){let i=new Uint8Array(8);new DataView(i.buffer,i.byteOffset,i.byteLength).setBigUint64(0,r,n),this.write(i,e)}getFloat32(e,r){let n=this.slice(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat32(0,r)}setFloat32(e,r,n){let i=new Uint8Array(4);new DataView(i.buffer,i.byteOffset,i.byteLength).setFloat32(0,r,n),this.write(i,e)}getFloat64(e,r){let n=this.slice(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat64(0,r)}setFloat64(e,r,n){let i=new Uint8Array(8);new DataView(i.buffer,i.byteOffset,i.byteLength).setFloat64(0,r,n),this.write(i,e)}};function Ct(t){return t instanceof Uint8Array?{get(e){return t[e]},set(e,r){t[e]=r}}:{get(e){return t.get(e)},set(e,r){t.set(e,r)}}}var Tu=4294967296,Ue=class{constructor(e=0,r=0){this.hi=e,this.lo=r}toBigInt(e){if(e)return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n);if(this.hi>>>31!==0){let r=~this.lo+1>>>0,n=~this.hi>>>0;return r===0&&(n=n+1>>>0),-(BigInt(r)+(BigInt(n)<<32n))}return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n)}zzDecode(){let e=-(this.lo&1),r=((this.lo>>>1|this.hi<<31)^e)>>>0,n=(this.hi>>>1^e)>>>0;return new Ue(n,r)}zzEncode(){let e=this.hi>>31,r=((this.hi<<1|this.lo>>>31)^e)>>>0,n=(this.lo<<1^e)>>>0;return new Ue(r,n)}toBytes(e,r=0){let n=Ct(e);for(;this.hi>0;)n.set(r++,this.lo&127|128),this.lo=(this.lo>>>7|this.hi<<25)>>>0,this.hi>>>=7;for(;this.lo>127;)n.set(r++,this.lo&127|128),this.lo=this.lo>>>7;n.set(r++,this.lo)}static fromBigInt(e){if(e===0n)return new Ue;let r=e<0;r&&(e=-e);let n=Number(e>>32n)|0,i=Number(e-(BigInt(n)<<32n))|0;return r&&(n=~n>>>0,i=~i>>>0,++i>Tu&&(i=0,++n>Tu&&(n=0))),new Ue(n,i)}static fromNumber(e){if(e===0)return new Ue;let r=e<0;r&&(e=-e);let n=e>>>0,i=(e-n)/4294967296>>>0;return r&&(i=~i>>>0,n=~n>>>0,++n>4294967295&&(n=0,++i>4294967295&&(i=0))),new Ue(i,n)}static fromBytes(e,r){let n=Ct(e),i=new Ue,s=0;if(e.length-r>4){for(;s<4;++s)if(i.lo=(i.lo|(n.get(r)&127)<<s*7)>>>0,n.get(r++)<128)return i;if(i.lo=(i.lo|(n.get(r)&127)<<28)>>>0,i.hi=(i.hi|(n.get(r)&127)>>4)>>>0,n.get(r++)<128)return i;s=0}else{for(;s<3;++s){if(r>=e.length)throw RangeError(`index out of range: ${r} > ${e.length}`);if(i.lo=(i.lo|(n.get(r)&127)<<s*7)>>>0,n.get(r++)<128)return i}return i.lo=(i.lo|(n.get(r++)&127)<<s*7)>>>0,i}if(e.length-r>4){for(;s<5;++s)if(i.hi=(i.hi|(n.get(r)&127)<<s*7+3)>>>0,n.get(r++)<128)return i}else for(;s<5;++s){if(r>=e.length)throw RangeError(`index out of range: ${r} > ${e.length}`);if(i.hi=(i.hi|(n.get(r)&127)<<s*7+3)>>>0,n.get(r++)<128)return i}throw Error("invalid varint encoding")}};var Iu=128,lg=127,pg=~lg,dg=Math.pow(2,31),gg=Math.pow(2,7),yg=Math.pow(2,14),mg=Math.pow(2,21),vg=Math.pow(2,28),bg=Math.pow(2,35),wg=Math.pow(2,42),xg=Math.pow(2,49),Eg=Math.pow(2,56),Sg=Math.pow(2,63),U={encodingLength(t){return t<gg?1:t<yg?2:t<mg?3:t<vg?4:t<bg?5:t<wg?6:t<xg?7:t<Eg?8:t<Sg?9:10},encode(t,e){let r=0,n=Ct(e);for(;t>=dg;)n.set(r++,t&255|Iu),t/=128;for(;(t&pg)>0;)n.set(r++,t&255|Iu),t>>>=7;n.set(r,t|0)},decode(t,e=0){let r=Ct(t),n=4294967295;if(n=(r.get(e)&127)>>>0,r.get(e++)<128||(n=(n|(r.get(e)&127)<<7)>>>0,r.get(e++)<128)||(n=(n|(r.get(e)&127)<<14)>>>0,r.get(e++)<128)||(n=(n|(r.get(e)&127)<<21)>>>0,r.get(e++)<128)||(n=(n|(r.get(e)&15)<<28)>>>0,r.get(e++)<128))return n;if((e+=5)>t.length)throw RangeError(`index out of range: ${e} > ${t.length}`);return n}},$i={encodingLength(t){return t<0?10:U.encodingLength(t)},encode(t,e){if(t<0){let r=0,n=Ct(e),i=Ue.fromNumber(t);for(;i.hi>0;)n.set(r++,i.lo&127|128),i.lo=(i.lo>>>7|i.hi<<25)>>>0,i.hi>>>=7;for(;i.lo>127;)n.set(r++,i.lo&127|128),i.lo=i.lo>>>7;n.set(r++,i.lo);return}U.encode(t,e)},decode(t,e=0){return U.decode(t,e)|0}},Yi={encodingLength(t){return t=(t<<1^t>>31)>>>0,U.encodingLength(t)},encode(t,e,r=0){return t=(t<<1^t>>31)>>>0,U.encode(t,e)},decode(t,e=0){let r=U.decode(t,e);return r>>>1^-(r&1)|0}};function Me(t,e){let r=new Uint8Array(U.encodingLength(t.length));return U.encode(t.length,r),e.decode(new Q(r,t),0)}function Le(t,e){let r=e.encode(t),n=U.encodingLength(U.decode(r));return r.slice(n)}var q;(function(t){t[t.VARINT=0]="VARINT",t[t.BIT64=1]="BIT64",t[t.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",t[t.START_GROUP=3]="START_GROUP",t[t.END_GROUP=4]="END_GROUP",t[t.BIT32=5]="BIT32"})(q||(q={}));function $(t,e,r,n,i){return{name:t,type:e,encode:r,decode:n,encodingLength:i}}var _g=function(){return 1},Ag=function(e){return Uint8Array.from([e?1:0])},Tg=function(e,r){return e.get(r)>0},Fo=$("bool",q.VARINT,Ag,Tg,_g);var Ig=function(e){let r=e.byteLength;return U.encodingLength(r)+r},Cg=function(e){let r=new Uint8Array(U.encodingLength(e.byteLength));return U.encode(e.byteLength,r),new Q(r,e)},Bg=function(e,r){let n=U.decode(e,r);return r+=U.encodingLength(n),e.slice(r,r+n)},xe=$("bytes",q.LENGTH_DELIMITED,Cg,Bg,Ig);var Cu=function(){return 8},Rg=function(e){let r=new Q(new Uint8Array(Cu(e)));return r.setFloat64(0,e,!0),r},Pg=function(e,r){return e.getFloat64(r,!0)},Dg=$("double",q.BIT64,Rg,Pg,Cu);function Uo(t){function e(s){if(t[s.toString()]==null)throw new Error("Invalid enum value");return typeof s=="number"?s:t[s]}let r=function(o){return U.encodingLength(e(o))},n=function(o){let a=e(o),c=new Uint8Array(U.encodingLength(a));return U.encode(a,c),c},i=function(o,a){let u=U.decode(o,a).toString();if(t[u]==null)throw new Error("Invalid enum value");return t[u]};return $("enum",q.VARINT,n,i,r)}var Bu=function(){return 4},Mg=function(e){let r=new Q(new Uint8Array(Bu(e)));return r.setInt32(0,e,!0),r},Lg=function(e,r){return e.getInt32(r,!0)},Ng=$("fixed32",q.BIT32,Mg,Lg,Bu);var Ru=function(e){return 8},kg=function(e){let r=new Q(new Uint8Array(Ru(e)));return r.setBigInt64(0,e,!0),r},Fg=function(e,r){return e.getBigInt64(r,!0)},Ug=$("fixed64",q.BIT64,kg,Fg,Ru);var Pu=function(){return 4},Og=function(e){let r=new Q(new Uint8Array(Pu(1)));return r.setFloat32(0,e,!0),r},Kg=function(e,r){return e.getFloat32(r,!0)},qg=$("float",q.BIT32,Og,Kg,Pu);var Du=function(e){return $i.encodingLength(e)},Vg=function(e){let r=new Uint8Array(Du(e));return $i.encode(e,r),r},zg=function(e,r){return $i.decode(e,r)},Gg=$("int32",q.VARINT,Vg,zg,Du);var Mu=0x7fn,ur={encodingLength(t){let e=0;for(;t>=0x80n;e++)t>>=7n;return e+1},encode(t,e){let r=Ct(e),n=0;for(;Mu<t;)r.set(n++,Number(t&Mu)|128),t>>=7n;r.set(n,Number(t))},decode(t,e=0){return Ue.fromBytes(t,e).toBigInt(!0)}},Zi={encodingLength(t){return t<0n?10:ur.encodingLength(t)},encode(t,e,r=0){if(t<0n){Ue.fromBigInt(t).toBytes(e,r);return}return ur.encode(t,e)},decode(t,e=0){return Ue.fromBytes(t,e).toBigInt(!1)}},ji={encodingLength(t){return ur.encodingLength(t>=0?t*2n:t*-2n-1n)},encode(t,e,r=0){Ue.fromBigInt(t).zzEncode().toBytes(e,r)},decode(t,e=0){return Ue.fromBytes(t,e).zzDecode().toBigInt(!1)}};var Lu=function(e){return Zi.encodingLength(e)},Hg=function(e){let r=new Uint8Array(Lu(e));return Zi.encode(e,r),r},Wg=function(e,r){return Zi.decode(e,r)|0n},$g=$("int64",q.VARINT,Hg,Wg,Lu);function Ne(t){let e=function(s){let o=0;for(let a of Object.values(t))o+=a.codec.encodingLength(s[a.name]);return U.encodingLength(o)+o},r=function(s){let o=new Q;function a(u,f,h){if(u==null){if(h.optional===!0)return;throw new Error(`Non optional field "${h.name}" was ${u===null?"null":"undefined"}`)}let l=f<<3|h.codec.type,g=new Uint8Array(U.encodingLength(l));U.encode(l,g);let p=h.codec.encode(u);o.append(g),o.append(p)}for(let[u,f]of Object.entries(t)){let h=parseInt(u);if(f.repeats===!0){if(!Array.isArray(s[f.name]))throw new Error(`Repeating field "${f.name}" was not an array`);for(let l of s[f.name])a(l,h,f)}else a(s[f.name],h,f)}let c=new Uint8Array(U.encodingLength(o.length));return U.encode(o.length,c),new Q(c,o)},n=function(s,o){let a=U.decode(s,o);o+=U.encodingLength(a);let c=o+a,u={};for(;o<c;){let f=U.decode(s,o);o+=U.encodingLength(f);let h=f&7,l=f>>3,g=t[l],p=0;if(h===q.VARINT)if(g!=null){let d=g.codec.decode(s,o);p=g.codec.encodingLength(d)}else{let d=U.decode(s,o);p=U.encodingLength(d)}else if(h===q.BIT64)p=8;else if(h===q.LENGTH_DELIMITED){let d=U.decode(s,o);p=d+U.encodingLength(d)}else if(h===q.BIT32)p=4;else{if(h===q.START_GROUP)throw new Error("Unsupported wire type START_GROUP");if(h===q.END_GROUP)throw new Error("Unsupported wire type END_GROUP")}if(g!=null){let d=g.codec.decode(s,o);g.repeats===!0?(u[g.name]==null&&(u[g.name]=[]),u[g.name].push(d)):u[g.name]=d}o+=p}for(let f of Object.values(t))f.repeats===!0&&u[f.name]==null&&(u[f.name]=[]);return u};return $("message",q.LENGTH_DELIMITED,r,n,e)}var Nu=function(){return 4},Yg=function(e){let r=new Q(new Uint8Array(Nu(e)));return r.setInt32(0,e,!0),r},Zg=function(e,r){return e.getInt32(r,!0)},jg=$("sfixed32",q.BIT32,Yg,Zg,Nu);var ku=function(){return 8},Xg=function(e){let r=new Q(new Uint8Array(ku(e)));return r.setBigInt64(0,e,!0),r},Qg=function(e,r){return e.getBigInt64(r,!0)},Jg=$("sfixed64",q.BIT64,Xg,Qg,ku);var Fu=function(e){return Yi.encodingLength(e)},ey=function(e){let r=new Uint8Array(Fu(e));return Yi.encode(e,r),r},ty=function(e,r){return Yi.decode(e,r)},ry=$("sint32",q.VARINT,ey,ty,Fu);var Uu=function(e){return ji.encodingLength(e)},ny=function(e){let r=new Uint8Array(Uu(e));return ji.encode(e,r),r},iy=function(e,r){return ji.decode(e,r)},sy=$("sint64",q.VARINT,ny,iy,Uu);var oy=function(e){let r=pe(e).byteLength;return U.encodingLength(r)+r},ay=function(e){let r=pe(e),n=new Uint8Array(U.encodingLength(r.byteLength));return U.encode(r.length,n),new Q(n,r)},cy=function(e,r){let n=U.decode(e,r);return r+=U.encodingLength(n),H(e.slice(r,r+n))},Ir=$("string",q.LENGTH_DELIMITED,ay,cy,oy);var Ou=function(e){return U.encodingLength(e)},uy=function(e){let r=new Uint8Array(Ou(e));return U.encode(e,r),r},fy=function(e,r){return U.decode(e,r)},hy=$("uint32",q.VARINT,uy,fy,Ou);var ly=function(e){return ur.encodingLength(e)},py=function(e){let r=new Uint8Array(ur.encodingLength(e));return ur.encode(e,r),r},dy=function(e,r){return ur.decode(e,r)},Jn=$("uint64",q.VARINT,py,dy,ly);var Ee;(function(t){t.RSA="RSA",t.Ed25519="Ed25519",t.Secp256k1="Secp256k1"})(Ee||(Ee={}));var Oo;(function(t){t[t.RSA=0]="RSA",t[t.Ed25519=1]="Ed25519",t[t.Secp256k1=2]="Secp256k1"})(Oo||(Oo={}));(function(t){t.codec=()=>Uo(Oo)})(Ee||(Ee={}));var Bt;(function(t){t.codec=()=>Ne({1:{name:"Type",codec:Ee.codec()},2:{name:"Data",codec:xe}}),t.encode=e=>Le(e,t.codec()),t.decode=e=>Me(e,t.codec())})(Bt||(Bt={}));var Rt;(function(t){t.codec=()=>Ne({1:{name:"Type",codec:Ee.codec()},2:{name:"Data",codec:xe}}),t.encode=e=>Le(e,t.codec()),t.decode=e=>Me(e,t.codec())})(Rt||(Rt={}));var UT=O(ni(),1),OT=O(rh(),1),Lv=O(ie(),1),ol=O(De(),1);var K1=O(De(),1);var Je={get(t=globalThis){let e=t.crypto;if(e==null||e.subtle==null)throw Object.assign(new Error("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p-crypto/blob/master/README.md#web-crypto-api"),{code:"ERR_MISSING_WEB_CRYPTO"});return e}};var q1=O(De(),1);var LA=O(Re(),1),NA=O(hs(),1),nh=O(ie(),1);function St(t,e){let r=Uint8Array.from(t.abs().toByteArray());if(r=r[0]===0?r.slice(1):r,e!=null){if(r.length>e)throw new Error("byte array longer than desired length");r=le([new Uint8Array(e-r.length),r])}return H(r,"base64url")}function st(t){let e=ih(t);return new nh.default.jsbn.BigInteger(H(e,"base16"),16)}function ih(t,e){let r=pe(t,"base64urlpad");if(e!=null){if(r.length>e)throw new Error("byte array longer than desired length");r=le([new Uint8Array(e-r.length),r])}return r}var V1={"P-256":256,"P-384":384,"P-521":521},z1=Object.keys(V1),HA=z1.join(" / ");function ca(t){let e=t?.algorithm??"AES-GCM",r=t?.keyLength??16,n=t?.nonceLength??12,i=t?.digest??"SHA-256",s=t?.saltLength??16,o=t?.iterations??32767,a=Je.get();r*=8;async function c(h,l){let g=a.getRandomValues(new Uint8Array(s)),p=a.getRandomValues(new Uint8Array(n)),d={name:e,iv:p};typeof l=="string"&&(l=pe(l));let m={name:"PBKDF2",salt:g,iterations:o,hash:{name:i}},b=await a.subtle.importKey("raw",l,{name:"PBKDF2"},!1,["deriveKey","deriveBits"]),S=await a.subtle.deriveKey(m,b,{name:e,length:r},!0,["encrypt"]),I=await a.subtle.encrypt(d,S,h);return le([g,d.iv,new Uint8Array(I)])}async function u(h,l){let g=h.slice(0,s),p=h.slice(s,s+n),d=h.slice(s+n),m={name:e,iv:p};typeof l=="string"&&(l=pe(l));let b={name:"PBKDF2",salt:g,iterations:o,hash:{name:i}},S=await a.subtle.importKey("raw",l,{name:"PBKDF2"},!1,["deriveKey","deriveBits"]),I=await a.subtle.deriveKey(b,S,{name:e,length:r},!0,["decrypt"]),R=await a.subtle.decrypt(m,I,d);return new Uint8Array(R)}return{encrypt:c,decrypt:u}}var ya={};Ge(ya,{RsaPrivateKey:()=>pn,RsaPublicKey:()=>ci,fromJwk:()=>ev,generateKeyPair:()=>tv,unmarshalRsaPrivateKey:()=>Q1,unmarshalRsaPublicKey:()=>J1});var ga=O(De(),1);var ET=O(fh(),1),ai=O(ie(),1);var lh=O(ha(),1),ph=O(De(),1);function gs(t){if(isNaN(t)||t<=0)throw(0,ph.default)(new Error("random bytes length must be a Number bigger than 0"),"ERR_INVALID_LENGTH");return(0,lh.default)(t)}var Lr={};Ge(Lr,{jwkToPkcs1:()=>$1,jwkToPkix:()=>Z1,pkcs1ToJwk:()=>W1,pkixToJwk:()=>Y1});var iT=O(ni(),1),sT=O(ds(),1),Xt=O(ie(),1);var la=O(De(),1);function W1(t){let e=Xt.default.asn1.fromDer(H(t,"ascii")),r=Xt.default.pki.privateKeyFromAsn1(e);return{kty:"RSA",n:St(r.n),e:St(r.e),d:St(r.d),p:St(r.p),q:St(r.q),dp:St(r.dP),dq:St(r.dQ),qi:St(r.qInv),alg:"RS256"}}function $1(t){if(t.n==null||t.e==null||t.d==null||t.p==null||t.q==null||t.dp==null||t.dq==null||t.qi==null)throw(0,la.default)(new Error("JWK was missing components"),"ERR_INVALID_PARAMETERS");let e=Xt.default.pki.privateKeyToAsn1({n:st(t.n),e:st(t.e),d:st(t.d),p:st(t.p),q:st(t.q),dP:st(t.dp),dQ:st(t.dq),qInv:st(t.qi)});return pe(Xt.default.asn1.toDer(e).getBytes(),"ascii")}function Y1(t){let e=Xt.default.asn1.fromDer(H(t,"ascii")),r=Xt.default.pki.publicKeyFromAsn1(e);return{kty:"RSA",n:St(r.n),e:St(r.e)}}function Z1(t){if(t.n==null||t.e==null)throw(0,la.default)(new Error("JWK was missing components"),"ERR_INVALID_PARAMETERS");let e=Xt.default.pki.publicKeyToAsn1({n:st(t.n),e:st(t.e)});return pe(Xt.default.asn1.toDer(e).getBytes(),"ascii")}var uT=O(ds(),1),pa=O(ie(),1);function dh(t,e){return e.map(r=>st(t[r]))}function gh(t){return pa.default.pki.setRsaPrivateKey(...dh(t,["n","e","d","p","q","dp","dq","qi"]))}function yh(t){return pa.default.pki.setRsaPublicKey(...dh(t,["n","e"]))}var mh=O(De(),1);async function vh(t){let e=await Je.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:t,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]),r=await xh(e);return{privateKey:r[0],publicKey:r[1]}}async function da(t){let r=[await Je.get().subtle.importKey("jwk",t,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["sign"]),await j1(t)],n=await xh({privateKey:r[0],publicKey:r[1]});return{privateKey:n[0],publicKey:n[1]}}async function bh(t,e){let r=await Je.get().subtle.importKey("jwk",t,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]),n=await Je.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},r,Uint8Array.from(e));return new Uint8Array(n,0,n.byteLength)}async function wh(t,e,r){let n=await Je.get().subtle.importKey("jwk",t,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);return await Je.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},n,e,r)}async function xh(t){if(t.privateKey==null||t.publicKey==null)throw(0,mh.default)(new Error("Private and public key are required"),"ERR_INVALID_PARAMETERS");return await Promise.all([Je.get().subtle.exportKey("jwk",t.privateKey),Je.get().subtle.exportKey("jwk",t.publicKey)])}async function j1(t){return await Je.get().subtle.importKey("jwk",{kty:t.kty,n:t.n,e:t.e},{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"])}function Eh(t,e,r,n){let i=e?yh(t):gh(t),s=H(Uint8Array.from(r),"ascii"),o=n(s,i);return pe(o,"ascii")}function Sh(t,e){return Eh(t,!0,e,(r,n)=>n.encrypt(r))}function _h(t,e){return Eh(t,!1,e,(r,n)=>n.decrypt(r))}async function ln(t,e){let n=await ca().encrypt(t,e);return tn.encode(n)}var ci=class{constructor(e){this._key=e}async verify(e,r){return await wh(this._key,r,e)}marshal(){return Lr.jwkToPkix(this._key)}get bytes(){return Bt.encode({Type:Ee.RSA,Data:this.marshal()})}encrypt(e){return Sh(this._key,e)}equals(e){return Be(this.bytes,e.bytes)}async hash(){let{bytes:e}=await Ce.digest(this.bytes);return e}},pn=class{constructor(e,r){this._key=e,this._publicKey=r}genSecret(){return gs(16)}async sign(e){return await bh(this._key,e)}get public(){if(this._publicKey==null)throw(0,ga.default)(new Error("public key not provided"),"ERR_PUBKEY_NOT_PROVIDED");return new ci(this._publicKey)}decrypt(e){return _h(this._key,e)}marshal(){return Lr.jwkToPkcs1(this._key)}get bytes(){return Rt.encode({Type:Ee.RSA,Data:this.marshal()})}equals(e){return Be(this.bytes,e.bytes)}async hash(){let{bytes:e}=await Ce.digest(this.bytes);return e}async id(){let e=await this.public.hash();return H(e,"base58btc")}async export(e,r="pkcs-8"){if(r==="pkcs-8"){let n=new ai.default.util.ByteBuffer(this.marshal()),i=ai.default.asn1.fromDer(n),s=ai.default.pki.privateKeyFromAsn1(i),o={algorithm:"aes256",count:1e4,saltSize:128/8,prfAlgorithm:"sha512"};return ai.default.pki.encryptRsaPrivateKey(s,e,o)}else{if(r==="libp2p-key")return await ln(this.bytes,e);throw(0,ga.default)(new Error(`export format '${r}' is not supported`),"ERR_INVALID_EXPORT_FORMAT")}}};async function Q1(t){let e=Lr.pkcs1ToJwk(t),r=await da(e);return new pn(r.privateKey,r.publicKey)}function J1(t){let e=Lr.pkixToJwk(t);return new ci(e)}async function ev(t){let e=await da(t);return new pn(e.privateKey,e.publicKey)}async function tv(t){let e=await vh(t);return new pn(e.privateKey,e.publicKey)}var Aa={};Ge(Aa,{Ed25519PrivateKey:()=>kr,Ed25519PublicKey:()=>pi,generateKeyPair:()=>yv,generateKeyPairFromSeed:()=>Kh,unmarshalEd25519PrivateKey:()=>dv,unmarshalEd25519PublicKey:()=>gv});var _a=O(De(),1);var Ch=O(un(),1);var ke=BigInt(0),j=BigInt(1),Ze=BigInt(2),Bh=BigInt(255),Ah=Ze**BigInt(252)+BigInt("27742317777372353535851937790883648493"),ye={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),P:Ze**Bh-BigInt(19),l:Ah,n:Ah,h:BigInt(8),Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960")};var Rh=Ze**BigInt(256),ui=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752"),_T=BigInt("6853475219497561581579357271197624642482790079785650197046958215289687604742"),rv=BigInt("25063068953384623474111414158702152701244531502492656460079210482610430750235"),nv=BigInt("54469307008909316920995813868745141605393597292927456921205312896311721017578"),iv=BigInt("1159843021668779879193775521855586647937357759715417654439879720876111806838"),sv=BigInt("40440834346308536858101042469323190826248399146238708352240133220865137265952"),Z=class{constructor(e,r,n,i){this.x=e,this.y=r,this.z=n,this.t=i}static fromAffine(e){if(!(e instanceof be))throw new TypeError("ExtendedPoint#fromAffine: expected Point");return e.equals(be.ZERO)?Z.ZERO:new Z(e.x,e.y,j,A(e.x*e.y))}static toAffineBatch(e){let r=cv(e.map(n=>n.z));return e.map((n,i)=>n.toAffine(r[i]))}static normalizeZ(e){return this.toAffineBatch(e).map(this.fromAffine)}equals(e){Th(e);let{x:r,y:n,z:i}=this,{x:s,y:o,z:a}=e,c=A(r*a),u=A(s*i),f=A(n*a),h=A(o*i);return c===u&&f===h}negate(){return new Z(A(-this.x),this.y,this.z,A(-this.t))}double(){let{x:e,y:r,z:n}=this,{a:i}=ye,s=A(e**Ze),o=A(r**Ze),a=A(Ze*A(n**Ze)),c=A(i*s),u=A(A((e+r)**Ze)-s-o),f=c+o,h=f-a,l=c-o,g=A(u*h),p=A(f*l),d=A(u*l),m=A(h*f);return new Z(g,p,m,d)}add(e){Th(e);let{x:r,y:n,z:i,t:s}=this,{x:o,y:a,z:c,t:u}=e,f=A((n-r)*(a+o)),h=A((n+r)*(a-o)),l=A(h-f);if(l===ke)return this.double();let g=A(i*Ze*u),p=A(s*Ze*c),d=p+g,m=h+f,b=p-g,S=A(d*l),I=A(m*b),R=A(d*b),w=A(l*m);return new Z(S,I,w,R)}subtract(e){return this.add(e.negate())}precomputeWindow(e){let r=1+256/e,n=[],i=this,s=i;for(let o=0;o<r;o++){s=i,n.push(s);for(let a=1;a<2**(e-1);a++)s=s.add(i),n.push(s);i=s.double()}return n}wNAF(e,r){!r&&this.equals(Z.BASE)&&(r=be.BASE);let n=r&&r._WINDOW_SIZE||1;if(256%n)throw new Error("Point#wNAF: Invalid precomputation window, must be power of 2");let i=r&&wa.get(r);i||(i=this.precomputeWindow(n),r&&n!==1&&(i=Z.normalizeZ(i),wa.set(r,i)));let s=Z.ZERO,o=Z.ZERO,a=1+256/n,c=2**(n-1),u=BigInt(2**n-1),f=2**n,h=BigInt(n);for(let l=0;l<a;l++){let g=l*c,p=Number(e&u);if(e>>=h,p>c&&(p-=f,e+=j),p===0){let d=i[g];l%2&&(d=d.negate()),o=o.add(d)}else{let d=i[g+Math.abs(p)-1];p<0&&(d=d.negate()),s=s.add(d)}}return Z.normalizeZ([s,o])[0]}multiply(e,r){return this.wNAF(ys(e,ye.l),r)}multiplyUnsafe(e){let r=ys(e,ye.l,!1),n=Z.BASE,i=Z.ZERO;if(r===ke)return i;if(this.equals(i)||r===j)return this;if(this.equals(n))return this.wNAF(r);let s=i,o=this;for(;r>ke;)r&j&&(s=s.add(o)),o=o.double(),r>>=j;return s}isSmallOrder(){return this.multiplyUnsafe(ye.h).equals(Z.ZERO)}isTorsionFree(){return this.multiplyUnsafe(ye.l).equals(Z.ZERO)}toAffine(e=ms(this.z)){let{x:r,y:n,z:i}=this,s=A(r*e),o=A(n*e);if(A(i*e)!==j)throw new Error("invZ was invalid");return new be(s,o)}fromRistrettoBytes(){va()}toRistrettoBytes(){va()}fromRistrettoHash(){va()}};Z.BASE=new Z(ye.Gx,ye.Gy,j,A(ye.Gx*ye.Gy));Z.ZERO=new Z(ke,j,j,ke);function Th(t){if(!(t instanceof Z))throw new TypeError("ExtendedPoint expected")}function ma(t){if(!(t instanceof et))throw new TypeError("RistrettoPoint expected")}function va(){throw new Error("Legacy method: switch to RistrettoPoint")}var et=class{constructor(e){this.ep=e}static calcElligatorRistrettoMap(e){let{d:r}=ye,n=A(ui*e*e),i=A((n+j)*iv),s=BigInt(-1),o=A((s-r*n)*A(n+r)),{isValid:a,value:c}=Ea(i,o),u=A(c*e);gr(u)||(u=A(-u)),a||(c=u),a||(s=n);let f=A(s*(n-j)*sv-o),h=c*c,l=A((c+c)*o),g=A(f*rv),p=A(j-h),d=A(j+h);return new Z(A(l*d),A(p*g),A(g*d),A(l*p))}static hashToCurve(e){e=yr(e,64);let r=ba(e.slice(0,32)),n=this.calcElligatorRistrettoMap(r),i=ba(e.slice(32,64)),s=this.calcElligatorRistrettoMap(i);return new et(n.add(s))}static fromHex(e){e=yr(e,32);let{a:r,d:n}=ye,i="RistrettoPoint.fromHex: the hex is not valid encoding of RistrettoPoint",s=ba(e);if(!fv(fi(s),e)||gr(s))throw new Error(i);let o=A(s*s),a=A(j+r*o),c=A(j-r*o),u=A(a*a),f=A(c*c),h=A(r*n*u-f),{isValid:l,value:g}=Ih(A(h*f)),p=A(g*c),d=A(g*p*h),m=A((s+s)*p);gr(m)&&(m=A(-m));let b=A(a*d),S=A(m*b);if(!l||gr(S)||b===ke)throw new Error(i);return new et(new Z(m,b,j,S))}toRawBytes(){let{x:e,y:r,z:n,t:i}=this.ep,s=A(A(n+r)*A(n-r)),o=A(e*r),{value:a}=Ih(A(s*o**Ze)),c=A(a*s),u=A(a*o),f=A(c*u*i),h;if(gr(i*f)){let g=A(r*ui),p=A(e*ui);e=g,r=p,h=A(c*nv)}else h=u;gr(e*f)&&(r=A(-r));let l=A((n-r)*h);return gr(l)&&(l=A(-l)),fi(l)}toHex(){return hi(this.toRawBytes())}toString(){return this.toHex()}equals(e){ma(e);let r=this.ep,n=e.ep,i=A(r.x*n.y)===A(r.y*n.x),s=A(r.y*n.y)===A(r.x*n.x);return i||s}add(e){return ma(e),new et(this.ep.add(e.ep))}subtract(e){return ma(e),new et(this.ep.subtract(e.ep))}multiply(e){return new et(this.ep.multiply(e))}multiplyUnsafe(e){return new et(this.ep.multiplyUnsafe(e))}};et.BASE=new et(Z.BASE);et.ZERO=new et(Z.ZERO);var wa=new WeakMap,be=class{constructor(e,r){this.x=e,this.y=r}_setWindowSize(e){this._WINDOW_SIZE=e,wa.delete(this)}static fromHex(e,r=!0){let{d:n,P:i}=ye;e=yr(e,32);let s=e.slice();s[31]=e[31]&-129;let o=dn(s);if(r&&o>=i)throw new Error("Expected 0 < hex < P");if(!r&&o>=Rh)throw new Error("Expected 0 < hex < 2**256");let a=A(o*o),c=A(a-j),u=A(n*a+j),{isValid:f,value:h}=Ea(c,u);if(!f)throw new Error("Point.fromHex: invalid y coordinate");let l=(h&j)===j;return(e[31]&128)!==0!==l&&(h=A(-h)),new be(h,o)}static async fromPrivateKey(e){return(await vs(e)).point}toRawBytes(){let e=fi(this.y);return e[31]|=this.x&j?128:0,e}toHex(){return hi(this.toRawBytes())}toX25519(){let{y:e}=this,r=A((j+e)*ms(j-e));return fi(r)}isTorsionFree(){return Z.fromAffine(this).isTorsionFree()}equals(e){return this.x===e.x&&this.y===e.y}negate(){return new be(A(-this.x),this.y)}add(e){return Z.fromAffine(this).add(Z.fromAffine(e)).toAffine()}subtract(e){return this.add(e.negate())}multiply(e){return Z.fromAffine(this).multiply(e,this).toAffine()}};be.BASE=new be(ye.Gx,ye.Gy);be.ZERO=new be(ke,j);var Nr=class{constructor(e,r){this.r=e,this.s=r,this.assertValidity()}static fromHex(e){let r=yr(e,64),n=be.fromHex(r.slice(0,32),!1),i=dn(r.slice(32,64));return new Nr(n,i)}assertValidity(){let{r:e,s:r}=this;if(!(e instanceof be))throw new Error("Expected Point instance");return ys(r,ye.l,!1),this}toRawBytes(){let e=new Uint8Array(64);return e.set(this.r.toRawBytes()),e.set(fi(this.s),32),e}toHex(){return hi(this.toRawBytes())}};function ov(...t){if(!t.every(n=>n instanceof Uint8Array))throw new Error("Expected Uint8Array list");if(t.length===1)return t[0];let e=t.reduce((n,i)=>n+i.length,0),r=new Uint8Array(e);for(let n=0,i=0;n<t.length;n++){let s=t[n];r.set(s,i),i+=s.length}return r}var av=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function hi(t){if(!(t instanceof Uint8Array))throw new Error("Uint8Array expected");let e="";for(let r=0;r<t.length;r++)e+=av[t[r]];return e}function Ph(t){if(typeof t!="string")throw new TypeError("hexToBytes: expected string, got "+typeof t);if(t.length%2)throw new Error("hexToBytes: received invalid unpadded hex");let e=new Uint8Array(t.length/2);for(let r=0;r<e.length;r++){let n=r*2,i=t.slice(n,n+2),s=Number.parseInt(i,16);if(Number.isNaN(s)||s<0)throw new Error("Invalid byte sequence");e[r]=s}return e}function Dh(t){let r=t.toString(16).padStart(64,"0");return Ph(r)}function fi(t){return Dh(t).reverse()}function gr(t){return(A(t)&j)===j}function dn(t){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");return BigInt("0x"+hi(Uint8Array.from(t).reverse()))}function ba(t){return A(dn(t)&Ze**Bh-j)}function A(t,e=ye.P){let r=t%e;return r>=ke?r:e+r}function ms(t,e=ye.P){if(t===ke||e<=ke)throw new Error(`invert: expected positive integers, got n=${t} mod=${e}`);let r=A(t,e),n=e,i=ke,s=j,o=j,a=ke;for(;r!==ke;){let u=n/r,f=n%r,h=i-o*u,l=s-a*u;n=r,r=f,i=o,s=a,o=h,a=l}if(n!==j)throw new Error("invert: does not exist");return A(i,e)}function cv(t,e=ye.P){let r=new Array(t.length),n=t.reduce((s,o,a)=>o===ke?s:(r[a]=s,A(s*o,e)),j),i=ms(n,e);return t.reduceRight((s,o,a)=>o===ke?s:(r[a]=A(s*r[a],e),A(s*o,e)),i),r}function Ft(t,e){let{P:r}=ye,n=t;for(;e-- >ke;)n*=n,n%=r;return n}function uv(t){let{P:e}=ye,r=BigInt(5),n=BigInt(10),i=BigInt(20),s=BigInt(40),o=BigInt(80),c=t*t%e*t%e,u=Ft(c,Ze)*c%e,f=Ft(u,j)*t%e,h=Ft(f,r)*f%e,l=Ft(h,n)*h%e,g=Ft(l,i)*l%e,p=Ft(g,s)*g%e,d=Ft(p,o)*p%e,m=Ft(d,o)*p%e,b=Ft(m,n)*h%e;return{pow_p_5_8:Ft(b,Ze)*t%e,b2:c}}function Ea(t,e){let r=A(e*e*e),n=A(r*r*e),i=uv(t*n).pow_p_5_8,s=A(t*r*i),o=A(e*s*s),a=s,c=A(s*ui),u=o===t,f=o===A(-t),h=o===A(-t*ui);return u&&(s=a),(f||h)&&(s=c),gr(s)&&(s=A(-s)),{isValid:u||f,value:s}}function Ih(t){return Ea(j,t)}async function xa(...t){let e=await li.sha512(ov(...t)),r=dn(e);return A(r,ye.l)}function fv(t,e){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function yr(t,e){let r=t instanceof Uint8Array?Uint8Array.from(t):Ph(t);if(typeof e=="number"&&r.length!==e)throw new Error(`Expected ${e} bytes`);return r}function ys(t,e,r=!0){if(!e)throw new TypeError("Specify max value");if(typeof t=="number"&&Number.isSafeInteger(t)&&(t=BigInt(t)),typeof t=="bigint"&&t<e){if(r){if(ke<t)return t}else if(ke<=t)return t}throw new TypeError("Expected valid scalar: 0 < scalar < max")}function hv(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}async function vs(t){if(t=typeof t=="bigint"||typeof t=="number"?Dh(ys(t,Rh)):yr(t),t.length!==32)throw new Error("Expected 32 bytes");let e=await li.sha512(t),r=hv(e.slice(0,32)),n=e.slice(32,64),i=A(dn(r),ye.l),s=be.BASE.multiply(i),o=s.toRawBytes();return{head:r,prefix:n,scalar:i,point:s,pointBytes:o}}async function Sa(t){return(await vs(t)).pointBytes}async function Mh(t,e){t=yr(t);let{prefix:r,scalar:n,pointBytes:i}=await vs(e),s=await xa(r,t),o=be.BASE.multiply(s),a=await xa(o.toRawBytes(),i,t),c=A(s+a*n,ye.l);return new Nr(o,c).toRawBytes()}async function Lh(t,e,r){e=yr(e),r instanceof be||(r=be.fromHex(r,!1));let{r:n,s:i}=t instanceof Nr?t.assertValidity():Nr.fromHex(t),s=Z.BASE.multiplyUnsafe(i),o=await xa(n.toRawBytes(),r.toRawBytes(),e),a=Z.fromAffine(r).multiplyUnsafe(o);return Z.fromAffine(n).add(a).subtract(s).multiplyUnsafe(ye.h).equals(Z.ZERO)}be.BASE._setWindowSize(8);var dr={node:Ch.default,web:typeof self=="object"&&"crypto"in self?self.crypto:void 0},li={TORSION_SUBGROUP:["0100000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac037a","0000000000000000000000000000000000000000000000000000000000000080","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc05","ecffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff7f","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc85","0000000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac03fa"],bytesToHex:hi,getExtendedPublicKey:vs,mod:A,invert:ms,hashToPrivateScalar:t=>{if(t=yr(t),t.length<40||t.length>1024)throw new Error("Expected 40-1024 bytes of private key as per FIPS 186");let e=A(dn(t),ye.l);if(e===ke||e===j)throw new Error("Invalid private key");return e},randomBytes:(t=32)=>{if(dr.web)return dr.web.getRandomValues(new Uint8Array(t));if(dr.node){let{randomBytes:e}=dr.node;return new Uint8Array(e(t).buffer)}else throw new Error("The environment doesn't have randomBytes function")},randomPrivateKey:()=>li.randomBytes(32),sha512:async t=>{if(dr.web){let e=await dr.web.subtle.digest("SHA-512",t.buffer);return new Uint8Array(e)}else{if(dr.node)return Uint8Array.from(dr.node.createHash("sha512").update(t).digest());throw new Error("The environment doesn't have sha512 function")}},precompute(t=8,e=be.BASE){let r=e.equals(be.BASE)?e:new be(e.x,e.y);return r._setWindowSize(t),r.multiply(Ze),r}};var gn=32,Qt=64,bs=32;async function Nh(){let t=li.randomPrivateKey(),e=await Sa(t);return{privateKey:Oh(t,e),publicKey:e}}async function kh(t){if(t.length!==bs)throw new TypeError('"seed" must be 32 bytes in length.');if(!(t instanceof Uint8Array))throw new TypeError('"seed" must be a node.js Buffer, or Uint8Array.');let e=t,r=await Sa(e);return{privateKey:Oh(e,r),publicKey:r}}async function Fh(t,e){let r=t.slice(0,bs);return await Mh(e,r)}async function Uh(t,e,r){return await Lh(e,r,t)}function Oh(t,e){let r=new Uint8Array(Qt);for(let n=0;n<bs;n++)r[n]=t[n],r[bs+n]=e[n];return r}var pi=class{constructor(e){this._key=yn(e,gn)}async verify(e,r){return await Uh(this._key,r,e)}marshal(){return this._key}get bytes(){return Bt.encode({Type:Ee.Ed25519,Data:this.marshal()})}equals(e){return Be(this.bytes,e.bytes)}async hash(){let{bytes:e}=await Ce.digest(this.bytes);return e}},kr=class{constructor(e,r){this._key=yn(e,Qt),this._publicKey=yn(r,gn)}async sign(e){return await Fh(this._key,e)}get public(){return new pi(this._publicKey)}marshal(){return this._key}get bytes(){return Rt.encode({Type:Ee.Ed25519,Data:this.marshal()})}equals(e){return Be(this.bytes,e.bytes)}async hash(){let{bytes:e}=await Ce.digest(this.bytes);return e}async id(){let e=await cr.digest(this.public.bytes);return Ae.encode(e.bytes).substring(1)}async export(e,r="libp2p-key"){if(r==="libp2p-key")return await ln(this.bytes,e);throw(0,_a.default)(new Error(`export format '${r}' is not supported`),"ERR_INVALID_EXPORT_FORMAT")}};function dv(t){if(t.length>Qt){t=yn(t,Qt+gn);let n=t.slice(0,Qt),i=t.slice(Qt,t.length);return new kr(n,i)}t=yn(t,Qt);let e=t.slice(0,Qt),r=t.slice(gn);return new kr(e,r)}function gv(t){return t=yn(t,gn),new pi(t)}async function yv(){let{privateKey:t,publicKey:e}=await Nh();return new kr(t,e)}async function Kh(t){let{privateKey:e,publicKey:r}=await kh(t);return new kr(e,r)}function yn(t,e){if(t=Uint8Array.from(t??[]),t.length!==e)throw(0,_a.default)(new Error(`Key must be a Uint8Array of length ${e}, got ${t.length}`),"ERR_INVALID_KEY_TYPE");return t}var Ma={};Ge(Ma,{Secp256k1PrivateKey:()=>bi,Secp256k1PublicKey:()=>vi,generateKeyPair:()=>Mv,unmarshalSecp256k1PrivateKey:()=>Pv,unmarshalSecp256k1PublicKey:()=>Dv});var sl=O(De(),1);var wn=O(De(),1);var mv=O(un(),1);var X=BigInt(0),ce=BigInt(1),Te=BigInt(2),gi=BigInt(3),vv=BigInt(8),Ca=Te**BigInt(256),he={a:X,b:BigInt(7),P:Ca-Te**BigInt(32)-BigInt(977),n:Ca-BigInt("432420386565659656852420866394968145599"),h:ce,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee")};function qh(t){let{a:e,b:r}=he,n=M(t*t),i=M(n*t);return M(i+e*t+r)}var ws=he.a===X,te=class{constructor(e,r,n){this.x=e,this.y=r,this.z=n}static fromAffine(e){if(!(e instanceof re))throw new TypeError("JacobianPoint#fromAffine: expected Point");return new te(e.x,e.y,ce)}static toAffineBatch(e){let r=Ev(e.map(n=>n.z));return e.map((n,i)=>n.toAffine(r[i]))}static normalizeZ(e){return te.toAffineBatch(e).map(te.fromAffine)}equals(e){if(!(e instanceof te))throw new TypeError("JacobianPoint expected");let{x:r,y:n,z:i}=this,{x:s,y:o,z:a}=e,c=M(i**Te),u=M(a**Te),f=M(r*u),h=M(s*c),l=M(M(n*a)*u),g=M(M(o*i)*c);return f===h&&l===g}negate(){return new te(this.x,M(-this.y),this.z)}double(){let{x:e,y:r,z:n}=this,i=M(e**Te),s=M(r**Te),o=M(s**Te),a=M(Te*(M((e+s)**Te)-i-o)),c=M(gi*i),u=M(c**Te),f=M(u-Te*a),h=M(c*(a-f)-vv*o),l=M(Te*r*n);return new te(f,h,l)}add(e){if(!(e instanceof te))throw new TypeError("JacobianPoint expected");let{x:r,y:n,z:i}=this,{x:s,y:o,z:a}=e;if(s===X||o===X)return this;if(r===X||n===X)return e;let c=M(i**Te),u=M(a**Te),f=M(r*u),h=M(s*c),l=M(M(n*a)*u),g=M(M(o*i)*c),p=M(h-f),d=M(g-l);if(p===X)return d===X?this.double():te.ZERO;let m=M(p**Te),b=M(p*m),S=M(f*m),I=M(d**Te-b-Te*S),R=M(d*(S-I)-l*b),w=M(i*a*p);return new te(I,R,w)}subtract(e){return this.add(e.negate())}multiplyUnsafe(e){let r=Gh(e),n=te.BASE,i=te.ZERO;if(r===X)return i;if(r===ce)return this;if(!ws){let l=i,g=this;for(;r>X;)r&ce&&(l=l.add(g)),g=g.double(),r>>=ce;return l}let{k1neg:s,k1:o,k2neg:a,k2:c}=Wh(r),u=i,f=i,h=this;for(;o>X||c>X;)o&ce&&(u=u.add(h)),c&ce&&(f=f.add(h)),h=h.double(),o>>=ce,c>>=ce;return s&&(u=u.negate()),a&&(f=f.negate()),f=new te(M(f.x*he.beta),f.y,f.z),u.add(f)}precomputeWindow(e){let r=ws?128/e+1:256/e+1,n=[],i=this,s=i;for(let o=0;o<r;o++){s=i,n.push(s);for(let a=1;a<2**(e-1);a++)s=s.add(i),n.push(s);i=s.double()}return n}wNAF(e,r){!r&&this.equals(te.BASE)&&(r=re.BASE);let n=r&&r._WINDOW_SIZE||1;if(256%n)throw new Error("Point#wNAF: Invalid precomputation window, must be power of 2");let i=r&&Ba.get(r);i||(i=this.precomputeWindow(n),r&&n!==1&&(i=te.normalizeZ(i),Ba.set(r,i)));let s=te.ZERO,o=te.ZERO,a=1+(ws?128/n:256/n),c=2**(n-1),u=BigInt(2**n-1),f=2**n,h=BigInt(n);for(let l=0;l<a;l++){let g=l*c,p=Number(e&u);if(e>>=h,p>c&&(p-=f,e+=ce),p===0){let d=i[g];l%2&&(d=d.negate()),o=o.add(d)}else{let d=i[g+Math.abs(p)-1];p<0&&(d=d.negate()),s=s.add(d)}}return{p:s,f:o}}multiply(e,r){let n=Gh(e),i,s;if(ws){let{k1neg:o,k1:a,k2neg:c,k2:u}=Wh(n),{p:f,f:h}=this.wNAF(a,r),{p:l,f:g}=this.wNAF(u,r);o&&(f=f.negate()),c&&(l=l.negate()),l=new te(M(l.x*he.beta),l.y,l.z),i=f.add(l),s=h.add(g)}else{let{p:o,f:a}=this.wNAF(n,r);i=o,s=a}return te.normalizeZ([i,s])[0]}toAffine(e=bn(this.z)){let{x:r,y:n,z:i}=this,s=e,o=M(s*s),a=M(o*s),c=M(r*o),u=M(n*a);if(M(i*s)!==ce)throw new Error("invZ was invalid");return new re(c,u)}};te.BASE=new te(he.Gx,he.Gy,ce);te.ZERO=new te(X,ce,X);var Ba=new WeakMap,re=class{constructor(e,r){this.x=e,this.y=r}_setWindowSize(e){this._WINDOW_SIZE=e,Ba.delete(this)}static fromCompressedHex(e){let r=e.length===32,n=dt(r?e:e.subarray(1));if(!Ia(n))throw new Error("Point is not on curve");let i=qh(n),s=xv(i),o=(s&ce)===ce;r?o&&(s=M(-s)):(e[0]&1)===1!==o&&(s=M(-s));let a=new re(n,s);return a.assertValidity(),a}static fromUncompressedHex(e){let r=dt(e.subarray(1,33)),n=dt(e.subarray(33,65)),i=new re(r,n);return i.assertValidity(),i}static fromHex(e){let r=Jt(e),n=r.length,i=r[0];if(n===32||n===33&&(i===2||i===3))return this.fromCompressedHex(r);if(n===65&&i===4)return this.fromUncompressedHex(r);throw new Error(`Point.fromHex: received invalid point. Expected 32-33 compressed bytes or 65 uncompressed bytes, not ${n}`)}static fromPrivateKey(e){return re.BASE.multiply(yi(e))}static fromSignature(e,r,n){e=Jt(e);let i=$h(e),{r:s,s:o}=Yh(r);if(n!==0&&n!==1)throw new Error("Cannot recover signature: invalid recovery bit");if(i===X)throw new Error("Cannot recover signature: msgHash cannot be 0");let a=n&1?"03":"02",c=re.fromHex(a+Fr(s)),{n:u}=he,f=bn(s,u),h=M(-i*f,u),l=M(o*f,u),g=re.BASE.multiplyAndAddUnsafe(c,h,l);if(!g)throw new Error("Cannot recover signature: point at infinify");return g.assertValidity(),g}toRawBytes(e=!1){return mr(this.toHex(e))}toHex(e=!1){let r=Fr(this.x);return e?`${this.y&ce?"03":"02"}${r}`:`04${r}${Fr(this.y)}`}toHexX(){return this.toHex(!0).slice(2)}toRawX(){return this.toRawBytes(!0).slice(1)}assertValidity(){let e="Point is not on elliptic curve",{x:r,y:n}=this;if(!Ia(r)||!Ia(n))throw new Error(e);let i=M(n*n),s=qh(r);if(M(i-s)!==X)throw new Error(e)}equals(e){return this.x===e.x&&this.y===e.y}negate(){return new re(this.x,M(-this.y))}double(){return te.fromAffine(this).double().toAffine()}add(e){return te.fromAffine(this).add(te.fromAffine(e)).toAffine()}subtract(e){return this.add(e.negate())}multiply(e){return te.fromAffine(this).multiply(e,this).toAffine()}multiplyAndAddUnsafe(e,r,n){let i=te.fromAffine(this),s=r===X||r===ce||this!==re.BASE?i.multiplyUnsafe(r):i.multiply(r),o=te.fromAffine(e).multiplyUnsafe(n),a=s.add(o);return a.equals(te.ZERO)?void 0:a.toAffine()}};re.BASE=new re(he.Gx,he.Gy);re.ZERO=new re(X,X);function Vh(t){return Number.parseInt(t[0],16)>=8?"00"+t:t}function zh(t){if(t.length<2||t[0]!==2)throw new Error(`Invalid signature integer tag: ${vn(t)}`);let e=t[1],r=t.subarray(2,e+2);if(!e||r.length!==e)throw new Error("Invalid signature integer: wrong length");if(r[0]===0&&r[1]<=127)throw new Error("Invalid signature integer: trailing length");return{data:dt(r),left:t.subarray(e+2)}}function bv(t){if(t.length<2||t[0]!=48)throw new Error(`Invalid signature tag: ${vn(t)}`);if(t[1]!==t.length-2)throw new Error("Invalid signature: incorrect length");let{data:e,left:r}=zh(t.subarray(2)),{data:n,left:i}=zh(r);if(i.length)throw new Error(`Invalid signature: left bytes after parsing: ${vn(i)}`);return{r:e,s:n}}var Ut=class{constructor(e,r){this.r=e,this.s=r,this.assertValidity()}static fromCompact(e){let r=Ss(e),n="Signature.fromCompact";if(typeof e!="string"&&!r)throw new TypeError(`${n}: Expected string or Uint8Array`);let i=r?vn(e):e;if(i.length!==128)throw new Error(`${n}: Expected 64-byte hex`);return new Ut(_s(i.slice(0,64)),_s(i.slice(64,128)))}static fromDER(e){let r=Ss(e);if(typeof e!="string"&&!r)throw new TypeError("Signature.fromDER: Expected string or Uint8Array");let{r:n,s:i}=bv(r?e:mr(e));return new Ut(n,i)}static fromHex(e){return this.fromDER(e)}assertValidity(){let{r:e,s:r}=this;if(!mi(e))throw new Error("Invalid Signature: r must be 0 < r < n");if(!mi(r))throw new Error("Invalid Signature: s must be 0 < s < n")}hasHighS(){let e=he.n>>ce;return this.s>e}normalizeS(){return this.hasHighS()?new Ut(this.r,he.n-this.s):this}toDERRawBytes(e=!1){return mr(this.toDERHex(e))}toDERHex(e=!1){let r=Vh(di(this.s));if(e)return r;let n=Vh(di(this.r)),i=di(n.length/2),s=di(r.length/2);return`30${di(n.length/2+r.length/2+4)}02${i}${n}02${s}${r}`}toRawBytes(){return this.toDERRawBytes()}toHex(){return this.toDERHex()}toCompactRawBytes(){return mr(this.toCompactHex())}toCompactHex(){return Fr(this.r)+Fr(this.s)}};function mn(...t){if(!t.every(Ss))throw new Error("Uint8Array list expected");if(t.length===1)return t[0];let e=t.reduce((n,i)=>n+i.length,0),r=new Uint8Array(e);for(let n=0,i=0;n<t.length;n++){let s=t[n];r.set(s,i),i+=s.length}return r}function Ss(t){return t instanceof Uint8Array}var wv=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function vn(t){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");let e="";for(let r=0;r<t.length;r++)e+=wv[t[r]];return e}function Fr(t){if(t>Ca)throw new Error("Expected number < 2^256");return t.toString(16).padStart(64,"0")}function Ta(t){return mr(Fr(t))}function di(t){let e=t.toString(16);return e.length&1?`0${e}`:e}function _s(t){if(typeof t!="string")throw new TypeError("hexToNumber: expected string, got "+typeof t);return BigInt(`0x${t}`)}function mr(t){if(typeof t!="string")throw new TypeError("hexToBytes: expected string, got "+typeof t);if(t.length%2)throw new Error("hexToBytes: received invalid unpadded hex"+t.length);let e=new Uint8Array(t.length/2);for(let r=0;r<e.length;r++){let n=r*2,i=t.slice(n,n+2),s=Number.parseInt(i,16);if(Number.isNaN(s)||s<0)throw new Error("Invalid byte sequence");e[r]=s}return e}function dt(t){return _s(vn(t))}function Jt(t){return t instanceof Uint8Array?Uint8Array.from(t):mr(t)}function Gh(t){if(typeof t=="number"&&Number.isSafeInteger(t)&&t>0)return BigInt(t);if(typeof t=="bigint"&&mi(t))return t;throw new TypeError("Expected valid private scalar: 0 < scalar < curve.n")}function M(t,e=he.P){let r=t%e;return r>=X?r:e+r}function pt(t,e){let{P:r}=he,n=t;for(;e-- >X;)n*=n,n%=r;return n}function xv(t){let{P:e}=he,r=BigInt(6),n=BigInt(11),i=BigInt(22),s=BigInt(23),o=BigInt(44),a=BigInt(88),c=t*t*t%e,u=c*c*t%e,f=pt(u,gi)*u%e,h=pt(f,gi)*u%e,l=pt(h,Te)*c%e,g=pt(l,n)*l%e,p=pt(g,i)*g%e,d=pt(p,o)*p%e,m=pt(d,a)*d%e,b=pt(m,o)*p%e,S=pt(b,gi)*u%e,I=pt(S,s)*g%e,R=pt(I,r)*c%e;return pt(R,Te)}function bn(t,e=he.P){if(t===X||e<=X)throw new Error(`invert: expected positive integers, got n=${t} mod=${e}`);let r=M(t,e),n=e,i=X,s=ce,o=ce,a=X;for(;r!==X;){let u=n/r,f=n%r,h=i-o*u,l=s-a*u;n=r,r=f,i=o,s=a,o=h,a=l}if(n!==ce)throw new Error("invert: does not exist");return M(i,e)}function Ev(t,e=he.P){let r=new Array(t.length),n=t.reduce((s,o,a)=>o===X?s:(r[a]=s,M(s*o,e)),ce),i=bn(n,e);return t.reduceRight((s,o,a)=>o===X?s:(r[a]=M(s*r[a],e),M(s*o,e)),i),r}var Hh=(t,e)=>(t+e/Te)/e,xs=Te**BigInt(128);function Wh(t){let{n:e}=he,r=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-ce*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=r,o=Hh(s*t,e),a=Hh(-n*t,e),c=M(t-o*r-a*i,e),u=M(-o*n-a*s,e),f=c>xs,h=u>xs;if(f&&(c=e-c),h&&(u=e-u),c>xs||u>xs)throw new Error("splitScalarEndo: Endomorphism failed, k="+t);return{k1neg:f,k1:c,k2neg:h,k2:u}}function $h(t){let{n:e}=he,n=t.length*8-256,i=dt(t);return n>0&&(i=i>>BigInt(n)),i>=e&&(i-=e),i}var Ra=class{constructor(){this.v=new Uint8Array(32).fill(1),this.k=new Uint8Array(32).fill(0),this.counter=0}hmac(...e){return at.hmacSha256(this.k,...e)}hmacSync(...e){if(typeof at.hmacSha256Sync!="function")throw new Error("utils.hmacSha256Sync is undefined, you need to set it");let r=at.hmacSha256Sync(this.k,...e);if(r instanceof Promise)throw new Error("To use sync sign(), ensure utils.hmacSha256 is sync");return r}incr(){if(this.counter>=1e3)throw new Error("Tried 1,000 k values for sign(), all were invalid");this.counter+=1}async reseed(e=new Uint8Array){this.k=await this.hmac(this.v,Uint8Array.from([0]),e),this.v=await this.hmac(this.v),e.length!==0&&(this.k=await this.hmac(this.v,Uint8Array.from([1]),e),this.v=await this.hmac(this.v))}reseedSync(e=new Uint8Array){this.k=this.hmacSync(this.v,Uint8Array.from([0]),e),this.v=this.hmacSync(this.v),e.length!==0&&(this.k=this.hmacSync(this.v,Uint8Array.from([1]),e),this.v=this.hmacSync(this.v))}async generate(){return this.incr(),this.v=await this.hmac(this.v),this.v}generateSync(){return this.incr(),this.v=this.hmacSync(this.v),this.v}};function mi(t){return X<t&&t<he.n}function Ia(t){return X<t&&t<he.P}function Sv(t,e,r){let n=dt(t);if(!mi(n))return;let{n:i}=he,s=re.BASE.multiply(n),o=M(s.x,i);if(o===X)return;let a=M(bn(n,i)*M(e+r*o,i),i);if(a===X)return;let c=new Ut(o,a),u=(s.x===c.r?0:2)|Number(s.y&ce);return{sig:c,recovery:u}}function yi(t){let e;if(typeof t=="bigint")e=t;else if(typeof t=="number"&&Number.isSafeInteger(t)&&t>0)e=BigInt(t);else if(typeof t=="string"){if(t.length!==64)throw new Error("Expected 32 bytes of private key");e=_s(t)}else if(Ss(t)){if(t.length!==32)throw new Error("Expected 32 bytes of private key");e=dt(t)}else throw new TypeError("Expected valid private key");if(!mi(e))throw new Error("Expected private key: 0 < key < n");return e}function _v(t){return t instanceof re?(t.assertValidity(),t):re.fromHex(t)}function Yh(t){if(t instanceof Ut)return t.assertValidity(),t;try{return Ut.fromDER(t)}catch{return Ut.fromCompact(t)}}function Pa(t,e=!1){return re.fromPrivateKey(t).toRawBytes(e)}function Zh(t){let e=t.length>32?t.slice(0,32):t;return dt(e)}function Av(t){let e=Zh(t),r=M(e,he.n);return jh(r<X?e:r)}function jh(t){if(typeof t!="bigint")throw new Error("Expected bigint");let e=Fr(t);return mr(e)}function Tv(t,e,r){if(t==null)throw new Error(`sign: expected valid message hash, not "${t}"`);let n=Jt(t),i=yi(e),s=[jh(i),Av(n)];if(r!=null){r===!0&&(r=at.randomBytes(32));let c=Jt(r);if(c.length!==32)throw new Error("sign: Expected 32 bytes of extra data");s.push(c)}let o=mn(...s),a=Zh(n);return{seed:o,m:a,d:i}}function Iv(t,e){let{sig:r,recovery:n}=t,{canonical:i,der:s,recovered:o}=Object.assign({canonical:!0,der:!0},e);i&&r.hasHighS()&&(r=r.normalizeS(),n^=1);let a=s?r.toDERRawBytes():r.toCompactRawBytes();return o?[a,n]:a}async function Xh(t,e,r={}){let{seed:n,m:i,d:s}=Tv(t,e,r.extraEntropy),o,a=new Ra;for(await a.reseed(n);!(o=Sv(await a.generate(),i,s));)await a.reseed();return Iv(o,r)}var Cv={strict:!0};function Qh(t,e,r,n=Cv){let i;try{i=Yh(t),e=Jt(e)}catch{return!1}let{r:s,s:o}=i;if(n.strict&&i.hasHighS())return!1;let a=$h(e);if(a===X)return!1;let c;try{c=_v(r)}catch{return!1}let{n:u}=he,f=bn(o,u),h=M(a*f,u),l=M(s*f,u),g=re.BASE.multiplyAndAddUnsafe(c,h,l);return g?M(g.x,u)===s:!1}re.BASE._setWindowSize(8);var ot={node:mv,web:typeof self=="object"&&"crypto"in self?self.crypto:void 0};var Es={},at={isValidPrivateKey(t){try{return yi(t),!0}catch{return!1}},privateAdd:(t,e)=>{let r=yi(t),n=dt(Jt(e));return Ta(M(r+n,he.n))},privateNegate:t=>{let e=yi(t);return Ta(he.n-e)},pointAddScalar:(t,e,r)=>{let n=re.fromHex(t),i=dt(Jt(e)),s=re.BASE.multiplyAndAddUnsafe(n,i,ce);if(!s)throw new Error("Tweaked point at infinity");return s.toRawBytes(r)},pointMultiply:(t,e,r)=>{let n=re.fromHex(t),i=dt(Jt(e));return n.multiply(i).toRawBytes(r)},hashToPrivateKey:t=>{if(t=Jt(t),t.length<40||t.length>1024)throw new Error("Expected 40-1024 bytes of private key as per FIPS 186");let e=M(dt(t),he.n-ce)+ce;return Ta(e)},randomBytes:(t=32)=>{if(ot.web)return ot.web.getRandomValues(new Uint8Array(t));if(ot.node){let{randomBytes:e}=ot.node;return Uint8Array.from(e(t))}else throw new Error("The environment doesn't have randomBytes function")},randomPrivateKey:()=>at.hashToPrivateKey(at.randomBytes(40)),bytesToHex:vn,hexToBytes:mr,concatBytes:mn,mod:M,invert:bn,sha256:async(...t)=>{if(ot.web){let e=await ot.web.subtle.digest("SHA-256",mn(...t));return new Uint8Array(e)}else if(ot.node){let{createHash:e}=ot.node,r=e("sha256");return t.forEach(n=>r.update(n)),Uint8Array.from(r.digest())}else throw new Error("The environment doesn't have sha256 function")},hmacSha256:async(t,...e)=>{if(ot.web){let r=await ot.web.subtle.importKey("raw",t,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),n=mn(...e),i=await ot.web.subtle.sign("HMAC",r,n);return new Uint8Array(i)}else if(ot.node){let{createHmac:r}=ot.node,n=r("sha256",t);return e.forEach(i=>n.update(i)),Uint8Array.from(n.digest())}else throw new Error("The environment doesn't have hmac-sha256 function")},sha256Sync:void 0,hmacSha256Sync:void 0,taggedHash:async(t,...e)=>{let r=Es[t];if(r===void 0){let n=await at.sha256(Uint8Array.from(t,i=>i.charCodeAt(0)));r=mn(n,n),Es[t]=r}return at.sha256(r,...e)},taggedHashSync:(t,...e)=>{if(typeof at.sha256Sync!="function")throw new Error("utils.sha256Sync is undefined, you need to set it");let r=Es[t];if(r===void 0){let n=at.sha256Sync(Uint8Array.from(t,i=>i.charCodeAt(0)));r=mn(n,n),Es[t]=r}return at.sha256Sync(r,...e)},precompute(t=8,e=re.BASE){let r=e===re.BASE?e:new re(e.x,e.y);return r._setWindowSize(t),r.multiply(gi),r}};function Jh(){return at.randomPrivateKey()}async function el(t,e){let{digest:r}=await Ce.digest(e);try{return await Xh(r,t)}catch(n){throw(0,wn.default)(n,"ERR_INVALID_INPUT")}}async function tl(t,e,r){try{let{digest:n}=await Ce.digest(r);return Qh(e,n,t)}catch(n){throw(0,wn.default)(n,"ERR_INVALID_INPUT")}}function rl(t){return re.fromHex(t).toRawBytes(!0)}function nl(t){try{Pa(t,!0)}catch(e){throw(0,wn.default)(e,"ERR_INVALID_PRIVATE_KEY")}}function Da(t){try{re.fromHex(t)}catch(e){throw(0,wn.default)(e,"ERR_INVALID_PUBLIC_KEY")}}function il(t){try{return Pa(t,!0)}catch(e){throw(0,wn.default)(e,"ERR_INVALID_PRIVATE_KEY")}}var vi=class{constructor(e){Da(e),this._key=e}async verify(e,r){return await tl(this._key,r,e)}marshal(){return rl(this._key)}get bytes(){return Bt.encode({Type:Ee.Secp256k1,Data:this.marshal()})}equals(e){return Be(this.bytes,e.bytes)}async hash(){let{bytes:e}=await Ce.digest(this.bytes);return e}},bi=class{constructor(e,r){this._key=e,this._publicKey=r??il(e),nl(this._key),Da(this._publicKey)}async sign(e){return await el(this._key,e)}get public(){return new vi(this._publicKey)}marshal(){return this._key}get bytes(){return Rt.encode({Type:Ee.Secp256k1,Data:this.marshal()})}equals(e){return Be(this.bytes,e.bytes)}async hash(){let{bytes:e}=await Ce.digest(this.bytes);return e}async id(){let e=await this.public.hash();return H(e,"base58btc")}async export(e,r="libp2p-key"){if(r==="libp2p-key")return await ln(this.bytes,e);throw(0,sl.default)(new Error(`export format '${r}' is not supported`),"ERR_INVALID_EXPORT_FORMAT")}};function Pv(t){return new bi(t)}function Dv(t){return new vi(t)}async function Mv(){let t=await Jh();return new bi(t)}var Ur={rsa:ya,ed25519:Aa,secp256k1:Ma};function al(t){let e=Object.keys(Ur).join(" / ");return(0,ol.default)(new Error(`invalid or unsupported key type ${t}. Must be ${e}`),"ERR_UNSUPPORTED_KEY_TYPE")}function wi(t){let e=Bt.decode(t),r=e.Data;switch(e.Type){case Ee.RSA:return Ur.rsa.unmarshalRsaPublicKey(r);case Ee.Ed25519:return Ur.ed25519.unmarshalEd25519PublicKey(r);case Ee.Secp256k1:return Ur.secp256k1.unmarshalSecp256k1PublicKey(r);default:throw al(e.Type)}}async function As(t){let e=Rt.decode(t),r=e.Data;switch(e.Type){case Ee.RSA:return await Ur.rsa.unmarshalRsaPrivateKey(r);case Ee.Ed25519:return Ur.ed25519.unmarshalEd25519PrivateKey(r);case Ee.Secp256k1:return Ur.secp256k1.unmarshalSecp256k1PrivateKey(r);default:throw al(e.Type)}}var Ts=O(Or(),1);var ml={ERR_SIGNATURE_NOT_VALID:"ERR_SIGNATURE_NOT_VALID"};var xi;(function(t){t.codec=()=>Ne({1:{name:"publicKey",codec:xe},2:{name:"payloadType",codec:xe},3:{name:"payload",codec:xe},5:{name:"signature",codec:xe}}),t.encode=e=>Le(e,t.codec()),t.decode=e=>Me(e,t.codec())})(xi||(xi={}));var Yv=O(De(),1);var vl=Symbol.for("@libp2p/peer-id");var bl=Object.values(on).map(t=>t.decoder).reduce((t,e)=>t.or(e),on.identity.decoder),wl=114,ka=36,Fa=37,Ei=class{constructor(e){this.type=e.type,this.multihash=e.multihash,this.privateKey=e.privateKey,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}get[vl](){return!0}toString(){return this.string==null&&(this.string=Ae.encode(this.multihash.bytes).slice(1)),this.string}toCID(){return ue.createV1(wl,this.multihash)}toBytes(){return this.multihash.bytes}toJSON(){return this.toString()}equals(e){if(e instanceof Uint8Array)return Be(this.multihash.bytes,e);if(typeof e=="string")return er(e).equals(this);if(e?.multihash?.bytes!=null)return Be(this.multihash.bytes,e.multihash.bytes);throw new Error("not valid Id")}},xn=class extends Ei{constructor(e){super({...e,type:"RSA"}),this.type="RSA",this.publicKey=e.publicKey}},En=class extends Ei{constructor(e){super({...e,type:"Ed25519"}),this.type="Ed25519",this.publicKey=e.multihash.digest}},Sn=class extends Ei{constructor(e){super({...e,type:"secp256k1"}),this.type="secp256k1",this.publicKey=e.multihash.digest}};function er(t,e){if(e=e??bl,t.charAt(0)==="1"||t.charAt(0)==="Q"){let r=Ar(Ae.decode(`z${t}`));return t.startsWith("12D")?new En({multihash:r}):t.startsWith("16U")?new Sn({multihash:r}):new xn({multihash:r})}return Ot(bl.decode(t))}function Ot(t){try{let e=Ar(t);if(e.code===cr.code){if(e.digest.length===ka)return new En({multihash:e});if(e.digest.length===Fa)return new Sn({multihash:e})}if(e.code===Ce.code)return new xn({multihash:e})}catch{return Zv(ue.decode(t))}throw new Error("Supplied PeerID CID is invalid")}function Zv(t){if(t==null||t.multihash==null||t.version==null||t.version===1&&t.code!==wl)throw new Error("Supplied PeerID CID is invalid");let e=t.multihash;if(e.code===Ce.code)return new xn({multihash:t.multihash});if(e.code===cr.code){if(e.digest.length===ka)return new En({multihash:t.multihash});if(e.digest.length===Fa)return new Sn({multihash:t.multihash})}throw new Error("Supplied PeerID CID is invalid")}async function xl(t,e){return t.length===ka?new En({multihash:It(cr.code,t),privateKey:e}):t.length===Fa?new Sn({multihash:It(cr.code,t),privateKey:e}):new xn({multihash:await Ce.digest(t),publicKey:t,privateKey:e})}var jv,gt=class{constructor(e){let{peerId:r,payloadType:n,payload:i,signature:s}=e;this.peerId=r,this.payloadType=n,this.payload=i,this.signature=s}marshal(){if(this.peerId.publicKey==null)throw new Error("Missing public key");return this.marshaled==null&&(this.marshaled=xi.encode({publicKey:this.peerId.publicKey,payloadType:this.payloadType,payload:this.payload,signature:this.signature})),this.marshaled}equals(e){return Be(this.marshal(),e.marshal())}async validate(e){let r=Sl(e,this.payloadType,this.payload);if(this.peerId.publicKey==null)throw new Error("Missing public key");return await wi(this.peerId.publicKey).verify(r,this.signature)}};jv=gt;gt.createFromProtobuf=async t=>{let e=xi.decode(t),r=await xl(e.publicKey);return new gt({peerId:r,payloadType:e.payloadType,payload:e.payload,signature:e.signature})};gt.seal=async(t,e)=>{let r=t.domain,n=t.codec,i=t.marshal(),s=Sl(r,n,i);if(e.privateKey==null)throw new Error("Missing private key");let a=await(await As(e.privateKey)).sign(s);return new gt({peerId:e,payloadType:n,payload:i,signature:a})};gt.openAndCertify=async(t,e)=>{let r=await gt.createFromProtobuf(t);if(!await r.validate(e))throw(0,El.default)(new Error("envelope signature is not valid for the given domain"),ml.ERR_SIGNATURE_NOT_VALID);return r};var Sl=(t,e,r)=>{let n=pe(t),i=Ts.default.encode(n.byteLength),s=Ts.default.encode(e.length),o=Ts.default.encode(r.length);return le([new Uint8Array(i),n,new Uint8Array(s),e,new Uint8Array(o),r])};var _l="[a-fA-F\\d:]",vr=t=>t&&t.includeBoundaries?`(?:(?<=\\s|^)(?=${_l})|(?<=${_l})(?=\\s|$))`:"",_t="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",Pe="[a-fA-F\\d]{1,4}",Is=`
(?:
(?:${Pe}:){7}(?:${Pe}|:)|                                    // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8
(?:${Pe}:){6}(?:${_t}|:${Pe}|:)|                             // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4
(?:${Pe}:){5}(?::${_t}|(?::${Pe}){1,2}|:)|                   // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4
(?:${Pe}:){4}(?:(?::${Pe}){0,1}:${_t}|(?::${Pe}){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4
(?:${Pe}:){3}(?:(?::${Pe}){0,2}:${_t}|(?::${Pe}){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4
(?:${Pe}:){2}(?:(?::${Pe}){0,3}:${_t}|(?::${Pe}){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4
(?:${Pe}:){1}(?:(?::${Pe}){0,4}:${_t}|(?::${Pe}){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4
(?::(?:(?::${Pe}){0,5}:${_t}|(?::${Pe}){1,7}|:))             // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4
)(?:%[0-9a-zA-Z]{1,})?                                             // %eth0            %1
`.replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),Xv=new RegExp(`(?:^${_t}$)|(?:^${Is}$)`),Qv=new RegExp(`^${_t}$`),Jv=new RegExp(`^${Is}$`),Ua=t=>t&&t.exact?Xv:new RegExp(`(?:${vr(t)}${_t}${vr(t)})|(?:${vr(t)}${Is}${vr(t)})`,"g");Ua.v4=t=>t&&t.exact?Qv:new RegExp(`${vr(t)}${_t}${vr(t)}`,"g");Ua.v6=t=>t&&t.exact?Jv:new RegExp(`${vr(t)}${Is}${vr(t)}`,"g");var Cs=Ua;function Bs(t){return Cs({exact:!0}).test(t)}function Al(t){return Cs.v6({exact:!0}).test(t)}function Tl(t){return Cs.v4({exact:!0}).test(t)}var Il=Tl,eb=Al,Oa=function(t){let e=0,r;if(Il(t))r=new Uint8Array(e+4),t.split(/\./g).forEach(n=>{r[e++]=parseInt(n,10)&255});else if(eb(t)){let n=t.split(":",8),i;for(i=0;i<n.length;i++){let s=Il(n[i]),o;s&&(o=Oa(n[i]),n[i]=H(o.slice(0,2),"base16")),o!=null&&++i<8&&n.splice(i,0,H(o.slice(2,4),"base16"))}if(n[0]==="")for(;n.length<8;)n.unshift("0");else if(n[n.length-1]==="")for(;n.length<8;)n.push("0");else if(n.length<8){for(i=0;i<n.length&&n[i]!=="";i++);let s=[i,1];for(i=9-n.length;i>0;i--)s.push("0");n.splice.apply(n,s)}for(r=new Uint8Array(e+16),i=0;i<n.length;i++){let s=parseInt(n[i],16);r[e++]=s>>8&255,r[e++]=s&255}}if(r==null)throw Error("Invalid ip address: "+t);return r},Cl=function(t,e,r){e=~~e,r=r??t.length-e;let n=[],i="",s=new DataView(t.buffer);if(r===4){for(let o=0;o<r;o++)n.push(t[e+o]);i=n.join(".")}else if(r===16){for(let o=0;o<r;o+=2)n.push(s.getUint16(e+o).toString(16));i=n.join(":"),i=i.replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3"),i=i.replace(/:{3,4}/,"::")}return i};var Si={},Ka={},rb=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,-1,"ip6zone"],[53,-1,"dns",!0],[54,-1,"dns4",!0],[55,-1,"dns6",!0],[56,-1,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,-1,"unix",!1,!0],[421,-1,"ipfs"],[421,-1,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,-1,"garlic64"],[460,0,"quic"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,-1,"memory"]];rb.forEach(t=>{let e=nb(...t);Ka[e.code]=e,Si[e.name]=e});function nb(t,e,r,n,i){return{code:t,size:e,name:r,resolvable:Boolean(n),path:Boolean(i)}}function At(t){if(typeof t=="number"){if(Ka[t]!=null)return Ka[t];throw new Error(`no protocol with code: ${t}`)}else if(typeof t=="string"){if(Si[t]!=null)return Si[t];throw new Error(`no protocol with name: ${t}`)}throw new Error(`invalid protocol id type: ${typeof t}`)}var Kr=O(Or(),1);function Pl(t,e){switch(At(t).code){case 4:case 41:return ib(e);case 6:case 273:case 33:case 132:return Ml(e).toString();case 53:case 54:case 55:case 56:case 400:case 777:return ob(e);case 421:return cb(e);case 444:return Rl(e);case 445:return Rl(e);default:return H(e,"base16")}}function Dl(t,e){switch(At(t).code){case 4:return Bl(e);case 41:return Bl(e);case 6:case 273:case 33:case 132:return qa(parseInt(e,10));case 53:case 54:case 55:case 56:case 400:case 777:return sb(e);case 421:return ab(e);case 444:return ub(e);case 445:return fb(e);default:return pe(e,"base16")}}function Bl(t){if(!Bs(t))throw new Error("invalid ip address");return Oa(t)}function ib(t){let e=Cl(t,0,t.length);if(e==null||!Bs(e))throw new Error("invalid ip address");return e}function qa(t){let e=new ArrayBuffer(2);return new DataView(e).setUint16(0,t),new Uint8Array(e)}function Ml(t){return new DataView(t.buffer).getUint16(t.byteOffset)}function sb(t){let e=pe(t),r=Uint8Array.from(Kr.default.encode(e.length));return le([r,e],r.length+e.length)}function ob(t){let e=Kr.default.decode(t);if(t=t.slice(Kr.default.decode.bytes),t.length!==e)throw new Error("inconsistent lengths");return H(t)}function ab(t){let e;t[0]==="Q"||t[0]==="1"?e=Ar(Ae.decode(`z${t}`)).bytes:e=ue.parse(t).multihash.bytes;let r=Uint8Array.from(Kr.default.encode(e.length));return le([r,e],r.length+e.length)}function cb(t){let e=Kr.default.decode(t),r=t.slice(Kr.default.decode.bytes);if(r.length!==e)throw new Error("inconsistent lengths");return H(r,"base58btc")}function ub(t){let e=t.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==16)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion address.`);let r=wt.decode("b"+e[0]),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");let i=qa(n);return le([r,i],r.length+i.length)}function fb(t){let e=t.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==56)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion3 address.`);let r=wt.decode(`b${e[0]}`),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");let i=qa(n);return le([r,i],r.length+i.length)}function Rl(t){let e=t.slice(0,t.length-2),r=t.slice(t.length-2),n=H(e,"base32"),i=Ml(r);return`${n}:${i}`}var _n=O(Or(),1);function hb(t){let e=[],r=t.split("/").slice(1);if(r.length===1&&r[0]==="")return[];for(let n=0;n<r.length;n++){let i=r[n],s=At(i);if(s.size===0){e.push([i]);continue}if(n++,n>=r.length)throw Nl("invalid address: "+t);if(s.path===!0){e.push([i,Ha(r.slice(n).join("/"))]);break}e.push([i,r[n]])}return e}function lb(t){let e=[];return t.map(r=>{let n=Ds(r);return e.push(n.name),r.length>1&&r[1]!=null&&e.push(r[1]),null}),Ha(e.join("/"))}function pb(t){return t.map(e=>{Array.isArray(e)||(e=[e]);let r=Ds(e);return e.length>1?[r.code,Dl(r.code,e[1])]:[r.code]})}function Va(t){return t.map(e=>{let r=Ds(e);return e[1]!=null?[r.code,Pl(r.code,e[1])]:[r.code]})}function za(t){return Ps(le(t.map(e=>{let r=Ds(e),n=Uint8Array.from(_n.default.encode(r.code));return e.length>1&&e[1]!=null&&(n=le([n,e[1]])),n})))}function Ga(t,e){return t.size>0?t.size/8:t.size===0?0:_n.default.decode(e)+_n.default.decode.bytes}function _i(t){let e=[],r=0;for(;r<t.length;){let n=_n.default.decode(t,r),i=_n.default.decode.bytes,s=At(n),o=Ga(s,t.slice(r+i));if(o===0){e.push([n]),r+=i;continue}let a=t.slice(r+i,r+i+o);if(r+=o+i,r>t.length)throw Nl("Invalid address Uint8Array: "+H(t,"base16"));e.push([n,a])}return e}function Rs(t){let e=_i(t),r=Va(e);return lb(r)}function db(t){t=Ha(t);let e=hb(t),r=pb(e);return za(r)}function Ll(t){return db(t)}function Ps(t){let e=gb(t);if(e!=null)throw e;return Uint8Array.from(t)}function gb(t){try{_i(t)}catch(e){return e}}function Ha(t){return"/"+t.trim().split("/").filter(e=>e).join("/")}function Nl(t){return new Error("Error parsing address: "+t)}function Ds(t){return At(t[0])}var Wa=O(Or(),1);var Fl=O(De(),1);var mb=Symbol.for("nodejs.util.inspect.custom"),Ul=new Map,kl=Symbol.for("@multiformats/js-multiaddr/multiaddr"),tt=class{constructor(e){if(e==null&&(e=""),Object.defineProperty(this,kl,{value:!0}),e instanceof Uint8Array)this.bytes=Ps(e);else if(typeof e=="string"){if(e.length>0&&e.charAt(0)!=="/")throw new Error(`multiaddr "${e}" must start with a "/"`);this.bytes=Ll(e)}else if(tt.isMultiaddr(e))this.bytes=Ps(e.bytes);else throw new Error("addr must be a string, Buffer, or another Multiaddr")}toString(){return Rs(this.bytes)}toJSON(){return this.toString()}toOptions(){let e=this.toString().split("/");return{family:e[1]==="ip4"?4:6,host:e[2],transport:e[3],port:parseInt(e[4])}}protos(){return this.protoCodes().map(e=>Object.assign({},At(e)))}protoCodes(){let e=[],r=this.bytes,n=0;for(;n<r.length;){let i=Wa.default.decode(r,n),s=Wa.default.decode.bytes,o=At(i);n+=Ga(o,r.slice(n+s))+s,e.push(i)}return e}protoNames(){return this.protos().map(e=>e.name)}tuples(){return _i(this.bytes)}stringTuples(){let e=_i(this.bytes);return Va(e)}encapsulate(e){return e=new tt(e),new tt(this.toString()+e.toString())}decapsulate(e){let r=e.toString(),n=this.toString(),i=n.lastIndexOf(r);if(i<0)throw new Error(`Address ${this.toString()} does not contain subaddress: ${e.toString()}`);return new tt(n.slice(0,i))}decapsulateCode(e){let r=this.tuples();for(let n=r.length-1;n>=0;n--)if(r[n][0]===e)return new tt(za(r.slice(0,n)));return this}getPeerId(){try{let r=this.stringTuples().filter(n=>n[0]===Si.ipfs.code).pop();if(r?.[1]!=null){let n=r[1];return n[0]==="Q"||n[0]==="1"?H(Ae.decode(`z${n}`),"base58btc"):H(ue.parse(n).multihash.bytes,"base58btc")}return null}catch{return null}}getPath(){let e=null;try{e=this.stringTuples().filter(r=>At(r[0]).path===!0)[0][1],e==null&&(e=null)}catch{e=null}return e}equals(e){return Be(this.bytes,e.bytes)}async resolve(){let e=this.protos().find(i=>i.resolvable);if(e==null)return[this];let r=Ul.get(e.name);if(r==null)throw(0,Fl.default)(new Error(`no available resolver for ${e.name}`),"ERR_NO_AVAILABLE_RESOLVER");return(await r(this)).map(i=>new tt(i))}nodeAddress(){let e=this.protoCodes(),r=this.protoNames(),n=this.toString().split("/").slice(1);if(n.length<4)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6}/{address}/{tcp, udp}/{port}".');if(e[0]!==4&&e[0]!==41&&e[0]!==54&&e[0]!==55)throw new Error(`no protocol with name: "'${r[0]}'". Must have a valid family name: "{ip4, ip6, dns4, dns6}".`);if(n[2]!=="tcp"&&n[2]!=="udp")throw new Error(`no protocol with name: "'${r[1]}'". Must have a valid transport protocol: "{tcp, udp}".`);return{family:e[0]===41||e[0]===55?6:4,address:n[1],port:parseInt(n[3])}}isThinWaistAddress(e){let r=(e??this).protos();return!(r.length!==2||r[0].code!==4&&r[0].code!==41||r[1].code!==6&&r[1].code!==273)}static fromNodeAddress(e,r){if(e==null)throw new Error("requires node address object");if(r==null)throw new Error("requires transport protocol");let n;switch(e.family){case 4:n="ip4";break;case 6:n="ip6";break;default:throw Error("Invalid addr family, should be 4 or 6.")}return new tt("/"+[n,e.address,r,e.port].join("/"))}static isName(e){return tt.isMultiaddr(e)?e.protos().some(r=>r.resolvable):!1}static isMultiaddr(e){return Boolean(e?.[kl])}[mb](){return"<Multiaddr "+H(this.bytes,"base16")+" - "+Rs(this.bytes)+">"}inspect(){return"<Multiaddr "+H(this.bytes,"base16")+" - "+Rs(this.bytes)+">"}};tt.resolvers=Ul;function Ol(t,e){let r=(n,i)=>n.toString().localeCompare(i.toString());return t.length===e.length&&e.sort(r)&&t.sort(r).every((n,i)=>e[i].equals(n))}var Ai;(function(t){let e;(function(r){r.codec=()=>Ne({1:{name:"multiaddr",codec:xe}}),r.encode=n=>Le(n,r.codec()),r.decode=n=>Me(n,r.codec())})(e=t.AddressInfo||(t.AddressInfo={})),t.codec=()=>Ne({1:{name:"peerId",codec:xe},2:{name:"seq",codec:Jn},3:{name:"addresses",codec:t.AddressInfo.codec(),repeats:!0}}),t.encode=r=>Le(r,t.codec()),t.decode=r=>Me(r,t.codec())})(Ai||(Ai={}));var Kl="libp2p-peer-record",ql=Uint8Array.from([3,1]);var Tt=class{constructor(e){this.domain=Tt.DOMAIN,this.codec=Tt.CODEC;let{peerId:r,multiaddrs:n,seqNumber:i}=e;this.peerId=r,this.multiaddrs=n??[],this.seqNumber=i??BigInt(Date.now())}marshal(){return this.marshaled==null&&(this.marshaled=Ai.encode({peerId:this.peerId.toBytes(),seq:BigInt(this.seqNumber),addresses:this.multiaddrs.map(e=>({multiaddr:e.bytes}))})),this.marshaled}equals(e){return!(!(e instanceof Tt)||!this.peerId.equals(e.peerId)||this.seqNumber!==e.seqNumber||!Ol(this.multiaddrs,e.multiaddrs))}};Tt.createFromProtobuf=t=>{let e=Ai.decode(t),r=Ot(e.peerId),n=(e.addresses??[]).map(s=>new tt(s.multiaddr)),i=e.seq;return new Tt({peerId:r,multiaddrs:n,seqNumber:i})};Tt.DOMAIN=Kl;Tt.CODEC=ql;var Kt=O(Wl(),1);Kt.default.formatters.b=t=>t==null?"undefined":Ae.baseEncode(t);Kt.default.formatters.t=t=>t==null?"undefined":wt.baseEncode(t);Kt.default.formatters.m=t=>t==null?"undefined":tn.baseEncode(t);Kt.default.formatters.p=t=>t==null?"undefined":t.toString();Kt.default.formatters.c=t=>t==null?"undefined":t.toString();Kt.default.formatters.k=t=>t==null?"undefined":t.toString();function Cn(t){return Object.assign((0,Kt.default)(t),{error:(0,Kt.default)(`${t}:error`),trace:(0,Kt.default)(`${t}:trace`)})}var $a=Symbol.for("@libp2p/topology");var $l=()=>{},Ya=class{constructor(e){this.min=e.min??0,this.max=e.max??1/0,this.peers=new Set,this.onConnect=e.onConnect??$l,this.onDisconnect=e.onDisconnect??$l}get[Symbol.toStringTag](){return $a.toString()}get[$a](){return!0}async setRegistrar(e){this.registrar=e}disconnect(e){this.onDisconnect(e)}};function Yl(t){return new Ya(t)}var Vr=function(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)},tr,Bn=class extends EventTarget{constructor(){super(...arguments),tr.set(this,new Map)}listenerCount(e){let r=Vr(this,tr,"f").get(e);return r==null?0:r.length}addEventListener(e,r,n){super.addEventListener(e,r,n);let i=Vr(this,tr,"f").get(e);i==null&&(i=[],Vr(this,tr,"f").set(e,i)),i.push({callback:r,once:(n!==!0&&n!==!1&&n?.once)??!1})}removeEventListener(e,r,n){super.removeEventListener(e.toString(),r??null,n);let i=Vr(this,tr,"f").get(e);i!=null&&(i=i.filter(({callback:s})=>s!==r),Vr(this,tr,"f").set(e,i))}dispatchEvent(e){let r=super.dispatchEvent(e),n=Vr(this,tr,"f").get(e.type);return n==null||(n=n.filter(({once:i})=>!i),Vr(this,tr,"f").set(e.type,n)),r}};tr=new WeakMap;var Za=class extends Event{constructor(e,r){super(e,r),this.detail=r?.detail}},yt=globalThis.CustomEvent??Za;var ja=O(Or(),1),Rn=(t,e,r)=>{let n=ja.default.encode(t,e,r);return Rn.bytes=ja.default.encode.bytes,e??Uint8Array.from(n)};Rn.bytes=0;var Zl=8,Rb=10*1024;function Ns(t){t=t??{};let e=Math.max(t.poolSize??Rb,t.minPoolSize??Zl),r=t.lengthEncoder??Rn;return async function*(i){let s=new Uint8Array(e),o=0;for await(let a of i){r(a.length,s,o);let c=s.slice(o,o+r.bytes);o+=r.bytes,s.length-o<Zl&&(s=new Uint8Array(e),o=0),yield le([c,a.slice()],c.length+a.length)}}}Ns.single=(t,e)=>{e=e??{};let r=e.lengthEncoder??Rn;return new Q(r(t.length),t.slice())};var Xa=O(Or(),1),Ti=t=>{let e=Xa.default.decode(t);return Ti.bytes=Xa.default.decode.bytes,e};Ti.bytes=0;var ks=O(De(),1),Pb=8,Db=1024*1024*4,Mb=new Q,br={LENGTH:"readLength",DATA:"readData"},Lb={[br.LENGTH]:(t,e,r,n)=>{let i=n?.lengthDecoder??Ti,s=n?.maxLengthLength??Pb,o=n?.maxDataLength??Db;e.append(t);let a;try{a=i(e.slice())}catch(c){if(e.length>s)throw(0,ks.default)(new Error("message length too long"),"ERR_MSG_LENGTH_TOO_LONG");if(c instanceof RangeError)return{mode:br.LENGTH,buffer:e,chunk:void 0,state:void 0,data:void 0};throw c}if(a>o)throw(0,ks.default)(new Error("message data too long"),"ERR_MSG_DATA_TOO_LONG");return t=e.subarray(i.bytes),e=new Q,n?.onLength!=null&&n.onLength(a),a<=0?{mode:br.LENGTH,chunk:t,buffer:e,data:Mb}:{mode:br.DATA,chunk:t,buffer:e,state:{dataLength:a},data:void 0}},[br.DATA]:(t,e,r,n)=>{if(e.append(t),r==null)throw new Error("state is required");if(e.length<r.dataLength)return{mode:br.DATA,buffer:e,state:r,chunk:void 0,data:void 0};let{dataLength:i}=r,s=e.subarray(0,i),o=e.length>i?e.subarray(i):void 0;return e=new Q,{mode:br.LENGTH,chunk:o,buffer:e,state:void 0,data:s}}};function Ii(t){return async function*(r){let n=new Q,i=br.LENGTH,s;for await(let o of r){let a=new Q(o);for(;a!=null;){let c=Lb[i](a,n,s,t);if(i=c.mode,a=c.chunk,n=c.buffer,s=c.state,c.data!=null){let u=c.data.slice();t?.onData!=null&&t.onData(u),yield u}}}if(n.length>0)throw(0,ks.default)(new Error("unexpected end of input"),"ERR_UNEXPECTED_EOF")}}Ii.fromReader=(t,e)=>{let r=1,n=async function*(){for(;;)try{let{done:s,value:o}=await t.next(r);if(s===!0)return;o!=null&&(yield o)}catch(s){if(s.code==="ERR_UNDER_READ")return{done:!0,value:null};throw s}finally{r=1}}();return Ii({...e??{},onLength:s=>{r=s}})(n)};function jl(t){return globalThis?.Buffer?.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(t):new Uint8Array(t)}var Xl=(t,e,r)=>(e=e??jl(4),new DataView(e.buffer,e.byteOffset,e.byteLength).setInt32(r??0,t,!1),e);Xl.bytes=4;var Ql=t=>{if(t.length<4)throw RangeError("Could not decode int32BE");return new DataView(t.buffer,t.byteOffset,t.byteLength).getInt32(0,!1)};Ql.bytes=4;var Ci=class extends Error{constructor(e,r){super(e??"The operation was aborted"),this.type="aborted",this.code=r??"ABORT_ERR"}};function Jl(t){if(t!=null){if(typeof t[Symbol.iterator]=="function")return t[Symbol.iterator]();if(typeof t[Symbol.asyncIterator]=="function")return t[Symbol.asyncIterator]();if(typeof t.next=="function")return t}throw new Error("argument is not an iterator or iterable")}function e0(t,e,r){let n=r??{},i=Jl(t);async function*s(){let o,a=()=>{o?.()};for(e.addEventListener("abort",a);;){let c;try{if(e.aborted){let{abortMessage:f,abortCode:h}=n;throw new Ci(f,h)}let u=new Promise((f,h)=>{o=()=>{let{abortMessage:l,abortCode:g}=n;h(new Ci(l,g))}});c=await Promise.race([u,i.next()]),o=null}catch(u){e.removeEventListener("abort",a);let f=u.type==="aborted"&&e.aborted;if(f&&n.onAbort!=null&&await n.onAbort(t),typeof i.return=="function")try{let h=i.return();h instanceof Promise&&h.catch(l=>{n.onReturnError!=null&&n.onReturnError(l)})}catch(h){n.onReturnError!=null&&n.onReturnError(h)}if(f&&n.returnOnAbort===!0)return;throw u}if(c.done===!0)break;yield c.value}e.removeEventListener("abort",a)}return s()}var kb=Cn("libp2p-pubsub:peer-streams"),Fs=class extends Bn{constructor(e){super(),this.id=e.id,this.protocol=e.protocol,this._inboundAbortController=new AbortController,this.closed=!1}get isReadable(){return Boolean(this.inboundStream)}get isWritable(){return Boolean(this.outboundStream)}write(e){if(this.outboundStream==null){let r=this.id.toString();throw new Error("No writable connection to "+r)}this.outboundStream.push(e)}attachInboundStream(e){return this._rawInboundStream=e,this.inboundStream=e0(Zn(this._rawInboundStream,Ii()),this._inboundAbortController.signal,{returnOnAbort:!0}),this.dispatchEvent(new yt("stream:inbound")),this.inboundStream}async attachOutboundStream(e){let r=this.outboundStream;return this.outboundStream!=null&&await this.outboundStream.end(),this._rawOutboundStream=e,this.outboundStream=qi({onEnd:n=>{this._rawOutboundStream!=null&&this._rawOutboundStream.reset!=null&&this._rawOutboundStream.reset(),this._rawOutboundStream=void 0,this.outboundStream=void 0,n!=null&&this.dispatchEvent(new yt("close"))}}),Zn(this.outboundStream,Ns(),this._rawOutboundStream).catch(n=>{kb.error(n)}),r==null&&this.dispatchEvent(new yt("stream:outbound")),this.outboundStream}close(){this.closed||(this.closed=!0,this.outboundStream!=null&&this.outboundStream.end(),this.inboundStream!=null&&this._inboundAbortController.abort(),this._rawOutboundStream=void 0,this.outboundStream=void 0,this._rawInboundStream=void 0,this.inboundStream=void 0,this.dispatchEvent(new yt("close")))}};var Us=class{constructor(e,r,n){this.gossip=e,this.msgs=new Map,this.history=[],this.msgIdToStrFn=n;for(let i=0;i<r;i++)this.history[i]=[]}get size(){return this.msgs.size}put(e,r,n=!1){let{msgIdStr:i}=e;return this.msgs.has(i)?!1:(this.msgs.set(i,{message:r,validated:n,originatingPeers:new Set,iwantCounts:new Map}),this.history[0].push({...e,topic:r.topic}),!0)}observeDuplicate(e,r){let n=this.msgs.get(e);n&&!n.validated&&n.originatingPeers.add(r)}get(e){return this.msgs.get(this.msgIdToStrFn(e))?.message}getWithIWantCount(e,r){let n=this.msgs.get(e);if(!n)return null;let i=(n.iwantCounts.get(r)??0)+1;return n.iwantCounts.set(r,i),{msg:n.message,count:i}}getGossipIDs(e){let r=new Map;for(let n=0;n<this.gossip;n++)this.history[n].forEach(i=>{let s=this.msgs.get(i.msgIdStr);if(s&&s.validated&&e.has(i.topic)){let o=r.get(i.topic);o||(o=[],r.set(i.topic,o)),o.push(i.msgId)}});return r}validate(e){let r=this.msgs.get(e);if(!r)return null;let{message:n,originatingPeers:i}=r;return r.validated=!0,r.originatingPeers=new Set,{message:n,originatingPeers:i}}shift(){this.history[this.history.length-1].forEach(r=>{this.msgs.delete(r.msgIdStr)}),this.history.pop(),this.history.unshift([])}remove(e){let r=this.msgs.get(e);return r?(this.msgs.delete(e),r):null}};var wr;(function(t){let e;(function(u){u.codec=()=>Ne({1:{name:"subscribe",codec:Fo,optional:!0},2:{name:"topic",codec:Ir,optional:!0}}),u.encode=f=>Le(f,u.codec()),u.decode=f=>Me(f,u.codec())})(e=t.SubOpts||(t.SubOpts={}));let r;(function(u){u.codec=()=>Ne({1:{name:"from",codec:xe,optional:!0},2:{name:"data",codec:xe,optional:!0},3:{name:"seqno",codec:xe,optional:!0},4:{name:"topic",codec:Ir},5:{name:"signature",codec:xe,optional:!0},6:{name:"key",codec:xe,optional:!0}}),u.encode=f=>Le(f,u.codec()),u.decode=f=>Me(f,u.codec())})(r=t.Message||(t.Message={}));let n;(function(u){u.codec=()=>Ne({1:{name:"ihave",codec:t.ControlIHave.codec(),repeats:!0},2:{name:"iwant",codec:t.ControlIWant.codec(),repeats:!0},3:{name:"graft",codec:t.ControlGraft.codec(),repeats:!0},4:{name:"prune",codec:t.ControlPrune.codec(),repeats:!0}}),u.encode=f=>Le(f,u.codec()),u.decode=f=>Me(f,u.codec())})(n=t.ControlMessage||(t.ControlMessage={}));let i;(function(u){u.codec=()=>Ne({1:{name:"topicID",codec:Ir,optional:!0},2:{name:"messageIDs",codec:xe,repeats:!0}}),u.encode=f=>Le(f,u.codec()),u.decode=f=>Me(f,u.codec())})(i=t.ControlIHave||(t.ControlIHave={}));let s;(function(u){u.codec=()=>Ne({1:{name:"messageIDs",codec:xe,repeats:!0}}),u.encode=f=>Le(f,u.codec()),u.decode=f=>Me(f,u.codec())})(s=t.ControlIWant||(t.ControlIWant={}));let o;(function(u){u.codec=()=>Ne({1:{name:"topicID",codec:Ir,optional:!0}}),u.encode=f=>Le(f,u.codec()),u.decode=f=>Me(f,u.codec())})(o=t.ControlGraft||(t.ControlGraft={}));let a;(function(u){u.codec=()=>Ne({1:{name:"topicID",codec:Ir,optional:!0},2:{name:"peers",codec:t.PeerInfo.codec(),repeats:!0},3:{name:"backoff",codec:Jn,optional:!0}}),u.encode=f=>Le(f,u.codec()),u.decode=f=>Me(f,u.codec())})(a=t.ControlPrune||(t.ControlPrune={}));let c;(function(u){u.codec=()=>Ne({1:{name:"peerID",codec:xe,optional:!0},2:{name:"signedPeerRecord",codec:xe,optional:!0}}),u.encode=f=>Le(f,u.codec()),u.decode=f=>Me(f,u.codec())})(c=t.PeerInfo||(t.PeerInfo={})),t.codec=()=>Ne({1:{name:"subscriptions",codec:t.SubOpts.codec(),repeats:!0},2:{name:"messages",codec:t.Message.codec(),repeats:!0},3:{name:"control",codec:t.ControlMessage.codec(),optional:!0}}),t.encode=u=>Le(u,t.codec()),t.decode=u=>Me(u,t.codec())})(wr||(wr={}));var Qa="/floodsub/1.0.0",Bi="/meshsub/1.0.0",Pn="/meshsub/1.1.0";var t0="ERR_TOPIC_VALIDATOR_REJECT",r0="ERR_TOPIC_VALIDATOR_IGNORE";function qt(t=[],e){return{subscriptions:[],messages:t,control:e?{graft:e.graft||[],prune:e.prune||[],ihave:e.ihave||[],iwant:e.iwant||[]}:void 0}}function Vt(t){if(t.length<=1)return t;let e=()=>Math.floor(Math.random()*Math.floor(t.length));for(let r=0;r<t.length;r++){let n=e(),i=t[r];t[r]=t[n],t[n]=i}return t}function Os(t){return t===Bi||t===Pn}function n0(t){return H(t,"base64")}var zr="StrictSign",Dn="StrictNoSign";var i0;(function(t){t.StrictSign="StrictSign",t.StrictNoSign="StrictNoSign"})(i0||(i0={}));var rr;(function(t){t[t.Signing=0]="Signing",t[t.Author=1]="Author",t[t.Anonymous=2]="Anonymous"})(rr||(rr={}));var zt;(function(t){t.Accept="accept",t.Ignore="ignore",t.Reject="reject"})(zt||(zt={}));var He;(function(t){t.Error="error",t.Ignore="ignore",t.Reject="reject",t.Blacklisted="blacklisted"})(He||(He={}));var ze;(function(t){t.InvalidSignature="invalid_signature",t.InvalidSeqno="invalid_seqno",t.InvalidPeerId="invalid_peerid",t.SignaturePresent="signature_present",t.SeqnoPresent="seqno_present",t.FromPresent="from_present",t.TransformFailed="transform_failed"})(ze||(ze={}));var ut;(function(t){t.duplicate="duplicate",t.invalid="invalid",t.valid="valid"})(ut||(ut={}));function Ja(t){switch(t){case zt.Ignore:return He.Ignore;case zt.Reject:return He.Reject}}async function ec(t,e){switch(t){case zr:{if(!e)throw Error("Must provide PeerId");if(e.privateKey==null)throw Error("Cannot sign message, no private key present");if(e.publicKey==null)throw Error("Cannot sign message, no public key present");let r=await As(e.privateKey);return{type:rr.Signing,author:e,key:e.publicKey,privateKey:r}}case Dn:return{type:rr.Anonymous};default:throw new Error(`Unknown signature policy "${t}"`)}}var se="ERR_INVALID_PEER_SCORE_PARAMS";var oe=O(De(),1),Ub={topics:{},topicScoreCap:10,appSpecificScore:()=>0,appSpecificWeight:10,IPColocationFactorWeight:-5,IPColocationFactorThreshold:10,IPColocationFactorWhitelist:new Set,behaviourPenaltyWeight:-10,behaviourPenaltyThreshold:0,behaviourPenaltyDecay:.2,decayInterval:1e3,decayToZero:.1,retainScore:3600*1e3},Ob={topicWeight:.5,timeInMeshWeight:1,timeInMeshQuantum:1,timeInMeshCap:3600,firstMessageDeliveriesWeight:1,firstMessageDeliveriesDecay:.5,firstMessageDeliveriesCap:2e3,meshMessageDeliveriesWeight:-1,meshMessageDeliveriesDecay:.5,meshMessageDeliveriesCap:100,meshMessageDeliveriesThreshold:20,meshMessageDeliveriesWindow:10,meshMessageDeliveriesActivation:5e3,meshFailurePenaltyWeight:-1,meshFailurePenaltyDecay:.5,invalidMessageDeliveriesWeight:-1,invalidMessageDeliveriesDecay:.3};function s0(t={}){return{...Ub,...t,topics:t.topics?Object.entries(t.topics).reduce((e,[r,n])=>(e[r]=Kb(n),e),{}):{}}}function Kb(t={}){return{...Ob,...t}}function o0(t){for(let[e,r]of Object.entries(t.topics))try{qb(r)}catch(n){throw(0,oe.default)(new Error(`invalid score parameters for topic ${e}: ${n.message}`),se)}if(t.topicScoreCap<0)throw(0,oe.default)(new Error("invalid topic score cap; must be positive (or 0 for no cap)"),se);if(t.appSpecificScore===null||t.appSpecificScore===void 0)throw(0,oe.default)(new Error("missing application specific score function"),se);if(t.IPColocationFactorWeight>0)throw(0,oe.default)(new Error("invalid IPColocationFactorWeight; must be negative (or 0 to disable)"),se);if(t.IPColocationFactorWeight!==0&&t.IPColocationFactorThreshold<1)throw(0,oe.default)(new Error("invalid IPColocationFactorThreshold; must be at least 1"),se);if(t.behaviourPenaltyWeight>0)throw(0,oe.default)(new Error("invalid BehaviourPenaltyWeight; must be negative (or 0 to disable)"),se);if(t.behaviourPenaltyWeight!==0&&(t.behaviourPenaltyDecay<=0||t.behaviourPenaltyDecay>=1))throw(0,oe.default)(new Error("invalid BehaviourPenaltyDecay; must be between 0 and 1"),se);if(t.decayInterval<1e3)throw(0,oe.default)(new Error("invalid DecayInterval; must be at least 1s"),se);if(t.decayToZero<=0||t.decayToZero>=1)throw(0,oe.default)(new Error("invalid DecayToZero; must be between 0 and 1"),se)}function qb(t){if(t.topicWeight<0)throw(0,oe.default)(new Error("invalid topic weight; must be >= 0"),se);if(t.timeInMeshQuantum===0)throw(0,oe.default)(new Error("invalid TimeInMeshQuantum; must be non zero"),se);if(t.timeInMeshWeight<0)throw(0,oe.default)(new Error("invalid TimeInMeshWeight; must be positive (or 0 to disable)"),se);if(t.timeInMeshWeight!==0&&t.timeInMeshQuantum<=0)throw(0,oe.default)(new Error("invalid TimeInMeshQuantum; must be positive"),se);if(t.timeInMeshWeight!==0&&t.timeInMeshCap<=0)throw(0,oe.default)(new Error("invalid TimeInMeshCap; must be positive"),se);if(t.firstMessageDeliveriesWeight<0)throw(0,oe.default)(new Error("invallid FirstMessageDeliveriesWeight; must be positive (or 0 to disable)"),se);if(t.firstMessageDeliveriesWeight!==0&&(t.firstMessageDeliveriesDecay<=0||t.firstMessageDeliveriesDecay>=1))throw(0,oe.default)(new Error("invalid FirstMessageDeliveriesDecay; must be between 0 and 1"),se);if(t.firstMessageDeliveriesWeight!==0&&t.firstMessageDeliveriesCap<=0)throw(0,oe.default)(new Error("invalid FirstMessageDeliveriesCap; must be positive"),se);if(t.meshMessageDeliveriesWeight>0)throw(0,oe.default)(new Error("invalid MeshMessageDeliveriesWeight; must be negative (or 0 to disable)"),se);if(t.meshMessageDeliveriesWeight!==0&&(t.meshMessageDeliveriesDecay<=0||t.meshMessageDeliveriesDecay>=1))throw(0,oe.default)(new Error("invalid MeshMessageDeliveriesDecay; must be between 0 and 1"),se);if(t.meshMessageDeliveriesWeight!==0&&t.meshMessageDeliveriesCap<=0)throw(0,oe.default)(new Error("invalid MeshMessageDeliveriesCap; must be positive"),se);if(t.meshMessageDeliveriesWeight!==0&&t.meshMessageDeliveriesThreshold<=0)throw(0,oe.default)(new Error("invalid MeshMessageDeliveriesThreshold; must be positive"),se);if(t.meshMessageDeliveriesWindow<0)throw(0,oe.default)(new Error("invalid MeshMessageDeliveriesWindow; must be non-negative"),se);if(t.meshMessageDeliveriesWeight!==0&&t.meshMessageDeliveriesActivation<1e3)throw(0,oe.default)(new Error("invalid MeshMessageDeliveriesActivation; must be at least 1s"),se);if(t.meshFailurePenaltyWeight>0)throw(0,oe.default)(new Error("invalid MeshFailurePenaltyWeight; must be negative (or 0 to disable)"),se);if(t.meshFailurePenaltyWeight!==0&&(t.meshFailurePenaltyDecay<=0||t.meshFailurePenaltyDecay>=1))throw(0,oe.default)(new Error("invalid MeshFailurePenaltyDecay; must be between 0 and 1"),se);if(t.invalidMessageDeliveriesWeight>0)throw(0,oe.default)(new Error("invalid InvalidMessageDeliveriesWeight; must be negative (or 0 to disable)"),se);if(t.invalidMessageDeliveriesDecay<=0||t.invalidMessageDeliveriesDecay>=1)throw(0,oe.default)(new Error("invalid InvalidMessageDeliveriesDecay; must be between 0 and 1"),se)}var Vb=O(De(),1),zb={gossipThreshold:-10,publishThreshold:-50,graylistThreshold:-80,acceptPXThreshold:10,opportunisticGraftThreshold:20};function a0(t={}){return{...zb,...t}}function c0(t,e,r,n){let i=0;if(Object.entries(e.topics).forEach(([o,a])=>{let c=r.topics[o];if(c===void 0)return;let u=0;if(a.inMesh){let g=a.meshTime/c.timeInMeshQuantum;g>c.timeInMeshCap&&(g=c.timeInMeshCap),u+=g*c.timeInMeshWeight}let f=a.firstMessageDeliveries;if(f>c.firstMessageDeliveriesCap&&(f=c.firstMessageDeliveriesCap),u+=f*c.firstMessageDeliveriesWeight,a.meshMessageDeliveriesActive&&a.meshMessageDeliveries<c.meshMessageDeliveriesThreshold){let g=c.meshMessageDeliveriesThreshold-a.meshMessageDeliveries;u+=g*g*c.meshMessageDeliveriesWeight}u+=a.meshFailurePenalty*c.meshFailurePenaltyWeight,u+=a.invalidMessageDeliveries*a.invalidMessageDeliveries*c.invalidMessageDeliveriesWeight,i+=u*c.topicWeight}),r.topicScoreCap>0&&i>r.topicScoreCap&&(i=r.topicScoreCap),i+=r.appSpecificScore(t)*r.appSpecificWeight,e.ips.forEach(o=>{if(r.IPColocationFactorWhitelist.has(o))return;let a=n.get(o),c=a?a.size:0;if(c>r.IPColocationFactorThreshold){let u=c-r.IPColocationFactorThreshold;i+=u*u*r.IPColocationFactorWeight}}),e.behaviourPenalty>r.behaviourPenaltyThreshold){let o=e.behaviourPenalty-r.behaviourPenaltyThreshold;i+=o*o*r.behaviourPenaltyWeight}return i}var h0=O(f0(),1),je;(function(t){t[t.unknown=0]="unknown",t[t.valid=1]="valid",t[t.invalid=2]="invalid",t[t.ignored=3]="ignored"})(je||(je={}));var Ks=class{constructor(){this.records=new Map,this.queue=new h0.default}ensureRecord(e){let r=this.records.get(e);if(r)return r;r={status:je.unknown,firstSeen:Date.now(),validated:0,peers:new Set},this.records.set(e,r);let n={msgId:e,expire:Date.now()+12e4};return this.queue.push(n),r}gc(){let e=Date.now(),r=this.queue.peekFront();for(;r&&r.expire<e;)this.records.delete(r.msgId),this.queue.shift(),r=this.queue.peekFront()}clear(){this.records.clear(),this.queue.clear()}};var nt=O(De(),1);function Gr(t){return t!=null&&typeof t.start=="function"&&typeof t.stop=="function"}function rt(t){return t!=null&&typeof t.init=="function"}var Mn=class{constructor(e={}){this.started=!1,e.peerId!=null&&this.setPeerId(e.peerId),e.addressManager!=null&&this.setAddressManager(e.addressManager),e.peerStore!=null&&this.setPeerStore(e.peerStore),e.upgrader!=null&&this.setUpgrader(e.upgrader),e.metrics!=null&&this.setMetrics(e.metrics),e.registrar!=null&&this.setRegistrar(e.registrar),e.connectionManager!=null&&this.setConnectionManager(e.connectionManager),e.transportManager!=null&&this.setTransportManager(e.transportManager),e.connectionGater!=null&&this.setConnectionGater(e.connectionGater),e.contentRouting!=null&&this.setContentRouting(e.contentRouting),e.peerRouting!=null&&this.setPeerRouting(e.peerRouting),e.datastore!=null&&this.setDatastore(e.datastore),e.connectionProtector!=null&&this.setConnectionProtector(e.connectionProtector),e.dht!=null&&this.setDHT(e.dht),e.pubsub!=null&&this.setPubSub(e.pubsub)}isStarted(){return this.started}async beforeStart(){await Promise.all(Object.values(this).filter(e=>Gr(e)).map(async e=>{e.beforeStart!=null&&await e.beforeStart()}))}async start(){await Promise.all(Object.values(this).filter(e=>Gr(e)).map(async e=>{await e.start()})),this.started=!0}async afterStart(){await Promise.all(Object.values(this).filter(e=>Gr(e)).map(async e=>{e.afterStart!=null&&await e.afterStart()}))}async beforeStop(){await Promise.all(Object.values(this).filter(e=>Gr(e)).map(async e=>{e.beforeStop!=null&&await e.beforeStop()}))}async stop(){await Promise.all(Object.values(this).filter(e=>Gr(e)).map(async e=>{await e.stop()})),this.started=!1}async afterStop(){await Promise.all(Object.values(this).filter(e=>Gr(e)).map(async e=>{e.afterStop!=null&&await e.afterStop()}))}setPeerId(e){return this.peerId=e,e}getPeerId(){if(this.peerId==null)throw(0,nt.default)(new Error("peerId not set"),"ERR_SERVICE_MISSING");return this.peerId}setMetrics(e){return this.metrics=e,rt(e)&&e.init(this),e}getMetrics(){return this.metrics}setAddressManager(e){return this.addressManager=e,rt(e)&&e.init(this),e}getAddressManager(){if(this.addressManager==null)throw(0,nt.default)(new Error("addressManager not set"),"ERR_SERVICE_MISSING");return this.addressManager}setPeerStore(e){return this.peerStore=e,rt(e)&&e.init(this),e}getPeerStore(){if(this.peerStore==null)throw(0,nt.default)(new Error("peerStore not set"),"ERR_SERVICE_MISSING");return this.peerStore}setUpgrader(e){return this.upgrader=e,rt(e)&&e.init(this),e}getUpgrader(){if(this.upgrader==null)throw(0,nt.default)(new Error("upgrader not set"),"ERR_SERVICE_MISSING");return this.upgrader}setRegistrar(e){return this.registrar=e,rt(e)&&e.init(this),e}getRegistrar(){if(this.registrar==null)throw(0,nt.default)(new Error("registrar not set"),"ERR_SERVICE_MISSING");return this.registrar}setConnectionManager(e){return this.connectionManager=e,rt(e)&&e.init(this),e}getConnectionManager(){if(this.connectionManager==null)throw(0,nt.default)(new Error("connectionManager not set"),"ERR_SERVICE_MISSING");return this.connectionManager}setTransportManager(e){return this.transportManager=e,rt(e)&&e.init(this),e}getTransportManager(){if(this.transportManager==null)throw(0,nt.default)(new Error("transportManager not set"),"ERR_SERVICE_MISSING");return this.transportManager}setConnectionGater(e){return this.connectionGater=e,rt(e)&&e.init(this),e}getConnectionGater(){if(this.connectionGater==null)throw(0,nt.default)(new Error("connectionGater not set"),"ERR_SERVICE_MISSING");return this.connectionGater}setContentRouting(e){return this.contentRouting=e,rt(e)&&e.init(this),e}getContentRouting(){if(this.contentRouting==null)throw(0,nt.default)(new Error("contentRouting not set"),"ERR_SERVICE_MISSING");return this.contentRouting}setPeerRouting(e){return this.peerRouting=e,rt(e)&&e.init(this),e}getPeerRouting(){if(this.peerRouting==null)throw(0,nt.default)(new Error("peerRouting not set"),"ERR_SERVICE_MISSING");return this.peerRouting}setDatastore(e){return this.datastore=e,rt(e)&&e.init(this),e}getDatastore(){if(this.datastore==null)throw(0,nt.default)(new Error("datastore not set"),"ERR_SERVICE_MISSING");return this.datastore}setConnectionProtector(e){return this.connectionProtector=e,rt(e)&&e.init(this),e}getConnectionProtector(){return this.connectionProtector}setDHT(e){return this.dht=e,rt(e)&&e.init(this),e}getDHT(){if(this.dht==null)throw(0,nt.default)(new Error("dht not set"),"ERR_SERVICE_MISSING");return this.dht}setPubSub(e){return this.pubsub=e,rt(e)&&e.init(this),e}getPubSub(){if(this.pubsub==null)throw(0,nt.default)(new Error("pubsub not set"),"ERR_SERVICE_MISSING");return this.pubsub}};var Ln=Cn("libp2p:gossipsub:score"),qs=class{constructor(e,r,n){this.params=e,this.metrics=r,this.peerStats=new Map,this.peerIPs=new Map,this.scoreCache=new Map,this.deliveryRecords=new Ks,this.components=new Mn,o0(e),this.scoreCacheValidityMs=n.scoreCacheValidityMs,this.computeScore=n.computeScore??c0}init(e){this.components=e}get size(){return this.peerStats.size}start(){if(this._backgroundInterval){Ln("Peer score already running");return}this._backgroundInterval=setInterval(()=>this.background(),this.params.decayInterval),Ln("started")}stop(){if(!this._backgroundInterval){Ln("Peer score already stopped");return}clearInterval(this._backgroundInterval),delete this._backgroundInterval,this.peerIPs.clear(),this.peerStats.clear(),this.deliveryRecords.clear(),Ln("stopped")}background(){this.refreshScores(),this.updateIPs(),this.deliveryRecords.gc()}dumpPeerScoreStats(){return Object.fromEntries(Array.from(this.peerStats.entries()).map(([e,r])=>[e,r]))}refreshScores(){let e=Date.now(),r=this.params.decayToZero;this.peerStats.forEach((n,i)=>{if(!n.connected){e>n.expire&&(this.removeIPs(i,n.ips),this.peerStats.delete(i),this.scoreCache.delete(i));return}Object.entries(n.topics).forEach(([s,o])=>{let a=this.params.topics[s];a!==void 0&&(o.firstMessageDeliveries*=a.firstMessageDeliveriesDecay,o.firstMessageDeliveries<r&&(o.firstMessageDeliveries=0),o.meshMessageDeliveries*=a.meshMessageDeliveriesDecay,o.meshMessageDeliveries<r&&(o.meshMessageDeliveries=0),o.meshFailurePenalty*=a.meshFailurePenaltyDecay,o.meshFailurePenalty<r&&(o.meshFailurePenalty=0),o.invalidMessageDeliveries*=a.invalidMessageDeliveriesDecay,o.invalidMessageDeliveries<r&&(o.invalidMessageDeliveries=0),o.inMesh&&(o.meshTime=e-o.graftTime,o.meshTime>a.meshMessageDeliveriesActivation&&(o.meshMessageDeliveriesActive=!0)))}),n.behaviourPenalty*=this.params.behaviourPenaltyDecay,n.behaviourPenalty<r&&(n.behaviourPenalty=0)})}score(e){this.metrics?.scoreFnCalls.inc();let r=this.peerStats.get(e);if(!r)return 0;let n=Date.now(),i=this.scoreCache.get(e);if(i&&i.cacheUntil>n)return i.score;this.metrics?.scoreFnRuns.inc();let s=this.computeScore(e,r,this.params,this.peerIPs),o=n+this.scoreCacheValidityMs;return i?(this.metrics?.scoreCachedDelta.observe(Math.abs(s-i.score)),i.score=s,i.cacheUntil=o):this.scoreCache.set(e,{score:s,cacheUntil:o}),s}addPenalty(e,r,n){let i=this.peerStats.get(e);i&&(i.behaviourPenalty+=r,this.metrics?.onScorePenalty(n))}addPeer(e){let r={connected:!0,expire:0,topics:{},ips:[],behaviourPenalty:0};this.peerStats.set(e,r);let n=this.getIPs(e);this.setIPs(e,n,r.ips),r.ips=n}removePeer(e){let r=this.peerStats.get(e);if(!!r){if(this.score(e)>0){this.removeIPs(e,r.ips),this.peerStats.delete(e);return}Object.entries(r.topics).forEach(([n,i])=>{i.firstMessageDeliveries=0;let s=this.params.topics[n].meshMessageDeliveriesThreshold;if(i.inMesh&&i.meshMessageDeliveriesActive&&i.meshMessageDeliveries<s){let o=s-i.meshMessageDeliveries;i.meshFailurePenalty+=o*o}i.inMesh=!1,i.meshMessageDeliveriesActive=!1}),r.connected=!1,r.expire=Date.now()+this.params.retainScore}}graft(e,r){let n=this.peerStats.get(e);if(n){let i=this.getPtopicStats(n,r);i&&(i.inMesh=!0,i.graftTime=Date.now(),i.meshTime=0,i.meshMessageDeliveriesActive=!1)}}prune(e,r){let n=this.peerStats.get(e);if(n){let i=this.getPtopicStats(n,r);if(i){let s=this.params.topics[r].meshMessageDeliveriesThreshold;if(i.meshMessageDeliveriesActive&&i.meshMessageDeliveries<s){let o=s-i.meshMessageDeliveries;i.meshFailurePenalty+=o*o}i.meshMessageDeliveriesActive=!1,i.inMesh=!1}}}validateMessage(e){this.deliveryRecords.ensureRecord(e)}deliverMessage(e,r,n){this.markFirstMessageDelivery(e,n);let i=this.deliveryRecords.ensureRecord(r),s=Date.now();if(i.status!==je.unknown){Ln("unexpected delivery: message from %s was first seen %s ago and has delivery status %d",e,s-i.firstSeen,je[i.status]);return}i.status=je.valid,i.validated=s,i.peers.forEach(o=>{o!==e.toString()&&this.markDuplicateMessageDelivery(o,n)})}rejectInvalidMessage(e,r){this.markInvalidMessageDelivery(e,r)}rejectMessage(e,r,n,i){switch(i){case He.Error:this.markInvalidMessageDelivery(e,n);return;case He.Blacklisted:return}let s=this.deliveryRecords.ensureRecord(r);if(s.status!==je.unknown){Ln("unexpected rejection: message from %s was first seen %s ago and has delivery status %d",e,Date.now()-s.firstSeen,je[s.status]);return}if(i===He.Ignore){s.status=je.ignored,s.peers.clear();return}s.status=je.invalid,this.markInvalidMessageDelivery(e,n),s.peers.forEach(o=>{this.markInvalidMessageDelivery(o,n)}),s.peers.clear()}duplicateMessage(e,r,n){let i=this.deliveryRecords.ensureRecord(r);if(!i.peers.has(e))switch(i.status){case je.unknown:i.peers.add(e);break;case je.valid:i.peers.add(e),this.markDuplicateMessageDelivery(e,n,i.validated);break;case je.invalid:this.markInvalidMessageDelivery(e,n);break;case je.ignored:break}}markInvalidMessageDelivery(e,r){let n=this.peerStats.get(e);if(n){let i=this.getPtopicStats(n,r);i&&(i.invalidMessageDeliveries+=1)}}markFirstMessageDelivery(e,r){let n=this.peerStats.get(e);if(n){let i=this.getPtopicStats(n,r);if(i){let s=this.params.topics[r].firstMessageDeliveriesCap;i.firstMessageDeliveries=Math.min(s,i.firstMessageDeliveries+1),i.inMesh&&(s=this.params.topics[r].meshMessageDeliveriesCap,i.meshMessageDeliveries=Math.min(s,i.meshMessageDeliveries+1))}}}markDuplicateMessageDelivery(e,r,n){let i=this.peerStats.get(e);if(i){let s=n!==void 0?Date.now():0,o=this.getPtopicStats(i,r);if(o&&o.inMesh){let a=this.params.topics[r];if(n!==void 0){let u=s-n,f=u>a.meshMessageDeliveriesWindow;if(this.metrics?.onDuplicateMsgDelivery(r,u,f),f)return}let c=a.meshMessageDeliveriesCap;o.meshMessageDeliveries=Math.min(c,o.meshMessageDeliveries+1)}}}getIPs(e){return this.components.getConnectionManager().getConnections(er(e)).map(r=>r.remoteAddr.toOptions().host)}setIPs(e,r,n){e:for(let i of r){for(let o of n)if(i===o)continue e;let s=this.peerIPs.get(i);s||(s=new Set,this.peerIPs.set(i,s)),s.add(e)}e:for(let i of n){for(let o of r)if(i===o)continue e;let s=this.peerIPs.get(i);!s||(s.delete(e),s.size||this.peerIPs.delete(i))}}removeIPs(e,r){r.forEach(n=>{let i=this.peerIPs.get(n);!i||(i.delete(e),i.size||this.peerIPs.delete(n))})}updateIPs(){this.peerStats.forEach((e,r)=>{let n=this.getIPs(r);this.setIPs(r,n,e.ips),e.ips=n})}getPtopicStats(e,r){let n=e.topics[r];return n!==void 0?n:this.params.topics[r]!==void 0?(n={inMesh:!1,graftTime:0,meshTime:0,firstMessageDeliveries:0,meshMessageDeliveries:0,meshMessageDeliveriesActive:!1,meshFailurePenalty:0,invalidMessageDeliveries:0},e.topics[r]=n,n):null}};var Vs=class{constructor(e,r,n){this.gossipsubIWantFollowupMs=e,this.msgIdToStrFn=r,this.metrics=n,this.promises=new Map,this.requestMsByMsg=new Map,this.requestMsByMsgExpire=10*e}get size(){return this.promises.size}get requestMsByMsgSize(){return this.requestMsByMsg.size}addPromise(e,r){let n=Math.floor(Math.random()*r.length),i=r[n],s=this.msgIdToStrFn(i),o=this.promises.get(s);o||(o=new Map,this.promises.set(s,o));let a=Date.now();o.has(e)||(o.set(e,a+this.gossipsubIWantFollowupMs),this.metrics&&(this.metrics.iwantPromiseStarted.inc(1),this.requestMsByMsg.has(s)||this.requestMsByMsg.set(s,a)))}getBrokenPromises(){let e=Date.now(),r=new Map,n=0;return this.promises.forEach((i,s)=>{i.forEach((o,a)=>{o<e&&(r.set(a,(r.get(a)??0)+1),i.delete(a),n++)}),i.size||this.promises.delete(s)}),this.metrics?.iwantPromiseBroken.inc(n),r}deliverMessage(e){this.trackMessage(e);let r=this.promises.get(e);r&&(this.promises.delete(e),this.metrics&&(this.metrics.iwantPromiseResolved.inc(1),this.metrics.iwantPromiseResolvedPeers.inc(r.size)))}rejectMessage(e,r){switch(this.trackMessage(e),r){case He.Error:return}this.promises.delete(e)}clear(){this.promises.clear()}prune(){let e=Date.now()-this.requestMsByMsgExpire;for(let[r,n]of this.requestMsByMsg.entries())if(n<e)this.requestMsByMsg.delete(r);else break}trackMessage(e){if(this.metrics){let r=this.requestMsByMsg.get(e);r!==void 0&&(this.metrics.iwantPromiseDeliveryTime.observe((Date.now()-r)/1e3),this.requestMsByMsg.delete(e))}}};var Nn=class{constructor(e){this.entries=new Map,this.validityMs=e.validityMs}get size(){return this.entries.size}put(e,r){this.entries.set(e,{value:r,validUntilMs:Date.now()+this.validityMs})}prune(){let e=Date.now();for(let[r,n]of this.entries.entries())if(n.validUntilMs<e)this.entries.delete(r);else break}has(e){return this.entries.has(e)}get(e){let r=this.entries.get(e);return r&&r.validUntilMs>=Date.now()?r.value:void 0}clear(){this.entries.clear()}};var l0;(function(t){t.forward="forward",t.publish="publish"})(l0||(l0={}));var nr;(function(t){t.Fanout="fanout",t.Random="random",t.Subscribed="subscribed",t.Outbound="outbound",t.NotEnough="not_enough",t.Opportunistic="opportunistic"})(nr||(nr={}));var Hr;(function(t){t.Dc="disconnected",t.BadScore="bad_score",t.Prune="prune",t.Unsub="unsubscribed",t.Excess="excess"})(Hr||(Hr={}));var Fn;(function(t){t.GraftBackoff="graft_backoff",t.BrokenPromise="broken_promise",t.MessageDeficit="message_deficit",t.IPColocation="IP_colocation"})(Fn||(Fn={}));var Un;(function(t){t.LowScore="low_score",t.MaxIhave="max_ihave",t.MaxIasked="max_iasked"})(Un||(Un={}));var kn;(function(t){t.graylist="graylist",t.publish="publish",t.gossip="gossip",t.mesh="mesh"})(kn||(kn={}));function p0(t,e,r){return{protocolsEnabled:t.gauge({name:"gossipsub_protocol",help:"Status of enabled protocols",labelNames:["protocol"]}),topicSubscriptionStatus:t.gauge({name:"gossipsub_topic_subscription_status",help:"Status of our subscription to this topic",labelNames:["topicStr"]}),topicPeersCount:t.gauge({name:"gossipsub_topic_peer_count",help:"Number of peers subscribed to each topic",labelNames:["topicStr"]}),meshPeerCounts:t.gauge({name:"gossipsub_mesh_peer_count",help:"Number of peers in our mesh",labelNames:["topicStr"]}),meshPeerInclusionEvents:t.gauge({name:"gossipsub_mesh_peer_inclusion_events_total",help:"Number of times we include peers in a topic mesh for different reasons",labelNames:["topic","reason"]}),meshPeerChurnEvents:t.gauge({name:"gossipsub_peer_churn_events_total",help:"Number of times we remove peers in a topic mesh for different reasons",labelNames:["topic","reason"]}),peersPerProtocol:t.gauge({name:"gossipsub_peers_per_protocol_count",help:"Peers connected for each topic",labelNames:["protocol"]}),heartbeatDuration:t.histogram({name:"gossipsub_heartbeat_duration_seconds",help:"The time it takes to complete one iteration of the heartbeat",buckets:[.01,.1,1]}),heartbeatSkipped:t.gauge({name:"gossipsub_heartbeat_skipped",help:"Heartbeat run took longer than heartbeat interval so next is skipped"}),asyncValidationResult:t.gauge({name:"gossipsub_async_validation_result_total",help:"Message validation result for each topic",labelNames:["topic","acceptance"]}),asyncValidationMcacheHit:t.gauge({name:"gossipsub_async_validation_mcache_hit_total",help:"Async validation result reported by the user layer",labelNames:["hit"]}),rpcRecvBytes:t.gauge({name:"gossipsub_rpc_recv_bytes_total",help:"RPC recv"}),rpcRecvCount:t.gauge({name:"gossipsub_rpc_recv_count_total",help:"RPC recv"}),rpcRecvSubscription:t.gauge({name:"gossipsub_rpc_recv_subscription_total",help:"RPC recv"}),rpcRecvMessage:t.gauge({name:"gossipsub_rpc_recv_message_total",help:"RPC recv"}),rpcRecvControl:t.gauge({name:"gossipsub_rpc_recv_control_total",help:"RPC recv"}),rpcRecvIHave:t.gauge({name:"gossipsub_rpc_recv_ihave_total",help:"RPC recv"}),rpcRecvIWant:t.gauge({name:"gossipsub_rpc_recv_iwant_total",help:"RPC recv"}),rpcRecvGraft:t.gauge({name:"gossipsub_rpc_recv_graft_total",help:"RPC recv"}),rpcRecvPrune:t.gauge({name:"gossipsub_rpc_recv_prune_total",help:"RPC recv"}),rpcRecvNotAccepted:t.gauge({name:"gossipsub_rpc_rcv_not_accepted_total",help:"Total count of RPC dropped because acceptFrom() == false"}),rpcSentBytes:t.gauge({name:"gossipsub_rpc_sent_bytes_total",help:"RPC sent"}),rpcSentCount:t.gauge({name:"gossipsub_rpc_sent_count_total",help:"RPC sent"}),rpcSentSubscription:t.gauge({name:"gossipsub_rpc_sent_subscription_total",help:"RPC sent"}),rpcSentMessage:t.gauge({name:"gossipsub_rpc_sent_message_total",help:"RPC sent"}),rpcSentControl:t.gauge({name:"gossipsub_rpc_sent_control_total",help:"RPC sent"}),rpcSentIHave:t.gauge({name:"gossipsub_rpc_sent_ihave_total",help:"RPC sent"}),rpcSentIWant:t.gauge({name:"gossipsub_rpc_sent_iwant_total",help:"RPC sent"}),rpcSentGraft:t.gauge({name:"gossipsub_rpc_sent_graft_total",help:"RPC sent"}),rpcSentPrune:t.gauge({name:"gossipsub_rpc_sent_prune_total",help:"RPC sent"}),msgPublishCount:t.gauge({name:"gossipsub_msg_publish_count_total",help:"Total count of msg published by topic",labelNames:["topic"]}),msgPublishPeers:t.gauge({name:"gossipsub_msg_publish_peers_total",help:"Total count of peers that we publish a msg to",labelNames:["topic"]}),msgPublishPeersByGroup:t.gauge({name:"gossipsub_msg_publish_peers_by_group",help:"Total count of peers (by group) that we publish a msg to",labelNames:["topic","peerGroup"]}),msgPublishBytes:t.gauge({name:"gossipsub_msg_publish_bytes_total",help:"Total count of msg publish data.length bytes",labelNames:["topic"]}),msgForwardCount:t.gauge({name:"gossipsub_msg_forward_count_total",help:"Total count of msg forwarded by topic",labelNames:["topic"]}),msgForwardPeers:t.gauge({name:"gossipsub_msg_forward_peers_total",help:"Total count of peers that we forward a msg to",labelNames:["topic"]}),msgReceivedPreValidation:t.gauge({name:"gossipsub_msg_received_prevalidation_total",help:"Total count of recv msgs before any validation",labelNames:["topic"]}),msgReceivedStatus:t.gauge({name:"gossipsub_msg_received_status_total",help:"Tracks distribution of recv msgs by duplicate, invalid, valid",labelNames:["topic","status"]}),msgReceivedInvalid:t.gauge({name:"gossipsub_msg_received_invalid_total",help:"Tracks specific reason of invalid",labelNames:["topic","error"]}),duplicateMsgDeliveryDelay:t.histogram({name:"gossisub_duplicate_msg_delivery_delay_seconds",help:"Time since the 1st duplicated message validated",labelNames:["topic"],buckets:[.25*r.maxMeshMessageDeliveriesWindowSec,.5*r.maxMeshMessageDeliveriesWindowSec,1*r.maxMeshMessageDeliveriesWindowSec,2*r.maxMeshMessageDeliveriesWindowSec,4*r.maxMeshMessageDeliveriesWindowSec]}),duplicateMsgLateDelivery:t.gauge({name:"gossisub_duplicate_msg_late_delivery_total",help:"Total count of late duplicate message delivery by topic, which triggers P3 penalty",labelNames:["topic"]}),scoreFnCalls:t.gauge({name:"gossipsub_score_fn_calls_total",help:"Total times score() is called"}),scoreFnRuns:t.gauge({name:"gossipsub_score_fn_runs_total",help:"Total times score() call actually computed computeScore(), no cache"}),scoreCachedDelta:t.histogram({name:"gossipsub_score_cache_delta",help:"Delta of score between cached values that expired",buckets:[10,100,1e3]}),peersByScoreThreshold:t.gauge({name:"gossipsub_peers_by_score_threshold_count",help:"Current count of peers by score threshold",labelNames:["threshold"]}),score:t.avgMinMax({name:"gossipsub_score",help:"Avg min max of gossip scores",labelNames:["topic","p"]}),scoreWeights:t.avgMinMax({name:"gossipsub_score_weights",help:"Separate score weights",labelNames:["topic","p"]}),scorePerMesh:t.avgMinMax({name:"gossipsub_score_per_mesh",help:"Histogram of the scores for each mesh topic",labelNames:["topic"]}),scoringPenalties:t.gauge({name:"gossipsub_scoring_penalties_total",help:"A counter of the kind of penalties being applied to peers",labelNames:["penalty"]}),behaviourPenalty:t.histogram({name:"gossipsub_peer_stat_behaviour_penalty",help:"Current peer stat behaviour_penalty at each scrape",buckets:[.25*r.behaviourPenaltyThreshold,.5*r.behaviourPenaltyThreshold,1*r.behaviourPenaltyThreshold,2*r.behaviourPenaltyThreshold,4*r.behaviourPenaltyThreshold]}),ihaveRcvIgnored:t.gauge({name:"gossipsub_ihave_rcv_ignored_total",help:"Total received IHAVE messages that we ignore for some reason",labelNames:["reason"]}),ihaveRcvMsgids:t.gauge({name:"gossipsub_ihave_rcv_msgids_total",help:"Total received IHAVE messages by topic",labelNames:["topic"]}),ihaveRcvNotSeenMsgids:t.gauge({name:"gossipsub_ihave_rcv_not_seen_msgids_total",help:"Total messages per topic we do not have, not actual requests",labelNames:["topic"]}),iwantRcvMsgids:t.gauge({name:"gossipsub_iwant_rcv_msgids_total",help:"Total received IWANT messages by topic",labelNames:["topic"]}),iwantRcvDonthaveMsgids:t.gauge({name:"gossipsub_iwant_rcv_dont_have_msgids_total",help:"Total requested messageIDs that we do not have"}),iwantPromiseStarted:t.gauge({name:"gossipsub_iwant_promise_sent_total",help:"Total count of started IWANT promises"}),iwantPromiseResolved:t.gauge({name:"gossipsub_iwant_promise_resolved_total",help:"Total count of resolved IWANT promises"}),iwantPromiseResolvedPeers:t.gauge({name:"gossipsub_iwant_promise_resolved_peers",help:"Total count of peers we have asked IWANT promises that are resolved"}),iwantPromiseBroken:t.gauge({name:"gossipsub_iwant_promise_broken",help:"Total count of broken IWANT promises"}),iwantPromiseDeliveryTime:t.histogram({name:"gossipsub_iwant_promise_delivery_seconds",help:"Histogram of delivery time of resolved IWANT promises",buckets:[.5*r.gossipPromiseExpireSec,1*r.gossipPromiseExpireSec,2*r.gossipPromiseExpireSec,4*r.gossipPromiseExpireSec]}),cacheSize:t.gauge({name:"gossipsub_cache_size",help:"Unbounded cache sizes",labelNames:["cache"]}),mcacheSize:t.gauge({name:"gossipsub_mcache_size",help:"Current mcache msg count"}),topicStrToLabel:e,toTopic(n){return this.topicStrToLabel.get(n)??n},onJoin(n){this.topicSubscriptionStatus.set({topicStr:n},1),this.meshPeerCounts.set({topicStr:n},0)},onLeave(n){this.topicSubscriptionStatus.set({topicStr:n},0),this.meshPeerCounts.set({topicStr:n},0)},onAddToMesh(n,i,s){let o=this.toTopic(n);this.meshPeerInclusionEvents.inc({topic:o,reason:i},s)},onRemoveFromMesh(n,i,s){let o=this.toTopic(n);this.meshPeerChurnEvents.inc({topic:o,reason:i},s)},onReportValidationMcacheHit(n){this.asyncValidationMcacheHit.inc({hit:n?"hit":"miss"})},onReportValidation(n,i){let s=this.toTopic(n);this.asyncValidationResult.inc({topic:s,acceptance:i})},onScorePenalty(n){this.scoringPenalties.inc({penalty:n},1)},onIhaveRcv(n,i,s){let o=this.toTopic(n);this.ihaveRcvMsgids.inc({topic:o},i),this.ihaveRcvNotSeenMsgids.inc({topic:o},s)},onIwantRcv(n,i){for(let[s,o]of n){let a=this.toTopic(s);this.iwantRcvMsgids.inc({topic:a},o)}this.iwantRcvDonthaveMsgids.inc(i)},onForwardMsg(n,i){let s=this.toTopic(n);this.msgForwardCount.inc({topic:s},1),this.msgForwardPeers.inc({topic:s},i)},onPublishMsg(n,i,s,o){let a=this.toTopic(n);this.msgPublishCount.inc({topic:a},1),this.msgPublishBytes.inc({topic:a},s*o),this.msgPublishPeers.inc({topic:a},s),this.msgPublishPeersByGroup.inc({topic:a,peerGroup:"direct"},i.direct),this.msgPublishPeersByGroup.inc({topic:a,peerGroup:"floodsub"},i.floodsub),this.msgPublishPeersByGroup.inc({topic:a,peerGroup:"mesh"},i.mesh),this.msgPublishPeersByGroup.inc({topic:a,peerGroup:"fanout"},i.fanout)},onMsgRecvPreValidation(n){let i=this.toTopic(n);this.msgReceivedPreValidation.inc({topic:i},1)},onMsgRecvResult(n,i){let s=this.toTopic(n);this.msgReceivedStatus.inc({topic:s,status:i})},onMsgRecvInvalid(n,i){let s=this.toTopic(n),o=i.reason===He.Error?i.error:i.reason;this.msgReceivedInvalid.inc({topic:s,error:o},1)},onDuplicateMsgDelivery(n,i,s){if(this.duplicateMsgDeliveryDelay.observe(i/1e3),s){let o=this.toTopic(n);this.duplicateMsgLateDelivery.inc({topic:o},1)}},onRpcRecv(n,i){this.rpcRecvBytes.inc(i),this.rpcRecvCount.inc(1),this.rpcRecvSubscription.inc(n.subscriptions.length),this.rpcRecvMessage.inc(n.messages.length),n.control&&(this.rpcRecvControl.inc(1),this.rpcRecvIHave.inc(n.control.ihave.length),this.rpcRecvIWant.inc(n.control.iwant.length),this.rpcRecvGraft.inc(n.control.graft.length),this.rpcRecvPrune.inc(n.control.prune.length))},onRpcSent(n,i){if(this.rpcSentBytes.inc(i),this.rpcSentCount.inc(1),this.rpcSentSubscription.inc(n.subscriptions.length),this.rpcSentMessage.inc(n.messages.length),n.control){let s=n.control.ihave.length,o=n.control.iwant.length,a=n.control.graft.length,c=n.control.prune.length;s>0&&this.rpcSentIHave.inc(s),o>0&&this.rpcSentIWant.inc(o),a>0&&this.rpcSentGraft.inc(a),c>0&&this.rpcSentPrune.inc(c),(s>0||o>0||a>0||c>0)&&this.rpcSentControl.inc(1)}},registerScores(n,i){let s=0,o=0,a=0,c=0;for(let u of n)u>=i.graylistThreshold&&s++,u>=i.publishThreshold&&o++,u>=i.gossipThreshold&&a++,u>=0&&c++;this.peersByScoreThreshold.set({threshold:kn.graylist},s),this.peersByScoreThreshold.set({threshold:kn.publish},o),this.peersByScoreThreshold.set({threshold:kn.gossip},a),this.peersByScoreThreshold.set({threshold:kn.mesh},c),this.score.set(n)},registerScoreWeights(n){for(let[i,s]of n.byTopic)this.scoreWeights.set({topic:i,p:"p1"},s.p1w),this.scoreWeights.set({topic:i,p:"p2"},s.p2w),this.scoreWeights.set({topic:i,p:"p3"},s.p3w),this.scoreWeights.set({topic:i,p:"p3b"},s.p3bw),this.scoreWeights.set({topic:i,p:"p4"},s.p4w);this.scoreWeights.set({p:"p5"},n.p5w),this.scoreWeights.set({p:"p6"},n.p6w),this.scoreWeights.set({p:"p7"},n.p7w)},registerScorePerMesh(n,i){let s=new Map;n.forEach((o,a)=>{let c=this.topicStrToLabel.get(a)??"unknown",u=s.get(c);u||(u=new Set,s.set(c,u)),o.forEach(f=>u?.add(f))});for(let[o,a]of s){let c=[];a.forEach(u=>{c.push(i.get(u)??0)}),this.scorePerMesh.set({topic:o},c)}}}}var zc=O(Vc(),1);var zp=pe("libp2p-pubsub:");async function Gp(t,e,r){switch(t.type){case rr.Signing:{let n={from:t.author.toBytes(),data:r,seqno:(0,zc.randomBytes)(8),topic:e,signature:void 0,key:void 0},i=le([zp,wr.Message.encode(n)]);return n.signature=await t.privateKey.sign(i),n.key=t.key,n}case rr.Author:return{from:t.author.toBytes(),data:r,seqno:(0,zc.randomBytes)(8),topic:e,signature:void 0,key:void 0};case rr.Anonymous:return{from:void 0,data:r,seqno:void 0,topic:e,signature:void 0,key:void 0}}}async function Hp(t,e){switch(t){case Dn:return e.signature!=null?{valid:!1,error:ze.SignaturePresent}:e.seqno!=null?{valid:!1,error:ze.SeqnoPresent}:e.key!=null?{valid:!1,error:ze.FromPresent}:{valid:!0,fromPeerId:null};case zr:{if(e.seqno==null)return{valid:!1,error:ze.InvalidSeqno};if(e.seqno.length!==8)return{valid:!1,error:ze.InvalidSeqno};if(e.signature==null)return{valid:!1,error:ze.InvalidSignature};if(e.from==null)return{valid:!1,error:ze.InvalidPeerId};let r;try{r=Ot(e.from)}catch{return{valid:!1,error:ze.InvalidPeerId}}let n;if(e.key){if(n=wi(e.key),r.publicKey!==void 0&&!Be(n.bytes,r.publicKey))return{valid:!1,error:ze.InvalidPeerId}}else{if(r.publicKey==null)return{valid:!1,error:ze.InvalidPeerId};n=wi(r.publicKey)}let i={from:e.from,data:e.data,seqno:e.seqno,topic:e.topic,signature:void 0,key:void 0},s=le([zp,wr.Message.encode(i)]);return await n.verify(s,e.signature)?{valid:!0,fromPeerId:r}:{valid:!1,error:ze.InvalidSignature}}}}var I2=O(Vc(),1);var C2=O(De(),1);var Wp=(t,e)=>{let r=pe(e.toString(16).padStart(16,"0"),"base16"),n=new Uint8Array(t.length+r.length);return n.set(t,0),n.set(r,t.length),n};function $p(t){if(t.sequenceNumber==null)throw Error("missing seqno field");return Wp(t.from.toBytes(),t.sequenceNumber)}async function Yp(t){return await Ce.encode(t.data)}function B2(t,e,r,n,i){let s=0,o=new Map;if(Object.entries(e.topics).forEach(([l,g])=>{let p=i.get(l)??"unknown",d=r.topics[l];if(d===void 0)return;let m=o.get(p);m||(m={p1w:0,p2w:0,p3w:0,p3bw:0,p4w:0},o.set(p,m));let b=0,S=0,I=0,R=0,w=0;g.inMesh&&(b+=Math.max(g.meshTime/d.timeInMeshQuantum,d.timeInMeshCap)*d.timeInMeshWeight);let T=g.firstMessageDeliveries;if(T>d.firstMessageDeliveriesCap&&(T=d.firstMessageDeliveriesCap),S+=T*d.firstMessageDeliveriesWeight,g.meshMessageDeliveriesActive&&g.meshMessageDeliveries<d.meshMessageDeliveriesThreshold){let V=d.meshMessageDeliveriesThreshold-g.meshMessageDeliveries;I+=V*V*d.meshMessageDeliveriesWeight}R+=g.meshFailurePenalty*d.meshFailurePenaltyWeight,w+=g.invalidMessageDeliveries*g.invalidMessageDeliveries*d.invalidMessageDeliveriesWeight,s+=(b+S+I+R+w)*d.topicWeight,m.p1w+=b,m.p2w+=S,m.p3w+=I,m.p3bw+=R,m.p4w+=w}),r.topicScoreCap>0&&s>r.topicScoreCap){s=r.topicScoreCap;let l=r.topicScoreCap/s;for(let g of o.values())g.p1w*=l,g.p2w*=l,g.p3w*=l,g.p3bw*=l,g.p4w*=l}let a=0,c=0,u=0;return a+=r.appSpecificScore(t)*r.appSpecificWeight,e.ips.forEach(l=>{if(r.IPColocationFactorWhitelist.has(l))return;let g=n.get(l),p=g?g.size:0;if(p>r.IPColocationFactorThreshold){let d=p-r.IPColocationFactorThreshold;c+=d*d*r.IPColocationFactorWeight}}),u+=e.behaviourPenalty*e.behaviourPenalty*r.behaviourPenaltyWeight,s+=a+c+u,{byTopic:o,p5w:a,p6w:c,p7w:u,score:s}}function Zp(t,e,r,n,i){let s={byTopic:new Map,p5w:[],p6w:[],p7w:[],score:[]};for(let o of t){let a=e.get(o);if(a){let c=B2(o,a,r,n,i);for(let[u,f]of c.byTopic){let h=s.byTopic.get(u);h||(h={p1w:[],p2w:[],p3w:[],p3bw:[],p4w:[]},s.byTopic.set(u,h)),h.p1w.push(f.p1w),h.p2w.push(f.p2w),h.p3w.push(f.p3w),h.p3bw.push(f.p3bw),h.p4w.push(f.p4w)}s.p5w.push(c.p5w),s.p6w.push(c.p6w),s.p7w.push(c.p7w),s.score.push(c.score)}else s.p5w.push(0),s.p6w.push(0),s.p7w.push(0),s.score.push(0)}return s}function uo(t,e,r=()=>!0){let n=new Set;if(e<=0)return n;for(let i of t){if(n.size>=e)break;r(i)&&(n.add(i),t.delete(i))}return n}function jp(t,e){return uo(t,e,()=>!0)}var nE=Pn,ft;(function(t){t[t.started=0]="started",t[t.stopped=1]="stopped"})(ft||(ft={}));var fo=class extends Bn{constructor(e={}){super(),this.multicodecs=[Pn,Bi],this.peers=new Map,this.direct=new Set,this.floodsubPeers=new Set,this.acceptFromWhitelist=new Map,this.topics=new Map,this.subscriptions=new Set,this.mesh=new Map,this.fanout=new Map,this.fanoutLastpub=new Map,this.gossip=new Map,this.control=new Map,this.peerhave=new Map,this.iasked=new Map,this.backoff=new Map,this.outbound=new Map,this.topicValidators=new Map,this.heartbeatTicks=0,this.components=new Mn,this.directPeerInitial=null,this.status={code:ft.stopped},this.heartbeatTimer=null,this.runHeartbeat=()=>{let n=this.metrics?.heartbeatDuration.startTimer();this.heartbeat().catch(i=>{this.log("Error running heartbeat",i)}).finally(()=>{if(n?.(),this.status.code===ft.started){clearTimeout(this.status.heartbeatTimeout);let i=(Date.now()-this.status.hearbeatStartMs)%this.opts.heartbeatInterval;i<this.opts.heartbeatInterval*.25&&(i+=this.opts.heartbeatInterval,this.metrics?.heartbeatSkipped.inc()),this.status.heartbeatTimeout=setTimeout(this.runHeartbeat,i)}})};let r={fallbackToFloodsub:!0,floodPublish:!0,doPX:!1,directPeers:[],D:6,Dlo:4,Dhi:12,Dscore:4,Dout:2,Dlazy:6,heartbeatInterval:1e3,fanoutTTL:6e4,mcacheLength:5,mcacheGossip:3,seenTTL:12e4,gossipsubIWantFollowupMs:3e3,prunePeers:16,pruneBackoff:6e4,graftFloodThreshold:1e4,opportunisticGraftPeers:2,opportunisticGraftTicks:60,directConnectTicks:300,...e,scoreParams:s0(e.scoreParams),scoreThresholds:a0(e.scoreThresholds)};if(this.globalSignaturePolicy=r.globalSignaturePolicy??zr,r.fallbackToFloodsub&&this.multicodecs.push(Qa),this.log=Cn(r.debugName??"libp2p:gossipsub"),this.opts=r,this.direct=new Set(r.directPeers.map(n=>n.id.toString())),this.seenCache=new Nn({validityMs:r.seenTTL}),this.publishedMessageIds=new Nn({validityMs:r.seenTTL}),e.msgIdFn)this.msgIdFn=e.msgIdFn;else switch(this.globalSignaturePolicy){case zr:this.msgIdFn=$p;break;case Dn:this.msgIdFn=Yp;break}if(e.fastMsgIdFn&&(this.fastMsgIdFn=e.fastMsgIdFn,this.fastMsgIdCache=new Nn({validityMs:r.seenTTL})),this.msgIdToStrFn=e.msgIdToStrFn??n0,this.mcache=e.messageCache||new Us(r.mcacheGossip,r.mcacheLength,this.msgIdToStrFn),e.dataTransform&&(this.dataTransform=e.dataTransform),e.metricsRegister){if(!e.metricsTopicStrToLabel)throw Error("Must set metricsTopicStrToLabel with metrics");let n=Math.max(...Object.values(r.scoreParams.topics).map(s=>s.meshMessageDeliveriesWindow),1e3),i=p0(e.metricsRegister,e.metricsTopicStrToLabel,{gossipPromiseExpireSec:this.opts.gossipsubIWantFollowupMs/1e3,behaviourPenaltyThreshold:r.scoreParams.behaviourPenaltyThreshold,maxMeshMessageDeliveriesWindowSec:n/1e3});i.mcacheSize.addCollect(()=>this.onScrapeMetrics(i));for(let s of this.multicodecs)i.protocolsEnabled.set({protocol:s},1);this.metrics=i}else this.metrics=null;this.gossipTracer=new Vs(this.opts.gossipsubIWantFollowupMs,this.msgIdToStrFn,this.metrics),this.score=new qs(this.opts.scoreParams,this.metrics,{scoreCacheValidityMs:r.heartbeatInterval})}getPeers(){return[...this.peers.keys()].map(e=>er(e))}isStarted(){return this.status.code===ft.started}async init(e){this.components=e,this.score.init(e)}async start(){if(this.isStarted())return;this.log("starting"),this.publishConfig=await ec(this.globalSignaturePolicy,this.components.getPeerId()),await Promise.all(this.opts.directPeers.map(async i=>{await this.components.getPeerStore().addressBook.add(i.id,i.addrs)})),await this.components.getRegistrar().handle(this.multicodecs,this.onIncomingStream.bind(this));let e=Yl({onConnect:this.onPeerConnected.bind(this),onDisconnect:this.onPeerDisconnected.bind(this)}),r=await this.components.getRegistrar().register(this.multicodecs,e),n=setTimeout(this.runHeartbeat,100);this.status={code:ft.started,registrarTopologyId:r,heartbeatTimeout:n,hearbeatStartMs:Date.now()+100},this.log("started"),this.score.start(),this.directPeerInitial=setTimeout(()=>{Promise.resolve().then(async()=>{await Promise.all(Array.from(this.direct).map(async i=>await this.connect(i)))}).catch(i=>{this.log(i)})},1e3)}async stop(){if(this.log("stopping"),this.status.code!==ft.started)return;let{registrarTopologyId:e}=this.status;this.status={code:ft.stopped},this.components.getRegistrar().unregister(e);for(let r of this.peers.values())r.close();this.peers.clear(),this.subscriptions.clear(),this.heartbeatTimer&&(this.heartbeatTimer.cancel(),this.heartbeatTimer=null),this.score.stop(),this.mesh.clear(),this.fanout.clear(),this.fanoutLastpub.clear(),this.gossip.clear(),this.control.clear(),this.peerhave.clear(),this.iasked.clear(),this.backoff.clear(),this.outbound.clear(),this.gossipTracer.clear(),this.seenCache.clear(),this.fastMsgIdCache&&this.fastMsgIdCache.clear(),this.directPeerInitial&&clearTimeout(this.directPeerInitial),this.log("stopped")}dumpPeerScoreStats(){return this.score.dumpPeerScoreStats()}onIncomingStream({protocol:e,stream:r,connection:n}){if(!this.isStarted())return;let i=n.remotePeer,o=this.addPeer(i,e,n.stat.direction).attachInboundStream(r);this.pipePeerReadStream(i,o).catch(a=>this.log(a))}onPeerConnected(e,r){!this.isStarted()||(this.log("topology peer connected %p %s",e,r.stat.direction),Promise.resolve().then(async()=>{try{let{stream:n,protocol:i}=await r.newStream(this.multicodecs);await this.addPeer(e,i,r.stat.direction).attachOutboundStream(n)}catch(n){this.log(n)}this.subscriptions.size>0&&this.sendSubscriptions(e.toString(),Array.from(this.subscriptions),!0)}))}onPeerDisconnected(e){this.log("connection ended %p",e),this.removePeer(e)}addPeer(e,r,n){let i=e.toString(),s=this.peers.get(i);return s===void 0&&(this.log("new peer %p",e),s=new Fs({id:e,protocol:r}),this.peers.set(i,s),s.addEventListener("close",()=>this.removePeer(e))),this.score.addPeer(i),r===Qa&&this.floodsubPeers.add(i),this.metrics?.peersPerProtocol.inc({protocol:r},1),this.outbound.get(i)||this.outbound.set(i,n==="outbound"),s}removePeer(e){let r=e.toString(),n=this.peers.get(r);if(n!=null){this.metrics?.peersPerProtocol.inc({protocol:n.protocol},-1),this.log("delete peer %p",e),this.peers.delete(r),n.close();for(let i of this.topics.values())i.delete(r)}for(let[i,s]of this.mesh)s.delete(r)===!0&&this.metrics?.onRemoveFromMesh(i,Hr.Dc,1);for(let i of this.fanout.values())i.delete(r);return this.floodsubPeers.delete(r),this.gossip.delete(r),this.control.delete(r),this.outbound.delete(r),this.score.removePeer(r),this.acceptFromWhitelist.delete(r),n}get started(){return this.status.code===ft.started}getMeshPeers(e){let r=this.mesh.get(e);return r?Array.from(r):[]}getSubscribers(e){let r=this.topics.get(e);return(r?Array.from(r):[]).map(n=>er(n))}getTopics(){return Array.from(this.subscriptions)}async pipePeerReadStream(e,r){try{await Zn(r,async n=>{for await(let i of n)try{let s=i instanceof Uint8Array?i:i.slice(),o=wr.decode(s);this.metrics?.onRpcRecv(o,s.length),this.opts.awaitRpcHandler?await this.handleReceivedRpc(e,o):this.handleReceivedRpc(e,o).catch(a=>this.log(a))}catch(s){this.log(s)}})}catch(n){this.log.error(n),this.onPeerDisconnected(e)}}async handleReceivedRpc(e,r){if(!this.acceptFrom(e.toString())){this.log("received message from unacceptable peer %p",e),this.metrics?.rpcRecvNotAccepted.inc();return}this.log("rpc from %p",e),r.subscriptions.length>0&&(r.subscriptions.forEach(n=>{this.handleReceivedSubscription(e,n)}),this.dispatchEvent(new yt("subscription-change",{detail:{peerId:e,subscriptions:r.subscriptions.filter(n=>n.topic!==null).map(n=>({topic:n.topic??"",subscribe:Boolean(n.subscribe)}))}})));for(let n of r.messages){let i=this.handleReceivedMessage(e,n).catch(s=>this.log(s));this.opts.awaitRpcMessageHandler&&await i}r.control&&await this.handleControlMessage(e.toString(),r.control)}handleReceivedSubscription(e,r){if(r.topic==null)return;this.log("subscription update from %p topic %s",e,r.topic);let n=this.topics.get(r.topic);n==null&&(n=new Set,this.topics.set(r.topic,n)),r.subscribe?n.add(e.toString()):n.delete(e.toString())}async handleReceivedMessage(e,r){this.metrics?.onMsgRecvPreValidation(r.topic);let n=await this.validateReceivedMessage(e,r);switch(this.metrics?.onMsgRecvResult(r.topic,n.code),n.code){case ut.duplicate:this.score.duplicateMessage(e.toString(),n.msgIdStr,r.topic),this.mcache.observeDuplicate(n.msgIdStr,e.toString());return;case ut.invalid:if(n.msgIdStr){let i=n.msgIdStr;this.score.rejectMessage(e.toString(),i,r.topic,n.reason),this.gossipTracer.rejectMessage(i,n.reason)}else this.score.rejectInvalidMessage(e.toString(),r.topic);this.metrics?.onMsgRecvInvalid(r.topic,n);return;case ut.valid:this.score.validateMessage(n.messageId.msgIdStr),this.gossipTracer.deliverMessage(n.messageId.msgIdStr),this.mcache.put(n.messageId,r,!this.opts.asyncValidation),this.subscriptions.has(r.topic)&&(!this.components.getPeerId().equals(e)||this.opts.emitSelf)&&(super.dispatchEvent(new yt("gossipsub:message",{detail:{propagationSource:e,msgId:n.messageId.msgIdStr,msg:n.msg}})),super.dispatchEvent(new yt("message",{detail:n.msg}))),this.opts.asyncValidation||this.forwardMessage(n.messageId.msgIdStr,r,e.toString())}}async validateReceivedMessage(e,r){let n=this.fastMsgIdFn?.(r),i=n?this.fastMsgIdCache?.get(n):void 0;if(i)return{code:ut.duplicate,msgIdStr:i};let s=await Hp(this.globalSignaturePolicy,r);if(!s.valid)return{code:ut.invalid,reason:He.Error,error:s.error};let o;try{let l=r.data??new Uint8Array(0);o=this.dataTransform?this.dataTransform.inboundTransform(r.topic,l):l}catch(l){return this.log("Invalid message, transform failed",l),{code:ut.invalid,reason:He.Error,error:ze.TransformFailed}}if(r.from==null)return this.log("Invalid message, transform failed"),{code:ut.invalid,reason:He.Error,error:ze.TransformFailed};let a={from:Ot(r.from),data:o,sequenceNumber:r.seqno==null?void 0:BigInt(`0x${H(r.seqno,"base16")}`),topic:r.topic},c=await this.msgIdFn(a),u=this.msgIdToStrFn(c),f={msgId:c,msgIdStr:u};if(n&&this.fastMsgIdCache?.put(n,u),this.seenCache.has(u))return{code:ut.duplicate,msgIdStr:u};this.seenCache.put(u);let h=this.topicValidators.get(r.topic);if(h!=null){let l;try{l=await h(a.topic,a,e)}catch(g){let p=g.code;p===r0&&(l=zt.Ignore),p===t0?l=zt.Reject:l=zt.Ignore}if(l!==zt.Accept)return{code:ut.invalid,reason:Ja(l),msgIdStr:u}}return{code:ut.valid,messageId:f,msg:a}}getScore(e){return this.score.score(e)}sendSubscriptions(e,r,n){this.sendRpc(e,{subscriptions:r.map(i=>({topic:i,subscribe:n})),messages:[]})}async handleControlMessage(e,r){if(r===void 0)return;let n=this.handleIHave(e,r.ihave),i=this.handleIWant(e,r.iwant),s=await this.handleGraft(e,r.graft);await this.handlePrune(e,r.prune),!(!n.length&&!i.length&&!s.length)&&this.sendRpc(e,qt(i,{iwant:n,prune:s}))}acceptFrom(e){if(this.direct.has(e))return!0;let r=Date.now(),n=this.acceptFromWhitelist.get(e);if(n&&n.messagesAccepted<128&&n.acceptUntil>=r)return n.messagesAccepted+=1,!0;let i=this.score.score(e);return i>=0?this.acceptFromWhitelist.set(e,{messagesAccepted:0,acceptUntil:r+1e3}):this.acceptFromWhitelist.delete(e),i>=this.opts.scoreThresholds.graylistThreshold}handleIHave(e,r){if(!r.length)return[];let n=this.score.score(e);if(n<this.opts.scoreThresholds.gossipThreshold)return this.log("IHAVE: ignoring peer %s with score below threshold [ score = %d ]",e,n),this.metrics?.ihaveRcvIgnored.inc({reason:Un.LowScore}),[];let i=(this.peerhave.get(e)??0)+1;if(this.peerhave.set(e,i),i>10)return this.log("IHAVE: peer %s has advertised too many times (%d) within this heartbeat interval; ignoring",e,i),this.metrics?.ihaveRcvIgnored.inc({reason:Un.MaxIhave}),[];let s=this.iasked.get(e)??0;if(s>=5e3)return this.log("IHAVE: peer %s has already advertised too many messages (%d); ignoring",e,s),this.metrics?.ihaveRcvIgnored.inc({reason:Un.MaxIasked}),[];let o=new Map;if(r.forEach(({topicID:u,messageIDs:f})=>{if(!u||!this.mesh.has(u))return;let h=0;f.forEach(l=>{let g=this.msgIdToStrFn(l);this.seenCache.has(g)||(o.set(g,l),h++)}),this.metrics?.onIhaveRcv(u,f.length,h)}),!o.size)return[];let a=o.size;a+s>5e3&&(a=5e3-s),this.log("IHAVE: Asking for %d out of %d messages from %s",a,o.size,e);let c=Array.from(o.values());return Vt(c),c=c.slice(0,a),this.iasked.set(e,s+a),this.gossipTracer.addPromise(e,c),[{messageIDs:c}]}handleIWant(e,r){if(!r.length)return[];let n=this.score.score(e);if(n<this.opts.scoreThresholds.gossipThreshold)return this.log("IWANT: ignoring peer %s with score below threshold [score = %d]",e,n),[];let i=new Map,s=new Map,o=0;return r.forEach(({messageIDs:a})=>{a.forEach(c=>{let u=this.msgIdToStrFn(c),f=this.mcache.getWithIWantCount(u,e);if(f==null){o++;return}if(s.set(f.msg.topic,1+(s.get(f.msg.topic)??0)),f.count>3){this.log("IWANT: Peer %s has asked for message %s too many times: ignoring request",e,c);return}i.set(u,f.msg)})}),this.metrics?.onIwantRcv(s,o),i.size?(this.log("IWANT: Sending %d messages to %s",i.size,e),Array.from(i.values())):(this.log("IWANT: Could not provide any wanted messages to %s",e),[])}async handleGraft(e,r){let n=[],i=this.score.score(e),s=Date.now(),o=this.opts.doPX;return r.forEach(({topicID:a})=>{if(!a)return;let c=this.mesh.get(a);if(!c){o=!1;return}if(c.has(e))return;if(this.direct.has(e)){this.log("GRAFT: ignoring request from direct peer %s",e),n.push(a),o=!1;return}let u=this.backoff.get(a)?.get(e);if(typeof u=="number"&&s<u){this.log("GRAFT: ignoring backed off peer %s",e),this.score.addPenalty(e,1,Fn.GraftBackoff),o=!1;let f=u+this.opts.graftFloodThreshold-this.opts.pruneBackoff;s<f&&this.score.addPenalty(e,1,Fn.GraftBackoff),this.addBackoff(e,a),n.push(a);return}if(i<0){this.log("GRAFT: ignoring peer %s with negative score: score=%d, topic=%s",e,i,a),n.push(a),o=!1,this.addBackoff(e,a);return}if(c.size>=this.opts.Dhi&&!this.outbound.get(e)){n.push(a),this.addBackoff(e,a);return}this.log("GRAFT: Add mesh link from %s in %s",e,a),this.score.graft(e,a),c.add(e),this.metrics?.onAddToMesh(a,nr.Subscribed,1)}),n.length?await Promise.all(n.map(a=>this.makePrune(e,a,o))):[]}async handlePrune(e,r){let n=this.score.score(e);for(let{topicID:i,backoff:s,peers:o}of r){if(i==null)continue;let a=this.mesh.get(i);if(!a)return;if(this.log("PRUNE: Remove mesh link to %s in %s",e,i),this.score.prune(e,i),a.has(e)&&(a.delete(e),this.metrics?.onRemoveFromMesh(i,Hr.Unsub,1)),typeof s=="number"&&s>0?this.doAddBackoff(e,i,s*1e3):this.addBackoff(e,i),o.length){if(n<this.opts.scoreThresholds.acceptPXThreshold){this.log("PRUNE: ignoring PX from peer %s with insufficient score [score = %d, topic = %s]",e,n,i);continue}await this.pxConnect(o)}}}addBackoff(e,r){this.doAddBackoff(e,r,this.opts.pruneBackoff)}doAddBackoff(e,r,n){let i=this.backoff.get(r);i||(i=new Map,this.backoff.set(r,i));let s=Date.now()+n;(i.get(e)??0)<s&&i.set(e,s)}applyIwantPenalties(){this.gossipTracer.getBrokenPromises().forEach((e,r)=>{this.log("peer %s didn't follow up in %d IWANT requests; adding penalty",r,e),this.score.addPenalty(r,e,Fn.BrokenPromise)})}clearBackoff(){if(this.heartbeatTicks%15!==0)return;let e=Date.now();this.backoff.forEach((r,n)=>{r.forEach((i,s)=>{i<e&&r.delete(s)}),r.size===0&&this.backoff.delete(n)})}async directConnect(){let e=[];this.direct.forEach(r=>{let n=this.peers.get(r);(!n||!n.isWritable)&&e.push(r)}),await Promise.all(e.map(async r=>await this.connect(r)))}async pxConnect(e){e.length>this.opts.prunePeers&&(Vt(e),e=e.slice(0,this.opts.prunePeers));let r=[];await Promise.all(e.map(async n=>{if(!n.peerID)return;let i=Ot(n.peerID).toString();if(!this.peers.has(i)){if(!n.signedPeerRecord){r.push(i);return}try{let s=await gt.openAndCertify(n.signedPeerRecord,"libp2p-peer-record"),o=s.peerId;if(!s.peerId.equals(i)){this.log("bogus peer record obtained through px: peer ID %p doesn't match expected peer %p",o,i);return}if(!await this.components.getPeerStore().addressBook.consumePeerRecord(s)){this.log("bogus peer record obtained through px: could not add peer record to address book");return}r.push(i)}catch{this.log("bogus peer record obtained through px: invalid signature or not a peer record")}}})),r.length&&await Promise.all(r.map(async n=>await this.connect(n)))}async connect(e){this.log("Initiating connection with %s",e),await(await this.components.getConnectionManager().openConnection(er(e))).newStream(this.multicodecs)}subscribe(e){if(this.status.code!==ft.started)throw new Error("Pubsub has not started");if(!this.subscriptions.has(e)){this.subscriptions.add(e);for(let r of this.peers.keys())this.sendSubscriptions(r,[e],!0)}this.join(e)}unsubscribe(e){if(this.status.code!==ft.started)throw new Error("Pubsub is not started");let r=this.subscriptions.delete(e);if(this.log("unsubscribe from %s - am subscribed %s",e,r),r)for(let n of this.peers.keys())this.sendSubscriptions(n,[e],!1);this.leave(e).catch(n=>{this.log(n)})}join(e){if(this.status.code!==ft.started)throw new Error("Gossipsub has not started");if(this.mesh.has(e))return;this.log("JOIN %s",e),this.metrics?.onJoin(e);let r=new Set,n=this.fanout.get(e);if(n&&(this.fanout.delete(e),this.fanoutLastpub.delete(e),n.forEach(i=>{!this.direct.has(i)&&this.score.score(i)>=0&&r.add(i)}),this.metrics?.onAddToMesh(e,nr.Fanout,r.size)),r.size<this.opts.D){let i=r.size;this.getRandomGossipPeers(e,this.opts.D,o=>!r.has(o)&&!this.direct.has(o)&&this.score.score(o)>=0).forEach(o=>{r.add(o)}),this.metrics?.onAddToMesh(e,nr.Random,r.size-i)}this.mesh.set(e,r),r.forEach(i=>{this.log("JOIN: Add mesh link to %s in %s",i,e),this.sendGraft(i,e)})}async leave(e){if(this.status.code!==ft.started)throw new Error("Gossipsub has not started");this.log("LEAVE %s",e),this.metrics?.onLeave(e);let r=this.mesh.get(e);r&&(await Promise.all(Array.from(r).map(async n=>(this.log("LEAVE: Remove mesh link to %s in %s",n,e),await this.sendPrune(n,e)))),this.mesh.delete(e))}selectPeersToForward(e,r,n){let i=new Set,s=this.topics.get(e);s&&(this.direct.forEach(a=>{s.has(a)&&r!==a&&!n?.has(a)&&i.add(a)}),this.floodsubPeers.forEach(a=>{s.has(a)&&r!==a&&!n?.has(a)&&this.score.score(a)>=this.opts.scoreThresholds.publishThreshold&&i.add(a)}));let o=this.mesh.get(e);return o&&o.size>0&&o.forEach(a=>{r!==a&&!n?.has(a)&&i.add(a)}),i}selectPeersToPublish(e){let r=new Set,n={direct:0,floodsub:0,mesh:0,fanout:0},i=this.topics.get(e);if(i)if(this.opts.floodPublish)i.forEach(s=>{this.direct.has(s)?(r.add(s),n.direct++):this.score.score(s)>=this.opts.scoreThresholds.publishThreshold&&(r.add(s),n.floodsub++)});else{this.direct.forEach(o=>{i.has(o)&&(r.add(o),n.direct++)}),this.floodsubPeers.forEach(o=>{i.has(o)&&this.score.score(o)>=this.opts.scoreThresholds.publishThreshold&&(r.add(o),n.floodsub++)});let s=this.mesh.get(e);if(s&&s.size>0)s.forEach(o=>{r.add(o),n.mesh++});else{let o=this.fanout.get(e);if(o&&o.size>0)o.forEach(a=>{r.add(a),n.fanout++});else{let a=this.getRandomGossipPeers(e,this.opts.D,c=>this.score.score(c)>=this.opts.scoreThresholds.publishThreshold);a.size>0&&(this.fanout.set(e,a),a.forEach(c=>{r.add(c),n.fanout++}))}this.fanoutLastpub.set(e,Date.now())}}return{tosend:r,tosendCount:n}}forwardMessage(e,r,n,i){n&&this.score.deliverMessage(n,e,r.topic);let s=this.selectPeersToForward(r.topic,n,i),o=qt([r]);s.forEach(a=>{this.sendRpc(a,o)}),this.metrics?.onForwardMsg(r.topic,s.size)}async publish(e,r){let n=this.dataTransform?this.dataTransform.outboundTransform(e,r):r;if(this.publishConfig==null)throw Error("PublishError.Uninitialized");let i=await Gp(this.publishConfig,e,n);if(i.from==null)throw Error("PublishError.InvalidMessage");let s={from:Ot(i.from),data:r,sequenceNumber:i.seqno==null?void 0:BigInt(`0x${H(i.seqno,"base16")}`),topic:e,signature:i.signature,key:i.key},o=await this.msgIdFn(s),a=this.msgIdToStrFn(o);if(this.seenCache.has(a))throw Error("PublishError.Duplicate");let{tosend:c,tosendCount:u}=this.selectPeersToPublish(i.topic),f=this.opts.emitSelf===!0&&this.subscriptions.has(e);if(c.size===0&&!this.opts.allowPublishToZeroPeers&&!f)throw Error("PublishError.InsufficientPeers");this.seenCache.put(a),this.mcache.put({msgId:o,msgIdStr:a},i,!0),this.publishedMessageIds.put(a);let h=qt([i]);for(let l of c)this.sendRpc(l,h)||c.delete(l);return this.metrics?.onPublishMsg(e,u,c.size,i.data!=null?i.data.length:0),f&&(c.add(this.components.getPeerId().toString()),super.dispatchEvent(new yt("gossipsub:message",{detail:{propagationSource:this.components.getPeerId(),msgId:a,msg:s}})),super.dispatchEvent(new yt("message",{detail:s}))),{recipients:Array.from(c.values()).map(l=>er(l))}}reportMessageValidationResult(e,r,n){if(n===zt.Accept){let i=this.mcache.validate(e);if(this.metrics?.onReportValidationMcacheHit(i!==null),i!=null){let{message:s,originatingPeers:o}=i;this.score.deliverMessage(r.toString(),e,s.topic),this.forwardMessage(e,i.message,r.toString(),o),this.metrics?.onReportValidation(s.topic,n)}}else{let i=this.mcache.remove(e);if(this.metrics?.onReportValidationMcacheHit(i!==null),i){let s=Ja(n),{message:o,originatingPeers:a}=i;this.score.rejectMessage(r.toString(),e,o.topic,s);for(let c of a)this.score.rejectMessage(c,e,o.topic,s);this.metrics?.onReportValidation(o.topic,n)}}}sendGraft(e,r){let i=qt([],{graft:[{topicID:r}]});this.sendRpc(e,i)}async sendPrune(e,r){let n=[await this.makePrune(e,r,this.opts.doPX)],i=qt([],{prune:n});this.sendRpc(e,i)}sendRpc(e,r){let n=this.peers.get(e);if(!n||!n.isWritable)return this.log(`Cannot send RPC to ${e} as there is no open stream to it available`),!1;let i=this.control.get(e);i&&(this.piggybackControl(e,r,i),this.control.delete(e));let s=this.gossip.get(e);s&&(this.piggybackGossip(e,r,s),this.gossip.delete(e));let o=wr.encode(r);return n.write(o),this.metrics?.onRpcSent(r,o.length),!0}piggybackControl(e,r,n){let i=n.graft.filter(({topicID:o})=>(o&&this.mesh.get(o)||new Set).has(e)),s=n.prune.filter(({topicID:o})=>!(o&&this.mesh.get(o)||new Set).has(e));!i.length&&!s.length||(r.control?(r.control.graft=r.control.graft.concat(i),r.control.prune=r.control.prune.concat(s)):r.control={graft:i,prune:s,ihave:[],iwant:[]})}piggybackGossip(e,r,n){r.control||(r.control={ihave:[],iwant:[],graft:[],prune:[]}),r.control.ihave=n}async sendGraftPrune(e,r,n){let i=this.opts.doPX;for(let[s,o]of e){let a=o.map(h=>({topicID:h})),c=[],u=r.get(s);u&&(c=await Promise.all(u.map(async h=>await this.makePrune(s,h,i&&!(n.get(s)??!1)))),r.delete(s));let f=qt([],{graft:a,prune:c});this.sendRpc(s,f)}for(let[s,o]of r){let a=await Promise.all(o.map(async u=>await this.makePrune(s,u,i&&!(n.get(s)??!1)))),c=qt([],{prune:a});this.sendRpc(s,c)}}emitGossip(e){let r=this.mcache.getGossipIDs(new Set(e.keys()));for(let[n,i]of e)this.doEmitGossip(n,i,r.get(n)??[])}doEmitGossip(e,r,n){if(!n.length||(Vt(n),n.length>5e3&&this.log("too many messages for gossip; will truncate IHAVE list (%d messages)",n.length),!r.size))return;let i=this.opts.Dlazy,s=.25*r.size,o=r;s>i&&(i=s),i>o.size?i=o.size:o=Vt(Array.from(o)).slice(0,i),o.forEach(a=>{let c=n;n.length>5e3&&(c=Vt(c.slice()).slice(0,5e3)),this.pushGossip(a,{topicID:e,messageIDs:c})})}flush(){for(let[e,r]of this.gossip.entries())this.gossip.delete(e),this.sendRpc(e,qt([],{ihave:r}));for(let[e,r]of this.control.entries())this.control.delete(e),this.sendRpc(e,qt([],{graft:r.graft,prune:r.prune}))}pushGossip(e,r){this.log("Add gossip to %s",e);let n=this.gossip.get(e)||[];this.gossip.set(e,n.concat(r))}async makePrune(e,r,n){if(this.score.prune(e,r),this.peers.get(e).protocol===Bi)return{topicID:r,peers:[]};let i=BigInt(this.opts.pruneBackoff/1e3);if(!n)return{topicID:r,peers:[],backoff:i};let s=this.getRandomGossipPeers(r,this.opts.prunePeers,a=>a!==e&&this.score.score(a)>=0),o=await Promise.all(Array.from(s).map(async a=>{let c=er(a);return{peerID:c.toBytes(),signedPeerRecord:await this.components.getPeerStore().addressBook.getRawEnvelope(c)}}));return{topicID:r,peers:o,backoff:i}}async heartbeat(){let{D:e,Dlo:r,Dhi:n,Dscore:i,Dout:s,fanoutTTL:o}=this.opts;this.heartbeatTicks++;let a=new Map,c=p=>{let d=a.get(p);return d===void 0&&(d=this.score.score(p),a.set(p,d)),d},u=new Map,f=new Map,h=new Map;this.clearBackoff(),this.peerhave.clear(),this.metrics?.cacheSize.set({cache:"iasked"},this.iasked.size),this.iasked.clear(),this.applyIwantPenalties(),this.heartbeatTicks%this.opts.directConnectTicks===0&&await this.directConnect(),this.fastMsgIdCache?.prune(),this.seenCache.prune(),this.gossipTracer.prune(),this.publishedMessageIds.prune();let l=new Map;this.mesh.forEach((p,d)=>{let m=this.topics.get(d),b=new Set,S=new Set;if(l.set(d,S),m){let w=Vt(Array.from(m)),T=this.backoff.get(d);for(let D of w){let k=this.peers.get(D);if(k&&Os(k.protocol)&&!p.has(D)&&!this.direct.has(D)){let V=c(D);(!T||!T.has(D))&&V>=0&&b.add(D),V>=this.opts.scoreThresholds.gossipThreshold&&S.add(D)}}}let I=(w,T)=>{this.log("HEARTBEAT: Remove mesh link to %s in %s",w,d),this.addBackoff(w,d),p.delete(w),c(w)>=this.opts.scoreThresholds.gossipThreshold&&S.add(w),this.metrics?.onRemoveFromMesh(d,T,1);let D=f.get(w);D?D.push(d):f.set(w,[d])},R=(w,T)=>{this.log("HEARTBEAT: Add mesh link to %s in %s",w,d),this.score.graft(w,d),p.add(w),S.delete(w),this.metrics?.onAddToMesh(d,T,1);let D=u.get(w);D?D.push(d):u.set(w,[d])};if(p.forEach(w=>{let T=c(w);T<0&&(this.log("HEARTBEAT: Prune peer %s with negative score: score=%d, topic=%s",w,T,d),I(w,Hr.BadScore),h.set(w,!0))}),p.size<r){let w=e-p.size;jp(b,w).forEach(D=>{R(D,nr.NotEnough)})}if(p.size>n){let w=Array.from(p);w.sort((D,k)=>c(k)-c(D)),w=w.slice(0,i).concat(Vt(w.slice(i)));let T=0;if(w.slice(0,e).forEach(D=>{this.outbound.get(D)&&T++}),T<s){let D=V=>{let me=w[V];for(let Fe=V;Fe>0;Fe--)w[Fe]=w[Fe-1];w[0]=me};if(T>0){let V=T;for(let me=1;me<e&&V>0;me++)this.outbound.get(w[me])&&(D(me),V--)}let k=e-T;for(let V=e;V<w.length&&k>0;V++)this.outbound.get(w[V])&&(D(V),k--)}w.slice(e).forEach(D=>{I(D,Hr.Excess)})}if(p.size>=r){let w=0;if(p.forEach(T=>{this.outbound.get(T)&&w++}),w<s){let T=s-w;uo(b,T,k=>this.outbound.get(k)===!0).forEach(k=>{R(k,nr.Outbound)})}}if(this.heartbeatTicks%this.opts.opportunisticGraftTicks===0&&p.size>1){let w=Array.from(p).sort((k,V)=>c(k)-c(V)),T=Math.floor(p.size/2),D=c(w[T]);if(D<this.opts.scoreThresholds.opportunisticGraftThreshold){let k=this.opts.opportunisticGraftPeers,V=uo(b,k,me=>c(me)>D);for(let me of V)this.log("HEARTBEAT: Opportunistically graft peer %s on topic %s",me,d),R(me,nr.Opportunistic)}}});let g=Date.now();this.fanoutLastpub.forEach((p,d)=>{p+o<g&&(this.fanout.delete(d),this.fanoutLastpub.delete(d))}),this.fanout.forEach((p,d)=>{let m=this.topics.get(d);p.forEach(R=>{(!m.has(R)||c(R)<this.opts.scoreThresholds.publishThreshold)&&p.delete(R)});let b=this.topics.get(d),S=[],I=new Set;if(l.set(d,I),b){let R=Vt(Array.from(b));for(let w of R){let T=this.peers.get(w);if(T&&Os(T.protocol)&&!p.has(w)&&!this.direct.has(w)){let D=c(w);D>=this.opts.scoreThresholds.publishThreshold&&S.push(w),D>=this.opts.scoreThresholds.gossipThreshold&&I.add(w)}}}if(p.size<e){let R=e-p.size;S.slice(0,R).forEach(w=>{p.add(w),I?.delete(w)})}}),this.emitGossip(l),await this.sendGraftPrune(u,f,h),this.flush(),this.mcache.shift(),this.dispatchEvent(new yt("gossipsub:heartbeat"))}getRandomGossipPeers(e,r,n=()=>!0){let i=this.topics.get(e);if(!i)return new Set;let s=[];return i.forEach(o=>{let a=this.peers.get(o);!a||Os(a.protocol)&&n(o)&&s.push(o)}),s=Vt(s),r>0&&s.length>r&&(s=s.slice(0,r)),new Set(s)}onScrapeMetrics(e){e.mcacheSize.set(this.mcache.size),e.cacheSize.set({cache:"direct"},this.direct.size),e.cacheSize.set({cache:"seenCache"},this.seenCache.size),e.cacheSize.set({cache:"fastMsgIdCache"},this.fastMsgIdCache?.size??0),e.cacheSize.set({cache:"publishedMessageIds"},this.publishedMessageIds.size),e.cacheSize.set({cache:"mcache"},this.mcache.size),e.cacheSize.set({cache:"score"},this.score.size),e.cacheSize.set({cache:"gossipTracer.promises"},this.gossipTracer.size),e.cacheSize.set({cache:"gossipTracer.requests"},this.gossipTracer.requestMsByMsgSize),e.cacheSize.set({cache:"topics"},this.topics.size),e.cacheSize.set({cache:"subscriptions"},this.subscriptions.size),e.cacheSize.set({cache:"mesh"},this.mesh.size),e.cacheSize.set({cache:"fanout"},this.fanout.size),e.cacheSize.set({cache:"peers"},this.peers.size),e.cacheSize.set({cache:"acceptFromWhitelist"},this.acceptFromWhitelist.size),e.cacheSize.set({cache:"gossip"},this.gossip.size),e.cacheSize.set({cache:"control"},this.control.size),e.cacheSize.set({cache:"peerhave"},this.peerhave.size),e.cacheSize.set({cache:"outbound"},this.outbound.size);let r=0;for(let o of this.backoff.values())r+=o.size;e.cacheSize.set({cache:"backoff"},r);for(let[o,a]of this.topics)e.topicPeersCount.set({topicStr:o},a.size);for(let[o,a]of this.mesh)e.meshPeerCounts.set({topicStr:o},a.size);let n=[],i=new Map;e.behaviourPenalty.reset();for(let o of this.peers.keys()){let a=this.score.score(o);n.push(a),i.set(o,a),e.behaviourPenalty.observe(this.score.peerStats.get(o)?.behaviourPenalty??0)}e.registerScores(n,this.opts.scoreThresholds),e.registerScorePerMesh(this.mesh,i);let s=Zp(this.peers.keys(),this.score.peerStats,this.score.params,this.score.peerIPs,e.topicStrToLabel);e.registerScoreWeights(s)}};fo.multicodec=Pn;return nd(iE);})();
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */
/*! noble-ed25519 - MIT License (c) 2019 Paul Miller (paulmillr.com) */
/*! noble-secp256k1 - MIT License (c) 2019 Paul Miller (paulmillr.com) */
return ChainsafeLibp2PGossipsub}));
